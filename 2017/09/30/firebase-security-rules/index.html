<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="原文链接：Firebase Security &amp;amp; Rules

Firebase 是一个可以从任意建立连接了的客户端访问的云数据库。因为任意客户端都可以连接到任意 Firebase [数据库]，你必须制定安全规则来保护你的数据。写不好恰当的安全规则会让你暴露在攻击中。不过别着急！你马上就能学到帮你紧紧锁住你的数据的全部知识了。
保持安全规则简洁。安全规则可能变得过于复杂，并很快变得不受控">
<meta property="og:type" content="article">
<meta property="og:title" content="Firebase 安全与规则">
<meta property="og:url" content="http://chengkang.me/2017/09/30/firebase-security-rules/index.html">
<meta property="og:site_name" content="CHENG KANG">
<meta property="og:description" content="原文链接：Firebase Security &amp;amp; Rules

Firebase 是一个可以从任意建立连接了的客户端访问的云数据库。因为任意客户端都可以连接到任意 Firebase [数据库]，你必须制定安全规则来保护你的数据。写不好恰当的安全规则会让你暴露在攻击中。不过别着急！你马上就能学到帮你紧紧锁住你的数据的全部知识了。
保持安全规则简洁。安全规则可能变得过于复杂，并很快变得不受控">
<meta property="og:updated_time" content="2017-09-30T13:09:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Firebase 安全与规则">
<meta name="twitter:description" content="原文链接：Firebase Security &amp;amp; Rules

Firebase 是一个可以从任意建立连接了的客户端访问的云数据库。因为任意客户端都可以连接到任意 Firebase [数据库]，你必须制定安全规则来保护你的数据。写不好恰当的安全规则会让你暴露在攻击中。不过别着急！你马上就能学到帮你紧紧锁住你的数据的全部知识了。
保持安全规则简洁。安全规则可能变得过于复杂，并很快变得不受控">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Firebase 安全与规则</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-2379838451092125",
        enable_page_level_ads: true
      });
    </script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/index.html">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/cheng-kang">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017/10/14/best-practice-for-firebase-realtime-datebase-development/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li>
        
        
        <li><a class="icon" href="/2017/06/06/learning-av-foundation-1/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://chengkang.me/2017/09/30/firebase-security-rules/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://chengkang.me/2017/09/30/firebase-security-rules/&text=Firebase 安全与规则"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://chengkang.me/2017/09/30/firebase-security-rules/&is_video=false&description=Firebase 安全与规则"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Firebase 安全与规则&body=Check out this article: http://chengkang.me/2017/09/30/firebase-security-rules/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://chengkang.me/2017/09/30/firebase-security-rules/&name=Firebase 安全与规则&description=&lt;blockquote&gt;
&lt;p&gt;原文链接：&lt;a href=&quot;https://howtofirebase.com/firebase-security-rules-88d94606ce4a&quot;&gt;Firebase Security &amp;amp; Rules&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Firebase 是一个可以从任意建立连接了的客户端访问的云数据库。因为任意客户端都可以连接到任意 Firebase [数据库]，你&lt;strong&gt;必须&lt;/strong&gt;制定安全规则来保护你的数据。写不好恰当的安全规则会让你暴露在攻击中。不过别着急！你马上就能学到帮你紧紧锁住你的数据的全部知识了。&lt;/p&gt;
&lt;p&gt;保持安全规则简洁。安全规则可能变得过于复杂，并很快变得不受控制如果你的数据结构不够设计充分的话。这篇文章展示了一些“最佳”实践。估计你会讲其略作修改就用到你的生产应用中去……如果你选择采用这些模式，记得仔细想想背后的含义就行。确保在你开始搞事之前，读了整篇文章以及&lt;a href=&quot;https://firebase.google.com/docs/database/security/&quot;&gt;安全规则文档&lt;/a&gt;全文。&lt;/p&gt;"><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安全规则是基于节点的"><span class="toc-number">1.</span> <span class="toc-text">安全规则是基于节点的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#级联规则"><span class="toc-number">2.</span> <span class="toc-text">级联规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例数据结构"><span class="toc-number">3.</span> <span class="toc-text">示例数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引子键来加快查询"><span class="toc-number">4.</span> <span class="toc-text">索引子键来加快查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#遍历树以获取细节权限"><span class="toc-number">5.</span> <span class="toc-text">遍历树以获取细节权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Bolt-规则编译器来-streamline-你的规则"><span class="toc-number">6.</span> <span class="toc-text">使用 Bolt 规则编译器来 streamline 你的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#根据读写权限来结构化你的数据"><span class="toc-number">7.</span> <span class="toc-text">根据读写权限来结构化你的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#保证安全性的同时验证你的数据"><span class="toc-number">8.</span> <span class="toc-text">保证安全性的同时验证你的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#别名规则"><span class="toc-number">9.</span> <span class="toc-text">别名规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署你的规则"><span class="toc-number">10.</span> <span class="toc-text">部署你的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#练习"><span class="toc-number">11.</span> <span class="toc-text">练习</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Firebase 安全与规则
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">CHENG KANG</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-10-01T04:08:37.000Z" itemprop="datePublished">2017-09-30</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Firebase/">Firebase</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <blockquote>
<p>原文链接：<a href="https://howtofirebase.com/firebase-security-rules-88d94606ce4a" target="_blank" rel="external">Firebase Security &amp; Rules</a></p>
</blockquote>
<p>Firebase 是一个可以从任意建立连接了的客户端访问的云数据库。因为任意客户端都可以连接到任意 Firebase [数据库]，你<strong>必须</strong>制定安全规则来保护你的数据。写不好恰当的安全规则会让你暴露在攻击中。不过别着急！你马上就能学到帮你紧紧锁住你的数据的全部知识了。</p>
<p>保持安全规则简洁。安全规则可能变得过于复杂，并很快变得不受控制如果你的数据结构不够设计充分的话。这篇文章展示了一些“最佳”实践。估计你会讲其略作修改就用到你的生产应用中去……如果你选择采用这些模式，记得仔细想想背后的含义就行。确保在你开始搞事之前，读了整篇文章以及<a href="https://firebase.google.com/docs/database/security/" target="_blank" rel="external">安全规则文档</a>全文。</p>
<a id="more"></a>
<h2 id="安全规则是基于节点的"><a href="#安全规则是基于节点的" class="headerlink" title="安全规则是基于节点的"></a>安全规则是基于节点的</h2><p>安全规则由一个单独的 JSON 对象管理，你可以在你的实时数据库控制台编辑或者使用 Firebase CLI [来编辑]。还有一个额外惊喜，如果你的规则格式错误的话，控制台和 CLI 会给你警告。</p>
<p>规则对象开始是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line"> &quot;rules&quot;: </span><br><span class="line">  &#123; </span><br><span class="line">    &quot;.read&quot;: false,</span><br><span class="line">    &quot;.write&quot;: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 JSON 对象的根节点必须命名为 <code>rules</code>。<code>rules</code> 节点默认不可读写。上面的立即显式地设置了 <code>.read</code> 和 <code>.write</code> 为 <code>false</code>，但是留个空白的规则也会有同样的效果。</p>
<h2 id="级联规则"><a href="#级联规则" class="headerlink" title="级联规则"></a>级联规则</h2><p>Firebase 级联规则是这样的：授予一个父母节点读写权限会同时授予其所有子节点读写权限。</p>
<p>再说一遍。</p>
<p>Firebase 级联规则是这样的：授予一个父母节点读写权限会同时授予其所有子节点读写权限。</p>
<p>这里有个巨大的“坑”，即使是对于有经验的 Firebase 用户来说也是这样。让我们回顾一下为什么 Firebase 这样来处理，以及我们可以如何绕过这个限制。</p>
<p>首先，Firebase 本质上要求这样的一种行为。如果你在 Firebase 里面查询一个节点，你将得到其<em>所有</em>的子节点。Firebase 非常注重性能表现，它不会花时间来在每一个子节点上套用规则并且做出可能的从父母节点移除的动作。那样会大大影响其表现。</p>
<p>第二，你可以通过根据你的权限结构来结构化你的数据以轻易地避免这些级联规则的问题。将你的数据嵌套在这样命名的高级别的节点中，比如 “admin”、“userReadable”、“userWritable” 或者 “userOwned”。将有着类似安全需求的对象分组在高级别节点下会有效地降低你需要维护的安全规则数量。</p>
<p><strong>关于验证规则小窍门：</strong>我们之后会谈到验证规则。验证规则用于阻止用于父母节点写权限的用户写入其子节点。这样的话，当你授予了写权限给 <code>userOwned/preferences/{uid}</code>，你可以编写一条验证规则，比如说 <code>userOwned/preferences/{uid}/isAdmin</code>，这样就可以阻止用户更新 <code>isAdmin</code> 这个子节点。</p>
<p>这种方法会带来一些后果，基本上任何在 <code>userOwned/preferences/{uid}</code> 的 <code>ref.set()</code> 的操作都会失败，因为你不能重写 <code>isAdmin</code> 这个子节点…你需要使用 <code>ref.update()</code> 来单独更新每一个子节点。将 <code>isAdmin</code> 节点移到你的数据结构的其他本就是用户可读不可写的部分会比较轻松。你可以将其命名为 <code>userReadable/preferences/{uid}/isAdmin</code>。</p>
<h2 id="示例数据结构"><a href="#示例数据结构" class="headerlink" title="示例数据结构"></a>示例数据结构</h2><p>我们将使用以下数据结构来继续剩下的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;users&quot;: &#123;</span><br><span class="line">    &quot;kanyesUID&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Kanye West&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;kwest@gmail.com&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;taylorsUID&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Taylor Swift&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;tswift@gmail.com&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;seacrestsUID&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Ryan Seacrest&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;rseacrest@gmail.com&quot;,</span><br><span class="line">      &quot;isAdmin&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;userReadable&quot;: &#123;</span><br><span class="line">    &quot;tweets&quot;: &#123;</span><br><span class="line">      &quot;kanyesUID&quot;: &#123;</span><br><span class="line">        &quot;aPushKey&quot;: &#123;</span><br><span class="line">          &quot;text&quot;: &quot;Imma let you finish, but...&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;bPushKey&quot;: &#123;</span><br><span class="line">          &quot;text&quot;: &quot;Queen B shoulda received this award...&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;retweets&quot;: &#123;</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;cPushKey&quot;: &#123;</span><br><span class="line">          &quot;key&quot;: &quot;aPushKey&quot;,</span><br><span class="line">          &quot;text&quot;: &quot;Imma let you finish, but...&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;dPushKey&quot;: &#123;</span><br><span class="line">          &quot;key&quot;: &quot;bPushKey&quot;,</span><br><span class="line">          &quot;text&quot;: &quot;Queen B shoulda received this award...&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;userWriteable&quot;: &#123;</span><br><span class="line">    &quot;tweetQueue&quot;: &#123;</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;text&quot;: &quot;I 💕 you all like Kanye 💕&apos;s Kanye&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;userOwned&quot;: &#123;</span><br><span class="line">    &quot;preferences&quot;: &#123;</span><br><span class="line">      &quot;kanyesUID&quot;: &#123;</span><br><span class="line">        &quot;loveKanye&quot;: true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;listenToHaters&quot;: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些数据有四个顶级节点：</p>
<ol>
<li>users</li>
<li>userReadable</li>
<li>userWriteable</li>
<li>userOwned</li>
</ol>
<p>我们有两个用户：</p>
<ol>
<li>Kanye West</li>
<li>Taylor Swift</li>
</ol>
<p><code>users</code> 节点包含了基础的用户数据，在这个例子中就是邮箱地址。我们设想当 Kanye 登陆了我们的 app，他的 uid 是 <code>kanyesUID</code>。类似的，Taylor 得到了这个 uid <code>taylorsUID</code>。这些 UID 会组成我们安全模型的基础。</p>
<p>首先，来让每个用户数据<code>用户可读</code>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在根节点 <code>rules</code> 上加了一个 <code>users</code> 节点。任何直接写在 <code>users</code> 节点下面的规则会被应用到所有其子节点中…但是我们并不想在 <code>users</code> 节点上设置规则。我们希望给每一个独立的用户基于其 uid 设置规则，因此我们创建了一个通配节点，<code>$uid</code>。我们可以随意命名通配节点，只要其开始字符是 <code>$</code>。最佳实践是给他们命名一些描述性的东西，因此我们将这个通配节点命名为 <code>$uid</code>，因为每个用户都将保存在其 uid 下。</p>
<p>通配节点应用于所有其他没有明确指出的节点上。有点糊涂了？看看这个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == &apos;taylorsUID&apos;&quot;,</span><br><span class="line">        &quot;.write&quot;: &quot;auth.uid == &apos;taylorsUID&apos;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到我们干了啥吗？我们仅赋予了 <code>$uid</code> 节点 <code>.read</code> 权限，但是我们给了 Taylor 这个用户 <code>.read</code> 和 <code>.write</code> 权限。</p>
<p>你可能在想 <code>auth.uid == $uid</code> 是什么意思。当用户通过 Firebase Authentication 认证成功时，这个用户会从系统获得一个 uid，它可以通过 <code>auth.uid</code> 访问到。因此当 Kanye 在系统中认证时，他的 <code>auth.uid</code> 等于 <code>kanyesUID</code>。我们可以将 <code>auth.uid</code> 和 <code>$uid</code> 比较来授予用户对他们自己节点的读权限，但对其他节点无权限。也可以直接和字符串比较：<code>&quot;.read&quot;: &quot;auth.uid == &#39;taylorsUID&#39;&quot;</code>。</p>
<h2 id="索引子键来加快查询"><a href="#索引子键来加快查询" class="headerlink" title="索引子键来加快查询"></a>索引子键来加快查询</h2><p>设想我们的 app 在进行这样一个查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref.child(&apos;users&apos;).orderByChild(&apos;email&apos;).equalTo(&apos;kwest@gmail.com&apos;).once(&apos;value&apos;, callback);</span><br></pre></td></tr></table></figure>
<p>我们在要求 firebase 来从 <code>users</code> 节点中搜索一个 <code>email</code> 节点为 <code>kwest@gmail.com</code> 的子节点。根据我们数据库的大小，这可能是一个非常巨量且缓慢的查询，因此 Firebase 给我们提供了指定子节点的高性能索引。在这个例子中，我们希望 Firebase 通过 <code>email</code> 这个子节点索引所有用户。做法很简单，<code>&quot;.indexOn&quot;: &quot;email&quot;</code>。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid&quot;,</span><br><span class="line">        &quot;.indexOn&quot;: [</span><br><span class="line">          &quot;email&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们还要索引其他子节点，比如说 <code>users/{$user}/username</code>，我们的规则就这么写 <code>&quot;.indexOn&quot;: [&quot;email&quot;, &quot;username&quot;]</code>。</p>
<h2 id="遍历树以获取细节权限"><a href="#遍历树以获取细节权限" class="headerlink" title="遍历树以获取细节权限"></a>遍历树以获取细节权限</h2><p>让我们将这个设想的类似 twitter 的 app 的第三个用户称为： Ryan Seacrest。Ryan 的账号是管理员账号。注意到了他的用户账号里的 <code>&quot;isAdmin&quot;: true</code> 属性了吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid || root.child(&apos;users&apos;).child(auth.uid).child(&apos;isAdmin&apos;).val() == true&quot;,</span><br><span class="line">        &quot;.write&quot;: &quot;root.child(&apos;users&apos;).child(auth.uid).child(&apos;isAdmin&apos;).val() == true&quot;,</span><br><span class="line">        &quot;.indexOn&quot;: [</span><br><span class="line">          &quot;email&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户们仍然可以读取他们自己的账户数据，不过我们刚刚给所有有 <code>isAdmin</code> 标识的用户赋予了读写权限。用于检测这个标识的规则是 <code>root.child(‘users’).child(auth.uid).child(‘isAdmin’).val()</code>。<code>root</code> 对象代表我们的 Firebase 的根节点。接着我们调用 <code>.child(&#39;nodeName&#39;)</code> 来向下找到我们的认证过的用户的 <code>isAdmin</code> 节点。看到了是怎么使用 <code>auth.uid</code> 来深入到这个认证用户的吗？是，这样做很聪明。它同时也悄悄地让任何没有认证的用户访问失败，这样这些节点就安全了。</p>
<p>还有一点要注意：我们在一个节点上调用 <code>.val()</code> 来获取它的值。这让人想起我们是如何使用 Firebase JavaScript SDK 来处理数据快照，应该看起来很熟悉吧。</p>
<p>另外一点：还有别的遍历树的方式。我们可以调用 <code>data.parent().child(auth.uid).val()</code> 来从我们正在保护的节点往上走到 <code>users</code> 再往下走。这个方法会很实用，但是从 <code>root</code> 开始遍历会更可靠，因为 <code>root</code> 对于我们 app 的任何部分都是一样的。为了安全，还是用 <code>root</code> 吧。</p>
<h2 id="使用-Bolt-规则编译器来-streamline-你的规则"><a href="#使用-Bolt-规则编译器来-streamline-你的规则" class="headerlink" title="使用 Bolt 规则编译器来 streamline 你的规则"></a>使用 Bolt 规则编译器来 streamline 你的规则</h2><p>到目前我们一直在直接修改我们的规则 JSON 对象。这没有问题，但是它可能总是在重复复制粘贴操作。Firebase 团队也已经疲于复制粘贴，于是写了一个和 <a href="https://github.com/firebase/firebase-tools" target="_blank" rel="external">firebase-tools</a> CLI 结合来让规则更容易写的编译器。</p>
<p>你需要通过 <code>npm install -g firebase-bolt</code> 安装 Bolt 并且在你的项目根目录创建一个命名为类似 <code>security-rules.bolt</code> 的文件。然后你可以执行 <code>firebase-bolt sevurity-rules.bolt</code>，它会编译你的 Bolt 规则到一个新的文件并命名为 <code>firebase-rules.json</code>。生成的 JSON 可能会比我们之前写的 JSON 更啰嗦，但是 Bolt 语法很好用精炼。详见 <a href="https://github.com/firebase/bolt/blob/master/docs/language.md" target="_blank" rel="external">Bolt language reference</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function isUser (auth, userKey) &#123;</span><br><span class="line">  return uid == userKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isAdmin (auth) &#123;</span><br><span class="line">  return root.child(&apos;users&apos;).child(auth.uid).child(&apos;isAdmin&apos;).val() == true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /users/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isAdmin(auth) &#125;</span><br><span class="line">  index() &#123; [&quot;email&quot;] &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /userReadable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /userWriteable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /userOwned/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意我们是怎样写在顶部的两个方法的：<code>isUser(auth, uid)</code> 和 <code>isAdmin(auth)</code>。这些方法不是必须的，但是超级有用。它们让我们可以在我们的规则中重用一些逻辑。</p>
<p>下一个部分有一堆 <code>path</code> 块。使用 <code>/[nodeName]/</code> 来通配你的路径。这些通配值在这些 path 的范围内都是可用的，因此你可从 <code>/userReadable/objectType/uid</code> 获取 <code>uid</code>，并传给 <code>read() { isUser(auth, uid) || isAdmin(auth) }</code>。</p>
<h2 id="根据读写权限来结构化你的数据"><a href="#根据读写权限来结构化你的数据" class="headerlink" title="根据读写权限来结构化你的数据"></a>根据读写权限来结构化你的数据</h2><p>你可能注意到了有三个顶级节点被命名为：</p>
<ul>
<li>userReadable</li>
<li>userWriteable</li>
<li>userOwned</li>
</ul>
<p>上一节中我们授予了用户读权限给 <code>userReadable</code> 的子节点、写权限给 <code>userWriteable</code> 的子节点以及完整的读写权限给 <code>userOwned</code> 的子节点。</p>
<p>这是只一个随意的数据结构…我们可以将这三个节点命名为随便什么。不过命名为描述性的名字会更好。接着我们用了通配路径（<code>path/userReadable/objectType/uid</code>）来给一组一组的对象应用规则。</p>
<p>现在我们不需要给我们创建的每一类对象都编写规则。我们只需要将这些对象嵌套在恰当的权限节点下就好了。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;userOwned&quot;: &#123;</span><br><span class="line">      &quot;preferences&quot;: &#123;</span><br><span class="line">        &quot;kanyesUID&quot;: &#123;</span><br><span class="line">          &quot;loveKanye&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;taylorsUID&quot;: &#123;</span><br><span class="line">          &quot;listenToHaters&quot;: false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>userOwned</code> 节点有对所有在匹配的用户 uid 下的对象的读写权限。因此只有 Kanye 可以访问 <code>/userOwned/preferences/kanyesUID</code>，并且 Kanye 有完整的读写权限。</p>
<p>要记得我们可以通过制定另一条匹配路径规则来重写统配规则，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">path /userOwned/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line"> read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line">path /userOwned/grammyNominations/taylorsUID &#123;</span><br><span class="line">  read() &#123; true &#125;</span><br><span class="line">  write() &#123; uid == kanyesUID &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二条规则重写了 <code>/userOwned/{objectType}/uid</code> 并仅授予 Kanye 对于 Taylor’s Grammy Nominations 的写权限。同时也让这个列表全世界可读，因此任何网站或者用户都可以通过 <code>https://&lt;some firebase&gt;.firebaseio.com/userOwned/grammyNominations/taylorsUID.json</code> 来获取这个列表。</p>
<h2 id="保证安全性的同时验证你的数据"><a href="#保证安全性的同时验证你的数据" class="headerlink" title="保证安全性的同时验证你的数据"></a>保证安全性的同时验证你的数据</h2><p><code>read()</code>、<code>write()</code> 以及 <code>index()</code> 覆盖了大多数使用情况，但有时候你可能需要更多对于要写入的数据的更细节的控制。</p>
<p>Bolt 允许你创建可以在多节点间重用的数据类型。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path /userOwned/preferences/&#123;uid&#125; is Preferences;</span><br><span class="line">type Preferences &#123;</span><br><span class="line"> validate() &#123; this.excuse.length &lt; 20 &amp;&amp; this.respectRating &lt; 5 &#125;</span><br><span class="line">  useAutotune: Boolean,</span><br><span class="line">  excuse: String,</span><br><span class="line">  respectRating: Number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>请注意，我们可以将验证规则和 <code>validate()</code> 混合在一起。</p>
<p>你也可以将类型和读写权限混合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">path /userOwned/preferences/&#123;uid&#125; is Preferences &#123;</span><br><span class="line"> read() &#123; isUser(auth, uid) &#125;</span><br><span class="line"> write() &#123; isUser(auth, uid) &#125;</span><br><span class="line">&#125;</span><br><span class="line">type Preferences &#123;</span><br><span class="line">  validate() &#123; this.excuse.length &lt; 20 &amp;&amp; this.respectRating &lt; 5 &#125;</span><br><span class="line">  useAutotune: Boolean,</span><br><span class="line">  excuse: String,</span><br><span class="line">  respectRating: Number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="别名规则"><a href="#别名规则" class="headerlink" title="别名规则"></a>别名规则</h2><p>目前为止我们仅仅使用了 <code>read()</code>、<code>write()</code>、<code>index()</code> 和 <code>validate()</code>，但是 Bolt 支持其它三个功能：</p>
<ul>
<li>create()</li>
<li>update()</li>
<li>delete()</li>
</ul>
<p>这些方法都是 <code>write()</code> 的别名，因此他们不能和 <code>write()</code> 一起混合到同一个 <code>path</code> 块。它们创建了分别仅适用于新建、更新或者删除操作的 <code>write()</code> 规则。下面的示例是如果你想要给用户权限创建对象但是不能编辑或者删除，<code>create()</code> 会生成处理这种情况的 <code>write()</code> 规则。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">path /dropbox/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line"> create() &#123; isUser(auth, uid) &#125;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">path /editable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  update() &#123; isUser(auth, uid) &#125;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">path /deleteable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  delete() &#123; isUser(auth, uid) &#125;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="部署你的规则"><a href="#部署你的规则" class="headerlink" title="部署你的规则"></a>部署你的规则</h2><p>有两种方式：</p>
<ol>
<li>执行 <code>firebase-bolt my-rules-file.bolt</code> 来创建 <code>my-rules-files.json</code>，然后你可以复制粘贴到你的实时数据库规则控制台。</li>
<li>执行 <code>firebase-tools init</code> 来创建你的 <code>firebase.json</code> 托管文件，然后在 <code>database.rules</code> 创建一个节点来指向你的 <code>.bolt</code> 或者 ‘.json’ 规则文件。接着运行 <code>firebase deploy --only rules</code> 来通过命令行部署你的规则。</li>
</ol>
<p>我们稍后会谈到 <code>firebase.json</code> 这个选项。现在，看看下面这个 <code>firebase.sjon</code> 例子并且留意 <code>database.rules</code> 这个节点。它指向了一个记录了我的 bolt 规则的叫做 <code>database.rules.bolt</code> 的文件。如果这个文件被命名为 <code>database.rules.json</code>，firebase 会知道我的规则是 JSON 格式，不过因为我命名了为 <code>.bolt</code>，它会在上传其到我的 Firebase 云上之前自动将其传给 <code>firebase-bolt</code> 编译器进行编译。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Eample firebase.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;database&quot;: &#123;</span><br><span class="line">    &quot;rules&quot;: &quot;database.rules.bolt&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hosting&quot;: &#123;</span><br><span class="line">    &quot;public&quot;: &quot;dist&quot;,</span><br><span class="line">    &quot;rewrites&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;source&quot;: &quot;/app/**/*&quot;,</span><br><span class="line">        &quot;destination&quot;: &quot;/index.html&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;ignore&quot;: [</span><br><span class="line">      &quot;firebase.json&quot;,</span><br><span class="line">      &quot;**/.*&quot;,</span><br><span class="line">      &quot;**/node_modules/**&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;functions&quot;: &#123;</span><br><span class="line">    &quot;.source&quot;: &quot;functions&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>差不多就这样了。</p>
<p>具体练习见原文吧 ：D。</p>

  </div>
  <script type="text/javascript">
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'http://7u2sl0.com1.z0.glb.clouddn.com/dbfmplayer.js';
    (d.head || d.body).appendChild(s);
    })();
  </script>
</article>

<div class="blog-post-comments">
  <div class="wildfire_thread"></div>
</div>


    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/index.html">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/cheng-kang">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#安全规则是基于节点的"><span class="toc-number">1.</span> <span class="toc-text">安全规则是基于节点的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#级联规则"><span class="toc-number">2.</span> <span class="toc-text">级联规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例数据结构"><span class="toc-number">3.</span> <span class="toc-text">示例数据结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#索引子键来加快查询"><span class="toc-number">4.</span> <span class="toc-text">索引子键来加快查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#遍历树以获取细节权限"><span class="toc-number">5.</span> <span class="toc-text">遍历树以获取细节权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Bolt-规则编译器来-streamline-你的规则"><span class="toc-number">6.</span> <span class="toc-text">使用 Bolt 规则编译器来 streamline 你的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#根据读写权限来结构化你的数据"><span class="toc-number">7.</span> <span class="toc-text">根据读写权限来结构化你的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#保证安全性的同时验证你的数据"><span class="toc-number">8.</span> <span class="toc-text">保证安全性的同时验证你的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#别名规则"><span class="toc-number">9.</span> <span class="toc-text">别名规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署你的规则"><span class="toc-number">10.</span> <span class="toc-text">部署你的规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#练习"><span class="toc-number">11.</span> <span class="toc-text">练习</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://chengkang.me/2017/09/30/firebase-security-rules/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://chengkang.me/2017/09/30/firebase-security-rules/&text=Firebase 安全与规则"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://chengkang.me/2017/09/30/firebase-security-rules/&is_video=false&description=Firebase 安全与规则"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Firebase 安全与规则&body=Check out this article: http://chengkang.me/2017/09/30/firebase-security-rules/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://chengkang.me/2017/09/30/firebase-security-rules/&title=Firebase 安全与规则"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://chengkang.me/2017/09/30/firebase-security-rules/&name=Firebase 安全与规则&description=&lt;blockquote&gt;
&lt;p&gt;原文链接：&lt;a href=&quot;https://howtofirebase.com/firebase-security-rules-88d94606ce4a&quot;&gt;Firebase Security &amp;amp; Rules&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Firebase 是一个可以从任意建立连接了的客户端访问的云数据库。因为任意客户端都可以连接到任意 Firebase [数据库]，你&lt;strong&gt;必须&lt;/strong&gt;制定安全规则来保护你的数据。写不好恰当的安全规则会让你暴露在攻击中。不过别着急！你马上就能学到帮你紧紧锁住你的数据的全部知识了。&lt;/p&gt;
&lt;p&gt;保持安全规则简洁。安全规则可能变得过于复杂，并很快变得不受控制如果你的数据结构不够设计充分的话。这篇文章展示了一些“最佳”实践。估计你会讲其略作修改就用到你的生产应用中去……如果你选择采用这些模式，记得仔细想想背后的含义就行。确保在你开始搞事之前，读了整篇文章以及&lt;a href=&quot;https://firebase.google.com/docs/database/security/&quot;&gt;安全规则文档&lt;/a&gt;全文。&lt;/p&gt;"><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 程康·CHENGKANG
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/index.html">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/cheng-kang">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>
    <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-75274957-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


<script>
  var wildfireConfig = () => ({
    databaseProvider: 'firebase',
    databaseConfig: {
        apiKey: "AIzaSyA58LRgGkScdEvlJ4UGw5pmq0BI6C_jum0",
        authDomain: "aggregator-d4b86.firebaseapp.com",
        databaseURL: "https://aggregator-d4b86.firebaseio.com",
        projectId: "aggregator-d4b86",
        storageBucket: "aggregator-d4b86.appspot.com",
        messagingSenderId: "293195558013"
    },
    theme: 'dark',
    locale: 'zh-CN',
    defaultAvatarURL: 'https://image.flaticon.com/icons/svg/621/621863.svg'
  })
</script>
<script src="https://unpkg.com/wildfire-dev@0.5.0/dist/wildfire.auto.js"></script>

</body>
</html>
