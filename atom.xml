<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CHENG KANG</title>
  <subtitle>Hello World Anyway</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://chengkang.me/"/>
  <updated>2017-12-27T00:36:13.378Z</updated>
  <id>http://chengkang.me/</id>
  
  <author>
    <name>ç¨‹åº·Â·CHENGKANG</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Introduction to Wildfire</title>
    <link href="http://chengkang.me/2017/12/19/introduction-to-wildfire/"/>
    <id>http://chengkang.me/2017/12/19/introduction-to-wildfire/</id>
    <published>2017-12-19T00:34:07.000Z</published>
    <updated>2017-12-27T00:36:13.378Z</updated>
    
    <content type="html"><![CDATA[<p align="center"><br><a href="https://www.npmjs.com/wildfire" target="_blank" rel="external"><img src="https://img.shields.io/npm/v/wildfire.svg?style=flat-square" alt=""></a><br></p>

<blockquote>
<p>A drop-in replacement for other comment systems.</p>
</blockquote>
<p><img src="https://cdn.rawgit.com/cheng-kang/wildfire/7d609949/resources/screenshots/home-page.png" alt=""></p>
<p><strong>Please visit the brand new <a href="https://wildfire.js.org" target="_blank" rel="external">Wildfire Home Page</a> (<a href="https://wildfire.js.org" target="_blank" rel="external">https://wildfire.js.org</a>). Detailed documentation is available.</strong></p>
<p><strong>Started using <code>wildfire</code>? Share your website with others: <a href="https://github.com/cheng-kang/wildfire/issues/9" target="_blank" rel="external">We are using Wildfire! </a>!</strong></p>
<p><strong>å…¨æ–°çš„ <a href="https://wildfire.js.org/#/zh-cn/" target="_blank" rel="external">Wildfire ä¸»é¡µ</a> (<a href="https://wildfire.js.org/#/zh-cn/" target="_blank" rel="external">https://wildfire.js.org/#/zh-cn/</a>) å·²ç»å¯ç”¨äº†ï¼Œå¿«å»é‚£å„¿çœ‹çœ‹è¯¦ç»†çš„æ–‡æ¡£å§ã€‚</strong></p>
<p><em>ç‚¹æ­¤æŸ¥çœ‹ <a href="https://github.com/cheng-kang/wildfire/blob/master/README-ZH.md" target="_blank" rel="external">ä¸­æ–‡ç‰ˆ README.md</a>ã€‚</em></p>
<a id="more"></a>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p><code>wildfire</code> aims to be an <strong>it-just-works</strong> comment system for personal websites, like your <code>Hexo</code> blogs. It takes advantage of free real-time databases (<a href="https://firebase.google.com" target="_blank" rel="external">Firebase</a> and <a href="https://wilddog.com" target="_blank" rel="external">Wilddog</a>) to store your comments data, and provide you real-time communicating experience.</p>
<p>Continue reading <a href="https://wildfire.js.org/#/preface" target="_blank" rel="external">Get Started</a>, and start your journey with <code>wildfire</code>!</p>
<blockquote>
<p>If you are using <code>Wildfire</code>, please share your website here: <a href="https://github.com/cheng-kang/wildfire/issues/9" target="_blank" rel="external">We are using Wildfire!</a> :-D.</p>
</blockquote>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p><strong>For site owners:</strong></p>
<ul>
<li>Database Support: <ul>
<li><a href="https://firebase.google.com/" target="_blank" rel="external">Firebase</a></li>
<li><a href="https://www.wilddog.com/" target="_blank" rel="external">Wilddog</a>.</li>
</ul>
</li>
<li>Admin Function: <ul>
<li>Delete comment</li>
<li>Ban users by their IP/email</li>
<li><a href="admin-helpers.md#_1-reset-discussion-count-for-all-pages">Reset discussion count of all pages</a></li>
<li><a href="get-discussion-count.md">Get discussion count</a></li>
</ul>
</li>
</ul>
<p><strong>For all visitors (anonymous &amp; authorized):</strong></p>
<ul>
<li>Comment (with <code>Markdown</code> support)</li>
<li>Mention (@username)</li>
</ul>
<p><strong>For authorized visitors:</strong></p>
<ul>
<li>Like/dislike a comment</li>
<li>Delete own comments</li>
<li>Report inappropriate comments</li>
<li>Update user profile<ul>
<li>Display name</li>
<li>Avatar</li>
</ul>
</li>
<li>Personal Center:<ul>
<li>Notification</li>
</ul>
</li>
</ul>
<h2 id="Showcase"><a href="#Showcase" class="headerlink" title="Showcase"></a>Showcase</h2><p>A live <code>wildfire</code> is at the bottom of this page.</p>
<p>For more showcases, check this Wiki page: <a href="https://github.com/cheng-kang/wildfire/wiki/1.-%E8%BF%99%E4%BA%9B%E7%BD%91%E7%AB%99%E6%AD%A3%E5%9C%A8%E4%BD%BF%E7%94%A8-Wildfire-%E9%87%8E%E7%81%AB%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F%EF%BC%81" target="_blank" rel="external">Who is using Wildfire?</a>.</p>
<h2 id="Donation"><a href="#Donation" class="headerlink" title="Donation"></a>Donation</h2><p>Buy us a cup of tea if you think <code>wildfire</code> does work! </p>
<blockquote>
<p>B.t.w., donâ€™t worry, the donation will be shared with <a href="http://maliao.cn" target="_blank" rel="external">@mrliao</a> ;-D.</p>
</blockquote>
<h4 id="Paypal-Me"><a href="#Paypal-Me" class="headerlink" title="- Paypal Me"></a>- Paypal Me</h4><p align="center"><br>  <a href="https://www.paypal.me/chengkang" target="_blank"><img src="https://cdn.rawgit.com/cheng-kang/wildfire/5f5ee7b5/resources/donate/paypal-me.png" width="320"></a><br></p>

<h4 id="Alipay-amp-Wechat"><a href="#Alipay-amp-Wechat" class="headerlink" title="- Alipay &amp; Wechat"></a>- Alipay &amp; Wechat</h4><p align="center"><br>  <img src="https://cdn.rawgit.com/cheng-kang/wildfire/5f5ee7b5/resources/donate/alipay.jpg" width="160"><br>  <img src="https://cdn.rawgit.com/cheng-kang/wildfire/5f5ee7b5/resources/donate/wechat.jpg" width="160"><br> </p>

<p>We appreciate your kindness!</p>
<h2 id="License"><a href="#License" class="headerlink" title="License"></a>License</h2><p><a href="https://github.com/cheng-kang/wildfire/blob/master/LICENSE" target="_blank" rel="external">GNU General Public License v3.0</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p align=center&gt;&lt;br&gt;&lt;a href=&quot;https://www.npmjs.com/wildfire&quot;&gt;&lt;img src=&quot;https://img.shields.io/npm/v/wildfire.svg?style=flat-square&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;A drop-in replacement for other comment systems.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://cdn.rawgit.com/cheng-kang/wildfire/7d609949/resources/screenshots/home-page.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Please visit the brand new &lt;a href=&quot;https://wildfire.js.org&quot;&gt;Wildfire Home Page&lt;/a&gt; (&lt;a href=&quot;https://wildfire.js.org&quot;&gt;https://wildfire.js.org&lt;/a&gt;). Detailed documentation is available.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Started using &lt;code&gt;wildfire&lt;/code&gt;? Share your website with others: &lt;a href=&quot;https://github.com/cheng-kang/wildfire/issues/9&quot;&gt;We are using Wildfire! &lt;/a&gt;!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…¨æ–°çš„ &lt;a href=&quot;https://wildfire.js.org/#/zh-cn/&quot;&gt;Wildfire ä¸»é¡µ&lt;/a&gt; (&lt;a href=&quot;https://wildfire.js.org/#/zh-cn/&quot;&gt;https://wildfire.js.org/#/zh-cn/&lt;/a&gt;) å·²ç»å¯ç”¨äº†ï¼Œå¿«å»é‚£å„¿çœ‹çœ‹è¯¦ç»†çš„æ–‡æ¡£å§ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ç‚¹æ­¤æŸ¥çœ‹ &lt;a href=&quot;https://github.com/cheng-kang/wildfire/blob/master/README-ZH.md&quot;&gt;ä¸­æ–‡ç‰ˆ README.md&lt;/a&gt;ã€‚&lt;/em&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="wildfire" scheme="http://chengkang.me/tags/wildfire/"/>
    
      <category term="comment system" scheme="http://chengkang.me/tags/comment-system/"/>
    
      <category term="firebase" scheme="http://chengkang.me/tags/firebase/"/>
    
      <category term="wilddog" scheme="http://chengkang.me/tags/wilddog/"/>
    
      <category term="hexo" scheme="http://chengkang.me/tags/hexo/"/>
    
      <category term="vue" scheme="http://chengkang.me/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>Firebase å®æ—¶æ•°æ®åº“å¼€å‘æœ€ä½³å®è·µ</title>
    <link href="http://chengkang.me/2017/10/14/best-practice-for-firebase-realtime-datebase-development/"/>
    <id>http://chengkang.me/2017/10/14/best-practice-for-firebase-realtime-datebase-development/</id>
    <published>2017-10-14T07:43:51.000Z</published>
    <updated>2017-10-14T15:44:41.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://medium.com/@CodeAndBiscuits/best-practices-for-firebase-realtime-database-development-14e8fd133d44" target="_blank" rel="external">Best Practices for Firebase Realtime Database Development</a></p>
<p>æ­¤æ–‡éå…¨æ–‡ç¿»è¯‘ï¼Œä¸€äº›å¯ä»¥çœç•¥çš„è¯å°±çœç•¥æ‰äº†ã€‚</p>
</blockquote>
<h2 id="è¯»æ–‡æ¡£ï¼"><a href="#è¯»æ–‡æ¡£ï¼" class="headerlink" title="è¯»æ–‡æ¡£ï¼"></a>è¯»æ–‡æ¡£ï¼</h2><p>Firebase çš„æ–‡æ¡£å’Œç¤ºä¾‹éƒ½éå¸¸å‹å¥½æ˜“æ‡‚ã€‚æœ‰é—®é¢˜æ‰¾æ–‡æ¡£ã€‚æœ‰ç©ºçš„è¯è¯·é€šè¯»å…¨æ–‡ã€‚</p>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åšå®¢ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­å‡ ç¯‡å¯¹æˆ‘ä»¬å¾ˆé‡è¦çš„æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://firebase.googleblog.com/2016/10/group-security-in-firebase-database.html" target="_blank" rel="external">Group Security in the Firebase Database</a></li>
<li><a href="https://firebase.googleblog.com/2013/10/queries-part-1-common-sql-queries.html" target="_blank" rel="external">Queries, Part 1: Common SQL Queries Converted for Firebase</a></li>
<li><a href="https://firebase.googleblog.com/2014/04/best-practices-arrays-in-firebase.html" target="_blank" rel="external">Best Practices: Arrays in Firebase</a></li>
</ul>
<h2 id="æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼"><a href="#æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼" class="headerlink" title="æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼"></a>æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼</h2><p>æœ‰ä¸€ä¸ªæ™®éçš„è¯¯è§£æ˜¯é¢å‘æ–‡æ¡£çš„æ•°æ®åº“å¯¹äºæ•°æ®ç»“æ„ä¸é‡è§†ã€‚æ°æ°ç›¸åï¼Œ<strong>å®ƒä»¬æ›´éœ€è¦æ³¨æ„æ•°æ®ç»“æ„</strong>ã€‚</p>
<p>å¥½çš„è§„åˆ’èƒ½è®©æ‰€æœ‰çš„è½¯ä»¶ç»„ä»¶éƒ½æœ‰æœ€å¥½çš„æ€§èƒ½ï¼Œè¿™å·²ç»æ²¡å•¥å¯å¤šè¯´çš„äº†ã€‚ä¸è¿‡åœ¨ SQL æ•°æ®åº“ä¸­ï¼Œé€šå¸¸æ˜¯é€šè¿‡ <code>joining more tables</code>ã€<code>doing sub-queries</code> æˆ–è€… <code>doing bulk data updates</code> æ¥ä¿®å¤è§„åˆ’ä¸­çš„é”™è¯¯ã€‚ç”±äº Firebase ä¸­å¹¶ä¸å­˜åœ¨è¿™äº›æ¦‚å¿µï¼Œå› æ­¤è¿˜æ˜¯èŠ±äº›æ—¶é—´æ¥è®¾è®¡ä½ çš„æ•°æ®æ¨¡å‹å¹¶æå‰å¤„ç†å¥½è¿™äº›é—®é¢˜ã€‚ä½ ä¼šåº†å¹¸è‡ªå·±è¿™ä¹ˆåšäº†çš„ã€‚</p>
<p>è¿˜æœ‰å•Šï¼Œè®°å¾—è¯»æ–‡æ¡£ã€‚</p>
<a id="more"></a>
<h2 id="Ref-å’Œç®€å•çš„æŸ¥è¯¢éƒ½å¾ˆâ€œå»‰ä»·â€"><a href="#Ref-å’Œç®€å•çš„æŸ¥è¯¢éƒ½å¾ˆâ€œå»‰ä»·â€" class="headerlink" title="Ref å’Œç®€å•çš„æŸ¥è¯¢éƒ½å¾ˆâ€œå»‰ä»·â€"></a>Ref å’Œç®€å•çš„æŸ¥è¯¢éƒ½å¾ˆâ€œå»‰ä»·â€</h2><p>åœ¨ Firebase ä¸­ï¼Œä¸€ä¸ª â€œrefâ€ å°±åƒä¸€ä¸ªå¯¹æ•°æ®çš„æŒ‡é’ˆã€‚ä½ å¯èƒ½æœ¬èƒ½åœ°å°±åƒå°†å…¶ç¼“å­˜æˆ–è€…ç”¨å…¶ä»–æ–¹å¼ç®¡ç†å¥½å®ƒä»¬ï¼Œä½†æ˜¯åœ¨ç°æœ‰çš„ Firebase å®¢æˆ·ç«¯åº“ä¸­ä½ æ²¡å¿…è¦è¿™ä¹ˆåšã€‚å®ƒä»¬ä»…ä»…å°±æ˜¯å¯¹æ•°æ®å¯¹è±¡çš„ URL å¼•ç”¨çš„åŒ…è£…è€Œå·²ï¼Œå¹¶ä¸”å…¶æä¾›çš„äº‹ä»¶å›è°ƒæ¯ä¸ªç›‘å¬å™¨ä¹Ÿåªèƒ½è®¿é—®ä¸€æ¬¡ã€‚å¦‚æœä½ éœ€è¦åœ¨ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œå°±ç”¨ä¸¤ä¸ª ref å»å¼•ç”¨ã€‚æ ¹æœ¬æ²¡æœ‰é¢å¤–â€œèŠ±é”€â€å“¦ã€‚</p>
<p>æ•°æ®æŸ¥è¯¢ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ä» SQL æ•°æ®åº“è½¬è¿‡æ¥çš„å‡è´§å·²ç»ä¹ æƒ¯äº†ç”¨å°½å¯èƒ½å°‘çš„æŸ¥è¯¢è¯­å¥æ¥æŸ¥è¯¢æ›´å¤šçš„å¯¹è±¡ä»¥å‡å°‘æ¥å›çš„æ—¶é—´ã€æŸ¥è¯¢æˆæœ¬ã€‚åœ¨æ‰å¹³åŒ–æ•°æ®ç»“æ„é‡Œæ¥è¯´ï¼Œå°±æ˜¯æŠŠä¸€äº›æ•°æ®å¤åˆ¶åˆ°å¤šä¸ªä½ç½®ä»¥è¾¾åˆ°ä¸€æ¬¡è¯·æ±‚è·å–åˆ°æ‰€æœ‰æ‰€éœ€æ•°æ®çš„ç›®çš„ã€‚</p>
<p>åœ¨ Firebase ä¸­ï¼Œè¿™æ ·å°±å¤§é”™ç‰¹é”™äº†ã€‚ä¸€æ˜¯åŸºäº key/ref çš„æŸ¥è¯¢è¢«éå¸¸å¥½åœ°ä¼˜åŒ–è¿‡äº†ï¼Œå¹¶ä¸” Firebase ä¸ºå…¶æä¾›äº†å¤§è§„æ¨¡çš„æ¨ªå‘æ‰©å±•ã€‚æˆ‘ä»¬åœ¨æ€§èƒ½æµ‹è¯•ä¸­å‘ç°ï¼ŒFirebase åœ¨æœ‰æ›´å¤šå°å‹æ•°æ®æŸ¥è¯¢æ—¶æ€§èƒ½æ›´å¥½ã€‚å³ä½¿æ˜¯ç§»é™¤ä¸€äº›ä¸å¿…è¦çš„æŸ¥è¯¢å­—æ®µéƒ½å¯ä»¥å¸¦æ¥å¯è§‚çš„æ€§èƒ½æå‡ã€‚</p>
<p>Firebase çš„å¤§è§„æ¨¡æ¨ªå‘å¯æ‰©å±•æ€§æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ã€‚å®ƒä¸æ˜¯ä»…ä»…â€œæœ‰å¾ˆå¥½â€ã€‚å®ƒåº”è¯¥ä½œä¸ºä½  app è®¾è®¡ä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ã€‚</p>
<h2 id="é¿å…æ•°ç»„"><a href="#é¿å…æ•°ç»„" class="headerlink" title="é¿å…æ•°ç»„"></a>é¿å…æ•°ç»„</h2><p>Firebase æ–‡æ¡£é‡Œé¢å·²ç»æåˆ°äº†è¿™ä¸ªè¯é¢˜ã€‚å®Œå…¨æ­£ç¡®ã€‚è¯·é¿å…å®ƒä»¬ã€‚</p>
<h2 id="Firebase-æ²¡æœ‰æ—¶é—´æ•°æ®ç±»å‹"><a href="#Firebase-æ²¡æœ‰æ—¶é—´æ•°æ®ç±»å‹" class="headerlink" title="Firebase æ²¡æœ‰æ—¶é—´æ•°æ®ç±»å‹"></a>Firebase æ²¡æœ‰æ—¶é—´æ•°æ®ç±»å‹</h2><p>Firebase æ²¡æœ‰æ—¶é—´æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”ä¸æ”¯æŒå€’åºæ’åºã€‚ä½ å¯ä»¥è‡ªå·±å°†æ—¶é—´è½¬æ¢æˆæ—¶é—´æˆ³ä»¥æ•°å­—å½¢å¼å­˜æ”¾ï¼Œå¹¶ä¸”å°†å…¶è´Ÿæ•°ä½œä¸ºæ’åºæ ‡è¯†ä¸€åŒå­˜å‚¨ã€‚åˆ©ç”¨è¿™ä¸ªæ’åºæ ‡è¯†å€¼å¯ä»¥å®ç°å€’åºæŸ¥è¯¢ã€‚</p>
<h2 id="å®ƒå¹¶ä¸æ˜¯ä¸‡èƒ½çš„"><a href="#å®ƒå¹¶ä¸æ˜¯ä¸‡èƒ½çš„" class="headerlink" title="å®ƒå¹¶ä¸æ˜¯ä¸‡èƒ½çš„"></a>å®ƒå¹¶ä¸æ˜¯ä¸‡èƒ½çš„</h2><p>å¥½å¥½åˆ©ç”¨ Firebase çš„é•¿å¤„ã€‚ä¸è¦ç”¨å®ƒå»è§£å†³æ¯ä¸€ä¸ªé—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº› Firebase ä¸èƒ½åšçš„ï¼š</p>
<ul>
<li>ä½œä¸ºæœç´¢å¼•æ“ã€‚å®ƒæœ‰ä¸€äº›åŸºæœ¬çš„æ“ä½œæ¯”å¦‚å‰ç¼€åŒ¹é…ï¼Œä½†ä¹Ÿå°±è¿™äº›äº†ã€‚å¦‚æœä½ éœ€è¦å…¨åŠŸèƒ½çš„æœç´¢ï¼Œå»ç”¨ ELKï¼ŒAlgolia ç­‰ç­‰å§ã€‚</li>
<li>ä½œä¸º API æ ˆã€‚Firebase çš„ Cloud Functions çœ‹èµ·æ¥å¾ˆæ£’ï¼Œä½†å®ƒè¿˜å¤„äº Beta æ—¶æœŸã€‚å¦‚æœä½ çš„ app æ¯” to-do list åº”ç”¨å¤æ‚çš„è¯ï¼Œè¿˜æ˜¯è§„åˆ’è§„åˆ’å¦‚ä½•åšæœåŠ¡å™¨ç«¯çš„å¯ä¿¡ä»»ä»£ç æ‰§è¡Œå§ã€‚</li>
<li>A reporting engine. You may still want to leverage a relational database when you need to slice/dice/filter/mutate/munge/etc your data.</li>
<li>ç”¨äºå…¨ç¦»çº¿åº”ç”¨ã€‚å®ƒæä¾›äº†ç¦»çº¿åŠŸèƒ½ï¼Œä½†å§‹ç»ˆè¿˜æ˜¯éœ€è¦å…ˆè¿ä¸Šäº‘ã€‚</li>
</ul>
<h2 id="Set-è¿˜æ˜¯-Update"><a href="#Set-è¿˜æ˜¯-Update" class="headerlink" title="Set è¿˜æ˜¯ Update"></a>Set è¿˜æ˜¯ Update</h2><p>SET å’Œ UPDATE ä¹‹é—´å­˜åœ¨ç€å·¨å¤§çš„å·®åˆ«ã€‚å®ƒå½±å“ç€å¦‚æœ key è¿˜ä¸å­˜åœ¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œç‰¹åˆ«æ˜¯åœ¨å¤æ‚å¯¹è±¡é‡Œé¢çš„ keyã€‚è¯·åŠ¡å¿…ç•™æ„ã€‚</p>
<h2 id="FirebaseUI-è¶…çº§æ£’ï¼"><a href="#FirebaseUI-è¶…çº§æ£’ï¼" class="headerlink" title="FirebaseUI è¶…çº§æ£’ï¼"></a>FirebaseUI è¶…çº§æ£’ï¼</h2><p>å™¢ï¼Œæˆ‘å¿…é¡»è¦æåˆ°ï¼Œé’ˆå¯¹å„ä¸ªå¹³å°éƒ½æœ‰ä¸€äº› FirebaseUI åŒç±»çš„é¡¹ç›®ã€‚å®ƒä»¬å¯¹äºå»ºç«‹ä¸€ä¸ªå±•ç¤º Firebase æ•°æ®é›†ä¸­çš„å¯¹è±¡åˆ—è¡¨çš„è¡¨æ ¼çœŸæ˜¯å¥½ç”¨åˆ°çˆ†ã€‚</p>
<p>å»äº†è§£ä¸€ä¸‹ FirebaseUI å§ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://medium.com/@CodeAndBiscuits/best-practices-for-firebase-realtime-database-development-14e8fd133d44&quot;&gt;Best Practices for Firebase Realtime Database Development&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ­¤æ–‡éå…¨æ–‡ç¿»è¯‘ï¼Œä¸€äº›å¯ä»¥çœç•¥çš„è¯å°±çœç•¥æ‰äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;è¯»æ–‡æ¡£ï¼&quot;&gt;&lt;a href=&quot;#è¯»æ–‡æ¡£ï¼&quot; class=&quot;headerlink&quot; title=&quot;è¯»æ–‡æ¡£ï¼&quot;&gt;&lt;/a&gt;è¯»æ–‡æ¡£ï¼&lt;/h2&gt;&lt;p&gt;Firebase çš„æ–‡æ¡£å’Œç¤ºä¾‹éƒ½éå¸¸å‹å¥½æ˜“æ‡‚ã€‚æœ‰é—®é¢˜æ‰¾æ–‡æ¡£ã€‚æœ‰ç©ºçš„è¯è¯·é€šè¯»å…¨æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿˜æœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åšå®¢ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­å‡ ç¯‡å¯¹æˆ‘ä»¬å¾ˆé‡è¦çš„æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.googleblog.com/2016/10/group-security-in-firebase-database.html&quot;&gt;Group Security in the Firebase Database&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.googleblog.com/2013/10/queries-part-1-common-sql-queries.html&quot;&gt;Queries, Part 1: Common SQL Queries Converted for Firebase&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://firebase.googleblog.com/2014/04/best-practices-arrays-in-firebase.html&quot;&gt;Best Practices: Arrays in Firebase&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼&quot;&gt;&lt;a href=&quot;#æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼&quot; class=&quot;headerlink&quot; title=&quot;æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼&quot;&gt;&lt;/a&gt;æ¨è®ºï¼šâ€æ— æ¨¡å¼â€ï¼ˆschema-lessï¼‰ä¸æ„å‘³ç€æ— è„‘ï¼&lt;/h2&gt;&lt;p&gt;æœ‰ä¸€ä¸ªæ™®éçš„è¯¯è§£æ˜¯é¢å‘æ–‡æ¡£çš„æ•°æ®åº“å¯¹äºæ•°æ®ç»“æ„ä¸é‡è§†ã€‚æ°æ°ç›¸åï¼Œ&lt;strong&gt;å®ƒä»¬æ›´éœ€è¦æ³¨æ„æ•°æ®ç»“æ„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¥½çš„è§„åˆ’èƒ½è®©æ‰€æœ‰çš„è½¯ä»¶ç»„ä»¶éƒ½æœ‰æœ€å¥½çš„æ€§èƒ½ï¼Œè¿™å·²ç»æ²¡å•¥å¯å¤šè¯´çš„äº†ã€‚ä¸è¿‡åœ¨ SQL æ•°æ®åº“ä¸­ï¼Œé€šå¸¸æ˜¯é€šè¿‡ &lt;code&gt;joining more tables&lt;/code&gt;ã€&lt;code&gt;doing sub-queries&lt;/code&gt; æˆ–è€… &lt;code&gt;doing bulk data updates&lt;/code&gt; æ¥ä¿®å¤è§„åˆ’ä¸­çš„é”™è¯¯ã€‚ç”±äº Firebase ä¸­å¹¶ä¸å­˜åœ¨è¿™äº›æ¦‚å¿µï¼Œå› æ­¤è¿˜æ˜¯èŠ±äº›æ—¶é—´æ¥è®¾è®¡ä½ çš„æ•°æ®æ¨¡å‹å¹¶æå‰å¤„ç†å¥½è¿™äº›é—®é¢˜ã€‚ä½ ä¼šåº†å¹¸è‡ªå·±è¿™ä¹ˆåšäº†çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰å•Šï¼Œè®°å¾—è¯»æ–‡æ¡£ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Firebase" scheme="http://chengkang.me/tags/Firebase/"/>
    
  </entry>
  
  <entry>
    <title>Firebase å®‰å…¨ä¸è§„åˆ™</title>
    <link href="http://chengkang.me/2017/09/30/firebase-security-rules/"/>
    <id>http://chengkang.me/2017/09/30/firebase-security-rules/</id>
    <published>2017-09-30T20:08:37.000Z</published>
    <updated>2017-09-30T13:09:49.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://howtofirebase.com/firebase-security-rules-88d94606ce4a" target="_blank" rel="external">Firebase Security &amp; Rules</a></p>
</blockquote>
<p>Firebase æ˜¯ä¸€ä¸ªå¯ä»¥ä»ä»»æ„å»ºç«‹è¿æ¥äº†çš„å®¢æˆ·ç«¯è®¿é—®çš„äº‘æ•°æ®åº“ã€‚å› ä¸ºä»»æ„å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥åˆ°ä»»æ„ Firebase [æ•°æ®åº“]ï¼Œä½ <strong>å¿…é¡»</strong>åˆ¶å®šå®‰å…¨è§„åˆ™æ¥ä¿æŠ¤ä½ çš„æ•°æ®ã€‚å†™ä¸å¥½æ°å½“çš„å®‰å…¨è§„åˆ™ä¼šè®©ä½ æš´éœ²åœ¨æ”»å‡»ä¸­ã€‚ä¸è¿‡åˆ«ç€æ€¥ï¼ä½ é©¬ä¸Šå°±èƒ½å­¦åˆ°å¸®ä½ ç´§ç´§é”ä½ä½ çš„æ•°æ®çš„å…¨éƒ¨çŸ¥è¯†äº†ã€‚</p>
<p>ä¿æŒå®‰å…¨è§„åˆ™ç®€æ´ã€‚å®‰å…¨è§„åˆ™å¯èƒ½å˜å¾—è¿‡äºå¤æ‚ï¼Œå¹¶å¾ˆå¿«å˜å¾—ä¸å—æ§åˆ¶å¦‚æœä½ çš„æ•°æ®ç»“æ„ä¸å¤Ÿè®¾è®¡å……åˆ†çš„è¯ã€‚è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†ä¸€äº›â€œæœ€ä½³â€å®è·µã€‚ä¼°è®¡ä½ ä¼šè®²å…¶ç•¥ä½œä¿®æ”¹å°±ç”¨åˆ°ä½ çš„ç”Ÿäº§åº”ç”¨ä¸­å»â€¦â€¦å¦‚æœä½ é€‰æ‹©é‡‡ç”¨è¿™äº›æ¨¡å¼ï¼Œè®°å¾—ä»”ç»†æƒ³æƒ³èƒŒåçš„å«ä¹‰å°±è¡Œã€‚ç¡®ä¿åœ¨ä½ å¼€å§‹æäº‹ä¹‹å‰ï¼Œè¯»äº†æ•´ç¯‡æ–‡ç« ä»¥åŠ<a href="https://firebase.google.com/docs/database/security/" target="_blank" rel="external">å®‰å…¨è§„åˆ™æ–‡æ¡£</a>å…¨æ–‡ã€‚</p>
<a id="more"></a>
<h2 id="å®‰å…¨è§„åˆ™æ˜¯åŸºäºèŠ‚ç‚¹çš„"><a href="#å®‰å…¨è§„åˆ™æ˜¯åŸºäºèŠ‚ç‚¹çš„" class="headerlink" title="å®‰å…¨è§„åˆ™æ˜¯åŸºäºèŠ‚ç‚¹çš„"></a>å®‰å…¨è§„åˆ™æ˜¯åŸºäºèŠ‚ç‚¹çš„</h2><p>å®‰å…¨è§„åˆ™ç”±ä¸€ä¸ªå•ç‹¬çš„ JSON å¯¹è±¡ç®¡ç†ï¼Œä½ å¯ä»¥åœ¨ä½ çš„å®æ—¶æ•°æ®åº“æ§åˆ¶å°ç¼–è¾‘æˆ–è€…ä½¿ç”¨ Firebase CLI [æ¥ç¼–è¾‘]ã€‚è¿˜æœ‰ä¸€ä¸ªé¢å¤–æƒŠå–œï¼Œå¦‚æœä½ çš„è§„åˆ™æ ¼å¼é”™è¯¯çš„è¯ï¼Œæ§åˆ¶å°å’Œ CLI ä¼šç»™ä½ è­¦å‘Šã€‚</p>
<p>è§„åˆ™å¯¹è±¡å¼€å§‹æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line"> &quot;rules&quot;: </span><br><span class="line">  &#123; </span><br><span class="line">    &quot;.read&quot;: false,</span><br><span class="line">    &quot;.write&quot;: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª JSON å¯¹è±¡çš„æ ¹èŠ‚ç‚¹å¿…é¡»å‘½åä¸º <code>rules</code>ã€‚<code>rules</code> èŠ‚ç‚¹é»˜è®¤ä¸å¯è¯»å†™ã€‚ä¸Šé¢çš„ç«‹å³æ˜¾å¼åœ°è®¾ç½®äº† <code>.read</code> å’Œ <code>.write</code> ä¸º <code>false</code>ï¼Œä½†æ˜¯ç•™ä¸ªç©ºç™½çš„è§„åˆ™ä¹Ÿä¼šæœ‰åŒæ ·çš„æ•ˆæœã€‚</p>
<h2 id="çº§è”è§„åˆ™"><a href="#çº§è”è§„åˆ™" class="headerlink" title="çº§è”è§„åˆ™"></a>çº§è”è§„åˆ™</h2><p>Firebase çº§è”è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šæˆäºˆä¸€ä¸ªçˆ¶æ¯èŠ‚ç‚¹è¯»å†™æƒé™ä¼šåŒæ—¶æˆäºˆå…¶æ‰€æœ‰å­èŠ‚ç‚¹è¯»å†™æƒé™ã€‚</p>
<p>å†è¯´ä¸€éã€‚</p>
<p>Firebase çº§è”è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šæˆäºˆä¸€ä¸ªçˆ¶æ¯èŠ‚ç‚¹è¯»å†™æƒé™ä¼šåŒæ—¶æˆäºˆå…¶æ‰€æœ‰å­èŠ‚ç‚¹è¯»å†™æƒé™ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ªå·¨å¤§çš„â€œå‘â€ï¼Œå³ä½¿æ˜¯å¯¹äºæœ‰ç»éªŒçš„ Firebase ç”¨æˆ·æ¥è¯´ä¹Ÿæ˜¯è¿™æ ·ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸ºä»€ä¹ˆ Firebase è¿™æ ·æ¥å¤„ç†ï¼Œä»¥åŠæˆ‘ä»¬å¯ä»¥å¦‚ä½•ç»•è¿‡è¿™ä¸ªé™åˆ¶ã€‚</p>
<p>é¦–å…ˆï¼ŒFirebase æœ¬è´¨ä¸Šè¦æ±‚è¿™æ ·çš„ä¸€ç§è¡Œä¸ºã€‚å¦‚æœä½ åœ¨ Firebase é‡Œé¢æŸ¥è¯¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½ å°†å¾—åˆ°å…¶<em>æ‰€æœ‰</em>çš„å­èŠ‚ç‚¹ã€‚Firebase éå¸¸æ³¨é‡æ€§èƒ½è¡¨ç°ï¼Œå®ƒä¸ä¼šèŠ±æ—¶é—´æ¥åœ¨æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ä¸Šå¥—ç”¨è§„åˆ™å¹¶ä¸”åšå‡ºå¯èƒ½çš„ä»çˆ¶æ¯èŠ‚ç‚¹ç§»é™¤çš„åŠ¨ä½œã€‚é‚£æ ·ä¼šå¤§å¤§å½±å“å…¶è¡¨ç°ã€‚</p>
<p>ç¬¬äºŒï¼Œä½ å¯ä»¥é€šè¿‡æ ¹æ®ä½ çš„æƒé™ç»“æ„æ¥ç»“æ„åŒ–ä½ çš„æ•°æ®ä»¥è½»æ˜“åœ°é¿å…è¿™äº›çº§è”è§„åˆ™çš„é—®é¢˜ã€‚å°†ä½ çš„æ•°æ®åµŒå¥—åœ¨è¿™æ ·å‘½åçš„é«˜çº§åˆ«çš„èŠ‚ç‚¹ä¸­ï¼Œæ¯”å¦‚ â€œadminâ€ã€â€œuserReadableâ€ã€â€œuserWritableâ€ æˆ–è€… â€œuserOwnedâ€ã€‚å°†æœ‰ç€ç±»ä¼¼å®‰å…¨éœ€æ±‚çš„å¯¹è±¡åˆ†ç»„åœ¨é«˜çº§åˆ«èŠ‚ç‚¹ä¸‹ä¼šæœ‰æ•ˆåœ°é™ä½ä½ éœ€è¦ç»´æŠ¤çš„å®‰å…¨è§„åˆ™æ•°é‡ã€‚</p>
<p><strong>å…³äºéªŒè¯è§„åˆ™å°çªé—¨ï¼š</strong>æˆ‘ä»¬ä¹‹åä¼šè°ˆåˆ°éªŒè¯è§„åˆ™ã€‚éªŒè¯è§„åˆ™ç”¨äºé˜»æ­¢ç”¨äºçˆ¶æ¯èŠ‚ç‚¹å†™æƒé™çš„ç”¨æˆ·å†™å…¥å…¶å­èŠ‚ç‚¹ã€‚è¿™æ ·çš„è¯ï¼Œå½“ä½ æˆäºˆäº†å†™æƒé™ç»™ <code>userOwned/preferences/{uid}</code>ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€æ¡éªŒè¯è§„åˆ™ï¼Œæ¯”å¦‚è¯´ <code>userOwned/preferences/{uid}/isAdmin</code>ï¼Œè¿™æ ·å°±å¯ä»¥é˜»æ­¢ç”¨æˆ·æ›´æ–° <code>isAdmin</code> è¿™ä¸ªå­èŠ‚ç‚¹ã€‚</p>
<p>è¿™ç§æ–¹æ³•ä¼šå¸¦æ¥ä¸€äº›åæœï¼ŒåŸºæœ¬ä¸Šä»»ä½•åœ¨ <code>userOwned/preferences/{uid}</code> çš„ <code>ref.set()</code> çš„æ“ä½œéƒ½ä¼šå¤±è´¥ï¼Œå› ä¸ºä½ ä¸èƒ½é‡å†™ <code>isAdmin</code> è¿™ä¸ªå­èŠ‚ç‚¹â€¦ä½ éœ€è¦ä½¿ç”¨ <code>ref.update()</code> æ¥å•ç‹¬æ›´æ–°æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ã€‚å°† <code>isAdmin</code> èŠ‚ç‚¹ç§»åˆ°ä½ çš„æ•°æ®ç»“æ„çš„å…¶ä»–æœ¬å°±æ˜¯ç”¨æˆ·å¯è¯»ä¸å¯å†™çš„éƒ¨åˆ†ä¼šæ¯”è¾ƒè½»æ¾ã€‚ä½ å¯ä»¥å°†å…¶å‘½åä¸º <code>userReadable/preferences/{uid}/isAdmin</code>ã€‚</p>
<h2 id="ç¤ºä¾‹æ•°æ®ç»“æ„"><a href="#ç¤ºä¾‹æ•°æ®ç»“æ„" class="headerlink" title="ç¤ºä¾‹æ•°æ®ç»“æ„"></a>ç¤ºä¾‹æ•°æ®ç»“æ„</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹æ•°æ®ç»“æ„æ¥ç»§ç»­å‰©ä¸‹çš„å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;users&quot;: &#123;</span><br><span class="line">    &quot;kanyesUID&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Kanye West&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;kwest@gmail.com&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;taylorsUID&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Taylor Swift&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;tswift@gmail.com&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;seacrestsUID&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;Ryan Seacrest&quot;,</span><br><span class="line">      &quot;email&quot;: &quot;rseacrest@gmail.com&quot;,</span><br><span class="line">      &quot;isAdmin&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;userReadable&quot;: &#123;</span><br><span class="line">    &quot;tweets&quot;: &#123;</span><br><span class="line">      &quot;kanyesUID&quot;: &#123;</span><br><span class="line">        &quot;aPushKey&quot;: &#123;</span><br><span class="line">          &quot;text&quot;: &quot;Imma let you finish, but...&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;bPushKey&quot;: &#123;</span><br><span class="line">          &quot;text&quot;: &quot;Queen B shoulda received this award...&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;retweets&quot;: &#123;</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;cPushKey&quot;: &#123;</span><br><span class="line">          &quot;key&quot;: &quot;aPushKey&quot;,</span><br><span class="line">          &quot;text&quot;: &quot;Imma let you finish, but...&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;dPushKey&quot;: &#123;</span><br><span class="line">          &quot;key&quot;: &quot;bPushKey&quot;,</span><br><span class="line">          &quot;text&quot;: &quot;Queen B shoulda received this award...&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;userWriteable&quot;: &#123;</span><br><span class="line">    &quot;tweetQueue&quot;: &#123;</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;text&quot;: &quot;I ğŸ’• you all like Kanye ğŸ’•&apos;s Kanye&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;userOwned&quot;: &#123;</span><br><span class="line">    &quot;preferences&quot;: &#123;</span><br><span class="line">      &quot;kanyesUID&quot;: &#123;</span><br><span class="line">        &quot;loveKanye&quot;: true</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;listenToHaters&quot;: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æ•°æ®æœ‰å››ä¸ªé¡¶çº§èŠ‚ç‚¹ï¼š</p>
<ol>
<li>users</li>
<li>userReadable</li>
<li>userWriteable</li>
<li>userOwned</li>
</ol>
<p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨æˆ·ï¼š</p>
<ol>
<li>Kanye West</li>
<li>Taylor Swift</li>
</ol>
<p><code>users</code> èŠ‚ç‚¹åŒ…å«äº†åŸºç¡€çš„ç”¨æˆ·æ•°æ®ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­å°±æ˜¯é‚®ç®±åœ°å€ã€‚æˆ‘ä»¬è®¾æƒ³å½“ Kanye ç™»é™†äº†æˆ‘ä»¬çš„ appï¼Œä»–çš„ uid æ˜¯ <code>kanyesUID</code>ã€‚ç±»ä¼¼çš„ï¼ŒTaylor å¾—åˆ°äº†è¿™ä¸ª uid <code>taylorsUID</code>ã€‚è¿™äº› UID ä¼šç»„æˆæˆ‘ä»¬å®‰å…¨æ¨¡å‹çš„åŸºç¡€ã€‚</p>
<p>é¦–å…ˆï¼Œæ¥è®©æ¯ä¸ªç”¨æˆ·æ•°æ®<code>ç”¨æˆ·å¯è¯»</code>â€¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨æ ¹èŠ‚ç‚¹ <code>rules</code> ä¸ŠåŠ äº†ä¸€ä¸ª <code>users</code> èŠ‚ç‚¹ã€‚ä»»ä½•ç›´æ¥å†™åœ¨ <code>users</code> èŠ‚ç‚¹ä¸‹é¢çš„è§„åˆ™ä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰å…¶å­èŠ‚ç‚¹ä¸­â€¦ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æƒ³åœ¨ <code>users</code> èŠ‚ç‚¹ä¸Šè®¾ç½®è§„åˆ™ã€‚æˆ‘ä»¬å¸Œæœ›ç»™æ¯ä¸€ä¸ªç‹¬ç«‹çš„ç”¨æˆ·åŸºäºå…¶ uid è®¾ç½®è§„åˆ™ï¼Œå› æ­¤æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé€šé…èŠ‚ç‚¹ï¼Œ<code>$uid</code>ã€‚æˆ‘ä»¬å¯ä»¥éšæ„å‘½åé€šé…èŠ‚ç‚¹ï¼Œåªè¦å…¶å¼€å§‹å­—ç¬¦æ˜¯ <code>$</code>ã€‚æœ€ä½³å®è·µæ˜¯ç»™ä»–ä»¬å‘½åä¸€äº›æè¿°æ€§çš„ä¸œè¥¿ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™ä¸ªé€šé…èŠ‚ç‚¹å‘½åä¸º <code>$uid</code>ï¼Œå› ä¸ºæ¯ä¸ªç”¨æˆ·éƒ½å°†ä¿å­˜åœ¨å…¶ uid ä¸‹ã€‚</p>
<p>é€šé…èŠ‚ç‚¹åº”ç”¨äºæ‰€æœ‰å…¶ä»–æ²¡æœ‰æ˜ç¡®æŒ‡å‡ºçš„èŠ‚ç‚¹ä¸Šã€‚æœ‰ç‚¹ç³Šæ¶‚äº†ï¼Ÿçœ‹çœ‹è¿™ä¸ªã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;taylorsUID&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == &apos;taylorsUID&apos;&quot;,</span><br><span class="line">        &quot;.write&quot;: &quot;auth.uid == &apos;taylorsUID&apos;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°æˆ‘ä»¬å¹²äº†å•¥å—ï¼Ÿæˆ‘ä»¬ä»…èµ‹äºˆäº† <code>$uid</code> èŠ‚ç‚¹ <code>.read</code> æƒé™ï¼Œä½†æ˜¯æˆ‘ä»¬ç»™äº† Taylor è¿™ä¸ªç”¨æˆ· <code>.read</code> å’Œ <code>.write</code> æƒé™ã€‚</p>
<p>ä½ å¯èƒ½åœ¨æƒ³ <code>auth.uid == $uid</code> æ˜¯ä»€ä¹ˆæ„æ€ã€‚å½“ç”¨æˆ·é€šè¿‡ Firebase Authentication è®¤è¯æˆåŠŸæ—¶ï¼Œè¿™ä¸ªç”¨æˆ·ä¼šä»ç³»ç»Ÿè·å¾—ä¸€ä¸ª uidï¼Œå®ƒå¯ä»¥é€šè¿‡ <code>auth.uid</code> è®¿é—®åˆ°ã€‚å› æ­¤å½“ Kanye åœ¨ç³»ç»Ÿä¸­è®¤è¯æ—¶ï¼Œä»–çš„ <code>auth.uid</code> ç­‰äº <code>kanyesUID</code>ã€‚æˆ‘ä»¬å¯ä»¥å°† <code>auth.uid</code> å’Œ <code>$uid</code> æ¯”è¾ƒæ¥æˆäºˆç”¨æˆ·å¯¹ä»–ä»¬è‡ªå·±èŠ‚ç‚¹çš„è¯»æƒé™ï¼Œä½†å¯¹å…¶ä»–èŠ‚ç‚¹æ— æƒé™ã€‚ä¹Ÿå¯ä»¥ç›´æ¥å’Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼š<code>&quot;.read&quot;: &quot;auth.uid == &#39;taylorsUID&#39;&quot;</code>ã€‚</p>
<h2 id="ç´¢å¼•å­é”®æ¥åŠ å¿«æŸ¥è¯¢"><a href="#ç´¢å¼•å­é”®æ¥åŠ å¿«æŸ¥è¯¢" class="headerlink" title="ç´¢å¼•å­é”®æ¥åŠ å¿«æŸ¥è¯¢"></a>ç´¢å¼•å­é”®æ¥åŠ å¿«æŸ¥è¯¢</h2><p>è®¾æƒ³æˆ‘ä»¬çš„ app åœ¨è¿›è¡Œè¿™æ ·ä¸€ä¸ªæŸ¥è¯¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref.child(&apos;users&apos;).orderByChild(&apos;email&apos;).equalTo(&apos;kwest@gmail.com&apos;).once(&apos;value&apos;, callback);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨è¦æ±‚ firebase æ¥ä» <code>users</code> èŠ‚ç‚¹ä¸­æœç´¢ä¸€ä¸ª <code>email</code> èŠ‚ç‚¹ä¸º <code>kwest@gmail.com</code> çš„å­èŠ‚ç‚¹ã€‚æ ¹æ®æˆ‘ä»¬æ•°æ®åº“çš„å¤§å°ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸å·¨é‡ä¸”ç¼“æ…¢çš„æŸ¥è¯¢ï¼Œå› æ­¤ Firebase ç»™æˆ‘ä»¬æä¾›äº†æŒ‡å®šå­èŠ‚ç‚¹çš„é«˜æ€§èƒ½ç´¢å¼•ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ› Firebase é€šè¿‡ <code>email</code> è¿™ä¸ªå­èŠ‚ç‚¹ç´¢å¼•æ‰€æœ‰ç”¨æˆ·ã€‚åšæ³•å¾ˆç®€å•ï¼Œ<code>&quot;.indexOn&quot;: &quot;email&quot;</code>ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid&quot;,</span><br><span class="line">        &quot;.indexOn&quot;: [</span><br><span class="line">          &quot;email&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬è¿˜è¦ç´¢å¼•å…¶ä»–å­èŠ‚ç‚¹ï¼Œæ¯”å¦‚è¯´ <code>users/{$user}/username</code>ï¼Œæˆ‘ä»¬çš„è§„åˆ™å°±è¿™ä¹ˆå†™ <code>&quot;.indexOn&quot;: [&quot;email&quot;, &quot;username&quot;]</code>ã€‚</p>
<h2 id="éå†æ ‘ä»¥è·å–ç»†èŠ‚æƒé™"><a href="#éå†æ ‘ä»¥è·å–ç»†èŠ‚æƒé™" class="headerlink" title="éå†æ ‘ä»¥è·å–ç»†èŠ‚æƒé™"></a>éå†æ ‘ä»¥è·å–ç»†èŠ‚æƒé™</h2><p>è®©æˆ‘ä»¬å°†è¿™ä¸ªè®¾æƒ³çš„ç±»ä¼¼ twitter çš„ app çš„ç¬¬ä¸‰ä¸ªç”¨æˆ·ç§°ä¸ºï¼š Ryan Seacrestã€‚Ryan çš„è´¦å·æ˜¯ç®¡ç†å‘˜è´¦å·ã€‚æ³¨æ„åˆ°äº†ä»–çš„ç”¨æˆ·è´¦å·é‡Œçš„ <code>&quot;isAdmin&quot;: true</code> å±æ€§äº†å—ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;users&quot;: &#123;</span><br><span class="line">      &quot;$uid&quot;: &#123;</span><br><span class="line">        &quot;.read&quot;: &quot;auth.uid == $uid || root.child(&apos;users&apos;).child(auth.uid).child(&apos;isAdmin&apos;).val() == true&quot;,</span><br><span class="line">        &quot;.write&quot;: &quot;root.child(&apos;users&apos;).child(auth.uid).child(&apos;isAdmin&apos;).val() == true&quot;,</span><br><span class="line">        &quot;.indexOn&quot;: [</span><br><span class="line">          &quot;email&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·ä»¬ä»ç„¶å¯ä»¥è¯»å–ä»–ä»¬è‡ªå·±çš„è´¦æˆ·æ•°æ®ï¼Œä¸è¿‡æˆ‘ä»¬åˆšåˆšç»™æ‰€æœ‰æœ‰ <code>isAdmin</code> æ ‡è¯†çš„ç”¨æˆ·èµ‹äºˆäº†è¯»å†™æƒé™ã€‚ç”¨äºæ£€æµ‹è¿™ä¸ªæ ‡è¯†çš„è§„åˆ™æ˜¯ <code>root.child(â€˜usersâ€™).child(auth.uid).child(â€˜isAdminâ€™).val()</code>ã€‚<code>root</code> å¯¹è±¡ä»£è¡¨æˆ‘ä»¬çš„ Firebase çš„æ ¹èŠ‚ç‚¹ã€‚æ¥ç€æˆ‘ä»¬è°ƒç”¨ <code>.child(&#39;nodeName&#39;)</code> æ¥å‘ä¸‹æ‰¾åˆ°æˆ‘ä»¬çš„è®¤è¯è¿‡çš„ç”¨æˆ·çš„ <code>isAdmin</code> èŠ‚ç‚¹ã€‚çœ‹åˆ°äº†æ˜¯æ€ä¹ˆä½¿ç”¨ <code>auth.uid</code> æ¥æ·±å…¥åˆ°è¿™ä¸ªè®¤è¯ç”¨æˆ·çš„å—ï¼Ÿæ˜¯ï¼Œè¿™æ ·åšå¾ˆèªæ˜ã€‚å®ƒåŒæ—¶ä¹Ÿæ‚„æ‚„åœ°è®©ä»»ä½•æ²¡æœ‰è®¤è¯çš„ç”¨æˆ·è®¿é—®å¤±è´¥ï¼Œè¿™æ ·è¿™äº›èŠ‚ç‚¹å°±å®‰å…¨äº†ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè°ƒç”¨ <code>.val()</code> æ¥è·å–å®ƒçš„å€¼ã€‚è¿™è®©äººæƒ³èµ·æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨ Firebase JavaScript SDK æ¥å¤„ç†æ•°æ®å¿«ç…§ï¼Œåº”è¯¥çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰å§ã€‚</p>
<p>å¦å¤–ä¸€ç‚¹ï¼šè¿˜æœ‰åˆ«çš„éå†æ ‘çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>data.parent().child(auth.uid).val()</code> æ¥ä»æˆ‘ä»¬æ­£åœ¨ä¿æŠ¤çš„èŠ‚ç‚¹å¾€ä¸Šèµ°åˆ° <code>users</code> å†å¾€ä¸‹èµ°ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå¾ˆå®ç”¨ï¼Œä½†æ˜¯ä» <code>root</code> å¼€å§‹éå†ä¼šæ›´å¯é ï¼Œå› ä¸º <code>root</code> å¯¹äºæˆ‘ä»¬ app çš„ä»»ä½•éƒ¨åˆ†éƒ½æ˜¯ä¸€æ ·çš„ã€‚ä¸ºäº†å®‰å…¨ï¼Œè¿˜æ˜¯ç”¨ <code>root</code> å§ã€‚</p>
<h2 id="ä½¿ç”¨-Bolt-è§„åˆ™ç¼–è¯‘å™¨æ¥-streamline-ä½ çš„è§„åˆ™"><a href="#ä½¿ç”¨-Bolt-è§„åˆ™ç¼–è¯‘å™¨æ¥-streamline-ä½ çš„è§„åˆ™" class="headerlink" title="ä½¿ç”¨ Bolt è§„åˆ™ç¼–è¯‘å™¨æ¥ streamline ä½ çš„è§„åˆ™"></a>ä½¿ç”¨ Bolt è§„åˆ™ç¼–è¯‘å™¨æ¥ streamline ä½ çš„è§„åˆ™</h2><p>åˆ°ç›®å‰æˆ‘ä»¬ä¸€ç›´åœ¨ç›´æ¥ä¿®æ”¹æˆ‘ä»¬çš„è§„åˆ™ JSON å¯¹è±¡ã€‚è¿™æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å®ƒå¯èƒ½æ€»æ˜¯åœ¨é‡å¤å¤åˆ¶ç²˜è´´æ“ä½œã€‚Firebase å›¢é˜Ÿä¹Ÿå·²ç»ç–²äºå¤åˆ¶ç²˜è´´ï¼Œäºæ˜¯å†™äº†ä¸€ä¸ªå’Œ <a href="https://github.com/firebase/firebase-tools" target="_blank" rel="external">firebase-tools</a> CLI ç»“åˆæ¥è®©è§„åˆ™æ›´å®¹æ˜“å†™çš„ç¼–è¯‘å™¨ã€‚</p>
<p>ä½ éœ€è¦é€šè¿‡ <code>npm install -g firebase-bolt</code> å®‰è£… Bolt å¹¶ä¸”åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªå‘½åä¸ºç±»ä¼¼ <code>security-rules.bolt</code> çš„æ–‡ä»¶ã€‚ç„¶åä½ å¯ä»¥æ‰§è¡Œ <code>firebase-bolt sevurity-rules.bolt</code>ï¼Œå®ƒä¼šç¼–è¯‘ä½ çš„ Bolt è§„åˆ™åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¹¶å‘½åä¸º <code>firebase-rules.json</code>ã€‚ç”Ÿæˆçš„ JSON å¯èƒ½ä¼šæ¯”æˆ‘ä»¬ä¹‹å‰å†™çš„ JSON æ›´å•°å—¦ï¼Œä½†æ˜¯ Bolt è¯­æ³•å¾ˆå¥½ç”¨ç²¾ç‚¼ã€‚è¯¦è§ <a href="https://github.com/firebase/bolt/blob/master/docs/language.md" target="_blank" rel="external">Bolt language reference</a>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function isUser (auth, userKey) &#123;</span><br><span class="line">  return uid == userKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isAdmin (auth) &#123;</span><br><span class="line">  return root.child(&apos;users&apos;).child(auth.uid).child(&apos;isAdmin&apos;).val() == true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /users/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isAdmin(auth) &#125;</span><br><span class="line">  index() &#123; [&quot;email&quot;] &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /userReadable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /userWriteable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path /userOwned/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„æˆ‘ä»¬æ˜¯æ€æ ·å†™åœ¨é¡¶éƒ¨çš„ä¸¤ä¸ªæ–¹æ³•çš„ï¼š<code>isUser(auth, uid)</code> å’Œ <code>isAdmin(auth)</code>ã€‚è¿™äº›æ–¹æ³•ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯è¶…çº§æœ‰ç”¨ã€‚å®ƒä»¬è®©æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„è§„åˆ™ä¸­é‡ç”¨ä¸€äº›é€»è¾‘ã€‚</p>
<p>ä¸‹ä¸€ä¸ªéƒ¨åˆ†æœ‰ä¸€å † <code>path</code> å—ã€‚ä½¿ç”¨ <code>/[nodeName]/</code> æ¥é€šé…ä½ çš„è·¯å¾„ã€‚è¿™äº›é€šé…å€¼åœ¨è¿™äº› path çš„èŒƒå›´å†…éƒ½æ˜¯å¯ç”¨çš„ï¼Œå› æ­¤ä½ å¯ä» <code>/userReadable/objectType/uid</code> è·å– <code>uid</code>ï¼Œå¹¶ä¼ ç»™ <code>read() { isUser(auth, uid) || isAdmin(auth) }</code>ã€‚</p>
<h2 id="æ ¹æ®è¯»å†™æƒé™æ¥ç»“æ„åŒ–ä½ çš„æ•°æ®"><a href="#æ ¹æ®è¯»å†™æƒé™æ¥ç»“æ„åŒ–ä½ çš„æ•°æ®" class="headerlink" title="æ ¹æ®è¯»å†™æƒé™æ¥ç»“æ„åŒ–ä½ çš„æ•°æ®"></a>æ ¹æ®è¯»å†™æƒé™æ¥ç»“æ„åŒ–ä½ çš„æ•°æ®</h2><p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†æœ‰ä¸‰ä¸ªé¡¶çº§èŠ‚ç‚¹è¢«å‘½åä¸ºï¼š</p>
<ul>
<li>userReadable</li>
<li>userWriteable</li>
<li>userOwned</li>
</ul>
<p>ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬æˆäºˆäº†ç”¨æˆ·è¯»æƒé™ç»™ <code>userReadable</code> çš„å­èŠ‚ç‚¹ã€å†™æƒé™ç»™ <code>userWriteable</code> çš„å­èŠ‚ç‚¹ä»¥åŠå®Œæ•´çš„è¯»å†™æƒé™ç»™ <code>userOwned</code> çš„å­èŠ‚ç‚¹ã€‚</p>
<p>è¿™æ˜¯åªä¸€ä¸ªéšæ„çš„æ•°æ®ç»“æ„â€¦æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸‰ä¸ªèŠ‚ç‚¹å‘½åä¸ºéšä¾¿ä»€ä¹ˆã€‚ä¸è¿‡å‘½åä¸ºæè¿°æ€§çš„åå­—ä¼šæ›´å¥½ã€‚æ¥ç€æˆ‘ä»¬ç”¨äº†é€šé…è·¯å¾„ï¼ˆ<code>path/userReadable/objectType/uid</code>ï¼‰æ¥ç»™ä¸€ç»„ä¸€ç»„çš„å¯¹è±¡åº”ç”¨è§„åˆ™ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ä¸éœ€è¦ç»™æˆ‘ä»¬åˆ›å»ºçš„æ¯ä¸€ç±»å¯¹è±¡éƒ½ç¼–å†™è§„åˆ™ã€‚æˆ‘ä»¬åªéœ€è¦å°†è¿™äº›å¯¹è±¡åµŒå¥—åœ¨æ°å½“çš„æƒé™èŠ‚ç‚¹ä¸‹å°±å¥½äº†ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;rules&quot;: &#123;</span><br><span class="line">    &quot;userOwned&quot;: &#123;</span><br><span class="line">      &quot;preferences&quot;: &#123;</span><br><span class="line">        &quot;kanyesUID&quot;: &#123;</span><br><span class="line">          &quot;loveKanye&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;taylorsUID&quot;: &#123;</span><br><span class="line">          &quot;listenToHaters&quot;: false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>userOwned</code> èŠ‚ç‚¹æœ‰å¯¹æ‰€æœ‰åœ¨åŒ¹é…çš„ç”¨æˆ· uid ä¸‹çš„å¯¹è±¡çš„è¯»å†™æƒé™ã€‚å› æ­¤åªæœ‰ Kanye å¯ä»¥è®¿é—® <code>/userOwned/preferences/kanyesUID</code>ï¼Œå¹¶ä¸” Kanye æœ‰å®Œæ•´çš„è¯»å†™æƒé™ã€‚</p>
<p>è¦è®°å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¶å®šå¦ä¸€æ¡åŒ¹é…è·¯å¾„è§„åˆ™æ¥é‡å†™ç»Ÿé…è§„åˆ™ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">path /userOwned/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line"> read() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">  write() &#123; isUser(auth, uid) || isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line">path /userOwned/grammyNominations/taylorsUID &#123;</span><br><span class="line">  read() &#123; true &#125;</span><br><span class="line">  write() &#123; uid == kanyesUID &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ¡è§„åˆ™é‡å†™äº† <code>/userOwned/{objectType}/uid</code> å¹¶ä»…æˆäºˆ Kanye å¯¹äº Taylorâ€™s Grammy Nominations çš„å†™æƒé™ã€‚åŒæ—¶ä¹Ÿè®©è¿™ä¸ªåˆ—è¡¨å…¨ä¸–ç•Œå¯è¯»ï¼Œå› æ­¤ä»»ä½•ç½‘ç«™æˆ–è€…ç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡ <code>https://&lt;some firebase&gt;.firebaseio.com/userOwned/grammyNominations/taylorsUID.json</code> æ¥è·å–è¿™ä¸ªåˆ—è¡¨ã€‚</p>
<h2 id="ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶éªŒè¯ä½ çš„æ•°æ®"><a href="#ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶éªŒè¯ä½ çš„æ•°æ®" class="headerlink" title="ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶éªŒè¯ä½ çš„æ•°æ®"></a>ä¿è¯å®‰å…¨æ€§çš„åŒæ—¶éªŒè¯ä½ çš„æ•°æ®</h2><p><code>read()</code>ã€<code>write()</code> ä»¥åŠ <code>index()</code> è¦†ç›–äº†å¤§å¤šæ•°ä½¿ç”¨æƒ…å†µï¼Œä½†æœ‰æ—¶å€™ä½ å¯èƒ½éœ€è¦æ›´å¤šå¯¹äºè¦å†™å…¥çš„æ•°æ®çš„æ›´ç»†èŠ‚çš„æ§åˆ¶ã€‚</p>
<p>Bolt å…è®¸ä½ åˆ›å»ºå¯ä»¥åœ¨å¤šèŠ‚ç‚¹é—´é‡ç”¨çš„æ•°æ®ç±»å‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path /userOwned/preferences/&#123;uid&#125; is Preferences;</span><br><span class="line">type Preferences &#123;</span><br><span class="line"> validate() &#123; this.excuse.length &lt; 20 &amp;&amp; this.respectRating &lt; 5 &#125;</span><br><span class="line">  useAutotune: Boolean,</span><br><span class="line">  excuse: String,</span><br><span class="line">  respectRating: Number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥å°†éªŒè¯è§„åˆ™å’Œ <code>validate()</code> æ··åˆåœ¨ä¸€èµ·ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥å°†ç±»å‹å’Œè¯»å†™æƒé™æ··åˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">path /userOwned/preferences/&#123;uid&#125; is Preferences &#123;</span><br><span class="line"> read() &#123; isUser(auth, uid) &#125;</span><br><span class="line"> write() &#123; isUser(auth, uid) &#125;</span><br><span class="line">&#125;</span><br><span class="line">type Preferences &#123;</span><br><span class="line">  validate() &#123; this.excuse.length &lt; 20 &amp;&amp; this.respectRating &lt; 5 &#125;</span><br><span class="line">  useAutotune: Boolean,</span><br><span class="line">  excuse: String,</span><br><span class="line">  respectRating: Number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åˆ«åè§„åˆ™"><a href="#åˆ«åè§„åˆ™" class="headerlink" title="åˆ«åè§„åˆ™"></a>åˆ«åè§„åˆ™</h2><p>ç›®å‰ä¸ºæ­¢æˆ‘ä»¬ä»…ä»…ä½¿ç”¨äº† <code>read()</code>ã€<code>write()</code>ã€<code>index()</code> å’Œ <code>validate()</code>ï¼Œä½†æ˜¯ Bolt æ”¯æŒå…¶å®ƒä¸‰ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li>create()</li>
<li>update()</li>
<li>delete()</li>
</ul>
<p>è¿™äº›æ–¹æ³•éƒ½æ˜¯ <code>write()</code> çš„åˆ«åï¼Œå› æ­¤ä»–ä»¬ä¸èƒ½å’Œ <code>write()</code> ä¸€èµ·æ··åˆåˆ°åŒä¸€ä¸ª <code>path</code> å—ã€‚å®ƒä»¬åˆ›å»ºäº†åˆ†åˆ«ä»…é€‚ç”¨äºæ–°å»ºã€æ›´æ–°æˆ–è€…åˆ é™¤æ“ä½œçš„ <code>write()</code> è§„åˆ™ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¯å¦‚æœä½ æƒ³è¦ç»™ç”¨æˆ·æƒé™åˆ›å»ºå¯¹è±¡ä½†æ˜¯ä¸èƒ½ç¼–è¾‘æˆ–è€…åˆ é™¤ï¼Œ<code>create()</code> ä¼šç”Ÿæˆå¤„ç†è¿™ç§æƒ…å†µçš„ <code>write()</code> è§„åˆ™ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">path /dropbox/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line"> create() &#123; isUser(auth, uid) &#125;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">path /editable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  update() &#123; isUser(auth, uid) &#125;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">path /deleteable/&#123;objectType&#125;/&#123;uid&#125; &#123;</span><br><span class="line">  delete() &#123; isUser(auth, uid) &#125;</span><br><span class="line">  read() &#123; isAdmin(auth) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="éƒ¨ç½²ä½ çš„è§„åˆ™"><a href="#éƒ¨ç½²ä½ çš„è§„åˆ™" class="headerlink" title="éƒ¨ç½²ä½ çš„è§„åˆ™"></a>éƒ¨ç½²ä½ çš„è§„åˆ™</h2><p>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>æ‰§è¡Œ <code>firebase-bolt my-rules-file.bolt</code> æ¥åˆ›å»º <code>my-rules-files.json</code>ï¼Œç„¶åä½ å¯ä»¥å¤åˆ¶ç²˜è´´åˆ°ä½ çš„å®æ—¶æ•°æ®åº“è§„åˆ™æ§åˆ¶å°ã€‚</li>
<li>æ‰§è¡Œ <code>firebase-tools init</code> æ¥åˆ›å»ºä½ çš„ <code>firebase.json</code> æ‰˜ç®¡æ–‡ä»¶ï¼Œç„¶ååœ¨ <code>database.rules</code> åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹æ¥æŒ‡å‘ä½ çš„ <code>.bolt</code> æˆ–è€… â€˜.jsonâ€™ è§„åˆ™æ–‡ä»¶ã€‚æ¥ç€è¿è¡Œ <code>firebase deploy --only rules</code> æ¥é€šè¿‡å‘½ä»¤è¡Œéƒ¨ç½²ä½ çš„è§„åˆ™ã€‚</li>
</ol>
<p>æˆ‘ä»¬ç¨åä¼šè°ˆåˆ° <code>firebase.json</code> è¿™ä¸ªé€‰é¡¹ã€‚ç°åœ¨ï¼Œçœ‹çœ‹ä¸‹é¢è¿™ä¸ª <code>firebase.sjon</code> ä¾‹å­å¹¶ä¸”ç•™æ„ <code>database.rules</code> è¿™ä¸ªèŠ‚ç‚¹ã€‚å®ƒæŒ‡å‘äº†ä¸€ä¸ªè®°å½•äº†æˆ‘çš„ bolt è§„åˆ™çš„å«åš <code>database.rules.bolt</code> çš„æ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶è¢«å‘½åä¸º <code>database.rules.json</code>ï¼Œfirebase ä¼šçŸ¥é“æˆ‘çš„è§„åˆ™æ˜¯ JSON æ ¼å¼ï¼Œä¸è¿‡å› ä¸ºæˆ‘å‘½åäº†ä¸º <code>.bolt</code>ï¼Œå®ƒä¼šåœ¨ä¸Šä¼ å…¶åˆ°æˆ‘çš„ Firebase äº‘ä¸Šä¹‹å‰è‡ªåŠ¨å°†å…¶ä¼ ç»™ <code>firebase-bolt</code> ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Eample firebase.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;database&quot;: &#123;</span><br><span class="line">    &quot;rules&quot;: &quot;database.rules.bolt&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hosting&quot;: &#123;</span><br><span class="line">    &quot;public&quot;: &quot;dist&quot;,</span><br><span class="line">    &quot;rewrites&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;source&quot;: &quot;/app/**/*&quot;,</span><br><span class="line">        &quot;destination&quot;: &quot;/index.html&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;ignore&quot;: [</span><br><span class="line">      &quot;firebase.json&quot;,</span><br><span class="line">      &quot;**/.*&quot;,</span><br><span class="line">      &quot;**/node_modules/**&quot;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;functions&quot;: &#123;</span><br><span class="line">    &quot;.source&quot;: &quot;functions&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><p>å·®ä¸å¤šå°±è¿™æ ·äº†ã€‚</p>
<p>å…·ä½“ç»ƒä¹ è§åŸæ–‡å§ ï¼šDã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://howtofirebase.com/firebase-security-rules-88d94606ce4a&quot;&gt;Firebase Security &amp;amp; Rules&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Firebase æ˜¯ä¸€ä¸ªå¯ä»¥ä»ä»»æ„å»ºç«‹è¿æ¥äº†çš„å®¢æˆ·ç«¯è®¿é—®çš„äº‘æ•°æ®åº“ã€‚å› ä¸ºä»»æ„å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥åˆ°ä»»æ„ Firebase [æ•°æ®åº“]ï¼Œä½ &lt;strong&gt;å¿…é¡»&lt;/strong&gt;åˆ¶å®šå®‰å…¨è§„åˆ™æ¥ä¿æŠ¤ä½ çš„æ•°æ®ã€‚å†™ä¸å¥½æ°å½“çš„å®‰å…¨è§„åˆ™ä¼šè®©ä½ æš´éœ²åœ¨æ”»å‡»ä¸­ã€‚ä¸è¿‡åˆ«ç€æ€¥ï¼ä½ é©¬ä¸Šå°±èƒ½å­¦åˆ°å¸®ä½ ç´§ç´§é”ä½ä½ çš„æ•°æ®çš„å…¨éƒ¨çŸ¥è¯†äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¿æŒå®‰å…¨è§„åˆ™ç®€æ´ã€‚å®‰å…¨è§„åˆ™å¯èƒ½å˜å¾—è¿‡äºå¤æ‚ï¼Œå¹¶å¾ˆå¿«å˜å¾—ä¸å—æ§åˆ¶å¦‚æœä½ çš„æ•°æ®ç»“æ„ä¸å¤Ÿè®¾è®¡å……åˆ†çš„è¯ã€‚è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†ä¸€äº›â€œæœ€ä½³â€å®è·µã€‚ä¼°è®¡ä½ ä¼šè®²å…¶ç•¥ä½œä¿®æ”¹å°±ç”¨åˆ°ä½ çš„ç”Ÿäº§åº”ç”¨ä¸­å»â€¦â€¦å¦‚æœä½ é€‰æ‹©é‡‡ç”¨è¿™äº›æ¨¡å¼ï¼Œè®°å¾—ä»”ç»†æƒ³æƒ³èƒŒåçš„å«ä¹‰å°±è¡Œã€‚ç¡®ä¿åœ¨ä½ å¼€å§‹æäº‹ä¹‹å‰ï¼Œè¯»äº†æ•´ç¯‡æ–‡ç« ä»¥åŠ&lt;a href=&quot;https://firebase.google.com/docs/database/security/&quot;&gt;å®‰å…¨è§„åˆ™æ–‡æ¡£&lt;/a&gt;å…¨æ–‡ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="Firebase" scheme="http://chengkang.me/tags/Firebase/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠLearning AV Foundationã€‹å­¦ä¹ ç¬”è®°ï¼Œç¬¬ä¸€ç« ï¼šAV Foundation åŸºç¡€</title>
    <link href="http://chengkang.me/2017/06/06/learning-av-foundation-1/"/>
    <id>http://chengkang.me/2017/06/06/learning-av-foundation-1/</id>
    <published>2017-06-06T18:20:16.000Z</published>
    <updated>2017-06-06T19:43:34.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>æœ¬ç³»åˆ—æ˜¯æˆ‘å­¦ä¹ ã€ŠLearning AV Foundationï¼šA Hands-on Guide to Matering the AV Foundation Frameworkã€‹çš„å­¦ä¹ ç¬”è®°ã€‚å°†ä»¥ç« ä¸ºå•ä½ï¼Œå¯¹å†…å®¹è¿›è¡Œæ€»ç»“ã€‚</p>
</blockquote>
<h2 id="AV-Foundation"><a href="#AV-Foundation" class="headerlink" title="AV Foundation"></a>AV Foundation</h2><p>AV Foundation å¤„äºä¸Šå±‚æ¡†æ¶ï¼ˆiOSï¼šAVKitã€UIKitï¼ŒMac OSï¼šAVKitã€AppKitï¼‰å’Œåº•å±‚æ¡†æ¶ï¼ˆCore Audioã€Core Videoï¼ŒCore Media ä»¥åŠ Core Animationï¼‰ä¹‹é—´ï¼Œåœ¨ iOS å’Œ Mac OS ä¸­é€šç”¨ã€‚</p>
<p>å…¶ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>éŸ³é¢‘æ’­æ”¾å’Œè®°å½•ï¼ˆAudio Playback and Recordingï¼‰</li>
<li>åª’ä½“æ–‡ä»¶æ£€æŸ¥ï¼ˆMedia Inspectionï¼‰</li>
<li>è§†é¢‘æ’­æ”¾ï¼ˆVideo Playbackï¼‰</li>
<li>åª’ä½“æ•æ‰ï¼ˆMedia Captureï¼‰</li>
<li>åª’ä½“ç¼–è¾‘ï¼ˆMedia Editingï¼‰</li>
<li>åª’ä½“å¤„ç†ï¼ˆMedia Processingï¼‰</li>
</ul>
<h2 id="æ•°å­—åª’ä½“-ï¼ˆDigital-Mediaï¼‰"><a href="#æ•°å­—åª’ä½“-ï¼ˆDigital-Mediaï¼‰" class="headerlink" title="æ•°å­—åª’ä½“ ï¼ˆDigital Mediaï¼‰"></a>æ•°å­—åª’ä½“ ï¼ˆDigital Mediaï¼‰</h2><p>ç°å®ä¸­çš„ä¿¡å·æ˜¯è¿ç»­çš„ï¼Œæ•°å­—ä¸–ç•Œä¸­çš„ä¿¡å·æ˜¯ç¦»æ•£çš„ã€‚ä¸ºäº†å‚¨å­˜å¹¶ä¼ è¾“åª’ä½“ä¿¡æ¯ï¼Œéœ€è¦å°†å°†è¿ç»­çš„<code>æ¨¡æ‹Ÿä¿¡å·</code>è½¬æ¢ä¸ºç¦»æ•£çš„<code>æ•°å­—ä¿¡å·</code>ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¹‹ä¸º<code>é‡‡æ ·ï¼ˆSamplingï¼‰</code>ã€‚</p>
<h3 id="é‡‡æ ·çš„ä¸¤ç§æ–¹å¼"><a href="#é‡‡æ ·çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="é‡‡æ ·çš„ä¸¤ç§æ–¹å¼"></a>é‡‡æ ·çš„ä¸¤ç§æ–¹å¼</h3><ol>
<li>æ—¶é—´é‡‡æ ·ï¼ˆTemporal Samplingï¼‰ï¼šæ•æ‰ä¸€ä¸ªä¿¡å·åœ¨å‘¨æœŸå†…çš„å˜åŒ–ã€‚</li>
<li>ç©ºé—´é‡‡æ ·ï¼ˆSpatial Sampling)ï¼šå¯¹ä¸€å¹…å›¾ç‰‡åœ¨ä¸€å®šåˆ†è¾¨ç‡ä¹‹ä¸‹æ•æ‰å…¶äº®åº¦å’Œè‰²åº¦ï¼Œ<br>è¿›è€Œåˆ›å»ºç”±è¯¥å›¾ç‰‡çš„åƒç´ ç‚¹æ•°æ®æ‰€æ„æˆçš„æ•°å­—åŒ–ç»“æœã€‚</li>
</ol>
<blockquote>
<p>å½“å¯¹ä¸€æ®µè§†é¢‘è¿›è¡Œæ•°å­—åŒ–æ—¶ï¼Œè¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå› ä¸ºé€šå¸¸çš„è§†é¢‘ä¿¡å·æ—¢æœ‰ç©ºé—´å±æ€§åˆæœ‰æ—¶é—´å±æ€§ã€‚</p>
</blockquote>
<h3 id="éŸ³é¢‘é‡‡æ ·"><a href="#éŸ³é¢‘é‡‡æ ·" class="headerlink" title="éŸ³é¢‘é‡‡æ ·"></a>éŸ³é¢‘é‡‡æ ·</h3><p>å¦‚ä¸‹ä¸¤ä¸ªéŸ³é¢‘æ­£å¼¦æ³¢å›¾ï¼Œåˆ†åˆ«æ˜¯ 1Hz ï¼ˆå·¦ï¼‰å’Œ 5Hz ï¼ˆå³ï¼‰ã€‚</p>
<p><img src="" alt=""></p>
<p>æˆ‘ä»¬å¯¹ä¿¡å·çš„ä¸¤ä¸ªæ–¹é¢æ¯”è¾ƒæ„Ÿå…´è¶£ã€‚ä¸€ä¸ªæ˜¯<code>æŒ¯å¹…</code>ï¼Œå®ƒä»£è¡¨ç”µå‹çš„å¼ºåº¦æˆ–è€…å¯¹åº”ä¿¡å·çš„å¼ºåº¦ã€‚å¦ä¸€ä¸ªæ˜¯<code>é¢‘ç‡</code>ï¼ˆå•ä½ï¼šèµ«å…¹ Hzï¼‰ï¼Œè¡¨ç¤ºåœ¨ä¸€å®šå‘¨æœŸå†…å®Œæˆå¾ªç¯çš„æ¬¡æ•°ã€‚</p>
<blockquote>
<p>äººç±»å¯å¬è§çš„éŸ³é¢‘èŒƒå›´æ˜¯ 20Hz~20kHzã€‚ä½†å…·ä½“èŒƒå›´ä¹Ÿå› äººè€Œå¼‚ã€‚</p>
</blockquote>
<p>éŸ³é¢‘æ•°å­—åŒ–ä½¿ç”¨åˆ°ä¸€ä¸ªç¼–ç æ–¹æ³•ï¼Œç§°ä¸º<code>çº¿æ€§è„‰å†²ç¼–ç è°ƒåˆ¶ï¼ˆlinear pulse-code madulationï¼‰</code>ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸º <code>Linear PCM</code> æˆ–è€… <code>LPCM</code>ã€‚è¿™ä¸ªè¿‡ç¨‹é€šè¿‡ä¸€ä¸ªå›ºå®šçš„å‘¨æœŸç‡ï¼ˆ<code>é‡‡æ ·ç‡ï¼ˆSampling Rateï¼‰</code>ï¼‰å¯¹éŸ³é¢‘ä¿¡å·è¿›è¡Œé‡‡æ ·ã€‚ä¸‹å›¾å±•ç¤ºäº†åœ¨ä¸€ç§’å†…å¯¹ä¿¡å·è¿›è¡Œ 7 æ­¤é‡‡æ ·åŠä¿¡å·æ•°å­—åŒ–çš„ç»“æœï¼š</p>
<p><img src="" alt=""></p>
<p>æ˜¾ç„¶ä½<code>é‡‡æ ·ç‡</code>çš„æ•°å­—ä¿¡å·æ— æ³•å¾ˆå¥½åœ°è¡¨ç°åŸå§‹æ•°æ®ã€‚ä¸‹å›¾æ˜¯æé«˜<code>é‡‡æ ·ç‡</code>ä¹‹åçš„ç»“æœï¼š</p>
<p><img src="" alt=""></p>
<p>è™½ç„¶æ— æ³•å®Œå…¨å‡†ç¡®è¡¨ç°åŸå§‹ä¿¡å·ï¼Œä½†æ˜¯éšç€<code>é‡‡æ ·ç‡</code>çš„æé«˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆè¶³å¤Ÿå¥½çš„æ•°å­—å‘ˆç°æ•ˆæœçš„<code>é‡‡æ ·ç‡</code>ã€‚è¿™ä¸ª<code>é‡‡æ ·ç‡</code>è¢«ç§°ä¸º<code>å°¼å¥æ–¯ç‰¹ç‡</code>ã€‚<strong>Harry Nyquist å‘ç°ï¼šæƒ³è¦å‡†ç¡®åœ°æ•æ‰ä¸€ä¸ªç‰¹å®šé¢‘ç‡ï¼Œä½ éœ€è¦ç”¨è‡³å°‘ä¸¤å€äºå…¶æœ€é«˜é¢‘ç‡çš„<code>é‡‡æ ·ç‡</code>è¿›è¡Œé‡‡æ ·ã€‚</strong></p>
<p>æ•°å­—éŸ³é¢‘é‡‡æ ·å¦ä¸€ä¸ªé‡è¦çš„æ–¹é¢æ˜¯æˆ‘ä»¬æ•æ‰æ¯ä¸ªæ ·æœ¬çš„å‡†ç¡®åº¦ã€‚å› ä¸º<code>æŒ¯å¹…</code>æ˜¯çº¿æ€§è¡¡é‡çš„ï¼Œå› æ­¤ä¹Ÿå°±æœ‰äº†<code>çº¿æ€§è„‰å†²ç¼–ç è°ƒåˆ¶</code>è¿™ä¸ªæœ¯è¯­ã€‚â€œç”¨äºä¿å­˜æ ·æœ¬å€¼çš„å­—èŠ‚æ•°å®šä¹‰äº†åœ¨çº¿æ€§ç»´åº¦ä¸Šå¯è¡Œçš„ç¦»æ•£åº¦ï¼ŒåŒæ—¶è¿™ä¸ªä¿¡æ¯ä¹Ÿè¢«ç§°ä¸ºéŸ³é¢‘çš„<code>ä½å…ƒæ·±åº¦(Bit Depth)</code>ã€‚ä¸ºæ¯ä¸ªæ ·æœ¬çš„æ•´ä½“é‡åŒ–åˆ†é…è¿‡å°‘çš„ä½ç»“æœä¿¡æ¯ä¼šå¯¼è‡´æ•°å­—éŸ³é¢‘ä¿¡å·äº§ç”Ÿå™ªå£°å’Œæ‰­æ›²ã€‚ä½¿ç”¨<code>ä½å…ƒæ·±åº¦</code>ä¸º8çš„æ–¹æ³•å¯ä»¥æä¾› 256 ä¸ªç¦»æ•£çº§åˆ«çš„æ•°æ®ï¼Œå¯¹äºä¸€äº›éŸ³é¢‘èµ„æºæ¥è¯´ï¼Œè¿™ä¸ªçº§åˆ«çš„<code>é‡‡æ ·ç‡</code>å·²ç»è¶³å¤Ÿäº†ï¼Œä½†å¯¹äºå¤§éƒ¨åˆ†éŸ³é¢‘å†…å®¹æ¥è¯´è¿˜ä¸å¤Ÿé«˜ã€‚CDéŸ³è´¨çš„<code>ä½å…ƒæ·±åº¦</code>ä¸º 16ï¼Œå¯ä»¥è¾¾åˆ° 65536 ä¸ªç¦»æ•£çº§åˆ«ã€‚ä¸“ä¸šçº§åˆ«çš„éŸ³é¢‘å½•åˆ¶ç¯å¢ƒçš„<code>ä½å…ƒæ·±åº¦</code>å¯ä»¥è¾¾åˆ° 24 æˆ–æ›´é«˜ã€‚â€</p>
<h3 id="æ•°å­—åª’ä½“å‹ç¼©"><a href="#æ•°å­—åª’ä½“å‹ç¼©" class="headerlink" title="æ•°å­—åª’ä½“å‹ç¼©"></a>æ•°å­—åª’ä½“å‹ç¼©</h3><p>è§†é¢‘æ–‡ä»¶ç”±ä¸€ç³»åˆ—è¢«ç§°ä¸º<code>å¸§ï¼ˆframeï¼‰</code>çš„å›¾ç‰‡ç»„æˆã€‚è§†é¢‘æ–‡ä»¶ä¸€ç§’é’Ÿå†…æ‰€èƒ½å±•ç°çš„å¸§æ•°ç§°ä¸ºè§†é¢‘çš„<code>å¸§ç‡</code>ï¼Œå¹¶ç”¨ <code>FPS(frames per second)</code> ä½œä¸ºå•ä½è¿›è¡Œæµ‹é‡ã€‚å¸¸è§çš„å¸§ç‡æ˜¯24FPSã€25FPS å’Œ 30FPSã€‚ä»¥ä¸‹æ˜¯ä¸åŒè‰²å½©ç©ºé—´ã€åˆ†è¾¨ç‡åŠå¸§ç‡ä¸‹æœªå‹ç¼©è§†é¢‘å ç”¨ç©ºé—´æ‰“ä¸‹ï¼š</p>
<p><img src="" alt=""></p>
<p>æ˜¾ç„¶ï¼Œéœ€è¦å‹ç¼©ã€‚</p>
<p>è§†é¢‘æ•°æ®é€šå¸¸ç”¨ä¸€ä¸ªå«åš <code>Y&#39;CbCr</code> çš„é¢œè‰²æ¨¡å‹è¿›è¡ŒåŠ å¯†ï¼Œå…¶æ–¹æ³•æ˜¯åˆ†ç¦»è‰²å½©é€šé“ï¼ˆUVï¼‰å’Œäº®åº¦é€šé“ï¼ˆYï¼‰ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ˜¯æˆ‘å­¦ä¹ ã€ŠLearning AV Foundationï¼šA Hands-on Guide to Matering the AV Foundation Frameworkã€‹çš„å­¦ä¹ ç¬”è®°ã€‚å°†ä»¥ç« ä¸ºå•ä½ï¼Œå¯¹å†…å®¹è¿›è¡Œæ€»ç»“ã€‚&lt;/p&gt;
&lt;/blockquo
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="AV Foundation" scheme="http://chengkang.me/tags/AV-Foundation/"/>
    
  </entry>
  
  <entry>
    <title>Core Graphics æ•™ç¨‹ç¬¬ä¸€éƒ¨åˆ†ï¼šå¼€å§‹</title>
    <link href="http://chengkang.me/2017/05/30/core-graphics-tutorial-part-1/"/>
    <id>http://chengkang.me/2017/05/30/core-graphics-tutorial-part-1/</id>
    <published>2017-05-30T11:20:08.000Z</published>
    <updated>2017-05-30T11:21:13.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Core Graphics" scheme="http://chengkang.me/tags/Core-Graphics/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬å››éƒ¨åˆ†ï¼šPathï¼Pathï¼</title>
    <link href="http://chengkang.me/2017/05/29/core-graphics-part-4/"/>
    <id>http://chengkang.me/2017/05/29/core-graphics-part-4/</id>
    <published>2017-05-29T20:18:57.000Z</published>
    <updated>2017-05-29T20:20:17.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.bignerdranch.com/blog/core-graphics-part-4-a-path-a-path/" target="_blank" rel="external">Core Graphics, Part 4: A Path! A Path!</a><br>çœ‹çœ‹ä¸Šä¸€ç¯‡å§ï¼š<a href="http://chengkang.me/2017/05/23/core-graphics-part-3/">ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬ä¸‰éƒ¨åˆ†ï¼šçº¿</a></p>
</blockquote>
<p>åœ¨ Core Graphics ä¸­ï¼Œä¸€ä¸ª <code>path</code> å°±æ˜¯å¯¹æŸç§å½¢çŠ¶çš„ä¸€æ­¥ä¸€æ­¥çš„æè¿°ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªåœ†ã€ä¸€ä¸ªæ­£æ–¹å½¢ã€ä¸€ä¸ªæ¡ƒå¿ƒã€ä¸€ä¸ªå­—é¢‘æŸ±çŠ¶å›¾æˆ–è€…å¯èƒ½æ˜¯ä¸€ä¸ªç¬‘è„¸ã€‚å®ƒå¹¶ä¸åŒ…å«ä»»ä½•è¯¸å¦‚åƒç´ é¢œè‰²ã€çº¿å®½æˆ–æ¸å˜è¿™æ ·çš„ä¿¡æ¯ã€‚è·¯å¾„ä¸»è¦æ˜¯ç”¨äºç»˜åˆ¶â€”â€”å°†å…¶ç”¨é¢œè‰²å¡«å……æˆ–è€…æè¾¹â€”â€”ç”¨é¢œè‰²æå‡ºè½®å»“ã€‚ä½ ä¹‹å‰çœ‹åˆ°çš„å„ç§ <a href="https://www.bignerdranch.com/blog/core-graphics-part-2-contextually-speaking/" target="_blank" rel="external"><code>GState</code></a> å‚æ•°æ§åˆ¶ç€ path å¦‚ä½•è¢«ç»˜åˆ¶ï¼ŒåŒ…æ‹¬ä¾‹å¦‚ line join å’Œ dash pattern åœ¨å†…çš„æ‰€æœ‰<a href="https://www.bignerdranch.com/blog/core-graphics-part-three-lines/" target="_blank" rel="external">çº¿å±æ€§</a>ã€‚</p>
<p>è¿™ä¸€æ¬¡è®©ä½ çœ‹çœ‹ path æ˜¯ä»€ä¹ˆç»„æˆçš„ã€‚ä¸‹ä¸€æ¬¡ä½ ä¼šçœ‹åˆ°ä¸€äº›ç”¨ path èƒ½åšçš„è¿œéç®€å•ç»˜åˆ¶çš„å¾ˆé…·çš„ä¸œè¥¿ã€‚</p>
<a id="more"></a>
<p>è™½ç„¶ä¸€ä¸ª path ä»£è¡¨äº†ä¸€ä¸ªç†æƒ³å›¾å½¢çš„é…æ–¹ï¼Œå®ƒéœ€è¦è¢«æ¸²æŸ“å‡ºæ¥æ‰èƒ½è¢«äººçœŸæ­£çœ‹åˆ°ã€‚æ¯ä¸€ä¸ª Core Graphics context éƒ½å°½å…¶å¯èƒ½å°† path æ¸²æŸ“å‡ºæ¥ã€‚å½“ç»˜åˆ¶ä¸€ä¸ªä½å›¾æ—¶ï¼Œä»»ä½•æ›²çº¿å’Œæ–œçº¿éƒ½æ˜¯åé”¯é½¿åŒ–çš„ã€‚è¿™æ„å‘³ç€ä½¿ç”¨é˜´å½±æ¥æ¬ºéª—çœ¼ç›ä½¿å…¶ä¸€ä½è¿™ä¸ªå½¢çŠ¶æ˜¯å¹³æ»‘çš„å³ä½¿å®ƒæ˜¯ç”±æ–¹å½¢åƒç´ ç‚¹ç»„æˆçš„ã€‚å½“åœ¨æ‰“å°æœºä¸Šç»˜åˆ¶æ—¶ï¼ŒåŒæ ·çš„äº‹æƒ…å‘ç”Ÿç€ï¼Œä¸è¿‡ç”¨çš„æ˜¯æå…¶å°çš„åƒç´ ç‚¹ã€‚å½“ç»˜åˆ¶ PDF æ—¶ï¼Œpath å¤§éƒ¨åˆ†ä»…ä»…æ˜¯åŸä½é˜²æ­¢ï¼Œå› ä¸º Core Graphics ç»˜åˆ¶æ¨¡å‹å’Œ PDF ç»˜åˆ¶æ¨¡å‹åŸºæœ¬æ˜¯ä¸€æ ·çš„ã€‚PDF å¼•æ“ï¼ˆä¾‹å¦‚ Preview æˆ–è€… Adobe Acrobatï¼‰ä¼šå»æ¸²æŸ“é‚£äº› PDF path è€Œé Core Graphics å¼•æ“ã€‚</p>
<p>ä½ å¯ä»¥è¯•è¯• <a href="https://github.com/markd2/grafdemo" target="_blank" rel="external">GrafDemo</a> é‡Œé¢çš„ pathã€‚å¤§å¤šæ•°è¿™é‡Œçš„æˆªå›¾éƒ½æ¥è‡ª GrafDemo é‡Œçš„ Path éƒ¨åˆ†ã€Arcs ä»¥åŠ All The Parts çª—å£ã€‚</p>
<h2 id="è·¯å¾„å…ƒç´ "><a href="#è·¯å¾„å…ƒç´ " class="headerlink" title="è·¯å¾„å…ƒç´ "></a>è·¯å¾„å…ƒç´ </h2><p>ä¸€ä¸ª path å°±æ˜¯ç”±ä¸€äº›è¢«ç§°ä¹‹ä¸º<em>å…ƒç´ </em>çš„åŸå§‹å½¢çŠ¶ï¼ˆæ›²çº¿ã€å¼§å’Œç›´çº¿ï¼‰è¿æ¥èµ·æ¥çš„ä¸€ç³»åˆ—ç‚¹ã€‚ä½ å¯ä»¥æƒ³è±¡æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ç»™ä¸€ä¸ªä¸“é—¨çš„æ‹¿ç€é“…ç¬”çš„æœºå™¨äººçš„ä¸€ä¸ªæŒ‡ä»¤ã€‚ä½ å‘Šè¯‰è¿™ä¸ªæœºå™¨äººè¦æèµ·é“…ç¬”å¹¶ç§»åŠ¨åˆ°ç¬›å¡å°”å¹³é¢çš„ä¸€ä¸ªç‚¹ï¼Œä½†æ˜¯ä¸è¦ç•™ä¸‹ä»»ä½• å°è®°ã€‚ä½ å¯ä»¥å‘Šè¯‰è¿™ä¸ªæœºå™¨äººå»æŠŠé“…ç¬”è½ä¸‹æ¥ç„¶åä»å½“å‰çš„ç‚¹åˆ°ä¸€ä¸ªæ–°ç‚¹é—´ç”»ç‚¹ä»€ä¹ˆã€‚æœ‰äº”ç§åŸºæœ¬çš„è·¯å¾„å…ƒç´ ï¼š</p>
<p><em>Move to Point</em>â€”â€”ç§»åŠ¨å½“å‰çš„ç‚¹åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®ä½†ä¸ç”»ä»»ä½•ä¸œè¥¿ã€‚æœºå™¨äººæŠ¬èµ·é“…ç¬”å¹¶ä¸”ç§»åŠ¨å®ƒçš„æ‰‹è‡‚ã€‚</p>
<p><em>Add Line To Point</em>â€”â€”ä»å½“å‰ç‚¹åˆ°ä¸€ä¸ªæ–°ç‚¹é—´æ·»åŠ ä¸€æ¡çº¿ã€‚æœºå™¨äººå°†é“…ç¬”è½ä¸‹æ¥å¹¶ç”»å‡ºä¸€æ¡ç›´çº¿ã€‚ä»¥ä¸‹æ˜¯ä¸€æ¬¡<em>ç§»åŠ¨åˆ°ç‚¹</em>ï¼ˆå·¦ä¸‹æ–¹ï¼‰å’Œå…¶åçš„ä¸¤æ¬¡<em>æ·»åŠ çº¿åˆ°ç‚¹</em>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: startPoint)</span><br><span class="line">path.addLine(to: nextPoint)</span><br><span class="line">path.addLine(to: endPoint)</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-moveto---x----158-132x---.gif" alt=""></p>
<p><em>æ·»åŠ äºŒæ¬¡æ›²çº¿åˆ°ç‚¹ Add Quad Curve To Point</em>â€”â€”é€šè¿‡ä¸€ä¸ªæ§åˆ¶ç‚¹ï¼Œä»å½“å‰ç‚¹åˆ°ä¸€ä¸ªæ–°ç‚¹é—´æ·»åŠ ä¸€æ¡äºŒæ¬¡æ›²çº¿ã€‚æœºå™¨äººè½ä¸‹äº†é“…ç¬”å¹¶åœ¨ç»˜åˆ¶ä¸€æ¡æ›²çº¿ã€‚è¿™æ¡çº¿å¹¶ä¸æ˜¯ç›´æ¥åˆ’åˆ°é‚£ä¸ªæ§åˆ¶ç‚¹â€”â€”ç›¸åè¿™ä¸ªæ§åˆ¶ç‚¹å½±å“ç€ï¼ˆçº¿çš„ï¼‰å½¢çŠ¶ã€‚æ§åˆ¶ç‚¹ç¦»æ›²çº¿è¶Šè¿œï¼Œå½¢çŠ¶å°±è¶Šæç«¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: firstPoint)</span><br><span class="line">path.addQuadCurve(to: endPoint, control: controlPoint)</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-quadcurve---x----155-130x---.gif" alt=""></p>
<p><em>Add Curve To Point</em>â€”â€”é€šè¿‡ä¸¤ä¸ªæ§åˆ¶ç‚¹ï¼Œä»å½“å‰ç‚¹åˆ°æ–°ç‚¹æ·»åŠ ä¸€æ¡ä¸‰æ¬¡<a href="https://vimeo.com/106757336" target="_blank" rel="external">è´å¡å°”æ›²çº¿</a>ã€‚å’ŒäºŒæ¬¡æ›²çº¿ä¸€æ ·ï¼Œæ§åˆ¶ç‚¹å½±å“ç€è¿™æ¡çº¿è¯¥å¦‚ä½•ç”»ã€‚äºŒæ¬¡æ›²çº¿æ— æ³•è‡ªèº«å½¢æˆä¸€ä¸ªç¯ï¼Œä½†æ˜¯è´å¡å°”æ›²çº¿å¯ä»¥ã€‚å¦‚æœä½ æ›¾åœ¨ Photoshop æˆ–è€… Illustrator ä¸­ä½¿ç”¨è¿‡é’¢ç¬”å·¥å…·ï¼Œä½ å°±å’Œè´å¡å°”æ›²çº¿æ‰“è¿‡äº¤é“äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: firstPoint)</span><br><span class="line">path.addCurve(to: endPoint,</span><br><span class="line">              control1: firstControl,</span><br><span class="line">              control2: secondControl)</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-beziercurve---x----155-130x---.gif" alt=""></p>
<p><em>Close Subpath</em>â€”â€”ä»å½“å‰ç‚¹åˆ°è·¯å¾„çš„ç¬¬ä¸€ä¸ªç‚¹é—´æ·»åŠ ä¸€æ¡ç›´çº¿ã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæœ€è¿‘çš„é‚£ä¸ª move-to-point ï¼ˆçš„ç‚¹ï¼‰ã€‚ä½ ä¼šå¸Œæœ›é—­åˆä¸€ä¸ªè·¯å¾„è€Œéæ·»åŠ ä¸€æ¡çº¿åˆ°èµ·å§‹ä½ç½®ã€‚æ ¹æ®ä½ å¦‚ä½•è®¡ç®—è¿™äº›ç‚¹ï¼Œç´¯ç§¯çš„æµ®ç‚¹åŒ–æ•´å¯èƒ½ä½¿å¾—è®¡ç®—å‡ºçš„ç»ˆç‚¹å’Œèµ·å§‹ç‚¹ä¸ä¸€æ ·ã€‚ä»¥ä¸‹ï¼ˆä»£ç ï¼‰å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: startPoint)</span><br><span class="line">path.addLine(to: nextPoint)</span><br><span class="line">path.addLine(to: endPoint)</span><br><span class="line">path.closeSubpath()</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-closed-path---x----145-132x---.gif" alt=""></p>
<p>æ³¨æ„è¿™ä¸ªåå­—æ˜¯ <em>Close Subpath</em>ã€‚é€šè¿‡æ‰§è¡Œä¸€æ¬¡ move-to æ“ä½œï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ†ç¦»éƒ¨åˆ†çš„è·¯å¾„ï¼Œä¾‹å¦‚è¿™ä¸ªåœ¨æˆ‘ä»¬ <a href="https://www.bignerdranch.com/training/courses/advanced-ios-bootcamp/" target="_blank" rel="external">Advanced iOS bootcamp</a> ä¸­æ–°ç»ƒä¹ é¢˜é‡Œçš„ä¸€ä¸ªæŸ±çŠ¶å›¾ã€‚è¿™äº›æŸ±å½¢éƒ½æ˜¯ç”¨ä¸€ä¸ªè·¯å¾„ç»˜åˆ¶çš„ã€‚è¿™ä¸ªè·¯å¾„è¢«ç”¨æ¥ç»™å®ƒä»¬ä¸Šè‰²ï¼Œå¹¶ä¸”æå‡ºè½®å»“ä»¥æ¸…æ¥šåœ°åŒºåˆ«å„ä¸ªæŸ±å½¢ã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-infographic---x----462-298x---.png" alt=""></p>
<h2 id="é‚£æ ·åšæ–¹ä¾¿å—ï¼Ÿ"><a href="#é‚£æ ·åšæ–¹ä¾¿å—ï¼Ÿ" class="headerlink" title="é‚£æ ·åšæ–¹ä¾¿å—ï¼Ÿ"></a>é‚£æ ·åšæ–¹ä¾¿å—ï¼Ÿ</h2><p>ç®€å•çš„å›¾å½¢ç”¨é‚£ä»…æœ‰çš„äº”ä¸ªåŸºæœ¬è·¯å¾„å…ƒç´ å»ç”Ÿæˆçš„è¯ï¼ˆä»£ç ã€è¿‡ç¨‹ï¼‰å¯èƒ½ä¼šå˜å¾—å¾ˆå†—é•¿ã€‚Core Graphics ï¼ˆæˆ–è€…è¯´ CGï¼‰æä¾›äº†ä¸€äº›ç®€ä¾¿æ–¹æ³•æ¥æ·»åŠ å¸¸è§çš„å½¢çŠ¶ï¼Œæ¯”å¦‚çŸ©å½¢ã€æ¤­åœ†æˆ–è€…ä¸€ä¸ªåœ†è§’çŸ©å½¢ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let squarePath = CGPath(rect: rect1, transform: nil)</span><br><span class="line">let ovalpath = CGPath(ellipseIn: rect2, transform: nil)</span><br><span class="line">let roundedRectanglePath = CGPath(roundedRect: rect3,</span><br><span class="line">                                  cornerWidth: 10.0,</span><br><span class="line">                                  cornerHeight: 10.0,</span><br><span class="line">                                  transform: nil)</span><br></pre></td></tr></table></figure>
<p>è¿™äº›æ–¹æ³•ä½¿ç”¨äº†ä¸€ä¸ª <em>transform</em> å¯¹è±¡ä½œä¸ºå®ƒä»¬æœ€åä¸€ä¸ªå‚æ•°ã€‚ä½ ä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­çœ‹åˆ°æ›´å¤šå…³äº transform çš„ä¸œè¥¿ï¼Œå› æ­¤æš‚æ—¶åªä¼ ä¸ª nil å°±è¡Œäº†ã€‚ä»¥ä¸Šçš„æ–¹æ³•ï¼ˆ<code>CGPath(rect:tranform:)</code>ã€<code>CGPath(ellipseIn:transform:)</code>å’Œ<code>CGPath(roundedRect:cornerWidth:cornerHeight:transform:)</code>ï¼‰ç”Ÿæˆäº†è¿™äº›å½¢çŠ¶ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-conveniences---x----860-230x---.png" alt=""></p>
<p>åŒæ ·ä¹Ÿè¿˜æœ‰ä¸€äº›å¯ä»¥è®©ä½ ç”¨ä¸€ä¸ªå°±èƒ½åˆ›å»ºæ›´å¤æ‚çš„è·¯å¾„çš„æ–¹æ³•ï¼Œä¾‹å¦‚å¤šä¸ªçŸ©å½¢æˆ–è€…å¤šä¸ªæ¤­åœ†ã€å¤šä¸ªçº¿æ®µæˆ–è€…ä¸€æ•´ä¸ªåˆ«çš„è·¯å¾„ã€‚</p>
<h2 id="Noah-çš„-ARCtangent"><a href="#Noah-çš„-ARCtangent" class="headerlink" title="Noah çš„ ARCtangent"></a>Noah çš„ ARCtangent</h2><p>ä½ ä¹Ÿå¯ä»¥åŠ ä¸€ç‚¹å¼§åœ¨é‡Œé¢ï¼Œå°±æ˜¯ä¸€ä¸ªåœ†å½¢è¾¹çš„éƒ¨åˆ†ã€‚ç”¨å“ªä¸€ä¸ªå–å†³äºä½ æ‰‹ä¸Šæ¡ç€ä»€ä¹ˆå€¼ã€‚</p>
<p><em>Arc</em>â€”â€”éœ€è¦ç»™å®šä½ æƒ³è¦çš„å¼§æ‰€åœ¨çš„é‚£ä¸ªåœ†çš„åœ†å¿ƒã€å®ƒçš„åŠå¾„ä»¥åŠèµ·å§‹å’Œç»ˆæ­¢è§’åº¦ï¼ˆç”¨å¼§åº¦è¡¨ç¤ºï¼‰ã€‚é‚£ä¸ªåœ†ä»èµ·å§‹è§’åº¦åˆ°ç»ˆæ­¢è§’åº¦ä¹‹é—´çš„é‚£ä¸€æ®µå°†ä¼šè¢«ç»˜åˆ¶ã€‚å¼§çš„ç»ˆç‚¹æˆä¸ºäº†å½“å‰ç‚¹ã€‚ä»¥ä¸‹ä»£ç ç»˜åˆ¶äº†å·¦è¾¹çš„çº¿ï¼Œå¤–åŠ ä¸€ä¸ªåœ†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: startPoint)</span><br><span class="line">path.addLine(to: firstSegmentPoint)</span><br><span class="line">path.addArc(center: centerPoint,</span><br><span class="line">            radius: radius,</span><br><span class="line">            startAngle: startAngle,</span><br><span class="line">            endAngle: endAngle,</span><br><span class="line">            clockwise: clockwise)</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-arc---x----217-262x---.gif" alt=""></p>
<p><em>Relative Arc</em>â€”â€”è¿™ä¸ªä¸æ­£å¸¸çš„å¼§ç±»ä¼¼ã€‚éœ€è¦ç»™å®šåœ†å¿ƒã€åŠå¾„å’Œèµ·å§‹è§’åº¦ã€‚ä½†å¹¶ä¸æ˜¯è¦ç»™å®šä¸€ä¸ªç»ˆæ­¢è§’åº¦ï¼Œè€Œæ˜¯ä½ è¦è¯´æ˜è¦ä»èµ·å§‹è§’åº¦å¾€å‰æˆ–è€…å¾€åç”»å¤šå°‘ä¸ªå¼§åº¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: startPoint)</span><br><span class="line">path.addLine(to: firstSegmentPoint)</span><br><span class="line">path.addRelativeArc(center: centerPoint,</span><br><span class="line">                    radius: radius,</span><br><span class="line">                    startAngle: startAngle,</span><br><span class="line">                    delta: deltaAngle)</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-relative-arc---x----217-262x---.gif" alt=""></p>
<p><em>Arc to Point</em>â€”â€”è¿™ä¸ªå°±æœ‰ç‚¹å¥‡æ€ªäº†ã€‚ä½ éœ€è¦ç»™å®šåœ†åŠå¾„å’Œä¸¤ä¸ªæ§åˆ¶ç‚¹ã€‚åœ¨åå°å‘¢ï¼Œå½“å‰çš„åº—ä¼šå’Œç¬¬ä¸€ä¸ªæ§åˆ¶ç‚¹è¿æ¥ï¼Œç„¶åä¸ç¬¬äºŒä¸ªæ§åˆ¶ç‚¹å½¢æˆä¸€ä¸ªè§’åº¦ã€‚è¿™äº›çº¿æ¥ä¸‹æ¥è¢«ç”¨äºæ„å»ºä¸€ä¸ªæœ‰ç€ç»™å®šåŠå¾„å¹¶æ­£åˆ‡äºè¿™äº›çº¿çš„åœ†ã€‚æˆ‘å°†è¿™ç§å¼§ç§°ä½œ â€œArc to Pointâ€ æ˜¯å› ä¸ºå…¶åº•å±‚çš„ C API åå­—å« <code>CGContextAddArcToPoint</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: startPoint)</span><br><span class="line">path.addLine(to: firstSegmentPoint)</span><br><span class="line">path.addArc(tangent1End: tangent1Point,</span><br><span class="line">            tangent2End: tangent2Point,</span><br><span class="line">            radius: radius)</span><br></pre></td></tr></table></figure>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2017/02/apath-arc-to-point---x----217-192x---.gif" alt=""></p>
<p>æˆ‘åœ¨è¯•ç€æƒ³å‡ºä¸€ä¸ªè¿™ä¸ªæ–¹æ³•çš„å¥½çš„åº”ç”¨åœºæ™¯æ—¶ï¼Œæœ‹å‹ <a href="https://www.bignerdranch.com/about/the-team/jeremy-sherman/" target="_blank" rel="external">Jeremy W. Sherman</a> æƒ³åˆ°ä¸€ä¸ªå¾ˆé…·çš„åº”ç”¨ï¼šå¦‚æœä½ æƒ³åšä¸€ä¸ªæ›²é¢çš„äº¤å‰å½±çº¿æ—¶å¯èƒ½æ¯”è¾ƒæœ‰ç”¨ï¼Œæƒ³æƒ³â€œç»™ä¸€æŠŠå‰‘çš„é¡¶éƒ¨åŠ ä¸€ç‚¹é˜´å½±â€â€”â€”ä½ å¯ä»¥é‡å¤åŒæ ·çš„æ­£åˆ‡å¹¶ä¸”æ”¹å˜åŠå¾„æ¥ç”»ä¸€äº›ç¦»é¡¶éƒ¨è¶Šæ¥è¶Šè¿œçš„å¼§ã€‚</p>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†è¿™äº›å¼§çš„æ–¹æ³•å¯ä»¥ç”¨ç›´çº¿æ®µæ¥è¿æ¥åœ†å¼§ã€‚ç”¨å‰ä¸¤ä¸ªå¼§æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯å¾„æ˜¯ä¸ä¼šåˆ›å»ºè¿™ä¸ªè¿æ¥ç”¨çš„çº¿æ®µçš„ã€‚Arc to point å¯èƒ½ä¼šåŒ…å«é‚£ä¸ªåˆå§‹çš„éƒ¨åˆ†ã€‚</p>
<h2 id="Path-vs-Context-æ“ä½œ"><a href="#Path-vs-Context-æ“ä½œ" class="headerlink" title="Path vs Context æ“ä½œ"></a>Path vs Context æ“ä½œ</h2><p>æœ‰ä¸¤ç§åœ¨ä»£ç é‡Œåˆ›å»ºè·¯å¾„çš„æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯å‘Šè¯‰ contextï¼šâ€œå˜¿ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ pathâ€ å¹¶å¼€å§‹ç´¯ç§¯ path å…ƒç´ ã€‚è¿™ä¸ª path åœ¨ä½ æè¾¹æˆ–è€…å¡«å……æ—¶å°±æ¶ˆå¤±äº†ã€‚æ²¡äº†ã€‚æ‹œæ‹œäº†ã€‚è¿™ä¸ª path ä¹Ÿå¹¶æ²¡æœ‰è¢«ä¿å­˜æˆ–è€…å¯ä»¥åœ¨ä½ ä¿å­˜æ¢å¤ GState çš„æ—¶å€™æ¢å¤â€”â€”å®ƒå®é™…ä¸Šå¹¶ä¸æ˜¯ GState çš„ä¸€éƒ¨åˆ†ã€‚æ¯ä¸€ä¸ª context åªæœ‰ä¸€ä¸ªåœ¨ç”¨çŠ¶æ€çš„ pathã€‚</p>
<p>ä¸€ä¸‹æ˜¯å½“å‰ context è¢«ç”¨äºæ„å»ºå’Œæè¾¹ä¸€ä¸ª path æ—¶çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let context = UIGraphicsGetCurrentContext()</span><br><span class="line">context.beginPath()</span><br><span class="line">context.move(to: controlPoints[0])</span><br><span class="line">context.addQuadCurve(to: controlPoints[1], control: controlPoints[2])</span><br><span class="line">context.strokePath()</span><br></pre></td></tr></table></figure>
<p>è¿™äº›å¯¹äºé‚£äº›ä¸€æ¬¡æ€§çš„åªåˆ›å»ºä¸€æ¬¡ã€ç”¨ä¸€æ¬¡ç„¶åè¢«é—å¿˜çš„ path éå¸¸æ£’ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>CGMutablePath</code> path å¯¹è±¡ï¼ˆä¸€ä¸ª <code>CGPath</code> ç±»å‹çš„ mutable å­ç±»ï¼Œä¸ <code>NSArray / NSMutableArray</code> é—´çš„å…³ç³»ç±»ä¼¼ï¼‰å¹¶åœ¨å…¶ä¸­ç´¯ç§¯ path ç»„ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªä½ å¯ä»¥ä¸€ç›´ç”¨çš„å®ä¾‹ã€‚è¦ç”¨ä¸€ä¸ª path å¯¹è±¡ç»˜åˆ¶çš„è¯ï¼Œä½ è¦å°†è¿™ä¸ª path æ·»åŠ åˆ° context ä¸­ç„¶åæ‰§è¡Œæè¾¹ä¸/æˆ–å¡«å……æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let path = CGMutablePath()</span><br><span class="line">path.move(to: controlPoints[0])</span><br><span class="line">path.addQuadCurve(to: controlPoints[1], control: controlPoints[2])</span><br><span class="line"></span><br><span class="line">context.addPath(path)</span><br><span class="line">context.strokePath()</span><br></pre></td></tr></table></figure>
<p>å¯¹äºä½ å¸¸ç”¨çš„å½¢çŠ¶ï¼ˆæ¯”å¦‚å¡ç‰‡æ¸¸æˆé‡Œçš„é‚£ä¸€å¥—å›¾æ ‡ï¼‰ï¼Œä½ å¯èƒ½å¸Œæœ›åˆ›å»ºä¸€ä¸ªçº¢å¿ƒ path å’Œä¸€ä¸ªæ–¹ç‰‡ path ä¸€æ¬¡ç„¶åç”¨å®ƒä»¬ä¸€æ¬¡æ¬¡ç»˜åˆ¶ã€‚</p>
<h2 id="å¦‚ä½•åˆ›å»ºï¼Ÿ"><a href="#å¦‚ä½•åˆ›å»ºï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ›å»ºï¼Ÿ"></a>å¦‚ä½•åˆ›å»ºï¼Ÿ</h2><p>é‚£ä¹ˆä½ å¦‚ä½•æ‰èƒ½åˆ›å»ºå‡ºæœ‰ç”¨åˆæœ‰è¶£çš„ path å‘¢ï¼Œæ¯”å¦‚å¿ƒå½¢æˆ–è€…ç¬‘è„¸ï¼Ÿä¸€ä¸ªæ–¹æ³•æ˜¯åšå¥½æ•°å­¦åŠŸè¯¾å¹¶è®¡ç®—å‡ºç‚¹ã€çº¿ã€æ›²çº¿å’Œå¼§éœ€è¦æ€ä¹ˆèµ°ã€‚</p>
<p>å¦ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ç”¨è½¯ä»¶å·¥å…·ã€‚æœ‰ä¸€äº›å¯ä»¥è®©ä½ ç”»å½¢çŠ¶çš„çš„åº”ç”¨ï¼Œç„¶åè¿”å›ç»™ä½ ä¸€å †å¯ä»¥ç›´æ¥ç²˜è´´åˆ°ä½ çš„åº”ç”¨ä¸­çš„ CG ä»£ç ã€‚åŒæ—¶ä¹Ÿæœ‰ä¸€äº›å¯ä»¥å°†å…¶ä»–å½¢å¼æ•°æ®ï¼ˆä¾‹å¦‚æ¥è‡ª Illustratorçš„ã€PDF æˆ–è€… SVGï¼‰è½¬æ¢æˆ path çš„åº“ã€‚æˆ‘åœ¨ç»™ <a href="https://www.bignerdranch.com/blog/protocols-part-2-delegation/" target="_blank" rel="external">Protocols part 2: Delegation</a> å‡†å¤‡çš„ world demo app ä¸­çš„å¯ç‚¹å‡»åœ°å›¾ä¸­ä½¿ç”¨äº† SVGã€‚</p>
<h2 id="è·¯å¾„ï¼Œç»“æ„"><a href="#è·¯å¾„ï¼Œç»“æ„" class="headerlink" title="è·¯å¾„ï¼Œç»“æ„"></a>è·¯å¾„ï¼Œç»“æ„</h2><p>Core Graphics è·¯å¾„æ˜¯ä¸é€æ˜æ•°æ®ç±»å‹ã€‚ä½ å…ˆç´¯ç§¯è·¯å¾„å…ƒç´ ç„¶ååœ¨ context ä¸­æ¸²æŸ“å®ƒã€‚ä¸ºäº†äº†è§£å†…éƒ¨æƒ…å†µï¼Œä½¿ç”¨ <code>CGPath</code> çš„ <code>apply(info:function:)</code> æ–¹æ³•æ¥éå†è·¯å¾„ç»„ä»¶ã€‚ä½ å¯ä»¥æä¾›ä¸€ä¸ªè¢«æ¯ä¸€ä¸ªè·¯å¾„å…ƒç´ é‡å¤è°ƒç”¨çš„æ–¹æ³•ï¼ˆåœ¨ Swift ä¸­ä½ å¯ä»¥ç”¨é—­åŒ…ï¼‰ã€‚ï¼ˆä½ å¯ä»¥å¿½ç•¥ info å‚æ•°é€šè¿‡ä¼  <code>nil</code>ã€‚è¿™æ˜¯åœ¨ Swift Core Graphics API åº•ä¸‹çš„ C API çš„ä¸€ä¸ªå»¶ç»­ã€‚åœ¨ C é‡Œé¢ä½ éœ€è¦æä¾›ä¸€ä¸ªæ–¹æ³•å¹¶ä¼ é€’ä»»ä½•ä½ éœ€è¦åœ¨é‡Œé¢ä½¿ç”¨åˆ°çš„å¯¹è±¡ã€‚ç”¨é—­åŒ…çš„è¯ä½ å°±åªéœ€è¦ç”¨ä½ éœ€è¦çš„é‚£äº›ã€‚ï¼‰</p>
<p>ä¹Ÿå› ä¸ºå…¶å¯¹ C çš„ç»§æ‰¿ï¼Œè¿™ä¸ªä¼ è¿›æ¥çš„æ–¹æ³•æˆ–é—­åŒ…æ˜¯ä¸€ä¸ª <code>UnsafePointer&lt;CGPathElement&gt;</code>ã€‚è¿™æ˜¯ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­ <code>CGPathElement</code> çš„æŒ‡é’ˆã€‚ä½ éœ€è¦é€šè¿‡ <code>pointee</code> æ¥å¼•ç”¨é‚£ä¸ªæŒ‡é’ˆä»¥å¾—åˆ°å®é™…çš„ <code>CGPathElement</code>ã€‚è¿™ä¸ª path å…ƒç´ æœ‰ä¸€ä¸ªç”¨äºè¡¨ç°å…¶ç±»å‹çš„æšä¸¾å€¼ï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„é‡Œçš„ç¬¬ä¸€ä¸ª <code>CGPoint</code> çš„ <code>UnsafeMutablePointer&lt;CGPoint&gt;</code>ã€‚ä½ éœ€è¦è‡ªå·±å»ææ¸…æ¥šä½ å¯ä»¥ä»é‚£ä¸ªæ•°ç»„é‡Œé¢å®‰å…¨è¯»å–å¤šå°‘æŒ‡é’ˆã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª <code>CGPath</code> æ‰©å±•ï¼Œå®ƒå¯ä»¥è®©ä¸€ä¸ª path å€¾å€’å‡ºå…¶å†…å®¹ã€‚ä½ ä¹Ÿå¯ä»¥ä»è¿™ä¸ª <a href="https://gist.github.com/markd2/7bd2a5e2969b000f296828b3bcbf49f8" target="_blank" rel="external">gist</a> ä¸­æ‰¾åˆ°è¿™æ®µä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import CoreGraphics</span><br><span class="line"></span><br><span class="line">extension CGPath &#123;</span><br><span class="line">    func dump() &#123;</span><br><span class="line">        self.apply(info: nil) &#123; info, unsafeElement in</span><br><span class="line">            let element = unsafeElement.pointee</span><br><span class="line"></span><br><span class="line">            switch element.type &#123;</span><br><span class="line">            case .moveToPoint:</span><br><span class="line">                let point = element.points[0]</span><br><span class="line">                print(&quot;moveto - \(point)&quot;)</span><br><span class="line">            case .addLineToPoint:</span><br><span class="line">                let point = element.points[0]</span><br><span class="line">                print(&quot;lineto - \(point)&quot;)</span><br><span class="line">            case .addQuadCurveToPoint:</span><br><span class="line">                let control = element.points[0]</span><br><span class="line">                let point = element.points[1]</span><br><span class="line">                print(&quot;quadCurveTo - \(point) - \(control)&quot;)</span><br><span class="line">            case .addCurveToPoint:</span><br><span class="line">                let control1 = element.points[0]</span><br><span class="line">                let control2 = element.points[1]</span><br><span class="line">                let point = element.points[2]</span><br><span class="line">                print(&quot;curveTo - \(point) - \(control1) - \(control2)&quot;)</span><br><span class="line">            case .closeSubpath:</span><br><span class="line">                print(&quot;close&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºä¹‹å‰åˆ›å»ºé‚£ä¸ª arc to point å›¾ç‰‡çš„ path å±•ç¤ºå‡ºè¿™æ¡å¼§æ˜¯ä¸€ç³»åˆ— curveTo æ“ä½œåŠè¿æ¥ç”¨çš„ç›´çº¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">path.move(to: startPoint)</span><br><span class="line">path.addLine(to: firstSegmentPoint)</span><br><span class="line">path.addArc(tangent1End: tangent1Point,</span><br><span class="line">            tangent2End: tangent2Point,</span><br><span class="line">            radius: radius)</span><br><span class="line">path.addLine(to: secondSegmentPoint)</span><br><span class="line">path.addLine(to: endPoint)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">moveto - (5.0, 91.0)      // explicit code</span><br><span class="line">lineto - (72.3, 91.0)     // explicit code</span><br><span class="line">lineto - (71.6904767391754, 104.885702433811)   // added by addArc</span><br><span class="line">curveTo - (95.5075588575432, 131.015122621923)</span><br><span class="line">        - (71.0519422129889, 118.678048199439)</span><br><span class="line">        - (81.7152130919145, 130.376588095736)</span><br><span class="line">curveTo - (113.012569145714, 124.955236840146)</span><br><span class="line">        - (101.903264013406, 131.311220082842)</span><br><span class="line">        - (108.168814214539, 129.14221144167)</span><br><span class="line">lineto - (129.666666666667, 91.0) // explicit code</span><br><span class="line">lineto - (197.0, 91.0)   // explicit code</span><br></pre></td></tr></table></figure>
<p>å³ä½¿æ˜¯ä¸€ä¸ªç”¨ <code>CGPath(ellipseIn:transform:)</code> åˆ›å»ºçš„â€œç®€å•çš„â€æ¤­åœ†ä¹Ÿæœ‰äº›å¤æ‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curveTo - (62.5, 107.0) - (110.0, 86.4050984922165) - (88.7335256169627, 107.0)</span><br><span class="line">curveTo - (15.0, 61.0) - (36.2664743830373, 107.0) - (15.0, 86.4050984922165)</span><br><span class="line">curveTo - (62.5, 15.0) - (15.0, 35.5949015077835) - (36.2664743830373, 15.0)</span><br><span class="line">curveTo - (110.0, 61.0) - (88.7335256169627, 15.0) - (110.0, 35.5949015077835)</span><br></pre></td></tr></table></figure>
<h2 id="ä¹‹å"><a href="#ä¹‹å" class="headerlink" title="ä¹‹å"></a>ä¹‹å</h2><p>è¿™ä¸€æ¬¡ä½ çœ‹åˆ°äº†åˆ›å»ºä¸€ä¸ª pathã€ç»˜åˆ¶å®ƒä»¥åŠå…¶ä¸­å‘ç”Ÿçš„ä¸€åˆ‡ã€‚è¿˜æœ‰å¾ˆå¤šä½ å¯ä»¥ç”¨ path åšçš„äº‹æƒ…ï¼Œä¸‹æ¬¡ç»§ç»­ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.bignerdranch.com/blog/core-graphics-part-4-a-path-a-path/&quot;&gt;Core Graphics, Part 4: A Path! A Path!&lt;/a&gt;&lt;br&gt;çœ‹çœ‹ä¸Šä¸€ç¯‡å§ï¼š&lt;a href=&quot;http://chengkang.me/2017/05/23/core-graphics-part-3/&quot;&gt;ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬ä¸‰éƒ¨åˆ†ï¼šçº¿&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ Core Graphics ä¸­ï¼Œä¸€ä¸ª &lt;code&gt;path&lt;/code&gt; å°±æ˜¯å¯¹æŸç§å½¢çŠ¶çš„ä¸€æ­¥ä¸€æ­¥çš„æè¿°ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªåœ†ã€ä¸€ä¸ªæ­£æ–¹å½¢ã€ä¸€ä¸ªæ¡ƒå¿ƒã€ä¸€ä¸ªå­—é¢‘æŸ±çŠ¶å›¾æˆ–è€…å¯èƒ½æ˜¯ä¸€ä¸ªç¬‘è„¸ã€‚å®ƒå¹¶ä¸åŒ…å«ä»»ä½•è¯¸å¦‚åƒç´ é¢œè‰²ã€çº¿å®½æˆ–æ¸å˜è¿™æ ·çš„ä¿¡æ¯ã€‚è·¯å¾„ä¸»è¦æ˜¯ç”¨äºç»˜åˆ¶â€”â€”å°†å…¶ç”¨é¢œè‰²å¡«å……æˆ–è€…æè¾¹â€”â€”ç”¨é¢œè‰²æå‡ºè½®å»“ã€‚ä½ ä¹‹å‰çœ‹åˆ°çš„å„ç§ &lt;a href=&quot;https://www.bignerdranch.com/blog/core-graphics-part-2-contextually-speaking/&quot;&gt;&lt;code&gt;GState&lt;/code&gt;&lt;/a&gt; å‚æ•°æ§åˆ¶ç€ path å¦‚ä½•è¢«ç»˜åˆ¶ï¼ŒåŒ…æ‹¬ä¾‹å¦‚ line join å’Œ dash pattern åœ¨å†…çš„æ‰€æœ‰&lt;a href=&quot;https://www.bignerdranch.com/blog/core-graphics-part-three-lines/&quot;&gt;çº¿å±æ€§&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ¬¡è®©ä½ çœ‹çœ‹ path æ˜¯ä»€ä¹ˆç»„æˆçš„ã€‚ä¸‹ä¸€æ¬¡ä½ ä¼šçœ‹åˆ°ä¸€äº›ç”¨ path èƒ½åšçš„è¿œéç®€å•ç»˜åˆ¶çš„å¾ˆé…·çš„ä¸œè¥¿ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Core Graphics" scheme="http://chengkang.me/tags/Core-Graphics/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘å“¥ä»¬å„¿ï¼Œæˆ‘çš„æ–¹æ³•å“ªå„¿å»äº†ï¼Ÿ</title>
    <link href="http://chengkang.me/2017/05/25/dude-where-is-my-call/"/>
    <id>http://chengkang.me/2017/05/25/dude-where-is-my-call/</id>
    <published>2017-05-25T19:09:58.000Z</published>
    <updated>2017-05-25T19:14:05.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.bignerdranch.com/blog/dude-wheres-my-call/" target="_blank" rel="external">Dude, Whereâ€™s my Call?</a></p>
</blockquote>
<p>æƒ³è±¡æœ‰ä¸€å¤©ä½ æ­£åœ¨ç»™ Swift ç¼–è¯‘å™¨å–‚ä¸€äº›çœ‹èµ·æ¥æ— å®³çš„ä»£ç ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// xcrun -sdk macosx swiftc -emit-executable cg.swift</span><br><span class="line"></span><br><span class="line">import CoreGraphics</span><br><span class="line"></span><br><span class="line">let path = CGPathCreateMutable()</span><br><span class="line">CGPathMoveToPoint(path, nil, 0.0, 23.0)</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¸€ä¸ªå†²å‡»æ³¢æ‰“æ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cg.swift:7:12: error: &apos;CGPathCreateMutable()&apos; has been replaced by &apos;CGMutablePath.init()&apos;</span><br><span class="line">&lt;unknown&gt;:0: note: &apos;CGPathCreateMutable()&apos; has been explicitly marked unavailable here</span><br><span class="line">cg.swift:8:1: error: &apos;CGPathMoveToPoint&apos; has been replaced by instance method &apos;CGMutablePath.moveTo(_:x:y:)&apos;</span><br><span class="line">&lt;unknown&gt;:0: note: &apos;CGPathMoveToPoint&apos; has been explicitly marked unavailable here</span><br></pre></td></tr></table></figure>
<p>å®ƒä»¬å“ªå„¿å»äº†ï¼Ÿè¢«é‡å‘½åäº†ã€‚</p>
<a id="more"></a>
<p>Swift 3 ä¸€ä¸ªé‡å¤§çš„ç‰¹æ€§å°±æ˜¯ç”± Swift-Evolution æè®® <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0005-objective-c-name-translation.md" target="_blank" rel="external">SE-0005 (Better Translation of Objective-C APIs Into Swift)</a> å’Œ <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0006-apply-api-guidelines-to-the-standard-library.md" target="_blank" rel="external">SE-0006 (Apply API Guidelines to the Standard Library)</a> å¸¦æ¥çš„â€è¶…çº§é‡å‘½åâ€œï¼Œè¿™æ¬¡è¶…çº§é‡å‘½åé‡å‘½åäº† C å’Œ Objective-C API ä¸­çš„ä¸€äº›æ–¹æ³•ä»¥ç»™å®ƒä»¬ä¸€ç§æ›´ Swift çš„æ„Ÿè§‰ã€‚Xcode é‡Œé¢æœ‰ä¸€ä¸ªç§»æ¤å™¨ä¼šå°†ä½ çš„ Swift 2 ä»£ç è½¬æ¢æˆæ–°çš„é£æ ¼ã€‚å®ƒä¼šæ‰§è¡Œå¾ˆå¤šæœºæ¢°çš„æ”¹å˜ï¼Œç»™ä½ ç•™ä¸€äº›ç”±äºå…¶ä»–è¯­è¨€æ”¹å˜éœ€è¦æ‰«å°¾çš„å·¥ä½œï¼Œä¾‹å¦‚<a href="https://github.com/apple/swift-evolution/blob/master/proposals/0007-remove-c-style-for-loops.md" target="_blank" rel="external">ç§»é™¤ C çš„ for å¾ªç¯</a>ã€‚</p>
<p>æœ‰ä¸€äº›é‡å‘½åç›¸å½“è½»å¾®ï¼Œæ¯”å¦‚ NSView ä¸­çš„è¿™ä¸ªï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Swift 2</span><br><span class="line">let localPoint = someView.convertPoint(event.locationInWindow, fromView: nil)</span><br><span class="line"></span><br><span class="line">// Swift 3</span><br><span class="line">let localPoint = someView.convert(event.locationInWindow, from: nil)</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œ <code>Point</code> ä»æ–¹æ³•åé‡Œç§»é™¤äº†ã€‚ä½ çŸ¥é“è‡ªå·±æ­£åœ¨å¤„ç†ä¸€ä¸ª pointï¼Œæ‰€ä»¥æ²¡å¿…è¦é‡å¤è¿™ä¸€äº‹å®ã€‚<code>fromView</code> é‡å‘½åä¸ºäº† <code>from</code> å› ä¸º <code>View</code> åªæ˜¯æä¾›äº†å†—ä½™çš„ç±»å‹ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰è®©è¿™ä¸ªè°ƒç”¨æ›´æ¸…æ¥šã€‚</p>
<p>å…¶ä»–çš„æ”¹å˜æ›´å¤§ä¸€äº›ï¼Œæ¯”å¦‚ Core Graphicsï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// Swift 2 / (Objective-C)</span><br><span class="line">let path = CGPathCreateMutable()</span><br><span class="line">CGPathMoveToPoint (path, nil, points[i].x, points[i].y)</span><br><span class="line">CGPathAddLineToPoint (path, nil, points[i + 1].x, points[i + 1].y)</span><br><span class="line">CGContextAddPath (context, path)</span><br><span class="line">CGContextStrokePath (context)</span><br><span class="line"></span><br><span class="line">// Swift 3</span><br><span class="line">let path = CGMutablePath()</span><br><span class="line">path.move (to: points[i])</span><br><span class="line">path.addLine (to: points[i + 1])</span><br><span class="line"></span><br><span class="line">context.addPath (path)</span><br><span class="line">context.strokePath ()</span><br></pre></td></tr></table></figure>
<p>å–”å™¢ã€‚è¿™å˜åŒ–å¤ªå¤§äº†ã€‚è¿™ä¸ª API ç°åœ¨çœ‹èµ·æ¥å°±æ˜¯è®©äººå–œæ¬¢çš„ Swift é£æ ¼ API è€Œä¸æ˜¯æ—§å¼çš„ C APIã€‚Apple åœ¨ Swift é‡Œé¢å®Œå…¨æ”¹å˜äº† Core Graphics API ï¼ˆè¿˜æœ‰ GCDï¼‰ä»¥è®©å®ƒä»¬æ›´å¥½ç”¨ã€‚ä½ åœ¨ Swift 3 é‡Œä¸èƒ½å†ç”¨è€å¼çš„ CG C é£æ ¼çš„ APIï¼Œå› æ­¤ä½ éœ€è¦å¼€å§‹ä¹ æƒ¯æ–°çš„é£æ ¼ã€‚æˆ‘å·²ç»å°† GrafDemo ï¼ˆæˆ‘è¿™äº› <a href="http://chengkang.me/2017/05/23/core-graphics-part-1/">Core Graphics</a> åšæ–‡çš„ç¤ºä¾‹ç¨‹åºï¼‰ åœ¨è‡ªåŠ¨ç¿»è¯‘å™¨ä¸­è·‘è¿‡ï¼ˆä¸¤æ¬¡ï¼‰äº†ã€‚ä½ å¯ä»¥åœ¨è¿™ä¸ª <a href="https://github.com/markd2/GrafDemo/pull/17/files" target="_blank" rel="external">pull</a> è¯·æ±‚ä¸­çœ‹åˆ° Swift 3 ç¬¬ä¸€ä¸ªç‰ˆæœ¬å‰åçš„å˜åŒ–ï¼Œåœ¨è¿™ä¸ª <a href="https://github.com/markd2/GrafDemo/pull/18/files" target="_blank" rel="external">pull</a> è¯·æ±‚ä¸­çœ‹åˆ° Xcode8b6 çš„ Swift 3 ç‰ˆæœ¬å‰åå˜åŒ–ã€‚</p>
<h2 id="ä»–ä»¬å¹²ä»€ä¹ˆäº†ï¼Ÿ"><a href="#ä»–ä»¬å¹²ä»€ä¹ˆäº†ï¼Ÿ" class="headerlink" title="ä»–ä»¬å¹²ä»€ä¹ˆäº†ï¼Ÿ"></a>ä»–ä»¬å¹²ä»€ä¹ˆäº†ï¼Ÿ</h2><p>Core Graphics API å°±æ˜¯ä¸€å †å…¨å±€å˜é‡å’Œå…¨å±€è‡ªç”±æ–¹æ³•ã€‚å°±æ˜¯è¯´ï¼Œæ–¹æ³•å¹¶ä¸æ˜¯ç›´æ¥å’ŒæŸäº›æ¯”å¦‚è¯´ç±»æˆ–è€…ç»“æ„ä½“è¿™æ ·çš„å®ä¾‹ç»‘å®šçš„ã€‚ç”¨ <code>CGContextAddArcToPoint</code> æ¥æ“ä½œ <code>CGContext</code> ä»…ä»…æ˜¯ä¸€ä¸ªä¼ ç»Ÿï¼Œä¸è¿‡ä½ ä¼ è¿›å»ä¸€ä¸ª <code>CGColor</code> ä¹Ÿä¸ä¼šæœ‰äººæ‹¦ç€ä½ ã€‚æ— éå°±æ˜¯ä¼šåœ¨è¿è¡Œæ—¶çˆ†ç‚¸è€Œå·²ã€‚åªæ˜¯åœ¨ C é£æ ¼çš„é¢å‘å¯¹è±¡ä½ æ‰æœ‰ä¸€ä¸ªéšæ™¦ç±»å‹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ è¿‡å»ï¼Œä½œä¸ºæŸç§ç¥å¥‡é¥¼å¹²ã€‚<code>CGContext*</code> æ–¹æ³•éœ€è¦ä¸€ä¸ª <code>CGContextRef</code>ã€‚<code>CGColor*</code> æ–¹æ³•éœ€è¦ä¸€ä¸ª <code>CGColorRef</code>ã€‚</p>
<p>é€šè¿‡ä¸€äº›ç¼–è¯‘å™¨çš„é­”æ³•ï¼ŒApple å°†è¿™äº›éšæ™¦å¼•ç”¨è½¬æˆäº†ç±»ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€äº›æ–¹æ³•ç»™è¿™äº›ç±»ä»¥å°†å…¶æ˜ å°„åˆ° C APIã€‚å½“ç¼–è¯‘å™¨çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä¸œè¥¿æ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let path = CGMutablePath()</span><br><span class="line">path.addLines(between: self.points)</span><br><span class="line">context.addPath(path)</span><br><span class="line">context.strokePath()</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼Œåœ¨èƒŒåï¼Œæ­£åœ¨å‘å‡ºè¿™ä¸€ç³»åˆ—è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let path = CGPathCreateMutable()</span><br><span class="line">CGPathAddLines(path, nil, self.points, self.points.count)</span><br><span class="line">CGContextAddPath(context, path)</span><br><span class="line">CGContextStrokePath(context)</span><br></pre></td></tr></table></figure>
<h2 id="â€œæ–°çš„â€ç±»"><a href="#â€œæ–°çš„â€ç±»" class="headerlink" title="â€œæ–°çš„â€ç±»"></a>â€œæ–°çš„â€ç±»</h2><p>ä»¥ä¸‹æ˜¯å·²ç»æ¥å— Swift 3.0 æ²»ç–—çš„å¸¸è§çš„éšæ™¦ç±»å‹ ï¼ˆå¿½ç•¥äº†ä¸€äº›ä¸“ç”¨çš„ç±»å‹æ¯”å¦‚ <code>CGDisplayMode</code> æˆ–è€… <code>CGEvent</code>ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸¤ä¸ªä½œä¸ºä»£è¡¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>CGAffineTransform - translateBy(x:30, y:50), rotate(by: CGFloat.pi / 2.0)</code></li>
<li><code>CGPath / CGMutablePath - contains(point, using: evenOdd), .addRelativeArc(center: x, radius: r, startAngle: sa, delta: deltaAngle)</code></li>
<li><code>CGContext - context.addPath(path), context.clip(to: cgrectArray)</code></li>
<li><code>CGBitmapContext (folded in to CGContext) - let c = CGContext(data: bytes, width: 30, height: 30, bitsPerComponent: 8, bytesPerRow: 120, space: colorspace, bitmapInfo: 0)</code></li>
<li><code>CGColor - let color = CGColor(red: 1.0, green: 0.5, blue: 0.333, alpha: 1.0)</code></li>
<li><code>CGFont - let font = CGFont(&quot;Helvetica&quot;), font.fullName</code></li>
<li><code>CGImage - image.masking(imageMask), image.cropping(to: rect)</code></li>
<li><code>CGLayer - let layer = GCLayer(context, size: size, auxilaryInfo: aux), layer.size</code></li>
<li><code>CGPDFContext (folded in to CGContext) / CGPDFDocument - context.beginPDFPage(pageInfo)</code></li>
</ul>
<p><code>CGRect</code> å’Œ <code>CGPoint</code> åœ¨ Swift 3 ä¹‹å‰æ—©å·²æœ‰äº†ä¸€äº›å¾ˆä¸é”™çš„æ‰©å±•ã€‚</p>
<h2 id="æ€ä¹ˆåšåˆ°çš„ï¼Ÿ"><a href="#æ€ä¹ˆåšåˆ°çš„ï¼Ÿ" class="headerlink" title="æ€ä¹ˆåšåˆ°çš„ï¼Ÿ"></a>æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</h2><p>ç¼–è¯‘å™¨æœ‰ä¸€ä¸ªå†…ç½®çš„è¯­æ³•è½¬æ¢å™¨ï¼Œå®ƒå°† Objective-C çš„æ˜æ˜é£æ ¼è½¬æ¢æˆæ›´ Swift äº›çš„å½¢å¼ã€‚å»æ‰é‡å¤çš„å•è¯å’Œé‚£äº›ä»…ä»…æ˜¯é‡å¤ç±»å‹ä¿¡æ¯çš„å•è¯ã€‚è¿˜å»æ‰äº†ä¸€äº›ä¹‹å‰æ˜¯åœ¨æ–¹æ³•è°ƒç”¨å·¦æ‹¬å·ä¹‹å‰çš„å•è¯å¹¶å°†å®ƒä»¬ç§»åˆ°æ‹¬å·é‡Œé¢ä½œä¸ºå‚æ•°æ ‡ç­¾ã€‚é€šè¿‡è¿™æ ·è‡ªåŠ¨æ¸…ç†äº†ä¸€å¤§å †è°ƒç”¨æ–¹æ³•ã€‚</p>
<p>å½“ç„¶ï¼Œäººç±»å–œæ¬¢æä¸€äº›å¾®å¦™å¤æ‚çš„è¨€è¾ï¼Œå› æ­¤åœ¨ Swift ç¼–è¯‘å™¨é‡Œæœ‰ä¸€ä¸ªå…è®¸æ‰‹åŠ¨é‡å†™è‡ªåŠ¨ç¿»è¯‘å™¨ç¿»è¯‘çš„éƒ¨åˆ†çš„æœºåˆ¶ã€‚è¿™æ˜¯å…·ä½“çš„å®ç°äº†ï¼ˆåˆ«åœ¨è¾“å‡ºäº§å“æ—¶ä¾é ä»–ä»¬ï¼‰ï¼Œä¸è¿‡ä»–ä»¬æä¾›äº†æ·±å…¥äº†è§£ç”¨äºè®©ç°å­˜ API å‡ºç°åœ¨ Swift ä¸­æ‰€åšçš„é‚£äº›å·¥ä½œçš„æœºä¼šã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªæ¶‰åŠåˆ°çš„æœºåˆ¶æ˜¯ â€overlayâ€œï¼Œå®ƒæ˜¯å½“ä½ å¼•å…¥ä¸€ä¸ªæ¡†æ¶æˆ–è€… C åº“æ—¶ç¼–è¯‘å™¨å¼•ç”¨çš„ç¬¬äºŒä¸ªåº“ã€‚<a href="https://raw.githubusercontent.com/apple/swift/master/docs/Lexicon.rst" target="_blank" rel="external">Swift Lexicon</a> å°† overlay å½¢å®¹ä¸ºâ€å½“åº“åœ¨ç³»ç»Ÿä¸­ä¸å‘è¢«ä¿®æ”¹æ—¶åœ¨ç³»ç»Ÿä¸­å¢å¼ºå’Œæ‰©å¤§è¿™ä¸ªåº“â€œã€‚ä¸€äº›ä¸€ç›´éƒ½å­˜åœ¨å¾ˆæ£’çš„ <code>CGRect</code> å’Œ <code>CGPoint</code> æ‰©å±•ï¼Œä¾‹å¦‚<code>someRect.divide(30.0, fromEdge: .MinXEdge)</code>ï¼Œæ€ä¹ˆæ¥çš„ï¼Ÿä»–ä»¬æ¥è‡ª overlayã€‚å·¥å…·é“¾æƒ³å•Šâ€å™¢ï¼Œæˆ‘çœ‹åˆ°ä½ åœ¨é“¾æ¥ Core Graphicsã€‚è®©æˆ‘å†åŠ ç‚¹æ–¹ä¾¿æ–¹æ³•å§ã€‚â€œ</p>
<p>è¿˜æœ‰å¦å¤–ä¸€ä¸ªæœºåˆ¶ï¼Œ<a href="https://github.com/apple/swift/tree/master/apinotes" target="_blank" rel="external">apinotes</a>ï¼Œç‰¹åˆ«æ˜¯ <a href="https://github.com/apple/swift/blob/master/apinotes/CoreGraphics.apinotes" target="_blank" rel="external">CoreGraphics.apinotes</a>ï¼Œä¸€å­—ä¸€è¯åœ°æ§åˆ¶ç€ Core Graphics ä¸­åœ°å‘½åå’Œå¯è§æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ Swift ä¸­åƒ <code>CGRectMake</code> è¿™æ ·ç”¨æ¥åˆå§‹åŒ–åŸºç¡€ç»“æ„ä½“çš„è°ƒç”¨æ²¡æœ‰ä½œç”¨ï¼Œå› ä¸ºå·²ç»æœ‰å®ƒä»¬çš„åˆå§‹åŒ–æ–¹æ³•äº†ã€‚æ‰€ä»¥å°±è®©è¿™äº›è°ƒç”¨æ–¹æ³•ä¸å¯ç”¨äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># The below are inline functions that are irrelevant due to memberwise inits</span><br><span class="line">- Name: CGPointMake</span><br><span class="line">  Availability: nonswift</span><br><span class="line">- Name: CGSizeMake</span><br><span class="line">  Availability: nonswift</span><br><span class="line">- Name: CGVectorMake</span><br><span class="line">  Availability: nonswift</span><br><span class="line">- Name: CGRectMake</span><br><span class="line">  Availability: nonswift</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿˜æœ‰å…¶ä»–çš„æ˜ å°„â€”â€”å¦‚æœä½ åœ¨ Swift ä¸­çœ‹åˆ°è¿™ä¸ªï¼Œé‚£å°±è°ƒç”¨é‚£ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># The below are fixups that inference didn&apos;t quite do what we wanted, and are</span><br><span class="line"># pulled over from what used to be in the overlays</span><br><span class="line">- Name: CGRectIsNull</span><br><span class="line">  SwiftName: &quot;getter:CGRect.isNull(self:)&quot;</span><br><span class="line">- Name: CGRectIsEmpty</span><br><span class="line">  SwiftName: &quot;getter:CGRect.isEmpty(self:)&quot;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç¼–è¯‘å™¨çœ‹åˆ°äº†æ¯”å¦‚ <code>rect.isEmpty()</code> è¿™æ ·çš„ä¸œè¥¿ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªè¯·æ±‚ç»™ <code>CGRectIsEmpty</code>ã€‚</p>
<p>ä»¥ä¸‹è¿˜æ˜¯ä¸€äº›æ–¹æ³•å’ŒåŠŸèƒ½çš„é‡å‘½åï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># The below are attempts at providing better names than inference</span><br><span class="line">- Name: CGPointApplyAffineTransform</span><br><span class="line">  SwiftName: CGPoint.applying(self:_:)</span><br><span class="line">- Name: CGSizeApplyAffineTransform</span><br><span class="line">  SwiftName: CGSize.applying(self:_:)</span><br><span class="line">- Name: CGRectApplyAffineTransform</span><br><span class="line">  SwiftName: CGRect.applying(self:_:)</span><br></pre></td></tr></table></figure>
<p>å½“ç¼–è¯‘å™¨çœ‹åˆ° <code>rect.applying(transform)</code>ï¼Œå®ƒå°±çŸ¥é“è°ƒç”¨ <code>CGRectApplyAffineTransform</code>ã€‚</p>
<p>ç¼–è¯‘å™¨åªèƒ½è‡ªåŠ¨é‡å‘½å Objective-C APIï¼Œå› ä¸ºå…¶éµå¾ªè‰¯å¥½çš„ç³»ç»Ÿå‘½åæ³•ã€‚C API ï¼ˆæ¯”å¦‚ Core Graphicsï¼‰éœ€è¦é€šè¿‡ overlay å’Œ apinote æ¥å®ç°ã€‚</p>
<h2 id="ä½ èƒ½åšä»€ä¹ˆ"><a href="#ä½ èƒ½åšä»€ä¹ˆ" class="headerlink" title="ä½ èƒ½åšä»€ä¹ˆ"></a>ä½ èƒ½åšä»€ä¹ˆ</h2><p>ä½ å¯ä»¥é€šè¿‡ <code>NS_SWIFT_NAME</code> åšä¸€äº›ç±»ä¼¼ apinote æœºåˆ¶çš„äº‹æƒ…ã€‚ä½ å¯ä»¥ç”¨è¿™ä¸ªå®æ¥æ³¨é‡Š C/Objective-C å¤´æ–‡ä»¶ï¼Œè¡¨ç¤ºåœ¨ Swift é‡Œè¦ç”¨é‚£ä¸ªåå­—ã€‚ç¼–è¯‘å™¨ä¼šå¯¹ä½ çš„ <code>NS_SWIFT_NAME</code> é‡‡ç”¨åŒæ ·çš„æ›¿æ¢ï¼ˆâ€å¦‚æœçœ‹åˆ° Xï¼Œå°±è°ƒç”¨ Yâ€œï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¿™æ˜¯ä¸€ä¸ª Intents(Siri) æ¡†æ¶ä¸­çš„è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)resolveWorkoutNameForEndWorkout:(INEndWorkoutIntent *)intent</span><br><span class="line">                         withCompletion:(void (^)(INSpeakableStringResolutionResult *resolutionResult))completion</span><br><span class="line">     NS_SWIFT_NAME(resolveWorkoutName(forEndWorkout:with:));</span><br></pre></td></tr></table></figure>
<p>ä» Objective-C ä¸­è°ƒç”¨å®ƒçš„è¯çœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSObject&lt;INEndWorkoutIntentHandling&gt; *workout = ...;</span><br><span class="line"></span><br><span class="line">[workout resolveWorkoutNameForEndWorkout: intent  withCompletion: ^(INSpeakableStringResolutionResult) &#123;</span><br><span class="line">     ...</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨ Swift ä¸­æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let workout: INEndWorkoutIntentHandling = ...</span><br><span class="line">workout.resolveWorkoutName(forEndWorkout: workout) &#123;</span><br><span class="line">    response in</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>NS_SWIFT_NAME</code>ï¼Œå’Œ Objective-C ä¸­çš„è½»é‡çº§æ³›å‹ï¼Œnullability æ³¨é‡Šï¼Œä»¥åŠ Swift ç¼–è¯‘å™¨ä¸­çš„è‡ªåŠ¨ Objective-C API é‡å‘½åä¸€èµ·ï¼Œå¯ä»¥è®©ä½ ç«‹åˆ»æœ‰ä¸€ç§æ¥å£éƒ½å›åˆ° Swift ä¸–ç•Œä¸­çš„æ„Ÿè§‰ã€‚</p>
<p>ä½¿ç”¨è‡ªåˆ¶çš„ overlay å’Œ apinote æ˜¯å¯ä»¥çš„ï¼Œä½†é‚£äº›åŸæœ¬æ˜¯åœ¨ Swift å’Œ Apple çš„ SDK ç»“åˆåœ¨ä¸€èµ·æ—¶ç”¨çš„ã€‚ä½ å¯ä»¥åœ¨ä½ è‡ªå·±çš„æ¡†æ¶ä¸­åˆ†å‘ apinoteï¼Œä½†æ˜¯ overlay éœ€è¦ä» Swift ç¼–è¯‘å™¨æ ‘ä¸­ç¼–è¯‘ã€‚</p>
<p>ä¸ºäº†è‡ªå·±åˆ›å»ºæ›´ Swift çš„ APIï¼Œä½ å¿…é¡»å°½å¯èƒ½åœ°åšå¥½å¤´æ–‡ä»¶æ—å¬ï¼ˆæ¯”å¦‚æ·»åŠ  nullability æ³¨é‡Šå’Œ NS_SWIFT_NAMEï¼‰ï¼Œç„¶ååœ¨ä½ çš„é¡¹ç›®ä¸­æ”¾ä¸€äº› Swift æ–‡ä»¶æ¥ä¼ªé€  overlay ä»¥è¦†ç›–ä»»ä½•å¤šä½™æƒ…å†µã€‚è¿™äº› â€overlayâ€ æ–‡ä»¶åœ¨æœ‰ ABI ç¨³å®šæ€§å‰éƒ½éœ€è¦ä½œä¸ºæºæ–‡ä»¶ä¼ é€ã€‚</p>
<p>è½»æ è¿‡ iOS 10 å¤´æ–‡ä»¶ï¼Œçœ‹èµ·æ¥æ–°çš„ API å–œæ¬¢ç”¨ <code>NS_SWIFT_NAME</code>ï¼Œè€Œè€ä¸€ç‚¹çš„æ›´ä¹…è¿œä¸€äº›çš„ API ç”¨ apinoteã€‚è¿™æ ·æœ‰ä¸€äº›é“ç†å› ä¸ºè¿™äº›å¤´æ–‡ä»¶æ˜¯åœ¨ä¸åŒ Swift ç‰ˆæœ¬ä¸­å…±äº«çš„ï¼Œè€Œç»™æ›´ä¹…è¿œçš„å¤´æ–‡ä»¶å¯èƒ½æ·»åŠ æ–°çš„ <code>NS_SWIFT_NAME</code> å¯èƒ½ä¼šåœ¨ç¼–è¯‘å™¨æœªæ”¹å˜çš„æƒ…å†µä¸‹ç ´åå½“å‰çš„ä»£ç ã€‚è€Œä¸”ï¼Œapinote å¯ä»¥ç”±ç¼–è¯‘å™¨å›¢é˜Ÿæˆ–è€…ç¤¾åŒºæˆå‘˜æ·»åŠ ï¼Œè€Œå¤´æ–‡ä»¶çš„æ”¹å˜éœ€è¦æ‹¥æœ‰è¿™ä¸ªå¤´æ–‡ä»¶çš„å›¢é˜Ÿçš„æ³¨æ„ã€‚è€Œé‚£ä¸ªå›¢é˜Ÿå¯èƒ½å·²ç»å‡†å¤‡å¥½æ­£è¦å‘å¸ƒä»–ä»¬çš„åŠŸèƒ½äº†ã€‚</p>
<h2 id="å®ƒå¥½å—ï¼Ÿ"><a href="#å®ƒå¥½å—ï¼Ÿ" class="headerlink" title="å®ƒå¥½å—ï¼Ÿ"></a>å®ƒå¥½å—ï¼Ÿ</h2><p>Swift 3 ç‰ˆæœ¬çš„ Core Graphics ç»å¯¹æ˜¯æ›´ä¼˜ç§€æ›´åŠ  Swift åŒ–ã€‚è€å®è¯´ï¼Œæˆ‘ä¹Ÿæƒ³åœ¨ Objective-C ä¸Šè¿™æ ·ç”¨ã€‚ä½ å¯èƒ½å› æ­¤å¤±æ‰ä¸€äº›å¯ Google æ€§ï¼Œå¹¶ä¸”éœ€è¦å½“ä½ åœ¨ Stack Overflow çš„æ–‡ç« æˆ–è€…ç½‘ä¸Šçš„æ•™ç¨‹ä¸­çœ‹åˆ°ç°æœ‰çš„ CG ä»£ç æ—¶åšä¸€äº›è„‘å†…è½¬æ¢ã€‚ä¸è¿‡é‚£ä¹Ÿä¸å¿…è¿™äº›æ—¥å­æ™®é€šçš„ Swift ä»£ç æ‰€éœ€çš„è„‘åŠ›è¿åŠ¨å¤šå¤šå°‘ã€‚</p>
<p>æœ‰ä¸€äº›ç”±äº CG ç±»ä¼¼ OO æœ¬è´¨åŠå…¶å¦‚ä½•è¿›å…¥ Swift ä¸­å¸¦æ¥çš„ API çš„ä¸åè°ƒã€‚åœ¨è¿™ä¸ª <code>CoreGraphics.apinotes</code> ä¸­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- Name: CGBitmapContextGetWidth</span><br><span class="line">  SwiftName: getter:CGContext.width(self:)</span><br><span class="line">- Name: CGPDFContextBeginPage</span><br><span class="line">  SwiftName: CGContext.beginPDFPage(self:_:)</span><br></pre></td></tr></table></figure>
<p><code>CGBitmapContext</code> å’Œ <code>CGPDFContext</code> æ–¹æ³•éƒ½è¢« <code>CGContext</code> å·å»äº†ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¯¹ä»»ä½• <code>CGContext</code> è¦å®ƒçš„å®½åº¦ï¼Œæˆ–è€…å«å®ƒå¼€å§‹ä¸€ä¸ª PDF é¡µé¢ã€‚å¦‚æœä½ æ‰¾ä¸€ä¸ªéä½å›¾ context è¦å®ƒçš„å®½ï¼Œä½ ä¼šå¾—åˆ°è¿™æ ·çš„è¿è¡Œæ—¶é”™è¯¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Error&gt;: CGBitmapContextGetWidth: invalid context 0x100e6c3c0.</span><br><span class="line">If you want to see the backtrace, please set CG_CONTEXT_SHOW_BACKTRACE environmental variable.</span><br></pre></td></tr></table></figure>
<p>å› æ­¤å³ä½¿è¿™ä¸ª API éå¸¸ Swift åŒ–äº†ï¼Œç¼–è¯‘å™¨å¹¶ä¸èƒ½æ•è·æŸäº›ç±»å‹çš„ API é”™ç”¨ã€‚Xcode ä¼šé«˜é«˜å…´å…´åœ°ç»™ä½ å…¶å®å®é™…ä¸Šä¸åˆé€‚çš„æ–¹æ³•è¡¥å…¨ã€‚æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼ŒC API æ›´å®‰å…¨ä¸€ç‚¹ï¼Œå› ä¸º <code>CGBitmapContextGetWidth</code> å¾ˆæ¸…æ¥šåœ°å‘Šè¯‰ä½ å®ƒè¦çš„æ˜¯ä¸€ä¸ªä½å›¾ context å³ä½¿ç¬¬ä¸€ä¸ªå‚æ•°ä»æŠ€æœ¯ä¸Šæ¥è¯´å°±è¿˜æ˜¯ä¸€ä¸ª <code>CGContextRef</code>ã€‚æˆ‘å¸Œæœ›è¿™ä»…ä»…æ˜¯ä¸€ä¸ª bug ï¼ˆ<a href="https://openradar.appspot.com/radar?id=6161102635270144" target="_blank" rel="external">rdar://27626070</a>ï¼‰ã€‚</p>
<p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šæƒ³è¶…çº§é‡å‘½åä»¥åŠåƒ NS_SWIFT_NAME è¿™æ ·çš„å·¥å…·ï¼Œçœ‹çœ‹è¿™ä¸ªå§ <a href="https://developer.apple.com/videos/play/wwdc2016/403/" target="_blank" rel="external">WWDC 2016 Session 403 - iOS API Design Guidelines</a>ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.bignerdranch.com/blog/dude-wheres-my-call/&quot;&gt;Dude, Whereâ€™s my Call?&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æƒ³è±¡æœ‰ä¸€å¤©ä½ æ­£åœ¨ç»™ Swift ç¼–è¯‘å™¨å–‚ä¸€äº›çœ‹èµ·æ¥æ— å®³çš„ä»£ç ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// xcrun -sdk macosx swiftc -emit-executable cg.swift&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;import CoreGraphics&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;let path = CGPathCreateMutable()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;CGPathMoveToPoint(path, nil, 0.0, 23.0)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶åä¸€ä¸ªå†²å‡»æ³¢æ‰“æ¥ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;cg.swift:7:12: error: &amp;apos;CGPathCreateMutable()&amp;apos; has been replaced by &amp;apos;CGMutablePath.init()&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;unknown&amp;gt;:0: note: &amp;apos;CGPathCreateMutable()&amp;apos; has been explicitly marked unavailable here&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cg.swift:8:1: error: &amp;apos;CGPathMoveToPoint&amp;apos; has been replaced by instance method &amp;apos;CGMutablePath.moveTo(_:x:y:)&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;unknown&amp;gt;:0: note: &amp;apos;CGPathMoveToPoint&amp;apos; has been explicitly marked unavailable here&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;å®ƒä»¬å“ªå„¿å»äº†ï¼Ÿè¢«é‡å‘½åäº†ã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Swift" scheme="http://chengkang.me/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬ä¸‰éƒ¨åˆ†ï¼šçº¿</title>
    <link href="http://chengkang.me/2017/05/25/core-graphics-part-3/"/>
    <id>http://chengkang.me/2017/05/25/core-graphics-part-3/</id>
    <published>2017-05-24T23:23:05.000Z</published>
    <updated>2017-05-24T23:24:56.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.bignerdranch.com/blog/core-graphics-part-three-lines/" target="_blank" rel="external">Core Graphics, Part 2: Contextually Speaking</a><br>çœ‹çœ‹ä¸Šä¸€ç¯‡å§ï¼š<a href="http://chengkang.me/2017/05/23/core-graphics-part-2/">ã€è¯‘ã€‘Core Graphics, ç¬¬äºŒéƒ¨åˆ†ï¼šè¯´è¯´ context ï¼ˆä¸Šä¸‹æ–‡ï¼‰</a></p>
</blockquote>
<p>è®¾æƒ³è¿™æ ·ä¸€æ¡ç®€å•çš„çº¿ï¼šå°±æ˜¯è¿æ¥ä¸¤ç‚¹çš„ä¸€æ¡ç›´åƒç´ åºåˆ—ã€‚æœ‰ä¸€äº›æœ‰åçš„ç®—æ³•ä½ å¯ä»¥ç”¨æ¥è‡ªå·±åšç»˜åˆ¶ï¼Œä½†æ˜¯è¿‘äº›æ—¥å­ï¼Œæˆ‘ä»¬æœ‰äº†å·¥å…·ç®±æ¥å¸®å¿™åšç¹æ‚çš„å·¥ä½œã€‚åœ¨ Core Graphics ä¸­ï¼Œä¸€æ¡çº¿å°±åªæ˜¯ä¸€ç§è·¯å¾„ã€‚è·¯å¾„å¯¹äºè®¸å¤š Core Graphics çš„ç‰¹æ€§æ¥è¯´éƒ½æ˜¯ä¸­å¿ƒï¼Œä¸‹ä¸€å›ä½ ä¼šå¾—çŸ¥å¾ˆå¤šè·¯å¾„çš„ä¿¡æ¯ã€‚ä¸è¿‡ç°åœ¨ï¼Œå…ˆæŠŠçº¿æƒ³æˆè¢«æå‡ºè½®å»“ï¼ˆè€Œéå¡«å……ï¼‰çš„ä¸€ç³»åˆ—çº¿çš„ç‰‡æ®µã€‚æœ‰ä¸€å¤§å †æ™®éçš„ <code>GState</code> å‚æ•°èƒ½å½±å“çº¿ï¼ˆçš„é¢œè‰²ã€å®½åº¦ã€é˜´å½±åŠå½¢å˜ï¼‰ï¼ŒåŒæ ·ä¹Ÿæœ‰ GState çš„å€¼ä¸ç»˜åˆ¶çº¿æœ‰å…³ã€‚</p>
<p>ä½ åœ¨è¿™çœ‹åˆ°çš„æ‰€æœ‰çº¿çš„å›¾ç‰‡éƒ½æ˜¯ç”¨ GrafDemo åˆ›å»ºçš„ã€‚ä½ å¯ä»¥åœ¨ <a href="https://github.com/markd2/GrafDemo" target="_blank" rel="external">GitHub</a> ä¸Šæ‰¾åˆ°æºç ï¼Œè¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬ä¸ºâ€Release cg-pt3â€œã€‚</p>
<a id="more"></a>
<p>è¿™å°±æ˜¯ Lines çª—å£çš„æ ·å­ï¼Œå·¦è¾¹æ˜¯ Objective-C çš„ NSViewï¼Œå³è¾¹æ˜¯ Swift çš„ NSViewã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-grafdemo-window.png" alt=""></p>
<p>å›æƒ³ä¸€ä¸‹ï¼ŒCG path åªæ˜¯å½¢çŠ¶çš„æè¿°ã€‚å®ƒä»¬å¹¶ä¸å®é™…åŒ…å«ä»»ä½•åƒç´ ç‚¹ã€‚<code>GState</code> æ§åˆ¶ç€ path å®é™…ä¸Šå¦‚ä½•è¢«æ¸²æŸ“ï¼Œåœ¨ view é‡Œé¢ã€image é‡Œé¢æˆ–è€… PDF é‡Œé¢ä¹Ÿå¥½ï¼Œæ— è®ºæ˜¯è¢«å¡«å……æˆ–è€…æ˜¯æè¾¹ã€‚æœ‰å››ä¸ª <code>GState</code> å±æ€§ä¸“å±äº stroked linesï¼šJoinï¼ŒMiter Limitï¼ŒEnd Cap å’Œ Dashã€‚</p>
<h2 id="Join-çš„é˜´æš—é¢"><a href="#Join-çš„é˜´æš—é¢" class="headerlink" title="Join çš„é˜´æš—é¢"></a>Join çš„é˜´æš—é¢</h2><p><code>line join</code> è¿™ä¸ªå±æ€§æ§åˆ¶ç€å½“çº¿è½¬è§’æ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼Œå¹¶ä¸”é€šè¿‡ä»¥ä¸‹æšä¸¾å€¼æ¥æè¿°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enum CGLineJoin &#123;</span><br><span class="line">    kCGLineJoinMiter       // default</span><br><span class="line">    kCGLineJoinRound</span><br><span class="line">    kCGLineJoinBevel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹è°ƒç”¨æ¥è®¾ç½®å®ƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetLineJoin (context, kCGLineJoinMiter)</span><br></pre></td></tr></table></figure>
<p><code>miter join</code> ï¼ˆæ–œè§’è¿æ¥ï¼‰æœ‰ä¸€ä¸ªå‡¸å‡ºæ¥çš„ç‚¹ã€‚<code>round join</code> ï¼ˆåœ†è§’è¿æ¥ï¼‰ åœ¨é“¾æ¥çš„â€è†å…³èŠ‚â€œå¤„æœ‰ä¸€ä¸ªåŠåœ†ï¼Œè€Œ <code>bevel join</code> ï¼ˆæ–œåˆ‡è¿æ¥ï¼‰ åˆ™æ˜¯ä¸€ä¸ªå¹³çš„æ ·å­ã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-joinstyles.png" alt=""></p>
<p>é‚£æ¡ä¸­é—´çš„ç™½çº¿æ˜¯ç»™ Quartz çš„é‚£ä¸ªç†æƒ³çš„è·¯å¾„ã€‚è“è‰²éƒ¨åˆ†æ˜¯è¿™ä¸ª path åœ¨ç‰¹å®š <code>GState</code> çŠ¶æ€ä¸‹è¢«æçš„è½®å»“ï¼Œ<code>GState</code> æä¾›äº†è½®å»“é¢œè‰²ã€çº¿å®½å’Œçº¿å±æ€§ã€‚</p>
<p>è¿™ä¸ªå›¾æœ‰ä¸¤ä¸ªçº¿æ®µè¿æ¥å¤„ã€‚åœ¨ä¸€ä¸ª path ä¸­çš„æ‰€æœ‰çº¿æ®µéƒ½æ˜¯ç”¨åŒä¸€ä¸ª <code>line join</code> å€¼ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³æ··æ­ <code>join</code> ç±»å‹ï¼Œä½ éœ€è¦åœ¨ context ä¸­è®¾ç½® <code>line join</code>ï¼Œç„¶åç”»ä¸€ç»„çº¿ï¼Œè®¾ç½® <code>line join</code> ä¸ºå¦ä¸€ä¸ªå€¼ï¼Œç„¶åç”»å¦ä¸€ç»„çº¿ã€‚ä½ æ— æ³•åœ¨ä¸€ä¸ªç»˜åˆ¶æ“ä½œä¸­æ··æ­ã€‚</p>
<h2 id="ç§˜è¯€å°±æ˜¯-Limit"><a href="#ç§˜è¯€å°±æ˜¯-Limit" class="headerlink" title="ç§˜è¯€å°±æ˜¯ Limit"></a>ç§˜è¯€å°±æ˜¯ Limit</h2><p>åœ†è§’è¿æ¥å’Œæ–œåˆ‡è¿æ¥æœ‰äº›æ— èŠã€‚ç«¯ç‚¹å°±æ˜¯ä¸ªåœ†ï¼Œæˆ–è€…æ‹è§’å¤„è¢«åˆ‡æ‰äº†ã€‚ä¸è¿‡ï¼Œæ–œè§’è¿æ¥æ˜¯é…·çš„ã€‚æ–œè§’è¿æ¥ç”»çš„é‚£ä¸ªçªå‡ºçš„éƒ¨åˆ†çš„é•¿åº¦æ˜¯æ ¹æ®é‚£ä¸¤æ¡çº¿å¤¹è§’å˜åŒ–çš„ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-miterlimit-1.gif" alt=""></p>
<p>ä¸è¿‡è¿˜æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜â€”â€”å¦‚æœä¸¤æ¡çº¿çš„å¤¹è§’éå¸¸é”çš„è¯ï¼Œçªå‡ºç«¯å¯èƒ½å˜å¾—ç›¸å½“é•¿ã€‚æœ‰å¦å¤–ä¸€ä¸ª GState å‚æ•°å¯ä»¥æ§åˆ¶è¿™ä¸ªï¼šMiter Limitã€‚è¿™æ˜¯ä¸€ä¸ª CGFloat å€¼ï¼Œå®ƒå‘Šè¯‰ CG ä»€ä¹ˆæ—¶å€™è¯¥ç”»è¿™ä¸ªçªå‡ºæ–œè§’çš„ä¸œè¥¿ï¼Œåˆæˆ–æ˜¯è¯¥æŠŠè¿™ä¸ªè¿æ¥å¤„å˜æˆæ–œåˆ‡çš„ã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-miterlimit-2.gif" alt=""></p>
<p>Miter Limit API å¾ˆç®€å•ï¼Œå‡è®¾ä½ çŸ¥é“è¿™ä¸ªå€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetMiterLimit (context, 5.0);</span><br></pre></td></tr></table></figure>
<p>å½“åœ¨å†³å®šæ˜¯æ–œè§’è¿˜æ˜¯æ–œåˆ‡æ—¶ï¼ŒQuartz ç”¨ GState ä¸­çš„ line width æ¥é™¤å®ƒå‡†å¤‡ç»˜åˆ¶çš„æ–œè§’çš„é•¿åº¦ã€‚è¶…è¿‡äº† miter limit å°±æ„å‘³ç€â€ä½¿ç”¨æ–œåˆ‡è¿æ¥â€œã€‚å› ä¸ºæ–œè§’çš„é•¿åº¦ä¸çº¿å®½æˆæ¯”ä¾‹ï¼ˆçº¿è¶Šå®½æ–œè§’è¶Šé•¿ï¼‰ï¼Œmiter limit å®é™…ä¸Šå°±ä¸çº¿å®½æ— å…³äº†â€”â€”è¿™ä¸ªå…³ç³»è¢«è§£é™¤äº†ã€‚åªè¦ä½ æŠŠä½ çš„ç»˜åˆ¶ä»£ç è°ƒæ•´åˆ°æœ‰ä¼˜ç§€çš„æ–œè§’/æ–œåˆ‡è¡Œä¸ºï¼Œä½ å°±ä¸ç”¨æ‹…å¿ƒçº¿å®½å˜ä¸å˜äº†ã€‚</p>
<h2 id="å˜¿ï¼Œå˜¿ï¼Œä»–åˆšè¯´äº†â€å±è‚¡â€œ"><a href="#å˜¿ï¼Œå˜¿ï¼Œä»–åˆšè¯´äº†â€å±è‚¡â€œ" class="headerlink" title="å˜¿ï¼Œå˜¿ï¼Œä»–åˆšè¯´äº†â€å±è‚¡â€œ"></a>å˜¿ï¼Œå˜¿ï¼Œä»–åˆšè¯´äº†â€å±è‚¡â€œ</h2><p>ä½ ä¸ä»…å¯ä»¥æ§åˆ¶è¿æ¥å¤„æ€ä¹ˆæ ·ï¼Œä¹Ÿå¯ä»¥æ§åˆ¶çº¿çš„å¼€å¤´å’Œæœ«ç«¯æ˜¯å¦‚ä½•ã€‚è¿™é‡Œæ˜¯ä¸‰ä¸ª Line Cap æ ·å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enum CGLineCap &#123;</span><br><span class="line">    kCGLineCapButt    // default</span><br><span class="line">    kCGLineCapRound</span><br><span class="line">    kCGLineCapSquare</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªæ”¹å˜ cap æ ·å¼çš„è°ƒç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextSetLineCap (context, kCGLineCapButt)</span><br></pre></td></tr></table></figure>
<p>butt cap ä¸åœ¨çº¿çš„æœ«ç«¯ç”»ä»»ä½•é¢å¤–çš„ä¸œè¥¿ã€‚round cap åŠ ä¸Šäº†ä¸€ä¸ªåŠåœ†ï¼Œsquare cap åˆ™æœ‰ä¸€ä¸ªåŠæ­£æ–¹å½¢åœ¨æœ«ç«¯ã€‚è¿™ä¸ªé¢å¤–éƒ¨åˆ†çš„å¤§å°æ˜¯å’Œçº¿å®½æˆæ¯”ä¾‹çš„ã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-capitation.png" alt=""></p>
<p>å’Œ line join æ ·å¼ä¸€æ ·ï¼Œä½ ä¸èƒ½åœ¨ä¸€æ¡çº¿ä¸Šæ··æ­ cap æ ·å¼ã€‚</p>
<h2 id="å†²ç ´å¤§é£é›ª"><a href="#å†²ç ´å¤§é£é›ª" class="headerlink" title="å†²ç ´å¤§é£é›ª"></a>å†²ç ´å¤§é£é›ª</h2><p>line join å’Œ line cap æ˜¯ä» PostScript ä¸­ç»§æ‰¿æ¥çš„ï¼Œå¦ä¸€ä¸ªå¾ˆé…·çš„å±æ€§ä¹Ÿæ˜¯ï¼šline dashã€‚</p>
<p>line dash æ˜¯é€šè¿‡ä¸€ä¸ªç”±â€æ ‡è®°ç©ºé—´â€œçš„æµ®ç‚¹æ•°å€¼ç»„æˆçš„æ•°ç»„ç»„æŒ‡å®šçš„ä¸€ä¸ªé‡å¤å›¾å½¢ã€‚å…ƒç´ é›¶æ˜¯è¿™æ¡è™šçº¿ç¬¬ä¸€ä¸ªéƒ¨åˆ†çš„é•¿åº¦ã€‚å…ƒç´ ä¸€æ˜¯è¦ç•™çš„ç©ºç™½çš„å¤§å°ã€‚å…ƒç´ äºŒæ˜¯å¦ä¸€ä¸ªçº¿çš„é•¿åº¦ï¼Œå…ƒç´ ä¸‰æ˜¯å¦ä¸€ä¸ªç©ºç™½ï¼Œå¦‚æ­¤ä¸‹å»ã€‚è¿™ä¸ªæ¨¡å¼ä¸€ç›´å¾ªç¯åˆ° CG ï¼ˆæˆ–è€… PostScriptï¼‰ç”¨å…‰äº†è¿™ä¸ªæ•°ç»„çš„å…ƒç´ ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ç»„çº¿çš„ç»„æˆéƒ¨åˆ†çš„é•¿åº¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGFloat lengths[] = &#123; 12.0, 8.0, 6.0, 14.0, 16.0, 7.0 &#125;;</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠå…¶ç›¸å…³çš„çº¿çš„æ¨¡å¼ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-phase-1.png" alt=""></p>
<p>ä¸‹é¢æ˜¯ç”¨è¿™ä¸ªæ¨¡å¼ç”»çš„ä¸€æ¡çº¿ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-phase-2.png" alt=""></p>
<p>è¿™é‡Œä½¿ç”¨äº†æ–œè§’è¿æ¥æ ·å¼ã€‚å› æ­¤ä¸¤ä¸ªè§’éƒ½æ˜¯æ–œè§’è¿æ¥ã€‚é‚£ä¸ªæ¶ˆå¤±çš„ä¸‹æ–¹çš„è¿æ¥å¤„æ˜¯è™šçº¿å›¾å½¢åœ¨åŸæœ¬è¿æ¥å¤„æœ‰ä¸€ä¸ªç©ºç™½åŒºåŸŸé€ æˆçš„ã€‚</p>
<p>è™šçº¿å›¾å½¢åœ¨çº¿çš„ç¬¬ä¸€ä¸ªç‚¹åˆå›ºå®šäº†ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-phase-3.gif" alt=""></p>
<p>æ¯ä¸€ä¸ªç‹¬ç«‹çš„å›¾å½¢åŒºé—´éƒ½æœ‰æœ«ç«¯ cap å±æ€§åœ¨åšç”¨ç€ï¼Œå› æ­¤åœ¨æœ‰ä¸€ä¸ªè™šçº¿å›¾å½¢ä»¥åŠ cap æˆ–è€… butt æœ«ç«¯ cap æ—¶ï¼Œcap å¯èƒ½äº’ç›¸é‡å è€Œå½¢æˆä¸€æ¡å®çº¿ã€‚</p>
<h2 id="Set-Phasers-to-Stun"><a href="#Set-Phasers-to-Stun" class="headerlink" title="Set Phasers to Stun"></a>Set Phasers to Stun</h2><p>ä¸‹é¢æ˜¯ä½ å¦‚ä½•è®¾ç½® line phaseï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void CGContextSetLineDash (CGContextRef c,</span><br><span class="line">                           CGFloat phase,</span><br><span class="line">                           const CGFloat lengths[], size_t count)</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼ å…¥ä¸€ä¸ªé•¿åº¦æ•°ç»„ä»¥åŠè¿™ä¸ªæ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼ˆå¹¶ä¸æ˜¯å®ƒçš„å­—èŠ‚é•¿åº¦ï¼‰ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ª phase å€¼ã€‚è¿™ä¸ª phase å€¼å‘Šè¯‰ Quartz ä»å“ªå„¿å¼€å§‹ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ã€‚ä½ å¯ä»¥é€šè¿‡ç”¨ä¸åŒçš„ phase å€¼è°ƒç”¨ <code>SetLineDash</code> è®©è¿™ä¸ªè™šçº¿åŠ¨èµ·æ¥ã€‚</p>
<p>ä¸‹é¢æ˜¯åŒæ ·ä¸€æ¡çº¿ï¼Œä»…ä»…æ˜¯ phase è¢«æ”¹å˜æ—¶çš„æ ·å­ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-phase-4.gif" alt=""></p>
<h2 id="ä¸€ä¸ª-Swift-åŒ–çš„åˆ†æ®µæ˜Ÿçƒ"><a href="#ä¸€ä¸ª-Swift-åŒ–çš„åˆ†æ®µæ˜Ÿçƒ" class="headerlink" title="ä¸€ä¸ª Swift åŒ–çš„åˆ†æ®µæ˜Ÿçƒ"></a>ä¸€ä¸ª Swift åŒ–çš„åˆ†æ®µæ˜Ÿçƒ</h2><p>Swift å°¤å…¶ä¾¿äºåˆ¶å®šçº¿åˆ†æ®µï¼Œä½ ä»…ä»…éœ€è¦ç›´æ¥ç”¨ä¸€ä¸ª CGFloat æ•°ç»„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let phase = CGFloat(linePhaseSlider.floatValue)</span><br><span class="line">let lengths = [</span><br><span class="line">    dash0Slider.floatValue, space0Slider.floatValue,</span><br><span class="line">    dash1Slider.floatValue, space1Slider.floatValue,</span><br><span class="line">    dash2Slider.floatValue, space2Slider.floatValue</span><br><span class="line">].map &#123; CGFloat($0) &#125;</span><br><span class="line">CGContextSetLineDash (context, phase, lengths, lengths.count)</span><br></pre></td></tr></table></figure>
<p>åœ¨ Objective-C è¿™ä¸€è¾¹ï¼Œä½ éœ€è¦ç”¨ä¸€ä¸ª NSNumbers æ•°ç»„å¹¶ä¸”æ‰‹åŠ¨å–å‡ºæµ®ç‚¹å€¼ï¼Œæˆ–è€…ç»´æŠ¤ä¸€ä¸ª CGFloat çš„ bufferã€‚</p>
<p>ç®€å•è¯´æ˜ä¸€ä¸‹ï¼šé‚£ä¸ª floatValue å’Œ map åœ¨ä¸€èµ·æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿè¿™ä¸ªæ•°ç»„éœ€è¦æ˜¯ CGFloat ç±»å‹ã€‚ NSSlider å¹¶æ²¡æœ‰ä¸€ç§å°†å…¶è¿”å›å€¼è¡¨è¾¾æˆ CGFloat çš„æ–¹å¼ã€‚ä¸€ç§é€‰æ‹©æ˜¯ç»™ NSSlider å†™ä¸€ä¸ª extensionï¼Œç”¨ä»¥å°†ä¸€ä¸ªç°æœ‰çš„ slider å€¼æ–¹æ³•è½¬æ¢æˆ CGFloatã€‚é‚£æ ·æŒºçƒ¦äººçš„ï¼Œå¹¶ä¸”ä½ åœ¨å’Œå…¶ä»–é¡¹ç›®å…±äº«è¿™æ®µä»£ç æ—¶å¾—è®°å¾—å°†å®ƒä¸€èµ·æ‹–è¿‡æ¥ã€‚ä½ ä¹Ÿå¯ä»¥å°†æ¯ä¸€ä¸ªæ¯ä¸€ä¸ª slider floatValue éƒ½è½¬æ¢äº†ï¼Œä¸è¿‡é‚£æ ·å°±åœ¨è§†è§‰ä¸Šå¾ˆæ‰°ç›®ï¼Œå¾ˆéš¾çœ‹æ¸…æ¥šæ˜¯å“ªä¸€ä¸ª slider åœ¨è´¡çŒ®å®ƒçš„å€¼ã€‚é€šè¿‡è·å–ä¸€ä¸ª floatsValues æ•°ç»„ç„¶åæ˜ å°„å®ƒä»¬åˆ° CGFloatï¼Œå®ƒä»ç„¶å¯è¯»ï¼Œå¹¶ä¸” <code>CGContextSetLineDash</code> å¾—åˆ°äº†å®ƒæƒ³è¦çš„æµ®ç‚¹ç±»å‹ã€‚</p>
<h2 id="Construction-Zone"><a href="#Construction-Zone" class="headerlink" title="Construction Zone"></a>Construction Zone</h2><p>Core Graphics æä¾›äº†ä¸€ç³»åˆ—ç”¨äºåˆ›å»º line path çš„è°ƒç”¨æ–¹æ³•ã€‚</p>
<p>åŠæ—¶æˆ‘è¿˜æ²¡æœ‰è°ˆåˆ° path APIï¼Œå¦‚æœä½ æ›¾ç”¨è¿‡ <code>NSBezierPath</code> çš„è¯ï¼Œç¬¬ä¸€ç§å½¢å¼åº”è¯¥å¤šå°‘æœ‰ç‚¹ç†Ÿæ‚‰ï¼šç§»åŠ¨åˆ°ä¸€ä¸ªç‚¹ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªæ–°ç‚¹ä½œä¸ºæ–°çº¿æ®µçš„æœ«ç«¯ï¼Œç»„æˆä¸€æ¡è¿ç»­çš„çº¿ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CGMutablePathRef path = CGPathCreateMutable();</span><br><span class="line"></span><br><span class="line">CGPathMoveToPoint (path, NULL, self.points[0].x, self.points[0].y);</span><br><span class="line"></span><br><span class="line">for (NSInteger i = 1; i &lt; kPointCount; i++) &#123;</span><br><span class="line">    CGPathAddLineToPoint (path, NULL, self.points[i].x, self.points[i].y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CGContextAddPath (context, path);</span><br><span class="line">CGContextStrokePath (context);</span><br></pre></td></tr></table></figure>
<p><code>self.points</code> è¿”å›çš„æ˜¯ä¸€ä¸ª CGFloat æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªåŒ…å«å››ä¸ª CGPoints çš„ C æ•°ç»„ã€‚</p>
<p>Swift å½¢å¼éå¸¸ç›¸ä¼¼ã€‚<code>points</code> æ˜¯ä¸€ä¸ªåŸç”Ÿ Swift CGFloat æ•°ç»„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let path = CGPathCreateMutable()</span><br><span class="line"></span><br><span class="line">CGPathMoveToPoint (path, nil, points[0].x, points[0].y)</span><br><span class="line"></span><br><span class="line">for i in 1 ..&lt; points.count &#123;</span><br><span class="line">    CGPathAddLineToPoint (path, nil, points[i].x, points[i].y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CGContextAddPath (context, path)</span><br><span class="line">CGContextStrokePath (context)</span><br></pre></td></tr></table></figure>
<p>ä¸‹ä¸€ç§å½¢å¼ç”¨åˆ°èµ„æ ¼ CGPoints æ•°ç»„ï¼Œå¹¶ä¸”åœ¨å†…éƒ¨è¿›è¡Œäº†å¦‚ä½ æ‰€è§è¿‡çš„ç›¸åŒç±»å‹çš„å¾ªç¯ã€‚è¿™ä¹Ÿå¾—åˆ°ä¸€ä¸ª pathã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CGMutablePathRef path = CGPathCreateMutable();</span><br><span class="line"></span><br><span class="line">CGPathAddLines (path, NULL, self.points, kPointCount);</span><br><span class="line"></span><br><span class="line">CGContextAddPath (context, path);</span><br><span class="line">CGContextStrokePath (context);</span><br></pre></td></tr></table></figure>
<p>Swift å®ç°ä¹Ÿè¿˜æ˜¯å·®ä¸å¤šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let path = CGPathCreateMutable()</span><br><span class="line"></span><br><span class="line">CGPathAddLines (path, nil, self.points, self.points.count)</span><br><span class="line"></span><br><span class="line">CGContextAddPath (context, path)</span><br><span class="line">CGContextStrokePath (context)</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰ç§ç”»çº¿æ–¹æ³•æ˜¯åˆ†åˆ«ç”»å‡ºæ¯ä¸€æ¡çº¿æ®µã€‚æ¯ä¸€æ¡çº¿æ®µæœ‰å…¶è‡ªå·±çš„ end-capï¼Œå¹¶ä¸”æœ‰ç›¸åº”çš„ line dash åº”ç”¨åœ¨ä¸Šé¢ã€‚åœ¨è¿æ¥å¤„ä¸ä¼šæœ‰æ–œè§’è¿æ¥å‡ºç°ï¼Œå› ä¸ºå¯¹ CG æ¥è¯´å¹¶æ²¡æœ‰è¿æ¥åœ¨ä¸€èµ·çš„çº¿ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">for (NSInteger i = 0; i &lt; kPointCount - 1; i++) &#123;</span><br><span class="line">    CGMutablePathRef path = CGPathCreateMutable();</span><br><span class="line"></span><br><span class="line">    CGPathMoveToPoint (path, NULL, self.points[i].x, self.points[i].y);</span><br><span class="line">    CGPathAddLineToPoint (path, NULL, self.points[i + 1].x, self.points[i + 1].y);</span><br><span class="line"></span><br><span class="line">    CGContextAddPath (context, path);</span><br><span class="line">    CGContextStrokePath (context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swift å½“ç„¶ä¹Ÿæ˜¯å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œé™¤äº†å¾ªç¯ç»“æ„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for i in 0 ..&lt; points.count - 1 &#123;</span><br><span class="line">    let path = CGPathCreateMutable()</span><br><span class="line">    CGPathMoveToPoint (path, nil, points[i].x, points[i].y)</span><br><span class="line">    CGPathAddLineToPoint (path, nil, points[i + 1].x, points[i + 1].y)</span><br><span class="line"></span><br><span class="line">    CGContextAddPath (context, path)</span><br><span class="line">    CGContextStrokePath (context)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€ç§å½¢å¼ä¹Ÿæ˜¯ç»˜åˆ¶å•ç‹¬çš„çº¿æ®µã€‚<code>CGContextStrokeLineSegements</code> ç”¨åˆ°ä¸€ä¸ªç‚¹å¯¹æ•°ç»„ï¼Œå¹¶ä¸”ä»¥å¶æ•°ç‚¹ X ä½œä¸ºå¼€å§‹åˆ° X+1 ä½œä¸ºç»“æŸç”»çº¿æ®µã€‚å› æ­¤ï¼Œå¯¹äºåŒ…å«ä¸‰ä¸ªçº¿æ®µçš„ï¼Œå®ƒä» 0-&gt;1ï¼Œ2-&gt;3 ä»¥åŠ 4-&gt;5 ç”»çº¿ã€‚GrafDemo çš„æ•°æ®å¹¶ä¸æ˜¯ä¸€ä¸ªæ¸å˜å½¢åŠ¿ï¼Œå› æ­¤æœ‰ä¸€äº›æ•°æ®é‡æ’çš„å·¥ä½œéœ€è¦åšã€‚</p>
<p>Objective-C è¿™ä¸€è¾¹ä½¿ç”¨äº†ä¸€ä¸ªå †æ ˆç¼“å†²åŒºæ¥ç»´æŒè¿™äº›ç‚¹ã€‚å¦‚æœæœ‰å¯èƒ½å…¶å¤§å°å˜å¾—å·¨å¤§çš„è¯ï¼Œä½¿ç”¨åŠ¨æ€å¤§å°çš„å †æ ˆç¼“å†²åŒºæ—¶è¦å½“å¿ƒã€‚å¦‚æœä½ é¢„æœŸæœ‰å¤§é‡çš„ç‚¹ï¼Œå¯èƒ½è¦æƒ³ç€åŠ¨æ€åˆ†é…ä¸€äº›å†…å­˜ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CGPoint segments[kPointCount * 2];</span><br><span class="line">CGPoint *scan = segments;</span><br><span class="line"></span><br><span class="line">for (NSInteger i = 0; i &lt; kPointCount - 1; i++) &#123;</span><br><span class="line">    *scan++ = self.points[i];</span><br><span class="line">    *scan++ = self.points[i + 1];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Strokes points 0-&gt;1 2-&gt;3 4-&gt;5</span><br><span class="line">CGContextStrokeLineSegments (context, segments, kPointCount * 2);</span><br></pre></td></tr></table></figure>
<p>Swift å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡å…é™¤äº†è¦æ³¨æ„å †æ ˆç¼“å†²åŒºçš„éº»çƒ¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var segments: [CGPoint] = []</span><br><span class="line"></span><br><span class="line">for i in 0 ..&lt; points.count - 1 &#123;</span><br><span class="line">    segments += [points[i]]</span><br><span class="line">    segments += [points[i + 1]]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Strokes points 0-&gt;1 2-&gt;3 4-&gt;5</span><br><span class="line">CGContextStrokeLineSegments (context, segments, segments.count)</span><br></pre></td></tr></table></figure>
<h2 id="è¡¨ç°"><a href="#è¡¨ç°" class="headerlink" title="è¡¨ç°"></a>è¡¨ç°</h2><p>åœ¨è¿›è¡Œæ€»ç»“ä¹‹å‰çš„æœ€åä¸€ç‚¹ã€‚Core Graphics å¯ä»¥ç›¸å½“å¿«ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯åœ¨ä¸€ä¸ª path ä¸­é‡å çº¿æ®µçš„è®¡ç®—å¼€é”€å¾ˆé«˜ã€‚å½“ Quartz æ¸²æŸ“ä¸€ä¸ª pathï¼Œå®ƒä¸å¯èƒ½å°±è¯´ï¼Œâ€å¥½å§ï¼Œç”»è¿™ä¸ªçº¿æ®µã€‚ç°åœ¨ç”»è¿™ä¸ªçº¿æ®µã€‚â€œè€Œä¸ç®¡å…¶ä»–è¿›ç¨‹ã€‚æƒ³æƒ³ä¸€ä¸‹ä½ åœ¨ç”»ä¸€ä¸ªç»¿è‰²åŠé€æ˜çš„çº¿ã€‚å¦‚æœä½ ç›²ç›®çš„å°†çº¿æ®µäº’ç›¸ç”»åœ¨å…¶å®ƒå„è‡ªä¹‹ä¸Šï¼Œä½ å¯èƒ½ä¼šå› ä¸ºæœ‰ä¸€äº›å›¾å±‚çš„åŠé€æ˜ç»¿è‰²â€é¢œæ–™â€œé‡å è€Œå¾—åˆ°æ·±ä¸€äº›çš„é¢œè‰²ã€‚åœ¨ç”»ä¸€ä¸ªçº¿æ®µä¹‹å‰ï¼ŒQuartz éœ€è¦ææ¸…æ¥šé‡å çš„éƒ¨åˆ†åœ¨å“ªä¸€é›†ä¸è¦é‡å¤ç»˜åˆ¶ã€‚</p>
<p>ä¸‹é¢æ˜¯å°†ä¸€ç»„çº¿ä½œä¸ºä¸€ä¸ª path ç»˜åˆ¶æˆ–è€…ä½œä¸ºå¤šä¸ªçº¿æ®µç»˜åˆ¶çš„æ•ˆæœï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2015/05/cg3-overlap.png" alt=""></p>
<p>æ³¨æ„çœ‹çœ‹å½“ä½ æœ‰ä¸€å¤§å †äº’ç›¸é‡å çš„çº¿æ—¶çš„è¡¨ç°â€”â€”é‡å éƒ¨åˆ†çš„è®¡ç®—æˆæœ¬ï¼ˆç›¸å¯¹äºæ‰€æœ‰å…¶å®ƒ Quartz çš„å·¥ä½œï¼‰æ˜¯å¤§äº O(N) çš„å¹¶ä¸”å½“æœ‰å¤§é‡çº¿æ®µæ˜¯å˜å¾—ç›¸å½“é«˜æ˜‚ã€‚</p>
<h2 id="ä¸‹ä¸€æ¬¡"><a href="#ä¸‹ä¸€æ¬¡" class="headerlink" title="ä¸‹ä¸€æ¬¡"></a>ä¸‹ä¸€æ¬¡</h2><p>éƒ½æ˜¯å…³äº path çš„ã€‚Pathï¼Pathï¼</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.bignerdranch.com/blog/core-graphics-part-three-lines/&quot;&gt;Core Graphics, Part 2: Contextually Speaking&lt;/a&gt;&lt;br&gt;çœ‹çœ‹ä¸Šä¸€ç¯‡å§ï¼š&lt;a href=&quot;http://chengkang.me/2017/05/23/core-graphics-part-2/&quot;&gt;ã€è¯‘ã€‘Core Graphics, ç¬¬äºŒéƒ¨åˆ†ï¼šè¯´è¯´ context ï¼ˆä¸Šä¸‹æ–‡ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è®¾æƒ³è¿™æ ·ä¸€æ¡ç®€å•çš„çº¿ï¼šå°±æ˜¯è¿æ¥ä¸¤ç‚¹çš„ä¸€æ¡ç›´åƒç´ åºåˆ—ã€‚æœ‰ä¸€äº›æœ‰åçš„ç®—æ³•ä½ å¯ä»¥ç”¨æ¥è‡ªå·±åšç»˜åˆ¶ï¼Œä½†æ˜¯è¿‘äº›æ—¥å­ï¼Œæˆ‘ä»¬æœ‰äº†å·¥å…·ç®±æ¥å¸®å¿™åšç¹æ‚çš„å·¥ä½œã€‚åœ¨ Core Graphics ä¸­ï¼Œä¸€æ¡çº¿å°±åªæ˜¯ä¸€ç§è·¯å¾„ã€‚è·¯å¾„å¯¹äºè®¸å¤š Core Graphics çš„ç‰¹æ€§æ¥è¯´éƒ½æ˜¯ä¸­å¿ƒï¼Œä¸‹ä¸€å›ä½ ä¼šå¾—çŸ¥å¾ˆå¤šè·¯å¾„çš„ä¿¡æ¯ã€‚ä¸è¿‡ç°åœ¨ï¼Œå…ˆæŠŠçº¿æƒ³æˆè¢«æå‡ºè½®å»“ï¼ˆè€Œéå¡«å……ï¼‰çš„ä¸€ç³»åˆ—çº¿çš„ç‰‡æ®µã€‚æœ‰ä¸€å¤§å †æ™®éçš„ &lt;code&gt;GState&lt;/code&gt; å‚æ•°èƒ½å½±å“çº¿ï¼ˆçš„é¢œè‰²ã€å®½åº¦ã€é˜´å½±åŠå½¢å˜ï¼‰ï¼ŒåŒæ ·ä¹Ÿæœ‰ GState çš„å€¼ä¸ç»˜åˆ¶çº¿æœ‰å…³ã€‚&lt;/p&gt;
&lt;p&gt;ä½ åœ¨è¿™çœ‹åˆ°çš„æ‰€æœ‰çº¿çš„å›¾ç‰‡éƒ½æ˜¯ç”¨ GrafDemo åˆ›å»ºçš„ã€‚ä½ å¯ä»¥åœ¨ &lt;a href=&quot;https://github.com/markd2/GrafDemo&quot;&gt;GitHub&lt;/a&gt; ä¸Šæ‰¾åˆ°æºç ï¼Œè¿™é‡Œä½¿ç”¨çš„ç‰ˆæœ¬ä¸ºâ€Release cg-pt3â€œã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Core Graphics" scheme="http://chengkang.me/tags/Core-Graphics/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Core Graphics, ç¬¬äºŒéƒ¨åˆ†ï¼šè¯´è¯´ context ï¼ˆä¸Šä¸‹æ–‡ï¼‰</title>
    <link href="http://chengkang.me/2017/05/24/core-graphics-part-2/"/>
    <id>http://chengkang.me/2017/05/24/core-graphics-part-2/</id>
    <published>2017-05-24T15:20:19.000Z</published>
    <updated>2017-05-24T15:33:30.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.bignerdranch.com/blog/core-graphics-part-2-contextually-speaking/" target="_blank" rel="external">Core Graphics, Part 2: Contextually Speaking</a><br>çœ‹çœ‹ä¸Šä¸€ç¯‡å§ï¼š<a href="http://chengkang.me/2017/05/23/core-graphics-part-1/">ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬ä¸€éƒ¨åˆ†ï¼šåºç« </a></p>
</blockquote>
<p>context ï¼ˆä¸Šä¸‹æ–‡ï¼‰å°±æ˜¯ Quartz çš„æ ¸å¿ƒï¼šä½ éœ€è¦æŒ‰ç…§æŸç§è§„èŒƒæ¥ä¸å½“å‰çš„ Core Graphics context äº¤äº’ä»¥çœŸæ­£ç»˜åˆ¶ä¸œè¥¿ï¼Œå› æ­¤ç†Ÿæ‚‰å®ƒã€å®ƒåšä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆå®ƒæ˜¯è¿™æ ·çš„æ˜¯æœ‰ç›Šå¤„çš„ã€‚</p>
<p>Core Graphics é‡Œé¢ä¸€ä¸ªåŸºç¡€çš„æ“ä½œæ˜¯åˆ›å»ºä¸€ä¸ª pathã€‚Path æ˜¯å½¢çŠ¶çš„æ•°å­¦æè¿°ã€‚ä¸€ä¸ª path å¯ä»¥æ˜¯ä¸€ä¸ªçŸ©å½¢ï¼Œæˆ–ä¸€ä¸ªåœ†ã€ä¸€ä¸ªç‰›ä»”å¸½ï¼Œæˆ–è€…ç”šè‡³æ˜¯æ³°å§¬é™µã€‚Path å¯ä»¥ç”¨é¢œè‰²å¡«å……â€”â€”å°±æ˜¯è¯´ï¼Œè¿™ä¸ª path ä¸­çš„æ‰€æœ‰çš„ç‚¹éƒ½è¢«è®¾ç½®æˆç‰¹å®šçš„é¢œè‰²ã€‚Path ä¹Ÿå¯ä»¥ç”»å‡ºè½®å»“ï¼ˆoutlinedï¼‰ï¼Œæˆ–è€…è¯´å«æè¾¹ï¼ˆstrokedï¼‰ã€‚è¿™å°±åƒæ˜¯ç”¨ä¸€æ”¯ç¾æœ¯é’¢ç¬”åœ¨è·¯å¾„å‘¨å›´ç”»å‡ºä¸€ä¸ªè½®å»“ã€‚ä¸‹é¢åˆ†åˆ«æ˜¯ä¸€ä¸ªåªç”»å‡ºäº†è½®å»“çš„ã€ä¸€ä¸ªåªå¡«å……é¢œè‰²çš„å’Œä¸€ä¸ªæ—¢å¡«å……äº†é»„è‰²ç”±æè“è¾¹çš„å¸½å­ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/12/hat-path.png" alt=""></p>
<a id="more"></a>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œå®é™…çš„è½®å»“å¯ä»¥å˜å¾—éå¸¸å¤æ‚ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ç§ç‰¹å®šçš„é¢œè‰²ã€‚ï¼ˆè½®å»“ï¼‰çº¿ä¹Ÿå¯ä»¥æœ‰è™šçº¿å›¾æ¡ˆã€‚å¯ä»¥ç”¨ç²—çº¿æ¡æè¾¹ä¹Ÿå¯ä»¥ç”¨ç»†çº¿ã€‚çº¿çš„æœ«ç«¯å¯ä»¥æ˜¯æ–¹çš„æˆ–åœ†çš„ï¼Œç­‰ç­‰ç­‰ç­‰ã€‚æœ‰å¾ˆå¤šç§å±æ€§ã€‚</p>
<p>å¦‚æœä½ ä»”ç»†ç ”è¯» Core Graphics APIï¼Œä½ å¹¶ä¸ä¼šçœ‹åˆ°æŸä¸ªæ–¹æ³•è°ƒç”¨ä½¿ç”¨äº†æ‰€æœ‰çš„è¿™äº›è®¾ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGStrokePath (path, fillColor, strokeColor, lineWidth, dashPattern, bloodType, endCap)</span><br></pre></td></tr></table></figure>
<p>ç›¸åï¼Œä»…ä»…æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void CGContextStrokePath(CGContextRef c)</span><br></pre></td></tr></table></figure>
<p>é‚£ï¼Œé‚£äº›é¢å¤–çš„å€¼ä»å“ªå„¿æ¥çš„ï¼Ÿå®ƒä»¬å°±ä» context ä¸­æ¥ã€‚</p>
<h2 id="ä¸€æ¡¶é›¶ç¢"><a href="#ä¸€æ¡¶é›¶ç¢" class="headerlink" title="ä¸€æ¡¶é›¶ç¢"></a>ä¸€æ¡¶é›¶ç¢</h2><p>Context ç»´æŒç€ä¸€å †å…³äºç»˜åˆ¶çš„å…¨å±€çŠ¶æ€ï¼Œå®ƒä»¬æ˜¯ä¸€å †ç‹¬ç«‹çš„å€¼ï¼š</p>
<ul>
<li>current path</li>
<li>current fill å’Œ stroke colors</li>
<li>line width å’Œ pattern</li>
<li>line cap å’Œ join (miter) styles</li>
<li>alpha (transparency), antialiasing å’Œ blend mode</li>
<li>shadows</li>
<li>transformation matrix</li>
<li>text atrributes ï¼ˆæ–‡å­—å±æ€§ï¼‰ (font, size, matrix)</li>
<li>ä¸€äº›å†·åƒ»çš„ä¸œè¥¿æ¯”å¦‚ line flatness å’Œ interpolation quality</li>
<li>ä»¥åŠæ›´å¤š</li>
</ul>
<p>æœ‰å¾ˆå¤šçŠ¶æ€é‡ã€‚Core Graphics ç»´æŒçš„çŠ¶æ€é‡çš„å…¨é›†å¹¶æ²¡æœ‰è¢«å†™å…¥æ–‡æ¡£ï¼Œå› æ­¤å¯èƒ½è¿˜æœ‰æ›´å¤šçš„è®¾ç½®é¡¹ã€‚ä¸åŒç§ç±»çš„ context ï¼ˆæ¯”å¦‚ï¼Œå›¾ç‰‡ä¸ PDFï¼‰å¯èƒ½åŒ…å«é¢å¤–ç§ç±»çš„æ•°æ®ã€‚</p>
<p>ä¸ç®¡ä»€ä¹ˆæ—¶å€™å½“ Core Graphics è¢«å‘ŠçŸ¥è¦ç»˜åˆ¶ä»€ä¹ˆä¸œè¥¿æ—¶ï¼Œæ¯”å¦‚â€œå¡«å……ä¸€æ¡è·¯å¾„ï¼ˆpathï¼‰ï¼Œâ€å®ƒéƒ½ä»å½“å‰çš„ context ä¸­å»æ‰¾éœ€è¦çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚æ ¹æ® context ä¸­åŒ…å«ä»€ä¹ˆï¼ŒåŒæ ·çš„ä¸€ä¸ªä»£ç åºåˆ—å¯ä»¥æœ‰å®Œå…¨ä¸åŒçš„ç»“æœã€‚ä¸€æ–¹é¢ï¼Œè¿™å¾ˆå¼ºå¤§ã€‚ä¸€æ®µæ³›å‹çš„ç»˜åˆ¶ä»£ç å¯ä»¥é€šè¿‡ context æ”¹å˜å¾—åˆ°ä¸åŒçš„ç»“æœã€‚å¦ä¸€æ–¹é¢ï¼Œcontext æ˜¯ä¸€å¤§å †å…¨å±€çŠ¶æ€ï¼Œè€Œå…¨å±€çŠ¶æ€å¾ˆå®¹æ˜“è¢«æ— æ„ä¸­æå¾—ä¹±ä¸ƒå…«ç³Ÿã€‚</p>
<p>æ¯”å¦‚è¯´æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">draw orange square:</span><br><span class="line">    set color to orange in the current context</span><br><span class="line">    fill a rectangle</span><br></pre></td></tr></table></figure>
<p>ä½ å°†å¾—åˆ°ä¸€ä¸ªæ©™è‰²æ­£æ–¹å½¢ã€‚ç°åœ¨å‡è®¾ä½ è¿˜è¦ç»˜åˆ¶ä¸€ä¸ªæ¡ƒå¿ƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">draw red valentine:</span><br><span class="line">    set color to red in the current context</span><br><span class="line">    fill a valentine</span><br></pre></td></tr></table></figure>
<p>è€¶ï¼ä¸€ä¸ªçº¢å¿ƒã€‚ç°åœ¨æ¯”å¦‚è¯´ä½ æŠŠç”»æ¡ƒå¿ƒçš„ä»£ç åŠ åˆ°ä½ çš„ç¬¬ä¸€ä¸ªæ–¹æ³•é‡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">draw orange square:</span><br><span class="line">    set color to orange in the current context</span><br><span class="line">    draw red valentine</span><br><span class="line">    fill a rectangle</span><br></pre></td></tr></table></figure>
<p>ä½ çš„çŸ©å½¢ä¼šæ˜¯çº¢è‰²è€Œä¸æ˜¯æ©™è‰²ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç»˜åˆ¶æ¡ƒå¿ƒçš„ä»£ç æŠ¢å äº†å½“å‰çš„ç»˜åˆ¶é¢œè‰²ã€‚ä½ å¡«å……çŸ©å½¢çš„æ—¶å€™é‚£ä¸ªé¢œè‰²æœ¬æ¥æ˜¯æ©™è‰²ï¼Œä½†æ˜¯ç°åœ¨æ˜¯çº¢çš„äº†ã€‚å¦‚ä½•é¿å…è¿™æ ·çš„ bug å‘¢ï¼Ÿ</p>
<p>æœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ç§æ˜¯åœ¨æ”¹å˜çŠ¶æ€ä¹‹å‰å°†çŠ¶æ€ä¿å­˜èµ·æ¥â€”â€”å¦‚æœä½ è¦æ”¹å˜å…¨å±€é¢œè‰²ï¼Œä¿å­˜ç°åœ¨çš„é¢œè‰²ï¼Œæ”¹å˜é¢œè‰²ï¼Œç»˜åˆ¶ï¼Œç„¶åæ¢å¤ä¹‹å‰çš„é¢œè‰²ã€‚è¿™æ ·åªæœ‰ä¸€ä¸¤ä¸ªå‚æ•°çš„æ—¶å€™è¿˜è¡Œï¼Œä½†æ˜¯å¦‚æœä½ è¦æ”¹å˜å¾ˆå¤šçš„æ—¶å€™è¿™ä¸ªæ–¹æ³•å¹¶ä¸èƒ½æ‰©å¤§è§„æ¨¡ã€‚è¿˜æœ‰ä¸€äº›è®¾ç½®é¡¹å› ä¸ºä¸€äº›å‰¯ä½œç”¨è¢«æ”¹å˜ï¼Œå› æ­¤ä½ ä¹Ÿå¾—è€ƒè™‘å®ƒä»¬ã€‚å™¢ï¼Œç„¶åå…¶å®åœ¨ Core Graphics é‡Œæ˜¯æ²¡æ³•è¿™ä¹ˆåšçš„ï¼Œå› ä¸ºæ ¹æœ¬æ²¡æœ‰å½“å‰ context çš„ getterã€‚æŠ±æ­‰å’¯ã€‚</p>
<h2 id="è¿™äº›æ¡¶çš„æ ˆï¼ˆcontext-æ ˆï¼‰"><a href="#è¿™äº›æ¡¶çš„æ ˆï¼ˆcontext-æ ˆï¼‰" class="headerlink" title="è¿™äº›æ¡¶çš„æ ˆï¼ˆcontext æ ˆï¼‰"></a>è¿™äº›æ¡¶çš„æ ˆï¼ˆcontext æ ˆï¼‰</h2><p>å¦å¤–ä¸€ç§æ–¹å¼æ˜¯åœ¨æ”¹å˜ä»»ä½•ä¸œè¥¿å‰ä¿å­˜<em>å®Œæ•´</em>çš„ contextã€‚ä¿å­˜ contextï¼Œæ”¹å˜é¢œè‰²æˆ–è€…çº¿å®½ï¼Œç»˜åˆ¶ï¼Œç„¶åæ¢å¤å®Œæ•´çš„ contextã€‚Core Graphics API æä¾›äº†ä¿å­˜å’Œæ¢å¤å½“å‰ context è®¾ç½®çš„æ–¹æ³•ã€‚è¿™äº›è®¾ç½®å«åš graphics stateï¼Œæˆ–è€…æ˜¯ GStateã€‚äº‹å®ä¸Šï¼Œå®ƒåœ¨èƒŒåç»´æŒç€ä¸€ä¸ª GStates æ ˆã€‚</p>
<p>å½“ä½ ä¿å­˜äº†å½“å‰ context çš„è®¾ç½®ï¼Œå®ƒä»¬è¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚æ¯ä¸€ä¸ª context éƒ½æœ‰ä¸€ä¸ªæ ˆã€‚å½“ä½ æ¢å¤ graphics stateï¼Œä¹‹å‰ä¿å­˜çš„ GState ä»æ ˆä¸­å¼¹å‡ºæ¥å¹¶ä¸”ç¼–ç¨‹ context å½“å‰çš„å€¼ã€‚å°†æ¡ƒå¿ƒç»˜åˆ¶ä»£ç è¿™æ ·ä¿®æ”¹å¯ä»¥ä¿®å¤â€œæ©™è‰²çŸ©å½¢æ˜¯çº¢è‰²â€çš„ bugï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">draw red valentine:</span><br><span class="line">    save graphics state</span><br><span class="line">    set color to red in the current context</span><br><span class="line">    fill a valentine</span><br><span class="line">    restore graphics state</span><br></pre></td></tr></table></figure>
<p>ç„¶åã€‚å®Œæ•´çš„ç»˜åˆ¶è°ƒç”¨åºåˆ—æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set color to orange in the current context</span><br><span class="line">save graphics state</span><br><span class="line">set color to red in the current context</span><br><span class="line">fill a valentine</span><br><span class="line">restore graphics state</span><br><span class="line">fill a rectangle</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ GState çš„æ”¹å˜ï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/12/gstates.png" alt=""></p>
<h2 id="Core-Graphics-API"><a href="#Core-Graphics-API" class="headerlink" title="Core Graphics API"></a>Core Graphics API</h2><p>å¥½äº†ï¼Œåœ¨æŠ½è±¡å±‚é¢è¿˜è¡Œï¼Œä½†æ˜¯è¿™äº›ä¸œè¥¿åœ¨ä½ å®é™…çœ‹åˆ°å®ƒæ—¶æ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿå¹¶ä¸å®Œå…¨å¦‚ä½ æ‰€æƒ³ã€‚Core Graphics æ˜¯ä¸€ä¸ª Core Foundation å‘³é“çš„ APIã€‚æœ‰å¾ˆå¤š Core Foundation çš„ä¼ ç»Ÿå½±å“ç€ Core Graphicsã€‚æœ€ä¸»è¦çš„å¤æ€ªç‚¹åœ¨äº Core Foundation å¯¹äºç”¨æŒ‡é’ˆå£°æ˜ä¸œè¥¿æœ‰ä¸€ç§è«åå…¶å¦™çš„ææƒ§ã€‚ç»“æœå°±æ˜¯ç”¨ Objective-C ä¸­çš„ â€œRefâ€ ç±»å‹ï¼Œæ¯”å¦‚ <code>CGContextRef</code> æˆ–è€… <code>CGColorRef</code>ã€‚è¿™äº›å…¶å®æ˜¯ç±»å‹é‡å®šä¹‰ä¹‹åéšè—äº†é‚£é¢—æ˜Ÿçš„æŒ‡é’ˆã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ­£ç¡®çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextRef currentContext = ....; // å®é™…ä¸Šæ˜¯ä¸ªæŒ‡é’ˆ</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹ä¸æ­£ç¡®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextRef *currentContext = ...; // æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆ</span><br></pre></td></tr></table></figure>
<p>ä½ çš„ç»˜åˆ¶ä»£ç å¾ˆå°‘ä¼šåˆ›å»ºå®ƒåœ¨å…¶ä¸­ç»˜åˆ¶çš„ contextï¼Œè€Œæ˜¯ä½¿ç”¨å½“å‰ contextã€‚ä½ å¯ä»¥åœ¨ iOS ä¸­è¿™æ ·è·å–å½“å‰ contextï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextRef context = UIGraphicsGetCurrentContext ();</span><br></pre></td></tr></table></figure>
<p>åœ¨ Desktop Cocoaï¼ŒOS X 10.10 ä¹‹å‰ï¼Œç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextRef context = [NSGraphicsContext.currentContext graphicsPort]</span><br></pre></td></tr></table></figure>
<p>åœ¨ 10.10 ä¹‹åï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGContextRef context = [NSGraphicsContext.currentContext CGContext]</span><br></pre></td></tr></table></figure>
<h2 id="ç”»å•Šï¼Œæœ‹å‹ï¼"><a href="#ç”»å•Šï¼Œæœ‹å‹ï¼" class="headerlink" title="ç”»å•Šï¼Œæœ‹å‹ï¼"></a>ç”»å•Šï¼Œæœ‹å‹ï¼</h2><p>å› ä¸º CG API æ˜¯ä¸€ä¸ªé¢å¯¹å¯¹è±¡çš„ C APIï¼Œæ–¹æ³•éƒ½æ˜¯æ ¹æ®å®ƒä»¬æ‰€æ“ä½œçš„â€œå¯¹è±¡â€å‘½åçš„ï¼ˆæ¯”å¦‚ï¼Œ<code>CGColor</code> æˆ–è€… <code>CGContext</code>ï¼‰ï¼Œå¹¶ä¸”æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¦‚åŒ Objective-C ä¸­çš„ reveiverã€‚å› æ­¤å°±æ˜¯é‚£ä¸ªâ€œå¯¹è±¡â€è¢«è¿™äº›è°ƒç”¨æ”¹å˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç”»çŸ©å½¢è½®å»“çš„ CGContext è°ƒç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CGContextRef context = ...;  // å‚ç…§ä¸Šæ–¹å¯¹åº”å¹³å°çš„è°ƒç”¨</span><br><span class="line">CGRect bounds = someView.bounds;</span><br><span class="line">CGContextStrokeRect (context, bounds);</span><br></pre></td></tr></table></figure>
<p>ï¼ˆæƒ³äº†è§£æ›´å¤šå…³äºçŸ©å½¢çš„ä¸œè¥¿ï¼Ÿè¿™æœ‰ä¸¤ç¯‡ <a href="https://www.bignerdranch.com/blog/rectangles-part-1/" target="_blank" rel="external">Part 1</a>, <a href="https://www.bignerdranch.com/blog/rectangles-part-2/" target="_blank" rel="external">Part 2</a>å…³äºå®ƒä»¬çš„æ–‡ç« ã€‚ï¼‰</p>
<p><code>CGContextStrokeRect</code> å– <code>CGContextRef</code> ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯ç”»å‡ºä¸€ä¸ªç‰¹å®šçŸ©å½¢çš„è½®å»“ã€‚å¦‚æœ context æ˜¯ image contextï¼Œæˆ–è€…æ˜¯ç”¨æ¥åœ¨å±å¹•ä¸Šæ¸²æŸ“å›¾å½¢çš„ contextï¼Œä¸€ä¸ªçŸ©å½¢è¿™ä¹ˆå¤šçš„åƒç´ ä¼šè¢«è®¾ç½®æˆ context å½“å‰çš„é¢œè‰²ï¼ˆå½“å‰çš„çº¿å®½ï¼Œæ ·å¼ï¼Œç­‰ç­‰ï¼‰ã€‚å¦‚æœå½“å‰çš„ context æ˜¯ PDF contextï¼Œé‚£ä¸€äº›æŒ‡ä»¤ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œåœ¨è¿™ä¸ª PDF å°†æ¥è¢«æ¸²æŸ“çš„æ—¶å€™æœ€ç»ˆç»˜åˆ¶å‡ºä¸€ä¸ªçŸ©å½¢ã€‚</p>
<h2 id="æ¸…æ´-Context"><a href="#æ¸…æ´-Context" class="headerlink" title="æ¸…æ´ Context"></a>æ¸…æ´ Context</h2><p>æ˜¯æ—¶å€™æ¥ç‚¹æ‹ŸçœŸä»£ç äº†ã€‚GrafDemo æ˜¯ä¸€ä¸ªå°†ä¼šåŒ…å«è¶Šæ¥è¶Šå¤šæ¶‰åŠ CG å„æ–¹é¢ demo çš„ appã€‚ä½ å¯ä»¥åœ¨ <a href="https://github.com/markd2/GrafDemo" target="_blank" rel="external">GitHub</a> ä¸Šæ‰¾åˆ°æºç ã€‚å½“å‰ç‰ˆæœ¬åœ¨è¿™é‡Œ <a href="https://github.com/markd2/GrafDemo/releases/tag/release-cg-pt2" target="_blank" rel="external">Release cg-pt2</a>ã€‚</p>
<p>GrafDemo åŒ…å«ä¸€ä¸ªç»˜åˆ¶äº†ä¸€ä¸ªåœ¨ç™½è‰²èƒŒæ™¯ä¸Šç”±ç²—è“çº¿åŒ…å›´çš„ç»¿è‰²åœ†å½¢çš„ NSViewï¼Œæ•´ä¸ª view ç”±ç»†é»‘è¾¹åŒ…å›´ã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/12/good-vs-sloppy-drawing.png" alt=""></p>
<p>è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šä¸€ä¸ªæœ‰è‰¯å¥½çš„æ¸…æ´çš„ GStateï¼Œå¦ä¸€ä¸ªæ²¡æœ‰ã€‚è¯·æ³¨æ„åœ¨é‚£ä¸ª sloppy ç‰ˆæœ¬ï¼Œè“è‰²ç²—çº¿æ³„éœ²å¹¶æ±¡æŸ“äº†è¾¹ç•Œã€‚å¦‚æœä½ å®é™…è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸¤ä¸ª view å¹¶æ’åœ¨ä¸€èµ·ã€‚ä¸€ä¸ªæ˜¯ Objective-C ç‰ˆæœ¬ï¼›å¦ä¸€ä¸ªæ˜¯ Swift ç‰ˆæœ¬ã€‚</p>
<p>è¿™ä¸ª view çš„å­ç±»æœ‰ä¸€ä¸ª convenience æ–¹æ³•ç”¨æ¥è·å–å½“å‰ contextã€‚è¿™åº”è¯¥ä¼šè®©å…¶è½¬ç§»åˆ° iOS æ—¶æ›´ç®€å•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (CGContextRef) currentContext &#123;</span><br><span class="line">    return [NSGraphicsContext.currentContext graphicsPort];</span><br><span class="line">&#125; // æŒ¡å¢™ context</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª view çš„ <code>drawRect</code> å®ç°å•çº¯åœ°è®¾ç½®äº†æè¾¹å’Œå¡«å……é¢œè‰²ï¼ŒæœŸæœ›ä»–ä»¬èƒ½è¢«èƒŒæ™¯å’Œè¾¹ç¼˜ç»˜åˆ¶æ–¹æ³•ç»™ç”¨ä¸Šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (void) drawSloppily &#123;</span><br><span class="line">    CGContextRef context = self.currentContext;</span><br><span class="line"></span><br><span class="line">    CGContextSetRGBStrokeColor (context, 0.0, 0.0, 0.0, 1.0); // Black</span><br><span class="line">    CGContextSetRGBFillColor (context, 1.0, 1.0, 1.0, 1.0); // White</span><br><span class="line"></span><br><span class="line">    [self drawSloppyBackground];</span><br><span class="line">    [self drawSloppyContents];</span><br><span class="line">    [self drawSloppyBorder];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>èƒŒæ™¯å’Œè¾¹ç¼˜çš„æ–¹æ³•éå¸¸ç›´æ¥æ˜äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void) drawSloppyBackground &#123;</span><br><span class="line">    CGContextFillRect (self.currentContext, self.bounds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void) drawSloppyBorder &#123;</span><br><span class="line">    CGContextStrokeRect (self.currentContext, self.bounds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»–ä»¬éƒ½å‡è®¾ context æ˜¯åƒ <code>drawRect</code> è®¾ç½®çš„é‚£æ ·ã€‚ä½†æ˜¯ï¼é—®é¢˜æ¥äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (void) drawSloppyContents &#123;</span><br><span class="line">    CGContextRef context = self.currentContext;</span><br><span class="line"></span><br><span class="line">    CGRect innerRect = CGRectInset (self.bounds, 20, 20);</span><br><span class="line"></span><br><span class="line">    CGContextSetRGBFillColor (context, 0.0, 1.0, 0.0, 1.0); // Green</span><br><span class="line">    CGContextFillEllipseInRect (context, innerRect);</span><br><span class="line"></span><br><span class="line">    CGContextSetRGBStrokeColor (context, 0.0, 0.0, 1.0, 1.0); // Blue</span><br><span class="line">    CGContextSetLineWidth (context, 6.0);</span><br><span class="line">    CGContextStrokeEllipseInRect (context, innerRect);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„é¢œè‰²å’Œçº¿å®½çš„æ”¹å˜ã€‚context ä¿æŒçš„æ˜¯ä¸€äº›å…¨å±€çš„çŠ¶æ€ï¼Œå› æ­¤å½“å‰çš„å¡«å……å’Œæè¾¹é¢œè‰²ï¼Œä»¥åŠå½“å‰çš„çº¿å®½éƒ½è¢«æ±¡æŸ“äº†ã€‚</p>
<h2 id="æŠŠæˆ‘å‹è¿›å»ï¼ŒæŠŠä½ å¼¹å‡ºæ¥"><a href="#æŠŠæˆ‘å‹è¿›å»ï¼ŒæŠŠä½ å¼¹å‡ºæ¥" class="headerlink" title="æŠŠæˆ‘å‹è¿›å»ï¼ŒæŠŠä½ å¼¹å‡ºæ¥"></a>æŠŠæˆ‘å‹è¿›å»ï¼ŒæŠŠä½ å¼¹å‡ºæ¥</h2><p>ä¿®å¤è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±æ˜¯åœ¨ç»˜åˆ¶å†…å®¹å‰å°† graphics context å‹å…¥æ ˆã€‚<code>CGContextSaveGState</code> å°†å½“å‰çš„ graphics contextã€ state çš„ä¸€ä»½æ‹·è´å‹å…¥æ ˆä¸­ã€‚<code>CGContextRestoreGState</code> ä»æ ˆé¡¶å¼¹å‡ºå¹¶æ›¿æ¢å½“å‰çš„ contextã€‚</p>
<p>ä¸‹é¢æ˜¯ä¼šä¿å­˜ graphics state çš„å¥½ä¸€ç‚¹çš„ç‰ˆæœ¬çš„å†…å®¹ç»˜åˆ¶ï¼ˆä»£ç ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (void) drawNiceContents &#123;</span><br><span class="line">    CGContextRef context = self.currentContext;</span><br><span class="line"></span><br><span class="line">    CGContextSaveGState (context); &#123;</span><br><span class="line">        CGRect innerRect = CGRectInset (self.bounds, 20, 20);</span><br><span class="line"></span><br><span class="line">        CGContextSetLineWidth (context, 6.0);</span><br><span class="line"></span><br><span class="line">        CGContextSetRGBFillColor (context, 0.0, 1.0, 0.0, 1.0); // Green</span><br><span class="line">        CGContextFillEllipseInRect (context, innerRect);</span><br><span class="line"></span><br><span class="line">        CGContextSetRGBStrokeColor (context, 0.0, 0.0, 1.0, 1.0); // Blue</span><br><span class="line">        CGContextStrokeEllipseInRect (context, innerRect);</span><br><span class="line"></span><br><span class="line">    &#125; CGContextRestoreGState (context);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ç®€å•åœ°åŒ…è£¹ä¿å­˜ã€æ¢å¤å°±é˜»æ­¢äº†è¿™ä¸ªæ–¹æ³•æ±¡æŸ“å…¶ä»–çš„æ–¹æ³•ã€‚</p>
<p>ä¸€ç‚¹å…³äºèŠ±æ‹¬å·çš„äº‹æƒ…ï¼šè¿™æ˜¯æˆ‘ä¸ªäººåœ¨æœ‰ä¸€äº›å¹³è¡¡çš„è°ƒç”¨æ—¶çš„å‡æ¨¡å‡å¼ï¼Œæ¯”å¦‚è¯´åœ¨ä¿å­˜å’Œæ¢å¤ GStateï¼Œæˆ–è€…é”å®šå’Œè§£é”äº’æ–¥ã€‚è¿™æ ·éå¸¸æ¸…æ¥šä»€ä¹ˆæ˜¯å¤„åœ¨ä¿æŠ¤ä¸­çš„ï¼Œå¹¶ä¸”è®©å®ƒå¾ˆæ¸…æ¥šåœ°èƒ½åœ¨ä¸€çœ¼çœ‹ä¸‹æ¥æ—¶è¢«å‘ç°æœ‰ä¸€ä¸ªä¿æŠ¤ä¼å­˜åœ¨ï¼Œè¿™æ¯”ä¸€å †å·¦å¯¹é½çš„ä»£ç å®¹æ˜“çœ‹è§å¾—å¤šã€‚å®ƒä»¬å®é™…ä¸Šå¹¶é Core Graphics API çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h2 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h2><p>å¥½äº†ï¼Œé‚£ Swift æ€ä¹ˆæ ·ï¼ŸGrafDemo æœ‰å¹³è¡Œçš„ Objective-C å®ç°å’Œ Swift å®ç°ï¼Œå› æ­¤éšä¾¿é€‰æ‹©ä½ è¦ç ”è¯»å“ªä¸€æ®µç¤ºä¾‹ä»£ç å§ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œç”¨ Swift å†™çš„ CG çš„ä»£ç å’Œå®ƒåœ¨ Objective-C ä¸­ä¸€æ ·ï¼Œåªæ˜¯æ²¡æœ‰äº†ç»“å°¾çš„åˆ†å·ã€‚ä¸‹é¢æ˜¯ sloppy å†…å®¹ç»˜åˆ¶åœ¨ Swift ä¸­çš„æ ·å­ã€‚<code>currentContext</code> æ˜¯ä¸€ä¸ªè¿”å›å½“å‰ç»˜åˆ¶ context çš„å±æ€§ï¼ˆç¨åæ›´å¤šç»†èŠ‚ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func drawSloppyContents() &#123;</span><br><span class="line">    let innerRect = CGRectInset(bounds, 20.0, 20.0)</span><br><span class="line"></span><br><span class="line">    CGContextSetRGBFillColor (currentContext, 0.0, 1.0, 0.0, 1.0) // Green</span><br><span class="line">    CGContextFillEllipseInRect (currentContext, innerRect)</span><br><span class="line"></span><br><span class="line">    CGContextSetRGBStrokeColor (currentContext, 0.0, 0.0, 1.0, 1.0) // Blue</span><br><span class="line">    CGContextSetLineWidth (currentContext, 6.0)</span><br><span class="line">    CGContextStrokeEllipseInRect (currentContext, innerRect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Scope-çš„æŠŠæˆ"><a href="#Scope-çš„æŠŠæˆ" class="headerlink" title="Scope çš„æŠŠæˆ"></a>Scope çš„æŠŠæˆ</h2><p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘çš„å°æŠŠæˆåœ¨ Swift ä¸­ä¸ç®¡ç”¨ï¼šæœªç»ä¿®é¥°çš„èŠ±æ‹¬å·å¯¹å˜æˆäº†ä¸€ä¸ªé—­åŒ…å¹¶é€ æˆäº†è¯­æ³•é”™è¯¯ã€‚ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…å«è¿™ä¸ªé—­åŒ…çš„å‡½æ•°ï¼Œå¹¶ä¸”ç”¨å®ƒæ¥åŒ…è£¹ä¿å­˜å’Œæ¢å¤ contextã€‚è¿™ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private func saveGState(drawStuff: () -&gt; ()) -&gt; () &#123;</span><br><span class="line">    CGContextSaveGState (currentContext)</span><br><span class="line">    drawStuff()</span><br><span class="line">    CGContextRestoreGState (currentContext)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠç›¸å…³çš„ç”¨æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">func drawNiceContents() &#123;</span><br><span class="line">    saveGState &#123;</span><br><span class="line">        let innerRect = CGRectInset(self.bounds, 20.0, 20.0)</span><br><span class="line"></span><br><span class="line">        CGContextSetRGBFillColor (self.currentContext, 0.0, 1.0, 0.0, 1.0) // Green</span><br><span class="line">        CGContextFillEllipseInRect (self.currentContext, innerRect)</span><br><span class="line"></span><br><span class="line">        CGContextSetRGBStrokeColor (self.currentContext, 0.0, 0.0, 1.0, 1.0) // Blue</span><br><span class="line">        CGContextSetLineWidth (self.currentContext, 6.0)</span><br><span class="line">        CGContextStrokeEllipseInRect (self.currentContext, innerRect)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦çš„ç¼ºç‚¹å°±æ˜¯ä½ å¿…é¡»ä½¿ç”¨ <code>self</code> æ¥åœ¨é‚£ä¸ªå—é‡Œå¼•ç”¨ä¸œè¥¿ã€‚æˆ‘è¿˜æ²¡æœ‰å†³å®šæ˜¯å¦è¦ä¸€ç›´ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<h2 id="è·å–-Context"><a href="#è·å–-Context" class="headerlink" title="è·å– Context"></a>è·å– Context</h2><p>è·å– <code>CGContext</code> åœ¨ iOS å’Œ OS X 10.10ï¼ˆä»¥åŠä¹‹åï¼‰ä¸­ç›¸å½“ç®€å•ã€‚è°¢å¤©è°¢åœ°ï¼ŒSwift èˆå¼ƒäº†ç±»å‹ä¸­çš„ â€Refâ€œ éƒ¨åˆ†ï¼Œå› æ­¤ä½ åªéœ€è¦ CGContextã€‚ä¸‹é¢æ˜¯å¦‚ä½•åœ¨ iOS ä¸­è·å–å½“å‰ contextï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let context = UIGraphicsGetCurrentContext()</span><br></pre></td></tr></table></figure>
<p><code>context</code> æ˜¯æ¨æ–­ç±»å‹ CGContextï¼Ÿã€‚å®ƒå¯ä»¥ä¸º nil å› ä¸ºæœ‰å¯èƒ½å½“å‰æ²¡æœ‰ contextã€‚Objective-C ä¸­ <code>UIGraphicsGetCurrentContext()</code> è¿”å›ä¸€ä¸ª <code>CGContextRef</code>ï¼Œå› æ­¤è¿™ä¸ªè½¬æ¢æ˜¯éå¸¸å®¹æ˜“çš„ã€‚</p>
<p>OS X 10.10 ä¸­ç»™ <code>NSGraphicsContext</code> æ·»åŠ äº†ä¸€ä¸ª <code>CGContext</code> å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let context = NSGraphicsContext.currentContext?.CGContext</span><br></pre></td></tr></table></figure>
<p>OS X 10.9 å°±æ²¡è¿™ä¹ˆå¹¸è¿ã€‚<code>NSGraphicsContext -graphicsPort</code> çš„è°ƒç”¨è¿”å›ä¸€ä¸ª <code>void*</code>ã€‚Swift å¹¶æ²¡æœ‰è®©æ”¹å˜æŒ‡é’ˆç±»å‹å˜å¾—ç®€å•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private var currentContext : CGContext? &#123;</span><br><span class="line">    get &#123;</span><br><span class="line">        // The 10.10 SDK provides a CGContext on NSGraphicsContext, but</span><br><span class="line">        // that&apos;s not available to folks running 10.9, so perform this</span><br><span class="line">        // violence to get a context via a void*.</span><br><span class="line">        // iOS can just use UIGraphicsGetCurrentContext.</span><br><span class="line"></span><br><span class="line">        let unsafeContextPointer = NSGraphicsContext.currentContext()?.graphicsPort</span><br><span class="line"></span><br><span class="line">        if let contextPointer = unsafeContextPointer &#123;</span><br><span class="line">            let opaquePointer = COpaquePointer(contextPointer)</span><br><span class="line">            let context: CGContextRef = Unmanaged.fromOpaque(opaquePointer).takeUnretainedValue()</span><br><span class="line">            return context</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return nil</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´ï¼Œ<code>unsafeContextPointer</code> æ˜¯ä¸€ä¸ª <code>UnsafeMutablePointer&lt;Void&gt;?</code>ã€‚å¦‚æœå®ƒä¸ä¸º nilï¼Œç”¨ä¸€ä¸ª <code>COpaquePointer</code> å°†å…¶åŒ…è£¹èµ·æ¥ã€‚è¿™åªæ˜¯ä¸ºäº†ä½ å¯ä»¥å°†å®ƒä¼ å…¥ <code>Unmanaged</code>ã€‚<code>Unmanaged</code> å¯ä»¥ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆçš„å€¼ï¼Œå¹¶ä¸”å› ä¸º <code>CGContext</code> åƒ <code>NSObject</code> ä¸€æ ·æœ‰å¼•ç”¨è®¡æ•°ï¼Œä½¿ç”¨ unretain çš„å€¼å°±å°†ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰æƒè½¬äº¤ç»™ ARC äº†ã€‚<code>takeUnretained</code> æ˜¯è¯´â€å˜¿ ARCï¼Œè¿™ä¸ªå€¼ä½ ç®¡ç€å§ã€‚å®ƒç°åœ¨æ˜¯ unretain çš„çŠ¶æ€ï¼Œå¹¶ä¸”å¯èƒ½åœ¨ autorelease æ± æ”¾å¹²æ—¶è·‘ä¸è§äº†ã€‚ä½ æƒ³åŠæ³•è®©å®ƒåœ¨éœ€è¦çš„æ—¶å€™ä¸€ç›´åœ¨å§ã€‚â€œ</p>
<h2 id="è”ç›Ÿä¸­çš„-GState"><a href="#è”ç›Ÿä¸­çš„-GState" class="headerlink" title="è”ç›Ÿä¸­çš„ GState"></a>è”ç›Ÿä¸­çš„ GState</h2><p>è¿™ä¸€æ¬¡ï¼Œä½ é‡è§äº† Core Graphics contextï¼Œè¿™æ˜¯ä¸€ç­ç­ç»˜åˆ¶å±æ€§ã€‚context æ˜¯ä¸€ä¸ªä¸é€æ˜çš„ç»“æ„ï¼Œå› æ­¤ä½ å¹¶ä¸çŸ¥é“é‡Œé¢æ½œè—ç€ä»€ä¹ˆã€‚ä¹Ÿå› ä¸ºè¿™ä¸ªå…¨å±€çŠ¶æ€ï¼Œä»¥åŠæœ‰ä¸€äº› Core Graphics è°ƒç”¨æœ‰å‰¯ä½œç”¨çš„äº‹å®ï¼ˆä¹‹åä¼šçœ‹åˆ°ï¼Œå½“ path é‡æ–°å‡ºç°çš„æ—¶å€™ï¼‰ï¼Œå‡ ä¹ä¸å¯èƒ½åœ¨æ”¹å˜ç»˜åˆ¶å±æ€§ä¹‹å‰ä¿å­˜å®ƒä»¬ã€‚</p>
<p>Core Graphics æœ‰ graphics state æ ˆçš„æ¦‚å¿µï¼Œè¿™ä¹Ÿå­˜åœ¨äº PostScript ä¸­ã€‚ä½ å¯ä»¥ç”¨ <code>CGContextSaveGState</code> æ¥å°†å½“å‰ graphics state çš„ä¸€ä»½æ‹·è´å‹å…¥æ ˆå¹¶ä¸”å¯ä»¥é€šè¿‡ <code>CGContextRestoreGState</code> å¼¹å‡ºä¿å­˜çš„çŠ¶æ€æœ‰æ•ˆåœ°æ’¤é”€ä»»ä½•å¯¹ context çš„æ”¹å˜ã€‚æœ‰ä¸€äº›ä¼šæ±¡æŸ“ context å¯¼è‡´åç»­ç»˜åˆ¶å‡ºé”™çš„ä»£ç ï¼Ÿç”¨ Save/Restore åŒ…è£¹æŠŠå®ƒèµ·æ¥ã€‚</p>
<p>Core Graphics çš„ä»£ç åœ¨ Objective-C å’Œ Swift ä¸­å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚åœ¨ iOS å’Œ OS X ä¸Šä¸šç»©ä¼šä¸€æ¨¡ä¸€æ ·ï¼Œå› æ­¤ Core Graphics ä»£ç æ˜¯åœ¨ç›¸å¯¹ Apple ç”Ÿæ€ç³»ç»Ÿä¸­çš„å…¶ä»–éƒ¨åˆ†ä¸­ç§»æ¤æ€§ç›¸å½“å¥½çš„ã€‚Swift ä¸­å”¯ä¸€çœŸæ­£å›°éš¾çš„æ˜¯åœ¨ Mavericks ç³»ç»Ÿä¸­ä» Cocoa å°† <code>void*</code> è£…æ¢æˆ <code>CGContext</code> ï¼ˆåŸºæœ¬ä¸Šåªæ˜¯ä»å†…å­˜åœ°å€ A åˆ°å†…å­˜åœ°å€ B å¤åˆ¶ 4-8 ä½ï¼‰ï¼Œå› ä¸º Swift è¯•å›¾è®©ç¨‹åºå‘˜è¿œç¦»é‚£äº›åº•å±‚ç»†èŠ‚ã€‚å¦‚æœä½ é’ˆå¯¹çš„æ˜¯ Yosemite åŠä¹‹åçš„ç‰ˆæœ¬ï¼Œè¿™å°±ä¸æ˜¯ä¸ªé—®é¢˜äº†ã€‚</p>
<p>ä¸‹ä¸€æ¬¡ï¼šLinesï¼ï¼ˆæ˜¯ Lines-çˆ½-è€¶-å¼€å¿ƒ-å¥½ç©-æ—¶é—´ï¼Œè€Œé Lines-éšå¼-æœªå±•å¼€çš„-å¯é€‰å€¼ã€‚ï¼‰</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.bignerdranch.com/blog/core-graphics-part-2-contextually-speaking/&quot;&gt;Core Graphics, Part 2: Contextually Speaking&lt;/a&gt;&lt;br&gt;çœ‹çœ‹ä¸Šä¸€ç¯‡å§ï¼š&lt;a href=&quot;http://chengkang.me/2017/05/23/core-graphics-part-1/&quot;&gt;ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬ä¸€éƒ¨åˆ†ï¼šåºç« &lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;context ï¼ˆä¸Šä¸‹æ–‡ï¼‰å°±æ˜¯ Quartz çš„æ ¸å¿ƒï¼šä½ éœ€è¦æŒ‰ç…§æŸç§è§„èŒƒæ¥ä¸å½“å‰çš„ Core Graphics context äº¤äº’ä»¥çœŸæ­£ç»˜åˆ¶ä¸œè¥¿ï¼Œå› æ­¤ç†Ÿæ‚‰å®ƒã€å®ƒåšä»€ä¹ˆä»¥åŠä¸ºä»€ä¹ˆå®ƒæ˜¯è¿™æ ·çš„æ˜¯æœ‰ç›Šå¤„çš„ã€‚&lt;/p&gt;
&lt;p&gt;Core Graphics é‡Œé¢ä¸€ä¸ªåŸºç¡€çš„æ“ä½œæ˜¯åˆ›å»ºä¸€ä¸ª pathã€‚Path æ˜¯å½¢çŠ¶çš„æ•°å­¦æè¿°ã€‚ä¸€ä¸ª path å¯ä»¥æ˜¯ä¸€ä¸ªçŸ©å½¢ï¼Œæˆ–ä¸€ä¸ªåœ†ã€ä¸€ä¸ªç‰›ä»”å¸½ï¼Œæˆ–è€…ç”šè‡³æ˜¯æ³°å§¬é™µã€‚Path å¯ä»¥ç”¨é¢œè‰²å¡«å……â€”â€”å°±æ˜¯è¯´ï¼Œè¿™ä¸ª path ä¸­çš„æ‰€æœ‰çš„ç‚¹éƒ½è¢«è®¾ç½®æˆç‰¹å®šçš„é¢œè‰²ã€‚Path ä¹Ÿå¯ä»¥ç”»å‡ºè½®å»“ï¼ˆoutlinedï¼‰ï¼Œæˆ–è€…è¯´å«æè¾¹ï¼ˆstrokedï¼‰ã€‚è¿™å°±åƒæ˜¯ç”¨ä¸€æ”¯ç¾æœ¯é’¢ç¬”åœ¨è·¯å¾„å‘¨å›´ç”»å‡ºä¸€ä¸ªè½®å»“ã€‚ä¸‹é¢åˆ†åˆ«æ˜¯ä¸€ä¸ªåªç”»å‡ºäº†è½®å»“çš„ã€ä¸€ä¸ªåªå¡«å……é¢œè‰²çš„å’Œä¸€ä¸ªæ—¢å¡«å……äº†é»„è‰²ç”±æè“è¾¹çš„å¸½å­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.bignerdranch.com/assets/img/blog/2014/12/hat-path.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Core Graphics" scheme="http://chengkang.me/tags/Core-Graphics/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘Core Graphicsï¼Œç¬¬ä¸€éƒ¨åˆ†ï¼šåºç« </title>
    <link href="http://chengkang.me/2017/05/23/core-graphics-part-1/"/>
    <id>http://chengkang.me/2017/05/23/core-graphics-part-1/</id>
    <published>2017-05-23T21:20:01.000Z</published>
    <updated>2017-05-23T21:21:36.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.bignerdranch.com/blog/core-graphics-part-1-in-the-beginning/" target="_blank" rel="external">Core Graphics, Part 1: In the Beginning - Mark Dalrymple</a></p>
</blockquote>
<p>Mac å’Œ iOS å¼€å‘è€…æœ‰è®¸å¤šä¸åŒçš„è®©ä¸œè¥¿æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ç¼–ç¨‹æ¥å£ã€‚UIKit å’Œ AppKit æœ‰å„ç§å„æ ·çš„ imageã€color å’Œ path ç±»ã€‚Core Animation è®©ä½ å¯ä»¥ç§»åŠ¨ layerã€‚OpenGL è®©ä½ å¯ä»¥åœ¨ä¸‰ç»´ç©ºé—´æ¸²æŸ“ä¸œè¥¿ã€‚SpriteKit è®©ä½ å¯ä»¥åšåŠ¨ç”»ã€‚AVFoundation è®©ä½ å¯ä»¥æ’­æ”¾è§†é¢‘ã€‚</p>
<p>Core Graphicsï¼Œæˆ–è€…å®ƒåœ¨å¸‚åœºä¸­è¢«äººç†ŸçŸ¥çš„åå­—â€œQuartzâ€ï¼Œæ˜¯è¿™ä¸ªå¹³å°ä¸Šæœ€è€çš„å›¾å½¢ç›¸å…³ API ä¹‹ä¸€ã€‚Quartz æ„å»ºäº†å¤§å¤šæ•°äºŒç»´çš„ä¸œè¥¿çš„åŸºç¡€ã€‚æƒ³è¦ç”»äº›å›¾å½¢ï¼Œç»™å®ƒä»¬å¡«å……ä¸Šæ¸å˜å¹¶ä¸”åŠ ä¸Šé˜´å½±ï¼Ÿç”¨ Core Graphicsã€‚æƒ³è¦åœ¨å±å¹•ä¸Šåˆæˆå›¾ç‰‡ï¼ŸCore Graphics èƒ½è§£å†³ã€‚æƒ³è¦åˆ›å»º PDFï¼Ÿè¿˜æ˜¯ Core Graphicsã€‚</p>
<a id="more"></a>
<p>CG æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„ APIï¼ŒåŒ…æ‹¬äº†ä»åŸºæœ¬çš„å‡ ä½•æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚ï¼šç‚¹ã€å¤§å°ã€å‘é‡å’ŒçŸ©å½¢ï¼‰å’Œç”¨äºæ“ä½œå®ƒä»¬çš„æ–¹æ³•ã€ç”¨äºå°†åƒç´ æ¸²æŸ“è¿›å›¾ç‰‡æˆ–è€…å±å¹•çš„ä¸œè¥¿ï¼Œä¸€ç›´åˆ°äº‹ä»¶å¤„ç†ã€‚ä½ å¯ä»¥ç”¨ CG æ¥åˆ›å»ºâ€œevents tapsâ€ï¼Œå®ƒèƒ½å¸®ä½ ç›‘å¬å’Œæ“ä½œåº”ç”¨ä¸­çš„äº‹ä»¶æµï¼ˆé¼ æ ‡ç‚¹å‡»ã€å±å¹•ç‚¹å‡»ã€ä»»æ„é”®ç›˜æŒ‰é”®ï¼‰ã€‚</p>
<p>å¥½å§ã€‚æœ€åä¸€é¡¹æ˜¯æœ‰ç‚¹å¥‡æ€ªã€‚ä¸ºä»€ä¹ˆä¸€ä¸ª graphics API è¦å¤„ç†ç”¨æˆ·äº‹ä»¶å‘¢ï¼Ÿè¿™å•Šå’Œåˆ«çš„ä¸€æ ·ï¼Œè¿˜å¾—ä»å†å²è¯´èµ·ã€‚è€Œä¸”äº†è§£ä¸€ç‚¹å†å²ä¹Ÿå¯ä»¥å¸®åŠ©ç†è§£ä¸ºä»€ä¹ˆ CG æ˜¯é‚£æ ·å·¥ä½œçš„ã€‚</p>
<h2 id="å†å²ä¸­çš„-PostScript"><a href="#å†å²ä¸­çš„-PostScript" class="headerlink" title="å†å²ä¸­çš„ PostScript"></a>å†å²ä¸­çš„ PostScript</h2><p>ä»æ—¶é—´çš„è¿·é›¾å¾€å›çœ‹ï¼ˆäºŒåä¸–çºªå…«åå¹´ä»£ï¼ŒDuran Duran è¿˜åœ¨ä¸Šå‡æœŸæ—¶ï¼‰ï¼Œgraphic API ç›¸æ¯”ä»Šå¤©è¿˜éå¸¸åˆçº§ã€‚ä½ èƒ½åšçš„åªæœ‰ä»æœ‰é™çš„è‰²ç›˜ä¸­æŒ‘é€‰é¢œè‰²ã€ç»˜åˆ¶ç‹¬ç«‹çš„åƒç´ ç‚¹ã€è¿çº¿å’Œç”»ä¸€äº›åŸºæœ¬çš„å›¾å½¢æ¯”å¦‚çŸ©å½¢å’Œæ¤­åœ†ã€‚ä½ å¯ä»¥è®¾ç½®å‰ªåˆ‡èŒƒå›´æ¥å‘Šè¯‰åˆ«äººï¼Œâ€œå˜¿ï¼Œè¿™å„¿ä¸èƒ½ç”»ï¼Œâ€è€Œä¸”æœ‰æ—¶å€™ä½ ä¼šæœ‰ä¸€äº›ä¸å—æ§çš„ç‰¹æ€§æ¯”å¦‚è°ƒæ•´çº¿æœ‰å¤šå®½ã€‚ç»å¸¸ä¼šæœ‰ä¸€äº›â€œåƒç´ ä½å—ä¼ è¾“â€çš„åŠŸèƒ½ç”¨äºå°†åƒç´ å—åˆ°å¤„å¤åˆ¶ã€‚Mac ä¸Šçš„ QuickDraw æœ‰ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½å«åš <code>regions</code>ï¼Œå®ƒèƒ½è®©ä½ åˆ›å»ºä»»æ„å½¢çŠ¶çš„åŒºåŸŸç„¶åä½¿ç”¨å®ƒä»¬æ¥ç»˜åˆ¶ã€å‰ªåˆ‡ã€ç»˜åˆ¶è½®å»“æˆ–è€… hit -testã€‚ä¸è¿‡åŸºæœ¬ä¸Šï¼Œå½“æ—¶çš„ API éƒ½æ˜¯é¢å‘åƒç´ çš„ã€‚</p>
<p>1985 å¹´ï¼ŒApple å‘å¸ƒäº† LaserWriterï¼Œä¸€ä¸ªæ˜¯å…¶é“¾æ¥çš„è®¡ç®—æœºä»·æ ¼ä¸¤å€çš„æ‰“å°æœºã€‚å®ƒåŒ…å«ä¸€ä¸ªæ¯”å…¶é“¾æ¥çš„è®¡ç®—æœºæ›´å¼ºåŠ²çš„å¾®å¤„ç†å™¨ï¼Œä»¥åŠä¸€ä¸ª 12 å€çš„ RAMã€‚å½’åŠŸäºä¸€ä¸ªå«åš PostScript çš„æŠ€æœ¯ï¼Œè¿™æ¬¾æ‰“å°æœºï¼ˆåœ¨å½“æ—¶ï¼‰åˆ¶ä½œå‡ºäº†é­…åŠ›æƒŠäººçš„æ‰“å°åˆ¶å“ã€‚</p>
<p>PostScript æ˜¯ä¸€ä¸ªæ¥è‡ª Adobe çš„åŸºäºæ ˆçš„è®¡ç®—æœºè¯­è¨€ï¼Œä¸ FORTH ç±»ä¼¼ã€‚PostScriptï¼Œ è¿™ç§æŠ€æœ¯ï¼Œæ˜¯ä¸ºäº†åˆ›å»ºçŸ¢é‡å›¾ï¼ˆè‰ºæœ¯çš„æ•°å­¦æè¿°ï¼‰è€ŒéåŸºäºåƒç´ ã€‚åœ¨ LaserWriter ä¸­å†…åµŒäº†ä¸€ä¸ª PostScript è§£é‡Šå™¨ï¼Œå› æ­¤å½“ Mac ä¸Šçš„ç¨‹åºæƒ³è¦æ‰“å°ä»€ä¹ˆä¸œè¥¿çš„æ—¶å€™ï¼Œè¿™ä¸ªç¨‹åºï¼ˆæˆ–è€…æŸä¸ªæ‰“å°æœºé©±åŠ¨ï¼‰å°†ä¼šç”Ÿæˆä¸€æ®µç¨‹åºä»£ç ï¼Œå°†å…¶è½½å…¥æ‰“å°æœºå¹¶æ‰§è¡Œã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª PostScript ä»£ç çš„ä¾‹å­ä»¥åŠç»“æœå›¾åƒï¼š</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/10/postscript-code.png" alt=""></p>
<p>ä½ å¯ä»¥åœ¨ <a href="https://github.com/markd2/CGPS" target="_blank" rel="external">Github</a> ä¸Šæ‰¾åˆ°è¿™ä¸ªé¡¹ç›®ã€‚</p>
<p>å°†é¡µé¢ç”¨ä»£ç å½¢å¼æ¥å±•ç°æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è®¾è®¡ä¸Šçš„å†³ç­–ã€‚è¿™ä½¿å¾—ç¨‹åºå¯ä»¥ä»¥ç®—æ³•çš„å½¢å¼å±•ç°é¡µé¢ä¸­çš„å†…å®¹ï¼Œå› æ­¤ç”¨äºæ‰§è¡Œè¿™æ®µç¨‹åºçš„è®¾å¤‡èƒ½å¤Ÿç”¨å…¶æœ€å¤§åˆ†è¾¨ç‡æ¥ç»˜åˆ¶é¡µé¢ã€‚å¯¹äºå½“æ—¶å¤§å¤šæ•°æ‰“å°æœºï¼Œè¿™ä¸ªå€¼æ˜¯ 300dpiã€‚å¯¹äºå…¶ä»–çš„ï¼Œ1200dpiã€‚å®ƒä»¬éƒ½æ˜¯ç”±åŒæ ·çš„ç”Ÿæˆçš„ç¨‹åºç»˜åˆ¶çš„ã€‚</p>
<p>é™¤äº†æ¸²æŸ“é¡µé¢ï¼ŒPostScript æ˜¯å›¾çµå®Œå¤‡çš„ï¼Œå¹¶ä¸”å¯ä»¥è¢«å½“ä½œé€šç”¨ç¼–ç¨‹è¯­è¨€ã€‚ä½ ç”šè‡³å¯ä»¥ç”¨å®ƒå†™ Web Serverã€‚</p>
<h2 id="Companion-CuBEs"><a href="#Companion-CuBEs" class="headerlink" title="Companion CuBEs"></a>Companion CuBEs</h2><p>NeXT å·¥ç¨‹å¸ˆåœ¨è®¾è®¡ä»–ä»¬çš„ç³»ç»Ÿæ—¶ï¼Œä»–ä»¬é€‰æ‹©äº† PostScript ä½œä¸ºæ¸²æŸ“æ¨¡å‹ã€‚Display PostScriptï¼Œç®€ç§° DPSï¼Œæ‰©å±•äº† PostScript æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨çª—å£åŒ–çš„è®¡ç®—æœºæ˜¾ç¤ºå™¨å·¥ä½œã€‚ä¸è¿‡å…¶æ ¸å¿ƒä»æ˜¯ä¸€ä¸ª PostScript è§£é‡Šå™¨ã€‚NeXT çš„åº”ç”¨å¯ä»¥ç”¨ PostScript ä»£ç å®ç°å…¶å±å¹•ç»˜åˆ¶ï¼Œå¹¶ä¸”ç”¨åŒä¸€æ®µä»£ç è¿›è¡Œæ‰“å°ã€‚ä½ åŒæ ·ä¹Ÿå¯ä»¥ç”¨ C å‡½æ•°æ¥åŒ…è£¹ postScript ï¼ˆä½¿ç”¨ä¸€ä¸ªå« pswrap çš„ç¨‹åºï¼‰ä»¥ä»åº”ç”¨ä»£ç ä¸­è°ƒç”¨ã€‚</p>
<p>Display PostScript æ˜¯ç”¨æˆ·äº¤äº’çš„åŸºç¡€ã€‚äº‹ä»¶ï¼ˆé¼ æ ‡ã€é”®ç›˜ã€æ›´æ–°ç­‰ç­‰ï¼‰é€šè¿‡ DPS ç³»ç»Ÿç„¶åè¢«åˆ†å‘åˆ°åº”ç”¨ä¸­å»ã€‚</p>
<p>NeXT å¹¶éå½“æ—¶å”¯ä¸€ä½¿ç”¨ PostScript çš„çª—å£åŒ–ç³»ç»Ÿã€‚Sun çš„ NeWSï¼ˆé™¤äº†åå­—åƒä¹‹å¤–ï¼Œå’Œ NeXT æ²¡æœ‰ä¸€ç‚¹å…³ç³»ï¼‰ä¹Ÿæœ‰ä¸€ä¸ªç”¨äºé©±åŠ¨ç³»ç»Ÿä¸­ç”¨æˆ·äº¤äº’çš„å†…åµŒ PostScript è§£é‡Šå™¨ã€‚</p>
<h2 id="è¯´è¯´-Quartz"><a href="#è¯´è¯´-Quartz" class="headerlink" title="è¯´è¯´ Quartz"></a>è¯´è¯´ Quartz</h2><p>ä¸ºä»€ä¹ˆ OS X å’Œ iOS ä¸ç”¨ Display PostScriptï¼ŸåŸºæœ¬ä¸Šæ˜¯é’±çš„åŸå› ã€‚Adobe æ”¶å– Display PostScript è¯ä¹¦è´¹ç”¨ã€‚åŒæ—¶ï¼ŒApple ä¹Ÿæ˜¯æœ‰åçš„æƒ³è¦å°½å¯èƒ½æœ‰æ›´å¤šä»–ä»¬è‡ªæœ‰çš„æŠ€æœ¯æ ˆã€‚é€šè¿‡å®ç° PostScript ç»˜åˆ¶æ¨¡å‹ï¼Œä½†å¹¶ä¸çœŸæ­£ä½¿ç”¨ PostScriptï¼Œä»–ä»¬æ—¢é¿å…äº†ä»˜è¯ä¹¦è´¹ä¹Ÿæœ‰äº† Core Graphics çš„ä»£ç ã€‚</p>
<p>æœ‰ä¸€ç§æ™®éçš„è¯´æ³•æ˜¯ Quartz æ˜¯â€œåŸºäºâ€ PDF çš„ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šçš„ç¡®å¦‚æ­¤ã€‚PDF å°±æ˜¯æ²¡æœ‰ä»»æ„ç¼–ç¨‹åŠŸèƒ½çš„ PostScript ç»˜åˆ¶æ¨¡å‹ã€‚Quartz è¢«è®¾è®¡æˆå…¶ API çš„å…¸å‹ä½¿ç”¨å’Œ PDF æœ¬èº«æ”¯æŒçš„éå¸¸æ¥è¿‘ï¼Œä»¥è‡³äºåœ¨è¿™ä¸ªå¹³å°ä¸Šåˆ›å»º PDF å‡ ä¹ä¸è´¹å¹ç°ä¹‹åŠ›ã€‚</p>
<p>å“ªæ€• Display PostScript è¢« Quartz å–ä»£äº†ï¼ŒåŒæ ·çš„åŸºæœ¬åŸç†è¢«ä¿ç•™ä¸‹æ¥äº†ï¼ŒåŒ…æ‹¬äº‹ä»¶å¤„ç†ã€‚çœ‹çœ‹ Cocoa æ ˆè½¨è¿¹çš„ 18 å¸§å§ã€‚DPS ä»åœ¨ï¼</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/10/stack-trace.png" alt=""></p>
<h2 id="åŸºç¡€æ¶æ„"><a href="#åŸºç¡€æ¶æ„" class="headerlink" title="åŸºç¡€æ¶æ„"></a>åŸºç¡€æ¶æ„</h2><p>æˆ‘ä¼šåœ¨æ¥ä¸‹æ¥çš„å‡ å‘¨è®²åˆ°æ›´å¤š Quartz ç»†èŠ‚çš„å„ä¸ªæ–¹é¢ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé‡ç‚¹æ˜¯ç”¨äºâ€œç”»ä¸œè¥¿â€çš„é‚£æ®µä»£ç è¢«ä»å®é™…å›¾å½¢æ¸²æŸ“ä¸­æŠ½è±¡å‡ºæ¥äº†ã€‚â€œæ¸²æŸ“â€å¯ä»¥æ˜¯â€œè®©ä¸œè¥¿åœ¨ NSView ä¸­æ˜¾ç¤ºâ€ï¼Œæˆ–è€…â€œè®©ä¸œè¥¿æ˜¾ç¤ºåœ¨ UIImage é‡Œé¢â€ï¼Œç”šè‡³æ˜¯â€œè®©ä¸œè¥¿æ˜¾ç¤ºåœ¨ PDF ä¸­â€ã€‚</p>
<p>ä½ æ‰€æœ‰çš„ CG ç»˜åˆ¶éƒ½åœ¨ä¸€ä¸ªâ€œcontextï¼ˆä¸Šä¸‹æ–‡ï¼‰â€ä¸­æ‰§è¡Œï¼Œå®ƒæ˜¯æ•°æ®ç»“æ„å’Œç”¨äºæ§åˆ¶å¦‚ä½•ç»˜åˆ¶çš„æ–¹æ³•çš„æŒ‡é’ˆçš„é›†åˆã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/10/output.png" alt=""></p>
<p>Context æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ï¼ˆåœ¨ Mac ä¸Šï¼‰æœ‰ NSWindowGraphicsContextã€‚è¿™ä¸€ç‰¹å®š context è·å–ä½ çš„ä»£ç å®‰æ’çš„ç»˜åˆ¶æŒ‡ä»¤ï¼Œç„¶ååœ¨ä½ çš„åº”ç”¨çš„åœ°å€ç©ºé—´é‡Œä¸­ä¸€å—å…±äº«å†…å­˜é‡Œç»˜åˆ¶å‡ºåƒç´ ã€‚è¿™ä¸€æ®µå†…å­˜ä¹Ÿä¸çª—å£æœåŠ¡å™¨å…±äº«ã€‚çª—å£æœåŠ¡å™¨å°†æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„åº”ç”¨çš„çª—å£è¡¨é¢æ ·å­ä¸€èµ·å±•ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>
<p>å¦ä¸€ç§ CG Context æ˜¯ä¸€ç§å›¾ç‰‡ contextã€‚ä»»ä½•ä½ è¿è¡Œçš„ç»˜åˆ¶ä»£ç éƒ½ä¼šå°†åƒç´ å¸ƒç½®åœ¨ä¸€ä¸ªä½å›¾å›¾ç‰‡ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå›¾ç‰‡æ¥ç»˜å…¥å…¶å®ƒ context ä¸­æˆ–è€…ä½œä¸º PNG æˆ– JPEG ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿã€‚åŒæ ·ä¹Ÿæœ‰ä¸€ä¸ª PDF contextã€‚è¿è¡Œçš„ç»˜åˆ¶ä»£ç ä¸ä¼šå˜æˆåƒç´ ï¼Œè€Œæ˜¯å˜æˆäº† PDF å‘½ä»¤å¹¶è¢«å­˜è¿›ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚æ­¤åï¼ŒPDFæŸ¥çœ‹å™¨å¯ä»¥ä½¿ç”¨é‚£äº› PDF å‘½ä»¤æ¥æ¸²æŸ“æˆæŸç§å¯ä»¥æŸ¥çœ‹çš„ä¸œè¥¿ã€‚</p>
<p><img src="https://www.bignerdranch.com/assets/img/blog/2014/10/different-results.png" alt=""></p>
<h2 id="æ¥ä¸‹æ¥"><a href="#æ¥ä¸‹æ¥" class="headerlink" title="æ¥ä¸‹æ¥"></a>æ¥ä¸‹æ¥</h2><p>ä¸‹ä¸€æ¬¡ï¼Œæ›´è¿‘è·ç¦»æ¥çœ‹çœ‹ contextï¼Œä»¥åŠä¸€äº› Core Graphics ä¸­çš„ä¾¿æ· APIã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.bignerdranch.com/blog/core-graphics-part-1-in-the-beginning/&quot;&gt;Core Graphics, Part 1: In the Beginning - Mark Dalrymple&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Mac å’Œ iOS å¼€å‘è€…æœ‰è®¸å¤šä¸åŒçš„è®©ä¸œè¥¿æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ç¼–ç¨‹æ¥å£ã€‚UIKit å’Œ AppKit æœ‰å„ç§å„æ ·çš„ imageã€color å’Œ path ç±»ã€‚Core Animation è®©ä½ å¯ä»¥ç§»åŠ¨ layerã€‚OpenGL è®©ä½ å¯ä»¥åœ¨ä¸‰ç»´ç©ºé—´æ¸²æŸ“ä¸œè¥¿ã€‚SpriteKit è®©ä½ å¯ä»¥åšåŠ¨ç”»ã€‚AVFoundation è®©ä½ å¯ä»¥æ’­æ”¾è§†é¢‘ã€‚&lt;/p&gt;
&lt;p&gt;Core Graphicsï¼Œæˆ–è€…å®ƒåœ¨å¸‚åœºä¸­è¢«äººç†ŸçŸ¥çš„åå­—â€œQuartzâ€ï¼Œæ˜¯è¿™ä¸ªå¹³å°ä¸Šæœ€è€çš„å›¾å½¢ç›¸å…³ API ä¹‹ä¸€ã€‚Quartz æ„å»ºäº†å¤§å¤šæ•°äºŒç»´çš„ä¸œè¥¿çš„åŸºç¡€ã€‚æƒ³è¦ç”»äº›å›¾å½¢ï¼Œç»™å®ƒä»¬å¡«å……ä¸Šæ¸å˜å¹¶ä¸”åŠ ä¸Šé˜´å½±ï¼Ÿç”¨ Core Graphicsã€‚æƒ³è¦åœ¨å±å¹•ä¸Šåˆæˆå›¾ç‰‡ï¼ŸCore Graphics èƒ½è§£å†³ã€‚æƒ³è¦åˆ›å»º PDFï¼Ÿè¿˜æ˜¯ Core Graphicsã€‚&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Core Graphics" scheme="http://chengkang.me/tags/Core-Graphics/"/>
    
  </entry>
  
  <entry>
    <title>react-native-lahk-marquee-labelï¼ˆè·‘é©¬ç¯æ–‡å­—ç»„ä»¶ï¼‰</title>
    <link href="http://chengkang.me/2017/04/11/react-native-lahk-marquee-label/"/>
    <id>http://chengkang.me/2017/04/11/react-native-lahk-marquee-label/</id>
    <published>2017-04-11T17:33:17.000Z</published>
    <updated>2017-04-14T21:36:51.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>A react-native marquee label component.</p>
<p>ä¸€ä¸ª react-native è·‘é©¬ç¯æ–‡å­—ç»„ä»¶ã€‚</p>
</blockquote>
<p>If you need a vertical marquee label, please use <a href="https://github.com/cheng-kang/react-native-lahk-marquee-label-vertical" target="_blank" rel="external">react-native-lahk-marquee-label-vertical</a>.</p>
<p><a href="https://badge.fury.io/js/react-native-lahk-marquee-label" target="_blank" rel="external"><img src="https://badge.fury.io/js/react-native-lahk-marquee-label.svg" alt="npm version"></a></p>
<h2 id="Anchors"><a href="#Anchors" class="headerlink" title="Anchors"></a>Anchors</h2><ol>
<li><a href="#desc">Desc</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#props">Props</a></li>
<li><a href="#ä¸­æ–‡ä»‹ç»">ä¸­æ–‡ä»‹ç»</a></li>
</ol>
<h2 id="Desc"><a href="#Desc" class="headerlink" title="Desc"></a>Desc</h2><p><a href="#install">Skip this part, go to <strong>#Install</strong></a></p>
<p>I needed a marquee label in one of my recent project and I didnâ€™t find a good one online, so I decided to create my own marquee label component.</p>
<p>I intended to make it work well on both iOS and Android, still there remains one thing in iOS which I cannot fix. I found that in <strong>iOS</strong>, when you use <code>View</code> component to wrap child components and donâ€™t explicitly set the parent <code>View</code> component width (e.g. use <code>flex</code>), the parent <code>View</code> component will have the same width as itâ€™s child. </p>
<p>It becomes a problem in this custom component because I use a child <code>View</code> component to wrap <code>Text</code> component in order to make the text expand and show in one line. I <strong>set the text containner <code>View</code> component size to be bigger than the <code>Text</code> so that it will not have multiple lines nor have the overflow text replaced by ellipsis.</strong> The default value of text container width is 1000, which is usually larger than the actual label width. This results in the problem mentioned above, the wrapper <code>View</code> width becomes 1000 also.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;View <span class="class"><span class="keyword">class</span></span>=<span class="string">"marquee-label"</span>&gt;</span><br><span class="line">  &lt;View class="marquee-label-text-container"&gt;</span><br><span class="line">    &lt;Text class="marquee-label-text"&gt;&#123;text&#125;&lt;/Text&gt;</span><br><span class="line">  &lt;/View&gt;</span><br><span class="line">&lt;<span class="regexp">/View&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong></p>
<ul>
<li>In Andorid, you can use both <code>width</code> or <code>flex</code> to layout the view.</li>
<li>In iOS, use <code>width</code> to layout the view. <code>flex</code> layout is not supported.</li>
</ul>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-native-lahk-marquee-label</span><br></pre></td></tr></table></figure>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><ol>
<li>Import</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MarqueeLabel <span class="keyword">from</span> <span class="string">'react-native-lahk-marquee-label'</span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>Use</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;MarqueeLabel</span><br><span class="line">  duration=&#123;<span class="number">8000</span>&#125;</span><br><span class="line">  text=&#123;<span class="string">'This is a Marquee Label.'</span>&#125;</span><br><span class="line">  textStyle=&#123;&#123; fontSize: <span class="number">13</span>, color: <span class="string">'white'</span> &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;MarqueeLabel</span><br><span class="line">  speed=&#123;<span class="number">250</span>&#125;</span><br><span class="line">  textStyle=&#123;&#123; fontSize: <span class="number">13</span>, color: <span class="string">'white'</span> &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  This is a Marquee Label.</span><br><span class="line">&lt;<span class="regexp">/MarqueeLabel&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h2><ul>
<li><code>children</code>: string, the text to show in the marquee. Alternative to <code>text</code>.</li>
<li><code>text</code>: string, the text to show in the marquee. Alternative to <code>children</code>.</li>
<li><code>duration</code>: number(unit: millisecond), the duration for the marquee to run one round. e.g. 6000 (for 6 seconds a round). Alternative to <code>speed</code>.</li>
<li><code>speed</code>: number(unit: px/s, px per second), the speed of the marquee. Alternative to <code>duration</code>.</li>
<li><code>bgViewStyle</code>: stylesheet object, background view component custom styles.</li>
<li><code>textStyle</code>: stylesheet object, text component custom styles.</li>
<li><code>textContainerWidth</code>: number, text container component width. If the text is not shown in one line, increase this value.</li>
<li><code>textContainerHeight</code>: number, text container component height. If the text is not shown in one line, increase this value.</li>
<li><code>textContainerStyle</code>: stylesheet object, not recommended to use, text containner component custom style.</li>
</ul>
<h2 id="ä¸­æ–‡ä»‹ç»"><a href="#ä¸­æ–‡ä»‹ç»" class="headerlink" title="ä¸­æ–‡ä»‹ç»"></a>ä¸­æ–‡ä»‹ç»</h2><p><a href="#install">è·³è½¬åˆ° <strong>#install</strong></a></p>
<p>æˆ‘åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­éœ€è¦ç”¨åˆ°è·‘é©¬ç¯ï¼Œä½†æ˜¯åœ¨ç½‘ä¸Šæ²¡æ‰¾åˆ°å¥½ç”¨çš„ã€‚æ‰€ä»¥æˆ‘å°±è‡ªå·±å†™äº†ä¸€ä¸ªè·‘é©¬ç¯çš„ç»„ä»¶ã€‚</p>
<p>æœ¬æ¥æ‰“ç®—è®©å®ƒå¯ä»¥åœ¨ iOS å’Œ Android å¹³å°ä¸Šéƒ½å¥½ç”¨çš„ï¼Œä¸è¿‡è¿˜æ˜¯åœ¨ iOS å¹³å°ä¸Šå­˜åœ¨ä¸€ä¸ªé—®é¢˜æ²¡æ³•è§£å†³ã€‚</p>
<p>æˆ‘å‘ç°åœ¨ iOS å¹³å°ä¸Šï¼Œå½“ä½¿ç”¨ <code>View</code> ç»„ä»¶æ¥åŒ…è£¹å­ç»„ä»¶çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºè®¾ç½®çˆ¶çº§ <code>View</code> ç»„ä»¶çš„å®½åº¦ï¼ˆwidth æ ·å¼ï¼‰ï¼ˆæ¯”å¦‚ç”¨ <code>flex</code> å¸ƒå±€ï¼‰ï¼Œé‚£ä¹ˆçˆ¶çº§ <code>View</code> ç»„ä»¶çš„å®½åº¦ä¼šè¢«è‡ªåŠ¨è®¾ç½®æˆå­ç»„ä»¶çš„å®½åº¦ã€‚ï¼ˆè‡³å°‘å½“å­ç»„ä»¶æ¯”çˆ¶ç»„ä»¶å®½åº¦å¤§æ—¶æ˜¯è¿™æ ·çš„ï¼Œå¦å¤–ä¸€ç§æƒ…å†µæˆ‘æ²¡æœ‰åšè¯•éªŒã€‚ï¼‰</p>
<p>æˆ‘çš„è·‘é©¬ç¯ç»„ä»¶ä¸­çš„é—®é¢˜åœ¨äºï¼Œæˆ‘ç”¨äº†ä¸€ä¸ªå­çº§ <code>View</code> ç»„ä»¶æ¥åŒ…è£¹ <code>Text</code> ç»„ä»¶ä»¥ä¿è¯æ–‡å­—æ˜¯åœ¨ä¸€è¡Œå…¨éƒ¨æ˜¾ç¤ºã€‚<strong>é€šè¿‡å°† text container çš„å®½åº¦è®¾ç½®å¾—æ¯” <code>Text</code> ç»„ä»¶å®½åº¦å¤§ï¼Œä¿è¯äº†æ–‡å­—ä¸ä¼šæ¢è¡Œï¼Œä¹Ÿä¸ä¼šç”¨çœç•¥å·æ›¿æ¢æº¢å‡ºæ–‡å­—ã€‚</strong> text container é»˜è®¤å®½åº¦ä¸º 1000ï¼Œè¿™æ¯”ä¸€èˆ¬çš„è·‘é©¬ç¯æ ‡ç­¾å®é™…å®½åº¦è¦å¤§ã€‚è€Œè¿™ä¹Ÿå°±å¯¼è‡´äº†ä¸Šè¿°çš„é—®é¢˜ï¼Œæœ€å¤–å±‚çš„ <code>View</code> çš„å®½åº¦ä¹Ÿå˜æˆäº† 1000ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;View <span class="class"><span class="keyword">class</span></span>=<span class="string">"marquee-label"</span>&gt;</span><br><span class="line">  &lt;View class="marquee-label-text-container"&gt;</span><br><span class="line">    &lt;Text class="marquee-label-text"&gt;&#123;text&#125;&lt;/Text&gt;</span><br><span class="line">  &lt;/View&gt;</span><br><span class="line">&lt;<span class="regexp">/View&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>å› æ­¤è¦æ³¨æ„ï¼š</strong></p>
<ul>
<li>åœ¨ Android å¹³å°ä¸Šï¼Œé€šè¿‡ <code>width</code> æˆ–è€… <code>flex</code> å¸ƒå±€æ¥è®¾ç½®æœ€å¤–å±‚ <code>View</code> çš„æ ·å¼éƒ½æ²¡é—®é¢˜ã€‚</li>
<li>åœ¨ iOS å¹³å°ä¸Šï¼Œè¯·ä½¿ç”¨å¹¶ä¸”åªèƒ½ä½¿ç”¨ <code>width</code> æ¥è®¾ç½®æ ·å¼ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;A react-native marquee label component.&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª react-native è·‘é©¬ç¯æ–‡å­—ç»„ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If you need a vertical marquee 
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>DoubanFMPlayer, A mimic of Douban.fm player</title>
    <link href="http://chengkang.me/2017/02/03/DoubanFMPlayer,%20A%20mimic%20of%20Douban.fm%20player/"/>
    <id>http://chengkang.me/2017/02/03/DoubanFMPlayer, A mimic of Douban.fm player/</id>
    <published>2017-02-03T22:31:30.000Z</published>
    <updated>2017-02-12T19:24:08.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>Project Page: <a href="https://github.com/cheng-kang/DoubanFMPlayer" target="_blank" rel="external">https://github.com/cheng-kang/DoubanFMPlayer</a></p>
</blockquote>
<p>A mimic of Douban.fm player on <a href="https://douban.fm/" target="_blank" rel="external">Douban.fm</a>. <em>Also a Flex practice project.</em></p>
<p>You can use it on your website or <strong>embed it in your Hexo theme</strong>.</p>
<h2 id="Showcase"><a href="#Showcase" class="headerlink" title="Showcase"></a>Showcase</h2><p>Click <a href="http://chengkang.me/DoubanFMPlayer/">here</a> to check live demo.</p>
<h3 id="Dark-Theme-the-color-of-the-player-is-dark-used-in-light-color-web-page"><a href="#Dark-Theme-the-color-of-the-player-is-dark-used-in-light-color-web-page" class="headerlink" title="Dark Theme (the color of the player is dark, used in light color web page)"></a>Dark Theme (the color of the player is dark, used in light color web page)</h3><p><img src="https://raw.githubusercontent.com/cheng-kang/DoubanFMPlayer/master/DBFMPlayer-1.gif" alt=""></p>
<h3 id="Light-Theme-the-color-of-the-player-is-light-used-in-dark-color-web-page"><a href="#Light-Theme-the-color-of-the-player-is-light-used-in-dark-color-web-page" class="headerlink" title="Light Theme (the color of the player is light, used in dark color web page)"></a>Light Theme (the color of the player is light, used in dark color web page)</h3><p><img src="https://raw.githubusercontent.com/cheng-kang/DoubanFMPlayer/master/DBFMPlayer-2.gif" alt=""></p>
<a id="more"></a>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Feel free to download source code from <code>/src</code> folder.</p>
<p>Alternatively, use the cdn Iâ€™ve set up:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dbfmplayer.js: http://7u2sl0.com1.z0.glb.clouddn.com/dbfmplayer.js</span><br><span class="line">dbfmplayer.css: http://7u2sl0.com1.z0.glb.clouddn.com/dbfmplayer.css</span><br></pre></td></tr></table></figure></p>
<h3 id="1-Use-it-on-your-website"><a href="#1-Use-it-on-your-website" class="headerlink" title="1. Use it on your website"></a>1. Use it on your website</h3><ol>
<li><p>Add any numbers of <code>dbfmplayer</code> tag to your HTML file.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dbfmplayer </span><br><span class="line">    title=&quot;èŒœã•ã™ å¸°è·¯ç…§ã‚‰ã•ã‚Œã©â€¦&quot; </span><br><span class="line">    singer=&quot;æ¤åæ—æª&quot;</span><br><span class="line">    album=&quot;https://img1.doubanio.com/lpic/s2722629.jpg&quot;</span><br><span class="line">    music=&quot;http://mr3.doubanio.com/ff7730a714d4e3ecbf3f5854f6154532/0/fm/song/p1033017_128k.mp4&quot;</span><br><span class="line">&gt;&lt;/dbfmplayer&gt;</span><br></pre></td></tr></table></figure>
<p> You <strong>must</strong> set <code>title</code>, <code>singer</code>, <code>album</code> and <code>music</code> attributes of your <code>dbfmplayer</code> tags.</p>
<ul>
<li><code>title</code>: name of the music</li>
<li><code>singer</code>: name of the singer/musician</li>
<li><code>album</code>: URL of a picture related to this music (both absolute URL or relative URL)</li>
<li><p><code>music</code>: URL of the music (both absolute URL or relative URL)</p>
<p><strong>Optional</strong> attributes are <code>theme</code> and <code>loop</code>.</p>
</li>
<li><p><code>theme</code>: â€œdarkâ€ or â€œlightâ€. Default theme is â€œdarkâ€, which is suitable for light color background web pages; theme â€œlightâ€ is suitable for dark color background web pages.</p>
</li>
<li><code>loop</code>: â€œtrueâ€ or â€œfalseâ€. Default value is â€œfalseâ€. If <code>loop</code> is set to â€œtrueâ€, the music will loop after it ends.</li>
<li><p><code>autoplay</code>: â€œtrueâ€ or â€œfalseâ€. Default value is â€œfalseâ€. If <code>autoplay</code> is set to â€œtrueâ€, the music will automatically start when itâ€™s loaded.</p>
<p>You can set <code>loop</code> and <code>autoplay</code> to â€œtrueâ€ in a convenient way:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dbfmplayer </span><br><span class="line">    title=&quot;èŒœã•ã™ å¸°è·¯ç…§ã‚‰ã•ã‚Œã©â€¦&quot; </span><br><span class="line">    singer=&quot;æ¤åæ—æª&quot;</span><br><span class="line">    album=&quot;https://img1.doubanio.com/lpic/s2722629.jpg&quot;</span><br><span class="line">    music=&quot;http://mr3.doubanio.com/ff7730a714d4e3ecbf3f5854f6154532/0/fm/song/p1033017_128k.mp4&quot;</span><br><span class="line">    loop</span><br><span class="line">    autoplay</span><br><span class="line">&gt;&lt;/dbfmplayer&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Add the following script to your HTML file.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    (function() &#123; // DON&apos;T EDIT BELOW THIS LINE</span><br><span class="line">    var d = document, s = d.createElement(&apos;script&apos;);</span><br><span class="line">    s.src = &apos;http://7u2sl0.com1.z0.glb.clouddn.com/dbfmplayer.js&apos;;</span><br><span class="line">    (d.head || d.body).appendChild(s);</span><br><span class="line">    &#125;)();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-Embed-it-in-your-Hexo-theme"><a href="#2-Embed-it-in-your-Hexo-theme" class="headerlink" title="2. Embed it in your Hexo theme"></a>2. Embed it in your Hexo theme</h3><ol>
<li><p>Add the following script to your layout file for <strong>Post</strong> (or anywhere else you want):</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    (function() &#123; // DON&apos;T EDIT BELOW THIS LINE</span><br><span class="line">    var d = document, s = d.createElement(&apos;script&apos;);</span><br><span class="line">    s.src = &apos;http://7u2sl0.com1.z0.glb.clouddn.com/dbfmplayer.js&apos;;</span><br><span class="line">    (d.head || d.body).appendChild(s);</span><br><span class="line">    &#125;)();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Now users can add music to their page by adding the <code>dbfmplayer</code> tag to their articles (markdown files) by following <a href="#1-use-it-on-your-website">1.1 Add any numbers of <code>dbfmplayer</code> tag to your HTML file.</a>. </p>
</li>
</ol>
<h2 id="Acknowledgements"><a href="#Acknowledgements" class="headerlink" title="Acknowledgements"></a>Acknowledgements</h2><p>Most SVG icons come from <a href="https://icomoon.io/" target="_blank" rel="external">Iconmoon.io</a>.</p>
<p>Designed by <a href="https://douban.fm" target="_blank" rel="external">Douban.fm</a>.</p>
<h2 id="Copyright"><a href="#Copyright" class="headerlink" title="Copyright"></a>Copyright</h2><p><strong>All copyright of the design belongs to who creates it.</strong> </p>
<p>Any copyright issue, please contact <a href="mailto:hi@chengkang.me">hi@chengkang.me</a>.</p>
<dbfmplayer title="èŒœã•ã™ å¸°è·¯ç…§ã‚‰ã•ã‚Œã©â€¦" singer="æ¤åæ—æª" album="https://img1.doubanio.com/lpic/s2722629.jpg" music="http://mr3.doubanio.com/ff7730a714d4e3ecbf3f5854f6154532/0/fm/song/p1033017_128k.mp4" theme="dark" loop autoplay></dbfmplayer>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Project Page: &lt;a href=&quot;https://github.com/cheng-kang/DoubanFMPlayer&quot;&gt;https://github.com/cheng-kang/DoubanFMPlayer&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A mimic of Douban.fm player on &lt;a href=&quot;https://douban.fm/&quot;&gt;Douban.fm&lt;/a&gt;. &lt;em&gt;Also a Flex practice project.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;You can use it on your website or &lt;strong&gt;embed it in your Hexo theme&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Showcase&quot;&gt;&lt;a href=&quot;#Showcase&quot; class=&quot;headerlink&quot; title=&quot;Showcase&quot;&gt;&lt;/a&gt;Showcase&lt;/h2&gt;&lt;p&gt;Click &lt;a href=&quot;http://chengkang.me/DoubanFMPlayer/&quot;&gt;here&lt;/a&gt; to check live demo.&lt;/p&gt;
&lt;h3 id=&quot;Dark-Theme-the-color-of-the-player-is-dark-used-in-light-color-web-page&quot;&gt;&lt;a href=&quot;#Dark-Theme-the-color-of-the-player-is-dark-used-in-light-color-web-page&quot; class=&quot;headerlink&quot; title=&quot;Dark Theme (the color of the player is dark, used in light color web page)&quot;&gt;&lt;/a&gt;Dark Theme (the color of the player is dark, used in light color web page)&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/cheng-kang/DoubanFMPlayer/master/DBFMPlayer-1.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Light-Theme-the-color-of-the-player-is-light-used-in-dark-color-web-page&quot;&gt;&lt;a href=&quot;#Light-Theme-the-color-of-the-player-is-light-used-in-dark-color-web-page&quot; class=&quot;headerlink&quot; title=&quot;Light Theme (the color of the player is light, used in dark color web page)&quot;&gt;&lt;/a&gt;Light Theme (the color of the player is light, used in dark color web page)&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/cheng-kang/DoubanFMPlayer/master/DBFMPlayer-2.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Examples to understand how to find Nash equilibrium by eliminating â€œdominated strategiesâ€</title>
    <link href="http://chengkang.me/2017/01/18/Examples%20to%20understand%20how%20to%20find%20Nash%20equilibrium%20by%20eliminating%20%E2%80%9Cdominated%20strategies%E2%80%9D/"/>
    <id>http://chengkang.me/2017/01/18/Examples to understand how to find Nash equilibrium by eliminating â€œdominated strategiesâ€/</id>
    <published>2017-01-18T17:14:22.000Z</published>
    <updated>2017-01-18T17:18:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>This is a summarization of contents from two different sources. It aims at helping people (at least myself) to understand what <code>dominated strategies</code> are and especially what <strong>weakly dominated strategy</strong> is.</p>
<h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><p>Suppose <em>si</em> and <em>sâ€™i</em> are two strategies for player <em>i</em> in a normal form game.</p>
<p>We say <em>sâ€™i</em> is <strong>strictly dominated</strong> by <em>si</em> if, for every choice of strategies of the other players, <em>i</em>â€™s payoff from choosing <em>si</em> is <code>strictly greater than</code> <em>i</em>â€™s payoff from choosing <em>sâ€™i</em>.</p>
<p>We call <em>sâ€™i</em> dominated strategy and <em>si</em> dominant strategy.</p>
<p>We say <em>sâ€™i</em> is <strong>weakly dominated</strong> by <em>si</em> if, for every choice of strategies of the other players, <em>i</em>â€™s payoff from chossing <em>si</em> is <code>at least as great as</code> <em>i</em>â€™s payoff from choosing <em>sâ€™i</em>.</p>
<a id="more"></a>
<h2 id="Remarks"><a href="#Remarks" class="headerlink" title="Remarks"></a>Remarks</h2><ol>
<li>If a unique strategy remains for the player, we call this the playerâ€™s dominant strategy.</li>
<li>If a unique strategy remains for all players, we call this strategy profile a dominant<br>strategy equilibrium.</li>
<li>A dominant strategy equilibrium is a Nash equilibrium. And we can eliminate<br>dominated strategies without losing any Nash equilibria.</li>
<li>If the iterated elimination of weakly dominated strategies leaves exactly one strategy<br>for each player, the resulting strategy profile is a Nash equilibrium. <strong>However some Nash equilibria can be discarded this way.</strong></li>
</ol>
<h2 id="Example-of-eliminating-strictly-dominated-strategies"><a href="#Example-of-eliminating-strictly-dominated-strategies" class="headerlink" title="Example of eliminating strictly dominated strategies"></a>Example of eliminating strictly dominated strategies</h2><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">Agent2</th>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">L</td>
<td style="text-align:center">C</td>
<td style="text-align:center">R</td>
</tr>
<tr>
<td style="text-align:center"><strong>Agent1</strong></td>
<td style="text-align:center">T</td>
<td style="text-align:center">73, 25</td>
<td style="text-align:center">57, 42</td>
<td style="text-align:center">66,32</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">M</td>
<td style="text-align:center">80, 26</td>
<td style="text-align:center">35, 12</td>
<td style="text-align:center">32,54</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">B</td>
<td style="text-align:center">28, 27</td>
<td style="text-align:center">63, 31</td>
<td style="text-align:center">54,29</td>
</tr>
</tbody>
</table>
<p>L can be eliminated since it is strictly dominated by R, and then M can be eliminated since it is strictly dominated by both T and B, and then R can be eliminated since it is strictly dominated by C. Now Agent1 will choose B, which will result in a payoff of <strong>63, 31</strong>.</p>
<h2 id="Example-of-eliminating-weakly-dominated-strategies"><a href="#Example-of-eliminating-weakly-dominated-strategies" class="headerlink" title="Example of eliminating weakly dominated strategies"></a>Example of eliminating weakly dominated strategies</h2><table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center">Agent2</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">L</td>
<td style="text-align:center">R</td>
</tr>
<tr>
<td style="text-align:center"><strong>Agent1</strong></td>
<td style="text-align:center">T</td>
<td style="text-align:center">1, 1</td>
<td style="text-align:center">0, 0</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">M</td>
<td style="text-align:center">1, 1</td>
<td style="text-align:center">2, 1</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">B</td>
<td style="text-align:center">0, 0</td>
<td style="text-align:center">2, 1</td>
</tr>
</tbody>
</table>
<p>This example illustrates the difficulties that may occur when eliminating weakly dominated strategies.</p>
<p>The actions that survive iterated elimination of weakly dominated strategiescan depend on the order in which the actions are eliminated.</p>
<ol>
<li><p>For example, T can be eliminated since it is weakly dominated by M,and then L can be eliminated since it is weakly dominated by R. Now, agent2 will choose action R, which will result in a payoff of <strong>(2, 1)</strong> for which ever action agent 1 selects.</p>
</li>
<li><p>On the other hand, action B could have been eliminated first since it is weakly dominated by M, and then R could have been eliminated since it is weakly dominated by L. Now, the payoff is <strong>(1, 1)</strong> for which ever action agent 1 selects.</p>
</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p>[1]<a href="http://tuvalu.santafe.edu/~jkchoi/ch2_a.pdf" target="_blank" rel="external">Leading fromStrength: Eliminating Dominated Strategies</a></p>
<p>[2]<a href="https://cs.uwaterloo.ca/~klarson/teaching/F08-886/WeaklyDominatedStrats.pdf" target="_blank" rel="external">Weakly Dominated Strategies</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;This is a summarization of contents from two different sources. It aims at helping people (at least myself) to understand what &lt;code&gt;dominated strategies&lt;/code&gt; are and especially what &lt;strong&gt;weakly dominated strategy&lt;/strong&gt; is.&lt;/p&gt;
&lt;h2 id=&quot;Definition&quot;&gt;&lt;a href=&quot;#Definition&quot; class=&quot;headerlink&quot; title=&quot;Definition&quot;&gt;&lt;/a&gt;Definition&lt;/h2&gt;&lt;p&gt;Suppose &lt;em&gt;si&lt;/em&gt; and &lt;em&gt;sâ€™i&lt;/em&gt; are two strategies for player &lt;em&gt;i&lt;/em&gt; in a normal form game.&lt;/p&gt;
&lt;p&gt;We say &lt;em&gt;sâ€™i&lt;/em&gt; is &lt;strong&gt;strictly dominated&lt;/strong&gt; by &lt;em&gt;si&lt;/em&gt; if, for every choice of strategies of the other players, &lt;em&gt;i&lt;/em&gt;â€™s payoff from choosing &lt;em&gt;si&lt;/em&gt; is &lt;code&gt;strictly greater than&lt;/code&gt; &lt;em&gt;i&lt;/em&gt;â€™s payoff from choosing &lt;em&gt;sâ€™i&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;We call &lt;em&gt;sâ€™i&lt;/em&gt; dominated strategy and &lt;em&gt;si&lt;/em&gt; dominant strategy.&lt;/p&gt;
&lt;p&gt;We say &lt;em&gt;sâ€™i&lt;/em&gt; is &lt;strong&gt;weakly dominated&lt;/strong&gt; by &lt;em&gt;si&lt;/em&gt; if, for every choice of strategies of the other players, &lt;em&gt;i&lt;/em&gt;â€™s payoff from chossing &lt;em&gt;si&lt;/em&gt; is &lt;code&gt;at least as great as&lt;/code&gt; &lt;em&gt;i&lt;/em&gt;â€™s payoff from choosing &lt;em&gt;sâ€™i&lt;/em&gt;.&lt;/p&gt;
    
    </summary>
    
    
      <category term="Game Theory" scheme="http://chengkang.me/tags/Game-Theory/"/>
    
      <category term="Dominated Strategies" scheme="http://chengkang.me/tags/Dominated-Strategies/"/>
    
  </entry>
  
  <entry>
    <title>QnAï¼Œä¸€ä¸ª Hexo FAQ ä¸»é¢˜</title>
    <link href="http://chengkang.me/2017/01/14/QnA%EF%BC%8C%E4%B8%80%E4%B8%AA%20Hexo%20FAQ%20%E4%B8%BB%E9%A2%98/"/>
    <id>http://chengkang.me/2017/01/14/QnAï¼Œä¸€ä¸ª Hexo FAQ ä¸»é¢˜/</id>
    <published>2017-01-14T11:47:03.000Z</published>
    <updated>2017-01-14T12:08:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>ä¹‹å‰åœ¨ Gitbook ä¸Šåˆ›å»ºäº†ä¸€ä¸ª FAQ ç½‘ç«™ï¼Œä½†æ˜¯ Gitbook ä½¿ç”¨èµ·æ¥åéº»çƒ¦ï¼Œè€Œä¸”ä¸»é¢˜ä¸å¥½çœ‹ã€‚é¢„æœŸåˆ›å»ºä¸€ä¸ª Gitbook ä¸»é¢˜ï¼Œä¸å¦‚åˆ›å»ºä¸€ä¸ª Hexo ä¸»é¢˜ï¼Œç„¶åå°†ç½‘ç«™éƒ¨ç½²åˆ° Github ä¸Šã€‚äºæ˜¯æˆ‘ä¾¿åŠ¨æ‰‹åˆ¶ä½œäº†è¿™ä¸ªä¸»é¢˜ã€‚</p>
<p>è¿™ä¸ªä¸»é¢˜çš„æœ€åˆç›®çš„æ˜¯ä¸ºäº†æœåŠ¡è¿™ä¸ªç½‘ç«™ <a href="http://chengkang.me/Swift-Newbie/">Swift Newbie: ç»™ Swift æ–°æ‰‹çš„çŸ¥è¯†åº“</a>ï¼Œå¯¹ Swift å­¦ä¹ æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å¼€çœ‹çœ‹ï¼Œæœ‰æ„è´¡çŒ®çš„åŒå­¦å¯ä»¥è”ç³»æˆ‘ <code>hi@chengkang.me</code>ã€‚</p>
<p>é¡¹ç›®ä¸»é¡µï¼š<a href="https://github.com/cheng-kang/hexo-theme-qna" target="_blank" rel="external">ã€ŠTheme QnA for Hexoã€‹</a></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/cheng-kang/hexo-theme-qna/master/QnA.png" alt=""></p>
<p>ä¸º Hexo è®¾è®¡çš„ã€çŸ¥è¯†åº“ã€ç±»ä¸»é¢˜ã€‚</p>
<a id="more"></a>
<h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><ul>
<li><a href="./Documentation.md">Documentation English Version</a></li>
</ul>
<h2 id="å±•ç¤º"><a href="#å±•ç¤º" class="headerlink" title="å±•ç¤º:"></a>å±•ç¤º:</h2><ul>
<li><a href="http://chengkang.me/hexo-theme-qna/">é¢„è§ˆ</a></li>
<li><a href="http://chengkang.me/Swift-Newbie/">Swift Newbie: ç»™ Swift æ–°æ‰‹çš„çŸ¥è¯†åº“</a></li>
</ul>
<h2 id="å¦‚ä½•å®‰è£…"><a href="#å¦‚ä½•å®‰è£…" class="headerlink" title="å¦‚ä½•å®‰è£…"></a>å¦‚ä½•å®‰è£…</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/cheng-kang/hexo-theme-qna.git themes/QnA</span><br></pre></td></tr></table></figure>
<h3 id="å¯ç”¨"><a href="#å¯ç”¨" class="headerlink" title="å¯ç”¨"></a>å¯ç”¨</h3><p>ä¿®æ”¹æ ¹ç›®å½•ä¸­ <code>_config.yml</code> çš„ <code>theme</code> ä¸º <code>QnAã€‚</code></p>
<h3 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> themes/QnA</span><br><span class="line">git pull</span><br></pre></td></tr></table></figure>
<h2 id="é«˜çº§åŠŸèƒ½"><a href="#é«˜çº§åŠŸèƒ½" class="headerlink" title="é«˜çº§åŠŸèƒ½"></a>é«˜çº§åŠŸèƒ½</h2><h3 id="å‘å¸ƒåˆ°-Github"><a href="#å‘å¸ƒåˆ°-Github" class="headerlink" title="å‘å¸ƒåˆ° Github"></a>å‘å¸ƒåˆ° Github</h3><p>å®‰è£… Hexo æ’ä»¶ <a href="https://github.com/hexojs/hexo-deployer-git" target="_blank" rel="external">hexo-deployer-git</a>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘ä½  Hexo åšå®¢æ ¹ç›®å½•ä¸­çš„ <code>_config.yml</code> æ–‡ä»¶ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> git</span><br><span class="line"><span class="attr">  repo:</span> &lt;repository url&gt; <span class="comment"># https://github.com/cheng-kang/hexo-theme-qna.git</span></span><br><span class="line"><span class="attr">  branch:</span> [branch] <span class="comment"># master</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯ç”¨ä¸­æ–‡ç«™å†…æœç´¢"><a href="#å¯ç”¨ä¸­æ–‡ç«™å†…æœç´¢" class="headerlink" title="å¯ç”¨ä¸­æ–‡ç«™å†…æœç´¢"></a>å¯ç”¨ä¸­æ–‡ç«™å†…æœç´¢</h3><blockquote>
<p>QnA é»˜è®¤åªæ”¯æŒè‹±æ–‡ç«™å†…æœç´¢ã€‚</p>
</blockquote>
<p>å®‰è£… Hexo æ’ä»¶ <a href="https://github.com/PaicHyperionDev/hexo-generator-search" target="_blank" rel="external">hexo-generator-search</a>ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure>
<h3 id="æ·»åŠ æ–°é¡µé¢"><a href="#æ·»åŠ æ–°é¡µé¢" class="headerlink" title="æ·»åŠ æ–°é¡µé¢"></a>æ·»åŠ æ–°é¡µé¢</h3><ol>
<li><p>æ·»åŠ ä¸€ä¸ªæ–°é¡µé¢ï¼Œä¾‹å¦‚ï¼šabout é¡µé¢ã€‚æ”¹å˜é¡µé¢å†…å®¹è¯·ä¿®æ”¹æ ¹ç›®å½•ä¸‹ source/about/index.md æ–‡ä»¶ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page about</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¾‘ theme/QnA ä¸­çš„ <code>_config.yml</code>ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  Home:</span> /</span><br><span class="line"><span class="attr">  Archive:</span> /archives</span><br><span class="line">  <span class="comment"># Add new page config here</span></span><br><span class="line">  <span class="comment"># Page Dispay Name: /pagename</span></span><br><span class="line">  <span class="comment"># e.g.</span></span><br><span class="line"><span class="attr">  About:</span> /about</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;ä¹‹å‰åœ¨ Gitbook ä¸Šåˆ›å»ºäº†ä¸€ä¸ª FAQ ç½‘ç«™ï¼Œä½†æ˜¯ Gitbook ä½¿ç”¨èµ·æ¥åéº»çƒ¦ï¼Œè€Œä¸”ä¸»é¢˜ä¸å¥½çœ‹ã€‚é¢„æœŸåˆ›å»ºä¸€ä¸ª Gitbook ä¸»é¢˜ï¼Œä¸å¦‚åˆ›å»ºä¸€ä¸ª Hexo ä¸»é¢˜ï¼Œç„¶åå°†ç½‘ç«™éƒ¨ç½²åˆ° Github ä¸Šã€‚äºæ˜¯æˆ‘ä¾¿åŠ¨æ‰‹åˆ¶ä½œäº†è¿™ä¸ªä¸»é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¸»é¢˜çš„æœ€åˆç›®çš„æ˜¯ä¸ºäº†æœåŠ¡è¿™ä¸ªç½‘ç«™ &lt;a href=&quot;http://chengkang.me/Swift-Newbie/&quot;&gt;Swift Newbie: ç»™ Swift æ–°æ‰‹çš„çŸ¥è¯†åº“&lt;/a&gt;ï¼Œå¯¹ Swift å­¦ä¹ æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å¼€çœ‹çœ‹ï¼Œæœ‰æ„è´¡çŒ®çš„åŒå­¦å¯ä»¥è”ç³»æˆ‘ &lt;code&gt;hi@chengkang.me&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é¡¹ç›®ä¸»é¡µï¼š&lt;a href=&quot;https://github.com/cheng-kang/hexo-theme-qna&quot;&gt;ã€ŠTheme QnA for Hexoã€‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/cheng-kang/hexo-theme-qna/master/QnA.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä¸º Hexo è®¾è®¡çš„ã€çŸ¥è¯†åº“ã€ç±»ä¸»é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>DanmuManager ä¸€ä¸ªç®€å•çš„å¼¹å¹•å·¥å…·</title>
    <link href="http://chengkang.me/2017/01/05/DanmuManager%20%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%BC%B9%E5%B9%95%E5%B7%A5%E5%85%B7/"/>
    <id>http://chengkang.me/2017/01/05/DanmuManager ä¸€ä¸ªç®€å•çš„å¼¹å¹•å·¥å…·/</id>
    <published>2017-01-05T18:14:32.000Z</published>
    <updated>2017-01-05T13:54:40.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>é¡¹ç›®é¦–é¡µï¼š <a href="https://github.com/cheng-kang/DanmuManager" target="_blank" rel="external">DanmuManager Github Repository</a></p>
</blockquote>
<h2 id="ä½¿ç”¨æ–¹æ³•-Usage"><a href="#ä½¿ç”¨æ–¹æ³•-Usage" class="headerlink" title="ä½¿ç”¨æ–¹æ³• Usage"></a>ä½¿ç”¨æ–¹æ³• Usage</h2><p><code>DanmuManager</code> å’Œ <code>VideoDanmuManager</code> æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œåè€…ç”¨äºè§†é¢‘å¼¹å¹•ã€‚</p>
<p>ä½ å¯ä»¥è¿è¡Œé¡¹ç›®ä¸­çš„æµ‹è¯•ï¼Œæ¥äº†è§£äºŒè€…çš„ä½¿ç”¨æ–¹æ³•ã€‚<br><a id="more"></a></p>
<p><img src="https://raw.githubusercontent.com/cheng-kang/DanmuManager/master/DanmuManager-1.gif" width="200"><br><img src="https://raw.githubusercontent.com/cheng-kang/DanmuManager/master/DanmuManager-2.gif" width="200"><br><img src="https://raw.githubusercontent.com/cheng-kang/DanmuManager/master/DanmuManager-3.gif" width="200"></p>
<h3 id="DanmuManager"><a href="#DanmuManager" class="headerlink" title="DanmuManager"></a>DanmuManager</h3><ol>
<li><p>åˆ›å»º DanmuManager</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let dm = DanmuManager(with: self.view)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>åˆå§‹åŒ– `init` æ–¹æ³•å…è®¸è‡ªå®šä¹‰ï¼š 

- `top`ã€`bottom`å¼¹å¹•æ˜¾ç¤ºåœ¨ `view` ä¸­çš„ä¸Šä¸‹ä½ç½®èŒƒå›´;
- `speed` å¼¹å¹•çš„é€Ÿåº¦;
- `customFont` å¼¹å¹•å­—ä½“ï¼ˆ`UIFont`, åŒ…æ‹¬å­—ä½“å®¶æ—å’Œå¤§å°ï¼Œé»˜è®¤ä¸ºç³»ç»Ÿå­—ä½“ï¼Œå­—å· 20ï¼‰ã€‚
</code></pre><ol>
<li><p>æ·»åŠ ä¸€æ¡å¼¹å¹• </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dm.add(with: â€œWow so cool!!!â€, at: 4)</span><br></pre></td></tr></table></figure>
<p> æ·»åŠ å¼¹å¹• <code>add</code> æ–¹æ³•æœ‰ä¸¤ä¸ªå¿…ä¼ å‚æ•°ï¼Œ<code>text</code>ï¼ˆå¼¹å¹•æ–‡å­—ï¼‰ å’Œ <code>line</code>ï¼ˆå¼¹å¹•æ‰€åœ¨è¡Œï¼‰;å¯é€‰å‚æ•° <code>hasBorder</code> ç”¨äºè®¾ç½®è¯¥æ¡å¼¹å¹•æ˜¯å¦æœ‰è¾¹æ¡†ï¼ˆé»˜è®¤ borderColor = UIColor.black.cgColorï¼ŒborderWidth = 1ï¼‰,é»˜è®¤å€¼ä¸º false;å¯é€‰å‚æ•° <code>isAdvance</code> ç”¨äºè®¾ç½®è¯¥æ¡å¼¹å¹•æ˜¯å¦å¼€å¯é«˜çº§åŠŸèƒ½ï¼ˆç›®å‰æ”¯æŒä¿®æ”¹ æ–‡å­—é¢œè‰² å’Œ èƒŒæ™¯é¢œè‰²ï¼‰ï¼Œé»˜è®¤å€¼ä¸º falseã€‚</p>
<p> å¦‚æœéœ€è¦å¼¹å¹•å‡ºç°åœ¨éšæœºè¡Œï¼Œå¯ä»¥ä½¿ç”¨</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func addRandom(with text: String = &quot;This is a test Danmu.&quot;, at line: Int = 0, hasBorder: Bool = false, isAdvanced: Bool = false)`ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>æš‚åœ/ç»§ç»­ å¼¹å¹•</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dm.pause()</span><br><span class="line">dm.resume()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `dm.toggle()` æ¥å¿«æ·åˆ‡æ¢ æš‚åœ/ç»§ç»­ã€‚
</code></pre><h3 id="VideoDanmuManager"><a href="#VideoDanmuManager" class="headerlink" title="VideoDanmuManager"></a>VideoDanmuManager</h3><ol>
<li><p>åˆ›å»º VideoDanmuManager</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">let vdm = VideoDanmuManager(view: self.view,</span><br><span class="line">                               videoLength: 10,</span><br><span class="line">                               danmuData: [</span><br><span class="line">                                   (3.4, &quot;3.4 Wowowowowowow!&quot;),</span><br><span class="line">                                   (3.4, &quot;3.4 SOOOO COOOOOOOOOOL!&quot;),</span><br><span class="line">                                   (3.4, &quot;3.4 Amazing!!!!&quot;),</span><br><span class="line">                                   (3.4, &quot;3.4 I love you~&quot;),</span><br><span class="line">                                   (3.4, &quot;3.4 MY BABY!!!!&quot;),</span><br><span class="line">                                   (1.1, &quot;1.1 This is a test Danmu!!!&quot;),</span><br><span class="line">                                   (2.0, &quot;2.0 Another test Danmu.&quot;),</span><br><span class="line">                                   (4.1, &quot;4.1 Amazing!!!!&quot;),</span><br><span class="line">                                   (6.1, &quot;6.1 Test!!!!&quot;),</span><br><span class="line">                                   (8.1, &quot;8.1 Test!!!!&quot;),</span><br><span class="line">                                   (9.1, &quot;9.1 Test!!!!&quot;),</span><br><span class="line">                                   (10, &quot;10 Test!!!!&quot;),</span><br><span class="line">           ],</span><br><span class="line">                               isSorted: false</span><br><span class="line">       )</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>`VideoDanmuManager` çš„åˆ›å»ºæœ‰ä¸‰ä¸ªå¿…é€‰å‚æ•°ï¼Œ`view`ï¼ˆæ˜¾ç¤ºå¼¹å¹•çš„è§†å›¾ï¼‰ï¼Œ`videoLength`ï¼ˆè§†é¢‘æ—¶é•¿ï¼Œç²¾ç¡®åˆ° 0.1 ç§’ï¼‰å’Œ `danmuData`ï¼ˆå·²ç»å­˜åœ¨çš„å¼¹å¹•åˆ—è¡¨ï¼‰ã€‚

å¯é€‰å‚æ•° `videoCurrent` é»˜è®¤ä¸º 0ï¼Œå³å¼€å§‹æ—¶åˆ»ï¼›ä½ å¯ä»¥é€šè¿‡ä¼ å…¥ä¸åŒçš„æ—¶é—´å€¼æ¥è®¾ç½®æ˜¾ç¤ºå¼¹å¹•çš„åˆå§‹æ—¶é—´ï¼ˆæ¯”å¦‚åœ¨è§†é¢‘ä» 1 åˆ† 15 ç§’å¼€å§‹æ’­æ”¾ï¼Œåˆ™åº”è®¾ç½® `videoCurrent` ä¸º 75ï¼‰ã€‚
å¯é€‰å‚æ•° `isSorted` é»˜è®¤ä¸º trueï¼Œå³é»˜è®¤æ•°æ®é›†å·²ç»æŒ‰ç…§å¼¹å¹•æ˜¾ç¤ºæ—¶é—´ä»å…ˆåˆ°åæ’åºï¼›å¦‚ä¼ å…¥ falseï¼Œåˆ™å°†è‡ªåŠ¨è°ƒç”¨ `func sort()` å¯¹æ•°æ®è¿›è¡Œæ’åºã€‚

å¯é€‰å‚æ•° `top` å’Œ `bottom` åŒ `DanmuManager`ã€‚
</code></pre><ol>
<li><p>å¼€å¯å¼¹å¹•</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vdm.start()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>ä½ éœ€è¦åœ¨è§†é¢‘å¼€å§‹æ’­æ”¾çš„åŒæ—¶ï¼Œæ‰‹åŠ¨å¼€å¯å¼¹å¹•ã€‚
</code></pre><ol>
<li><p>æš‚åœ/ç»§ç»­ å¼¹å¹•</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vdm.pause()</span><br><span class="line">vdm.resume()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `vdm.toggle()` æ¥å¿«æ·åˆ‡æ¢ æš‚åœ/ç»§ç»­ã€‚
</code></pre><ol>
<li><p>ä¸­æ­¢å¼¹å¹•</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vdm.stop()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>é‡æ–°å¼€å§‹å¼¹å¹•</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vdm.restart()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>ä½ ä¹Ÿå¯ä»¥åœ¨æŒ‡å®šæ—¶é—´ç‚¹é‡æ–°å¼€å§‹å¼¹å¹•ï¼š

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vdm.restart(at: 75)</span><br></pre></td></tr></table></figure>
</code></pre><h2 id="è®¾è®¡æ€è·¯"><a href="#è®¾è®¡æ€è·¯" class="headerlink" title="è®¾è®¡æ€è·¯"></a>è®¾è®¡æ€è·¯</h2><p><code>DanmuManager</code> é€šè¿‡è®¾ç½®çš„å­—ä½“å¤§å°è®¡ç®—æ–‡æœ¬æ˜¾ç¤ºé«˜åº¦ <code>lineHeight</code>ï¼Œé€šè¿‡ <code>numberOfLines = Int(floor((bottom - top) / lineHeight))</code> å¾—åˆ°å¯ä»¥æ˜¾ç¤ºçš„å¼¹å¹•è¡Œæ•°ï¼›ä½¿ç”¨ <code>inUsingLines</code>ï¼Œ<code>enteringTimers</code> å’Œ <code>waitingQueues</code> æ¥åˆ†åˆ«è®°å½• æ­£åœ¨ä½¿ç”¨çš„è¡Œï¼ˆæœ‰å°¾éƒ¨è¿˜æ²¡æœ‰å®Œå…¨è¿›å…¥è§†å›¾çš„å¼¹å¹•çš„è¡Œï¼‰ï¼Œæ­£åœ¨è¿›å…¥è§†å›¾çš„å¼¹å¹•çš„è®¡æ—¶å™¨ å’Œ æ­£åœ¨ç­‰å¾…è¿›å…¥çš„å¼¹å¹•é˜Ÿåˆ—ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢å¼¹å¹•é‡å ï¼Œåªæœ‰å½“ å½“å‰è¡Œä¸­å‰ä¸€æ¡å¼¹å¹•å°¾éƒ¨è¿›å…¥è§†å›¾ æ—¶ï¼ˆä¹‹åï¼‰ï¼Œä¸‹ä¸€æ¡å¼¹å¹•æ‰å¯ä»¥å‘å°„ã€‚</p>
<p><code>enteringTimers</code> ä¸­æ¯ä¸€ä¸ª Timer éƒ½å¯¹åº”ä¸€æ¡æ­£åœ¨è¿›å…¥è§†å›¾çš„å¼¹å¹•ï¼Œå½“è®¡æ—¶å™¨ç»“æŸæ—¶ï¼Œé€šè¿‡ NotificationCenter å‘é€šçŸ¥å°†è¯¥å¼¹å¹•æ‰€åœ¨çš„è¡Œçš„çŠ¶æ€æ›´æ”¹ä¸º falseã€‚</p>
<p>å› ä¸ºå¼¹å¹•å­˜åœ¨æš‚åœçŠ¶æ€ï¼Œå¦‚æœå¼¹å¹•å¯¹åº”çš„ Timer ä¸åŒæ—¶æš‚åœï¼Œå°†å¯¼è‡´ å¼¹å¹•æ‰€åœ¨è¡ŒçŠ¶æ€ æå‰æ›´æ”¹ä¸º falseã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å‚è€ƒä»–äººçš„æƒ³æ³•å¹¶æ”¹è¿›ååˆ›å»ºäº† PauseableTimerï¼Œå¹¶åœ¨æœ¬é¡¹ç›®ä¸­ä½¿ç”¨ä¸Šäº†ã€‚æˆ‘çš„å¦å¤–ä¸€ç¯‡åšå®¢æ›´è¯¦ç»†åœ°ä»‹ç»äº† <a href="http://chengkang.me/2017/01/05/PauseableTimer%20%E4%B8%80%E4%B8%AA%E5%8F%AF%E6%9A%82%E5%81%9C%E7%9A%84%E8%AE%A1%E6%97%B6%E5%99%A8/">ã€ŠPauseableTimerã€‹</a>ã€‚</p>
<p>ä¸ºäº†é¿å…æ‰‹åŠ¨å‘å°„å¼¹å¹•å’Œè‡ªåŠ¨å‘å°„é˜Ÿåˆ—ä¸­çš„å¼¹å¹•å‡ºç°å†²çªï¼ˆå¼¹å¹•é‡å ï¼‰ï¼Œæ‰€æœ‰å¼¹å¹•é€šè¿‡ <code>taskTimer</code> å®šæ—¶ä»»åŠ¡ç»Ÿä¸€è°ƒåº¦ã€‚</p>
<h2 id="ä¸‹ä¸€æ­¥-Next-Step"><a href="#ä¸‹ä¸€æ­¥-Next-Step" class="headerlink" title="ä¸‹ä¸€æ­¥ Next Step"></a>ä¸‹ä¸€æ­¥ Next Step</h2><p>ç°åœ¨æµè¡Œçš„å¼¹å¹•åŠŸèƒ½è¶Šæ¥è¶Šå¤æ‚ã€é«˜çº§ï¼ŒDanmuManager åªæ˜¯å®Œæˆäº†æœ€åŸºç¡€çš„æ»šåŠ¨æ–‡å­—å¼¹å¹•åŠŸèƒ½ã€‚æœªæ¥å¯èƒ½ä¼šå­¦ä¹ å¸¸è§çš„å¼¹å¹•ï¼Œæ·»åŠ ä¸€äº›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ å¯¹æ»šåŠ¨å¼¹å¹•çš„æ“ä½œï¼Œå±…ä¸­å¼¹å¹• ç­‰ã€‚    </p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;é¡¹ç›®é¦–é¡µï¼š &lt;a href=&quot;https://github.com/cheng-kang/DanmuManager&quot;&gt;DanmuManager Github Repository&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä½¿ç”¨æ–¹æ³•-Usage&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨æ–¹æ³•-Usage&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨æ–¹æ³• Usage&quot;&gt;&lt;/a&gt;ä½¿ç”¨æ–¹æ³• Usage&lt;/h2&gt;&lt;p&gt;&lt;code&gt;DanmuManager&lt;/code&gt; å’Œ &lt;code&gt;VideoDanmuManager&lt;/code&gt; æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œåè€…ç”¨äºè§†é¢‘å¼¹å¹•ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥è¿è¡Œé¡¹ç›®ä¸­çš„æµ‹è¯•ï¼Œæ¥äº†è§£äºŒè€…çš„ä½¿ç”¨æ–¹æ³•ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Swift" scheme="http://chengkang.me/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Pauseable Timer ä¸€ä¸ªå¯æš‚åœçš„è®¡æ—¶å™¨</title>
    <link href="http://chengkang.me/2017/01/05/PauseableTimer%20%E4%B8%80%E4%B8%AA%E5%8F%AF%E6%9A%82%E5%81%9C%E7%9A%84%E8%AE%A1%E6%97%B6%E5%99%A8/"/>
    <id>http://chengkang.me/2017/01/05/PauseableTimer ä¸€ä¸ªå¯æš‚åœçš„è®¡æ—¶å™¨/</id>
    <published>2017-01-05T15:31:35.000Z</published>
    <updated>2017-01-05T13:58:05.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>é¡¹ç›®ä¸»é¡µ: <a href="https://github.com/cheng-kang/PauseableTimer" target="_blank" rel="external">PauseableTimer Github Repository</a><br>è‹±æ–‡ä»‹ç»ï¼š <a href="http://chengkang.me/2017/01/04/Pauseable%20Timer/">Pauseable Timer</a></p>
</blockquote>
<p>PauseableTimer æ˜¯ä¸€ä¸ªç”¨ Swift å†™çš„å¯æš‚åœçš„è®¡æ—¶å™¨ã€‚</p>
<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æš‚åœè®¡æ—¶å™¨ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½åœ¨ Timer(Swift3) ä¸­å¹¶æ²¡æœ‰è¢«å®ç°ã€‚å› æ­¤ï¼Œç»è¿‡ä¸€äº›å¤±è´¥çš„å°è¯•ï¼Œæˆ‘åˆ›å»ºäº†è¿™ä¸ªå¯ä»¥æš‚åœçš„è®¡æ—¶å™¨ï¼Œå¸Œæœ›å¯¹ä½ ä¹Ÿæœ‰ç”¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/cheng-kang/PauseableTimer/master/PauseableTimer-1.gif" alt=""></p>
<a id="more"></a>
<h2 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h2><ol>
<li><p>åˆ›å»ºä¸€ä¸ªè®¡æ—¶å™¨ Timer</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">let timer = Timer.scheduledTimer(timeInterval: 10, target: self, selector: aSelector, userInfo: nil, repeats: true)</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºä¸€ä¸ªå¯æš‚åœçš„è®¡æ—¶å™¨ PauseableTimerï¼Œå¹¶å°†ä¹‹å‰åˆ›å»ºçš„ Timer ä½œä¸ºå‚æ•°ä¼ å…¥ </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">let pauseableTimer = PauseableTimer(timer: timer)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æš‚åœ ç„¶å é‡æ–°å¼€å§‹ï¼</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">pauseableTimer.pause()</span><br><span class="line">pauseableTimer.resume()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>æ³¨æ„</strong></p>
<ul>
<li>å¦‚æœç”¨äºåˆå§‹åŒ– PauseableTimer çš„ Timer ä¸æ˜¯é€šè¿‡ scheduledTimer æ–¹æ³•åˆå§‹åŒ–çš„æˆ–æ²¡æœ‰è¢«åŠ å…¥åˆ° RunLoop ä¸­ï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰‹åŠ¨å°†å®ƒåŠ å…¥åˆ° RunLoop ä¸­ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼Œ<code>RunLoop.current.add(timer, forMode: .commonModes)</code>ã€‚</li>
<li>å¦‚æœä½ éœ€è¦æ“ä½œç”¨äºåˆå§‹åŒ– PauseableTimer çš„ Timer æˆ–è€…éœ€è¦è·å–å®ƒçš„å±æ€§ï¼Œè¯·ä½¿ç”¨ PauseableTimer çš„ <code>timer</code> å±æ€§ã€‚å°±åƒè¿™æ ·ï¼Œ<code>pauseableTimer.timer.firedate = Date()</code>ã€‚</li>
<li><code>invalidate()</code> æ–¹æ³•æ˜¯ä¸ºä¾¿äºæ‰‹åŠ¨è®© timer å¤±æ•ˆè€Œåˆ›å»ºçš„ã€‚</li>
</ul>
<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>PauseableTimer å¹¶æ²¡æœ‰é‡æ–°å®ç° Swift ä¸­çš„ Timerï¼Œè€Œæ˜¯å°† Timer ä½œä¸ºä¸€ä¸ªå±æ€§ç„¶ååœ¨å®ƒçš„å¸®åŠ©ä¸‹å®ç°äº† æš‚åœ çš„åŠŸèƒ½ã€‚</p>
<p>è¿™ä¸ªåŠŸèƒ½çš„åŸç†å—åˆ° <a href="http://www.jianshu.com/p/e554a164d0da" target="_blank" rel="external">NSTimer æ€»ç»“1(åŒ…æ‹¬è®¡æ—¶å™¨ä¸å‡†çš„è§£å†³)</a> çš„å¯å‘ã€‚ </p>
<p>ä¸»è¦æ€æƒ³æ˜¯ <code>å½“ä½ éœ€è¦æš‚åœçš„æ—¶å€™ï¼Œå°† Timer çš„ firedate è®¾ç½®ä¸ºä¸€ä¸ªæ— æ³•è¾¾åˆ°çš„æ—¥æœŸï¼ˆè¿™æ ·è®¡æ—¶å™¨ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ„Ÿè§‰èµ·æ¥å°±åƒæ˜¯æš‚åœäº† :Dï¼‰ï¼›å½“ä½ éœ€è¦é‡æ–°å¼€å§‹çš„æ—¶å€™ï¼Œå°† firedate è®¾ç½®å›åŸæ¥çš„æ—¶é—´ï¼ˆè¿™æ ·è®¡æ—¶å™¨å°±å¯ä»¥ã€ç…§å¸¸ã€è§¦å‘ï¼‰</code>ã€‚ </p>
<p>ç®€å•èªæ˜ï¼</p>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°äº†åŠ äº†å¼•å·çš„ã€ç…§å¸¸ã€ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•å¯èƒ½æ— æ³•è¾¾åˆ°ä½ çš„æœŸæœ›ï¼Œå› ä¸º</p>
<ol>
<li><p>Firedate è¿‡æœŸäº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">ç°åœ¨çš„æ—¶é—´æ˜¯ 2017.01.04 10:25ã€‚</span><br><span class="line">åŸæœ¬çš„ firedate æ˜¯ 2017.01.04 10:30ã€‚</span><br><span class="line">ä½ ç°åœ¨æš‚åœäº†è¿™ä¸ªè®¡æ—¶å™¨ï¼Œå¹¶ä¸”åœ¨ååˆ†é’Ÿåï¼ˆ2017.01.04 10:35ï¼‰é‡æ–°å¼€å§‹ã€‚è¿™æ—¶ï¼Œè®¡æ—¶å™¨å·²ç»é”™è¿‡äº†å®ƒé¢„è®¡çš„ firedateï¼ˆ2017.01.04 10:30ï¼‰ã€‚</span><br><span class="line">ç„¶è€Œï¼Œå¦‚æœè¿™ä¸ªè®¡æ—¶å™¨å·²ç»åœ¨ RunLoop å½“ä¸­çš„è¯ï¼Œå½“ä½ åœ¨ 2017.01.04 10:35 å°† firedate è®¾ç½®å› 2017.01.04 10:30 æ—¶ï¼Œè®¡æ—¶å™¨ä¼šç«‹å³è§¦å‘ä¸€æ¬¡ã€‚</span><br></pre></td></tr></table></figure>
</li>
<li><p>æˆ‘ä»¬å¸Œæœ›è®¡æ—¶å™¨ç»§ç»­ç­‰å¾…å‰©ä¸‹çš„ç­‰å¾…æ—¶é—´ã€‚</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">ç°åœ¨çš„æ—¶é—´æ˜¯ 2017.01.04 10:25:00ã€‚</span><br><span class="line">è®¡æ—¶å™¨çš„ timeInterval æ˜¯ 60 ç§’ã€‚ç°åœ¨è®¡æ—¶å™¨è¢«åŠ å…¥åˆ° RunLoopï¼Œå®ƒåº”è¯¥åœ¨ 60 ç§’åè§¦å‘ï¼Œä¹Ÿå°±æ˜¯åœ¨ 2017.01.04 10:26:00ã€‚</span><br><span class="line">ç„¶åä½ å› ä¸ºæŸç§åŸå› åœ¨ 10 ç§’åæš‚åœäº†å®ƒï¼Œä¹Ÿå°±æ˜¯åœ¨ 2017.01.04 10:25:10ã€‚ä½ åœ¨ 2017.01.04 10:25:50 çš„æ—¶å€™é‡æ–°å¼€å§‹äº†è®¡æ—¶å™¨ã€‚</span><br><span class="line">ä¸è¿‡ï¼Œä½ ä»ç„¶å¸Œæœ›å®ƒæ˜¯åœ¨è®¾ç½®å¥½åï¼Œç­‰å¾… 60 ç§’å†è§¦å‘ï¼Œä¸ç®¡æš‚åœçš„é‚£æ®µæ—¶é—´ã€‚æ‰€ä»¥å®ƒåº”è¯¥å†ç­‰å¾… 50 ç§’ï¼Œç„¶ååœ¨ 2017.01.04 10:26:40 è§¦å‘ã€‚</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å®Œç¾çš„è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯æ»¡è¶³ä»¥ä¸Šæ‰€è¿°ä¸‰ç§æƒ…å†µçš„ï¼ˆå¦ä¸€ç§æƒ…å†µæ˜¯æˆ‘ä»¬ä¸åœ¨ä¹åŸå§‹ firedate æ˜¯å¦è¿‡æœŸï¼‰ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªé¡¹ç›®ç›®å‰åªè§£å†³äº†ç¬¬äºŒä¸ªæƒ…å†µï¼Œå› ä¸ºè¿™æ˜¯æˆ‘åœ¨å…¶ä»–é¡¹ç›®ä¸­æ‰€é‡åˆ°çš„éœ€è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<p>æœªæ¥æˆ‘å¯èƒ½ä¼šç»§ç»­è¿™ä¸ªå°é¡¹ç›®ï¼Œç„¶åå°†æ¯ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆéƒ½å®Œå–„èµ·æ¥ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;é¡¹ç›®ä¸»é¡µ: &lt;a href=&quot;https://github.com/cheng-kang/PauseableTimer&quot;&gt;PauseableTimer Github Repository&lt;/a&gt;&lt;br&gt;è‹±æ–‡ä»‹ç»ï¼š &lt;a href=&quot;http://chengkang.me/2017/01/04/Pauseable%20Timer/&quot;&gt;Pauseable Timer&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;PauseableTimer æ˜¯ä¸€ä¸ªç”¨ Swift å†™çš„å¯æš‚åœçš„è®¡æ—¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æš‚åœè®¡æ—¶å™¨ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½åœ¨ Timer(Swift3) ä¸­å¹¶æ²¡æœ‰è¢«å®ç°ã€‚å› æ­¤ï¼Œç»è¿‡ä¸€äº›å¤±è´¥çš„å°è¯•ï¼Œæˆ‘åˆ›å»ºäº†è¿™ä¸ªå¯ä»¥æš‚åœçš„è®¡æ—¶å™¨ï¼Œå¸Œæœ›å¯¹ä½ ä¹Ÿæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/cheng-kang/PauseableTimer/master/PauseableTimer-1.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Swift" scheme="http://chengkang.me/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>Pauseable Timer</title>
    <link href="http://chengkang.me/2017/01/04/Pauseable%20Timer/"/>
    <id>http://chengkang.me/2017/01/04/Pauseable Timer/</id>
    <published>2017-01-04T22:58:48.000Z</published>
    <updated>2017-01-05T13:57:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>Project Page: <a href="https://github.com/cheng-kang/PauseableTimer" target="_blank" rel="external">PauseableTimer Github Repository</a></p>
<p>Chinese Version: <a href="http://chengkang.me/2017/01/05/PauseableTimer%20%E4%B8%80%E4%B8%AA%E5%8F%AF%E6%9A%82%E5%81%9C%E7%9A%84%E8%AE%A1%E6%97%B6%E5%99%A8/">ã€ŠPauseable Timer ä¸€ä¸ªå¯æš‚åœçš„è®¡æ—¶å™¨ã€‹</a></p>
</blockquote>
<p>Pauseable Timer is a pause-able timer written in Swift.</p>
<p>There are occassions when we need timers to pause, however, this feature is not implemented in Timer(Swift3). Thus, after some failed attempts, I create this pause-able timer which hopefully could be useful to you.</p>
<p><img src="https://raw.githubusercontent.com/cheng-kang/PauseableTimer/master/PauseableTimer-1.gif" alt=""></p>
<a id="more"></a>
<h2 id="How-to-Use"><a href="#How-to-Use" class="headerlink" title="How to Use"></a>How to Use</h2><ol>
<li><p>Create a Timer</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">let timer = Timer.scheduledTimer(timeInterval: 10, target: self, selector: aSelector, userInfo: nil, repeats: true)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Create a Pauseable Timer and pass the timer as an argument.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">let pauseableTimer = PauseableTimer(timer: timer)</span><br></pre></td></tr></table></figure>
</li>
<li><p>Pause and Resume!</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">pauseableTimer.pause()</span><br><span class="line">pauseableTimer.resume()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>Notice</strong></p>
<ul>
<li>If the timer you use to initialize a PauseableTimer is not scheduled (or added to RunLoop) already, you need to manually schedule it (ro add it to RunLoop). You can do it by <code>RunLoop.current.add(timer, forMode: .commonModes)</code>. </li>
<li>Use <code>timer</code> property of PauseableTimer if you need to manipulate the timer or get itâ€™s properties. Like this <code>pauseableTimer.timer.firedate = Date()</code>.</li>
<li>A convinient method <code>invalidate()</code> is created to invalidate the timer.</li>
</ul>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>Pauseable Timer does not re-implement Timer in Swift, but takes a Timer as a property and implement â€˜Pauseâ€™ feature with the help of it.</p>
<p>The concept of this feature is inspired by <a href="http://www.jianshu.com/p/e554a164d0da" target="_blank" rel="external">NSTimer æ€»ç»“1(åŒ…æ‹¬è®¡æ—¶å™¨ä¸å‡†çš„è§£å†³)</a>. </p>
<p>The main idea is <code>set the firedate of Timer to a un-reachable date when you want it pause (the timer will wait until forever and you can take it as pausing :D), and set it back to its original firedate when you want it resume (and the timer will fire &quot;as expected&quot;).</code></p>
<p>Simple and Excellent!</p>
<p>You might have noticed the double qouted â€œas expectedâ€. Acctually, this might fail your expectation because</p>
<ol>
<li><p>The firedate is expried.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">The current time is 2017.01.04 10:25.</span><br><span class="line">The original firedate is 2017.01.04 10:30.</span><br><span class="line">You pause the timer at this moment and resume it 10 mins after which is 2017.01.04 10:35. So the timer has missed it&apos;s expected firedate. </span><br><span class="line">However it will fire once you set the firedate back to 2017.01.04 10:30 at 2017.01.04 10:35, if the timer is already added to RunLoop.</span><br></pre></td></tr></table></figure>
</li>
<li><p>The timer is expected to wait for the remaining waiting time.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e.g.</span><br><span class="line">The current time is 2017.01.04 10:25:00.</span><br><span class="line">The timeInterval of the timer is 60 seconds. It&apos;s scheduled at this moment, and should fire 60 seconds later at 2017.01.04 10:26:00.</span><br><span class="line">And for some reason you pause it 10 seconds after, which is 2017.01.04 10:25:10. And you resume the timer at 2017.01.04 10:25:50.</span><br><span class="line">However, you still want it to fire 60 seconds after it&apos;s scheduled, regardless the pausing part. So it should wait for 50 seconds more and fire at 2017.01.04 10:26:40.</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>An ideal solution should be one that fits all 3 conditions (another one is the condition that someone doesnâ€™t care if the original firedate is expired or not) discussed above. However, this project only deals with condition 2 because that is the problem I encountered with.</p>
<p>Hopefully, I will continue this small project in the future and complete it with solutions to every condition.</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;Project Page: &lt;a href=&quot;https://github.com/cheng-kang/PauseableTimer&quot;&gt;PauseableTimer Github Repository&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Chinese Version: &lt;a href=&quot;http://chengkang.me/2017/01/05/PauseableTimer%20%E4%B8%80%E4%B8%AA%E5%8F%AF%E6%9A%82%E5%81%9C%E7%9A%84%E8%AE%A1%E6%97%B6%E5%99%A8/&quot;&gt;ã€ŠPauseable Timer ä¸€ä¸ªå¯æš‚åœçš„è®¡æ—¶å™¨ã€‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Pauseable Timer is a pause-able timer written in Swift.&lt;/p&gt;
&lt;p&gt;There are occassions when we need timers to pause, however, this feature is not implemented in Timer(Swift3). Thus, after some failed attempts, I create this pause-able timer which hopefully could be useful to you.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/cheng-kang/PauseableTimer/master/PauseableTimer-1.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="iOS" scheme="http://chengkang.me/tags/iOS/"/>
    
      <category term="Swift" scheme="http://chengkang.me/tags/Swift/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘æˆ‘æœ€å–œæ¬¢çš„ JavaScript è®¾è®¡æ¨¡å¼</title>
    <link href="http://chengkang.me/2016/07/02/my-favorite-javascript-pattern/"/>
    <id>http://chengkang.me/2016/07/02/my-favorite-javascript-pattern/</id>
    <published>2016-07-02T09:50:25.000Z</published>
    <updated>2016-07-02T02:51:54.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://www.sitepoint.com/my-favorite-javascript-design-pattern/" target="_blank" rel="external">My Favorite JavaScript Design Pattern</a></p>
</blockquote>
<h1 id="æˆ‘æœ€å–œæ¬¢çš„-JavaScript-è®¾è®¡æ¨¡å¼"><a href="#æˆ‘æœ€å–œæ¬¢çš„-JavaScript-è®¾è®¡æ¨¡å¼" class="headerlink" title="æˆ‘æœ€å–œæ¬¢çš„ JavaScript è®¾è®¡æ¨¡å¼"></a>æˆ‘æœ€å–œæ¬¢çš„ JavaScript è®¾è®¡æ¨¡å¼</h1><p>æˆ‘è§‰å¾—èŠä¸€ä¸‹æˆ‘çˆ±ç”¨çš„ JavaScript è®¾è®¡æ¨¡å¼åº”è¯¥å¾ˆæœ‰æ„æ€ã€‚æˆ‘æ˜¯ä¸€æ­¥ä¸€æ­¥æ‰å®šä¸‹æ¥çš„ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´ä»å„ç§æ¥æºå¸æ”¶å’Œé€‚åº”ç›´åˆ°è¾¾åˆ°ä¸€ä¸ªèƒ½æä¾›æˆ‘æ‰€éœ€çš„çµæ´»æ€§çš„æ¨¡å¼ã€‚</p>
<p>è®©æˆ‘ç»™ä½ çœ‹çœ‹æ¦‚è§ˆï¼Œç„¶åå†æ¥çœ‹å®ƒæ˜¯æ€ä¹ˆå½¢æˆçš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">function MyScript()&#123;&#125;</span><br><span class="line">(function()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  var THIS = this;</span><br><span class="line"></span><br><span class="line">  function defined(x)</span><br><span class="line">  &#123;</span><br><span class="line">    return typeof x != &apos;undefined&apos;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  this.ready = false;</span><br><span class="line"></span><br><span class="line">  this.init = function(</span><br><span class="line">  &#123;</span><br><span class="line">    this.ready = true;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  this.doSomething = function()</span><br><span class="line">  &#123;</span><br><span class="line">  &#125;;   </span><br><span class="line"></span><br><span class="line">  var options = &#123;</span><br><span class="line">      x : 123,</span><br><span class="line">      y : &apos;abc&apos;</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">  this.define = function(key, value)</span><br><span class="line">  &#123;</span><br><span class="line">    if(defined(options[key]))</span><br><span class="line">    &#123;</span><br><span class="line">      options[key] = value;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;).apply(MyScript);</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>å¦‚ä½ åœ¨å®ä¾‹ä»£ç ä¸­çœ‹åˆ°çš„ï¼Œæ•´ä½“æ¡†æ¶æ˜¯ä¸€ä¸ªå‡½æ•°ç›´æ¥é‡ï¼ˆfunction literalï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(function()</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>å‡½æ•°ç›´æ¥é‡åŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡ŒåŸŸï¼Œç›¸å½“äºå®šä¹‰ä¸€ä¸ªæœ‰åçš„å‡½æ•°ç„¶åç«‹å³è°ƒç”¨å®ƒï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function doSomething()</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">doSomething();</span><br></pre></td></tr></table></figure>
<p>æˆ‘æœ€åˆå¼€å§‹ä½¿ç”¨å‡½æ•°ç›´æ¥é‡æ˜¯ä¸ºäº†<code>å°è£…</code>â€”â€”ä»»ä½•æ ¼å¼çš„ä»»ä½•è„šæœ¬éƒ½å¯ä»¥è¢«å°è£…åœ¨é‚£ä¸ªé—­åŒ…é‡Œï¼Œå¹¶ä¸”å®ƒæœ‰æ•ˆåœ°å°†å®ƒ<code>å¯†å°</code>åœ¨ç§æœ‰åŸŸä¸­ï¼Œä»è€Œä¿æŠ¤å®ƒä¸ä¼šä¸åŒä¸€ä¸ªåŸŸé‡Œçš„å…¶å®ƒè„šæœ¬æˆ–è€…æ•°æ®å†²çªã€‚åœ¨æœ€åé¢çš„é‚£ä¸€å¯¹æ‹¬å·å°±æ˜¯åœ¨æ‰§è¡Œè¿™ä¸ªåŸŸï¼Œå°±åƒå…¶å®ƒå‡½æ•°ä¸€æ ·è°ƒç”¨å®ƒã€‚</p>
<p>ä½†æ˜¯å¦‚æœï¼Œè¿™ä¸ªåŸŸé€šè¿‡ä½¿ç”¨ <code>Function.apply</code> æ¥æ‰§è¡Œè€Œä¸æ˜¯å…¨å±€è°ƒç”¨ï¼Œè¿™å¯ä»¥è®©å®ƒåœ¨ä¸€ä¸ªå¯è¢«å¤–ç•Œå¼•ç”¨çš„<em>ç‰¹å®šå‘½å</em>çš„åŸŸä¸­æ‰§è¡Œã€‚</p>
<p>å› æ­¤é€šè¿‡ç»“åˆäºŒè€…â€”â€”åˆ›å»ºä¸€ä¸ªå‘½åå‡½æ•°ï¼Œç„¶ååœ¨è¿™ä¸ªå‘½åå‡½æ•°çš„åŸŸå†…æ‰§è¡Œä¸€ä¸ªå‡½æ•°ç›´æ¥é‡â€”â€”æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¸€æ¬¡æ€§çš„å¯ä»¥æ„æˆä»»ä½•è„šæœ¬çš„åŸºç¡€çš„å¯¹è±¡ï¼Œå®ƒæ¨¡æ‹Ÿäº†ç±»ä¼¼é¢å‘å¯¹è±¡ç±»çš„ç»§æ‰¿æ€§è´¨ã€‚</p>
<h2 id="å†…åœ¨ä¹‹ç¾"><a href="#å†…åœ¨ä¹‹ç¾" class="headerlink" title="å†…åœ¨ä¹‹ç¾"></a>å†…åœ¨ä¹‹ç¾</h2><p>çœ‹çœ‹ç¬¬ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼Œä½ å°±èƒ½çœ‹åˆ°å°é—­åŸŸç»“æ„æä¾›äº†ä»€ä¹ˆæ ·çš„çµæ´»æ€§ã€‚å½“ç„¶ï¼Œè¿™äº›ä½ éƒ½å¯ä»¥åœ¨ä»»ä½•æ–¹æ³•ä¸­åšåˆ°ï¼Œä½†æ˜¯é€šè¿‡ç”¨è¿™ç§æ–¹å¼åŒ…è£…èµ·æ¥ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¯ä»¥å’Œä»»ä½•å‘½ååŸŸè”ç³»èµ·æ¥çš„ç»“æ„ä½“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªè¿™æ ·çš„ç»“æ„ä½“ï¼Œç„¶åå°†å®ƒä»¬å’ŒåŒä¸€ä¸ªåŸŸè”ç³»èµ·æ¥ï¼Œè¿™æ ·å®ƒä»¬ä¹‹é—´å…¨éƒ¨å¯ä»¥å…±äº«å®ƒä»¬çš„å…¬å¼€æ•°æ®ã€‚</p>
<p>ä¸è¿‡åœ¨å…±äº«å…¬å¼€æ•°æ®çš„åŒäº‹ï¼Œæ¯ä¸€ä¸ªï¼ˆç»“æ„ä½“ï¼‰ä¹Ÿå¯ä»¥å®šä¹‰å®ƒè‡ªå·±çš„ç§æœ‰æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œåœ¨è„šæœ¬çš„æœ€ä¸Šé¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var THIS = this;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå«åš <code>THIS</code> çš„ç§æœ‰å˜é‡ï¼Œå®ƒæŒ‡å‘è¿™ä¸ªå‡½æ•°åŸŸï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç§æœ‰æ–¹æ³•ä¸­ä½¿ç”¨â€”â€”å’Œç”¨ <code>self = this</code> æ¥åˆ›å»ºå†…éƒ¨åŸŸæ˜¯ä¸€æ ·çš„æ‹›æ•°ã€‚</p>
<p>é€šè¿‡åŒæ ·æ–¹å¼å£°æ˜çš„å…¶ä»–ç§æœ‰å˜é‡ï¼Œå¦‚æœä»–ä»¬å®šä¹‰å¸¸é‡æ•°æ®çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨å¤§å†™ä¼ ç»Ÿï¼ˆä¸è¿‡ç”¨ <code>const</code> è€Œä¸æ˜¯ <code>var</code> æ¥åšå£°æ˜çš„æ–¹å¼åº”è¯¥è¢«é¿å…ï¼Œå› ä¸ºå¯¹å®ƒçš„æ”¯æŒä¸æ˜¯å¾ˆå¥½ï¼‰ã€‚</p>
<p>ç§æœ‰æ–¹æ³•å¯ä»¥ç”¨æ¥æä¾›å†…éƒ¨åŠŸèƒ½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function defined(x)</span><br><span class="line">&#123;</span><br><span class="line">  return typeof x != &apos;undefined&apos;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥åˆ›å»ºå…¶ä»–å®ä¾‹æˆ–è€…å¤–ç•Œå¯ä»¥è®¿é—®çš„å…¬å¼€æ–¹æ³•å’Œå±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">this.ready = false;</span><br><span class="line"></span><br><span class="line">this.init = function()</span><br><span class="line">&#123;</span><br><span class="line">  this.ready = true;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">this.doSomething = function()</span><br><span class="line">&#123;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºç‰¹æ®Šçš„å€¼â€”â€”ç§æœ‰ä½†æ˜¯å¯ä»¥å…¬å¼€å®šä¹‰ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯é€šè¿‡å…¬å¼€çš„ <code>define</code> æ–¹æ³•ï¼›å®ƒçš„å‚æ•°å¯ä»¥æ ¹æ®æ•°æ®éœ€è¦å†è¿›è¡ŒéªŒè¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var options = &#123;</span><br><span class="line">  x : 123,</span><br><span class="line">  y : &apos;abc&apos;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">this.define = function(key, value)</span><br><span class="line">&#123;</span><br><span class="line">  if(defined(options[key]))</span><br><span class="line">  &#123;</span><br><span class="line">    options[key] = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="å°è£…èµ·æ¥ï¼"><a href="#å°è£…èµ·æ¥ï¼" class="headerlink" title="å°è£…èµ·æ¥ï¼"></a>å°è£…èµ·æ¥ï¼</h2><p>æ‰€æœ‰çš„è¿™äº›ç‰¹ç‚¹è®©è¿™ä¸ªç»“æ„ä½“å¯¹æˆ‘éå¸¸æœ‰ç”¨ã€‚å¹¶ä¸”å®ƒå°è£…åœ¨ä¸€ä¸ªæ•´æ´ã€è‡ªæˆ‘æ‰§è¡Œçš„å•ä¾‹ä¸­â€”â€”ä¸€ä¸ªå®¹æ˜“å¼•ç”¨ã€æ•´åˆå’Œä½¿ç”¨çš„ä¸€æ¬¡æ€§å¯¹è±¡ã€‚</p>
<p>æ‰€ä»¥ä½ æ€ä¹ˆæƒ³ï¼Ÿè¿™ä¸ªæ¨¡å¼çœ¼ç†Ÿå—ï¼Œæˆ–è€…ä½ æœ‰ä»€ä¹ˆå…¶ä»–å–œæ¬¢ç”¨çš„ï¼Ÿ</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.sitepoint.com/my-favorite-javascript-design-pattern/&quot;&gt;My Favorite JavaScript Design Pattern&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;æˆ‘æœ€å–œæ¬¢çš„-JavaScript-è®¾è®¡æ¨¡å¼&quot;&gt;&lt;a href=&quot;#æˆ‘æœ€å–œæ¬¢çš„-JavaScript-è®¾è®¡æ¨¡å¼&quot; class=&quot;headerlink&quot; title=&quot;æˆ‘æœ€å–œæ¬¢çš„ JavaScript è®¾è®¡æ¨¡å¼&quot;&gt;&lt;/a&gt;æˆ‘æœ€å–œæ¬¢çš„ JavaScript è®¾è®¡æ¨¡å¼&lt;/h1&gt;&lt;p&gt;æˆ‘è§‰å¾—èŠä¸€ä¸‹æˆ‘çˆ±ç”¨çš„ JavaScript è®¾è®¡æ¨¡å¼åº”è¯¥å¾ˆæœ‰æ„æ€ã€‚æˆ‘æ˜¯ä¸€æ­¥ä¸€æ­¥æ‰å®šä¸‹æ¥çš„ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´ä»å„ç§æ¥æºå¸æ”¶å’Œé€‚åº”ç›´åˆ°è¾¾åˆ°ä¸€ä¸ªèƒ½æä¾›æˆ‘æ‰€éœ€çš„çµæ´»æ€§çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ç»™ä½ çœ‹çœ‹æ¦‚è§ˆï¼Œç„¶åå†æ¥çœ‹å®ƒæ˜¯æ€ä¹ˆå½¢æˆçš„ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;function MyScript()&amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(function()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  var THIS = this;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  function defined(x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return typeof x != &amp;apos;undefined&amp;apos;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.ready = false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.init = function(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    this.ready = true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.doSomething = function()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  var options = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      x : 123,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      y : &amp;apos;abc&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  this.define = function(key, value)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if(defined(options[key]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      options[key] = value;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;).apply(MyScript);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://chengkang.me/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://chengkang.me/tags/JavaScript/"/>
    
      <category term="Design Pattern" scheme="http://chengkang.me/tags/Design-Pattern/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘JavaScript å‘½åç©ºé—´</title>
    <link href="http://chengkang.me/2016/06/28/javascript-namespace-by-michaux/"/>
    <id>http://chengkang.me/2016/06/28/javascript-namespace-by-michaux/</id>
    <published>2016-06-28T15:07:58.000Z</published>
    <updated>2016-06-28T08:12:50.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="http://peter.michaux.ca/articles/javascript-namespacing" target="_blank" rel="external">ã€ŠJavaScript Namespacingã€‹</a></p>
</blockquote>
<h1 id="JavaScript-å‘½åç©ºé—´"><a href="#JavaScript-å‘½åç©ºé—´" class="headerlink" title="JavaScript å‘½åç©ºé—´"></a>JavaScript å‘½åç©ºé—´</h1><p>JavaScript ä¸­æœ‰å¾ˆå¤šå¯ä»¥ç»™ä½ çš„å¯¹è±¡å®‰å…¨åˆ†é…å‘½åç©ºé—´çš„æ–¹æ³•ã€‚è¿™ç¯‡æ–‡ç« è®¨è®ºæˆ‘è§è¿‡çš„æ™®éçš„å®è·µã€‚</p>
<h2 id="å‰ç¼€å‘½åç©ºé—´"><a href="#å‰ç¼€å‘½åç©ºé—´" class="headerlink" title="å‰ç¼€å‘½åç©ºé—´"></a>å‰ç¼€å‘½åç©ºé—´</h2><p>å¦‚æœå‘½åç©ºé—´çš„ç›®çš„æ˜¯é¿å…å†²çªçš„è¯ã€‚ä¸‹é¢è¿™ä¸ªç³»ç»Ÿï¼Œåªè¦æˆ‘ä»¬çŸ¥é“å…¨å±€å˜é‡åå‰ç¼€ <em>myApp_</em> æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥åƒå…¶ä»–ç³»ç»Ÿä¸€æ ·é¿å…å‘½åç©ºé—´å†²çªã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// add uniquely named global properties</span><br><span class="line">var myApp_sayHello = function() &#123;</span><br><span class="line">  alert(&apos;hello&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">var myApp_sayGoodbye = function() &#123;</span><br><span class="line">  alert(&apos;goodbye&apos;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// use the namespace properties</span><br><span class="line">myApp_sayHello();</span><br></pre></td></tr></table></figure>
<p>C è¯­è¨€ç¨‹åºç»å¸¸ä½¿ç”¨å‰ç¼€å‘½åç©ºé—´ã€‚åœ¨ JavaScript çš„ä¸–ç•Œä¸­ï¼Œä½ å¯èƒ½ä¼šç¢°è§ Macromedia çš„ MM_ æ–¹æ³•ï¼Œä¾‹å¦‚ MM_showHideLayersã€‚</p>
<p>æˆ‘è®¤ä¸ºå‰ç¼€å‘½åç©ºé—´æ˜¯ JavaScript ä¸­æœ€æ¸…æ¥šæ˜ç™½çš„å‘½åç©ºé—´ç³»ç»Ÿã€‚ï¼ˆä¸‹é¢çš„å¯¹è±¡å‘½åç©ºé—´ç­–ç•¥åœ¨åŠ å…¥äº† <code>this</code> å…³é”®å­—åä¼šå¯¼è‡´å›°æƒ‘ã€‚ï¼‰</p>
<p>å‰ç¼€å‘½åç©ºé—´çš„ç¡®åˆ›å»ºäº†å¾ˆå¤šå…¨å±€å¯¹è±¡ã€‚è¿™å¯¹äºå‰ç¼€ç”¨æ¥é¿å…çš„å‘½åç©ºé—´å†²çªå¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚å‰ç¼€å‘½åç©ºé—´çš„é—®é¢˜æ˜¯ï¼Œæœ‰äº›ç½‘é¡µæµè§ˆå™¨ï¼ˆä¾‹å¦‚ IE6ï¼‰åœ¨æœ‰å¾ˆå¤šå…¨å±€å¯¹è±¡æ—¶è¡¨ç°å¾ˆç³Ÿç³•ï¼Œå°±æˆ‘æ‰€å¬è¯´ã€‚æˆ‘åšäº†ä¸€äº›æµ‹è¯•å¹¶ä¸”å‘ç°æœ‰ä¸€ä¸ª comp.lang.javascript çš„å°çº¿ç¨‹ï¼Œä¸è¿‡æˆ‘æ²¡æœ‰å°±è¿™ä¸ªè¯é¢˜ç ”ç©¶å½»åº•ã€‚</p>
<a id="more"></a>
<h2 id="å•å¯¹è±¡å‘½åç©ºé—´"><a href="#å•å¯¹è±¡å‘½åç©ºé—´" class="headerlink" title="å•å¯¹è±¡å‘½åç©ºé—´"></a>å•å¯¹è±¡å‘½åç©ºé—´</h2><p>å½“ä¸‹ï¼Œæœ€æµè¡Œçš„ JavaScript å‘½åç©ºé—´å®è·µæ˜¯ä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡æ¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªè¢«å¼•ç”¨çš„å¯¹è±¡å¼•ç”¨ä½ çš„ã€çœŸæ­£çš„ä¸šåŠ¡ã€ï¼Œå¹¶ä¸”å› ä¸ºä½ çš„å…¨å±€å¯¹è±¡çš„å‘½åç‹¬ä¸€æ— äºŒï¼Œä½ çš„ä»£ç å’Œå…¶ä»–äººçš„ä»£ç å°±å¯ä»¥ä¸€èµ·å—¨çš®åœ°è¿è¡Œã€‚</p>
<p>å¦‚æœä½ ç¡®å®šè¿™ä¸ªä¸–ç•Œä¸Šæ²¡æœ‰ä»»ä½•äººç”¨äº†è¿™ä¸ªå…¨å±€å˜é‡å <em>myApp</em>ï¼Œé‚£ä¹ˆä½ å¯ä»¥æœ‰è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// define the namespace object</span><br><span class="line">var myApp = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">// add properties to the namespace object</span><br><span class="line">myApp.sayHello = function() &#123;</span><br><span class="line">  alert(&apos;hello&apos;);</span><br><span class="line">&#125;;</span><br><span class="line">myApp.sayGoodbye = function() &#123;</span><br><span class="line">  alert(&apos;goodbye&apos;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// use the namespace properties</span><br><span class="line">myApp.sayHello();</span><br></pre></td></tr></table></figure>
<p>å½“ä¸Šé¢ä»£ç çš„æœ€åä¸€è¡Œæ‰§è¡Œæ—¶ï¼ŒJavaScript è§£é‡Šå™¨é¦–å…ˆæ‰¾åˆ° <em>myApp</em> å¯¹è±¡ï¼Œç„¶åæ‰¾åˆ°å¹¶è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„ <em>syaHello</em> å±æ€§ã€‚</p>
<p>å¯¹è±¡å‘½åç©ºé—´çš„ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒä¼šå¯¼è‡´ä¸é¢å‘å¯¹è±¡æ¶ˆæ¯ä¼ é€’æ··æ·†ã€‚è¿™ä¸¤è€…ä¹‹é—´å¹¶æ²¡æœ‰æ˜æ˜¾çš„å¥æ³•å·®å¼‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 1</span><br><span class="line">namespace.prop();</span><br><span class="line"></span><br><span class="line">// 2</span><br><span class="line">receiver.message();</span><br></pre></td></tr></table></figure>
<p>æ›´ä»”ç»†åœ°ç ”ç©¶è¿™ä¸ªæ··æ·†ï¼Œæˆ‘ä»¬å¾—å‡ºä¸‹é¢çš„å‘½åç©ºé—´æƒ³æ³•ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹åº“ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">myApp.message = &apos;hello&apos;;</span><br><span class="line"></span><br><span class="line">myApp.sayHello = function() &#123;</span><br><span class="line">  alert(myApp.message);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç”¨è¿™ä¸ªåº“çš„ä»£ç å¯ä»¥éšæ„è¿›è¡Œå†™æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myApp.sayHello(); // works</span><br><span class="line">  </span><br><span class="line">var importedfn = myApp.sayHello;</span><br><span class="line"></span><br><span class="line">importedfn(); // works</span><br></pre></td></tr></table></figure>
<p>å°†è¿™ä¸ªå’Œé‚£ä¸ªä»¤äººæ··æ·†çš„ä½¿ç”¨ <code>this</code> çš„æ¶ˆæ¯ä¼ é€’ç‰ˆæœ¬æ¯”è¾ƒä¸€ä¸‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">myApp.message = &apos;hello&apos;;</span><br><span class="line"></span><br><span class="line">myApp.sayHello = function() &#123;</span><br><span class="line">  alert(this.message);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç”¨è¿™ä¸ªåº“çš„ä»£ç å¯ä»¥éšæ„è¿›è¡Œå†™æ“ä½œã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myApp.sayHello() // works because &quot;this&quot; refers to myApp object.</span><br><span class="line"></span><br><span class="line">var importedfn = myApp.sayHello;</span><br><span class="line"></span><br><span class="line">importedfn(); // error because &quot;this&quot; refers to global object.</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢çš„è¦ä¸Šçš„ä¸€è¯¾æ˜¯ï¼Œ<code>this</code> æ°¸è¿œä¸èƒ½å¼•ç”¨ä¸€ä¸ªè¢«ä½œä¸ºå‘½åç©ºé—´çš„å¯¹è±¡å› ä¸ºå®ƒè‚¯èƒ½å¯¼è‡´å…³äºä»å‘½åç©ºé—´å¼•å…¥æ ‡è¯†ç¬¦çš„æ··æ·†ã€‚è¿™ä¸ªé—®é¢˜æ˜¯ <code>this</code> åœ¨æˆ‘çš„ <a href="http://peter.michaux.ca/article/7933" target="_blank" rel="external">JavaScript Warning Words</a> åˆ—è¡¨ä¸­çš„åŸå› ä¹‹ä¸€ã€‚</p>
<p>ï¼ˆè¿™ä¹Ÿè¡¨æ˜äº†åº“çš„ API å±æ€§åº”è¯¥æŒ‡å‘ç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ ·è¿™äº›æ–¹æ³•å¯ä»¥è¢«å¯¼å…¥å…¶ä»–å‘½åç©ºé—´ã€‚è¿™ä¸ªé—®é¢˜æ˜¯åœ¨æˆ‘çš„æ–‡ç«  <a href="http://peter.michaux.ca/article/3556" target="_blank" rel="external">Lazy Function Definition Pattern</a> çš„è¯„è®ºä¸­è¢«æŒ‡å‡ºçš„ã€‚æ‡’æƒ°æ–¹æ³•å®šä¹‰å¯ä»¥åœ¨è¢«éšè—åœ¨åº“ä¸­å¹¶ä¸”ä¸æ˜¯ API çš„éƒ¨åˆ†æ—¶å®‰å…¨ä½¿ç”¨ã€‚ï¼‰</p>
<h2 id="åµŒå¥—å¯¹è±¡å‘½åç©ºé—´"><a href="#åµŒå¥—å¯¹è±¡å‘½åç©ºé—´" class="headerlink" title="åµŒå¥—å¯¹è±¡å‘½åç©ºé—´"></a>åµŒå¥—å¯¹è±¡å‘½åç©ºé—´</h2><p>åµŒå¥—å¯¹è±¡å‘½åç©ºé—´æ˜¯å¦ä¸€ä¸ªæ™®éçš„å®è·µï¼Œå®ƒæ‰©å±•äº†å¯¹è±¡å‘½åç©ºé—´çš„æƒ³æ³•ã€‚ä½ å¯èƒ½è§è¿‡ç±»ä¼¼å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YAHOO.util.Event.addListener(/*...*/)</span><br></pre></td></tr></table></figure>
<p>è§£å†³ä¸Šé¢çš„ä»£ç éœ€è¦è§£é‡Šå™¨é¦–å…ˆæ‰¾åˆ°å…¨èšå¾· <em>YAHOO</em> å¯¹è±¡ï¼Œç„¶åå®ƒçš„ <em>util</em> å¯¹è±¡ï¼Œç„¶åå®ƒçš„ <em>Event</em> å¯¹è±¡ï¼Œç„¶åæ‰¾åˆ°å¹¶è°ƒç”¨å®ƒçš„ <em>addListener</em> å±æ€§ã€‚è¿™æ ·çš„è¯æ¯æ¬¡äº‹ä»¶å¤„ç†å™¨ç»‘å®šåˆ°ä¸€ä¸ª DOM å…ƒç´ ä¸ŠèŠ±çš„åŠŸå¤«å¤ªå¤šäº†ï¼Œå› æ­¤å¯¼å…¥çš„æ¦‚å¿µå¼€å§‹è¢«é‡‡ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(function() &#123;</span><br><span class="line">  var yue = YAHOO.util.Event;</span><br><span class="line">  yue.addListener(/*...*/);</span><br><span class="line">  yue.addListener(/*...*/);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ¸…æ¥š <em>YAHOO.util.Event.addListener</em> æ–¹æ³•ä¸ä¼šç”¨ <code>this</code> å…³é”®å­—å¹¶ä¸”æ°¸è¿œå¼•ç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå¯¼å…¥å¯ä»¥å˜å¾—æ›´åŠ ç®€æ´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(function() &#123;</span><br><span class="line">  var yuea = YAHOO.util.Event.addEventListener;</span><br><span class="line">  yuea(/*...*/);</span><br><span class="line">  yuea(/*...*/);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>æˆ‘è§‰å¾—å½“ç›®çš„åªæ˜¯é¿å…æ ‡è¯†ç¬¦å†²çªæ—¶ï¼ŒåµŒå¥—å¯¹è±¡å‘½åç©ºé—´çš„å¤æ‚æ˜¯ä¸å¿…è¦çš„ã€‚éš¾é“ Yahoo! è¿˜è§‰å¾—è¿™äº›å…¨å±€æ ‡è¯†ç¬¦ YAHOO_util_Event å’Œ YAHOO_util_Event_addEventListener ä¸å¤Ÿç‹¬ç‰¹å—ï¼Ÿ</p>
<p>æˆ‘è®¤ä¸ºä½¿ç”¨åµŒå¥—å¯¹è±¡å‘½åç©ºé—´çš„åŠ¨æœºæ˜¯è¦çœ‹èµ·æ¥å’Œ Java åŒ…å‘½åä¼ ç»Ÿä¸€æ ·ï¼Œè¿™åœ¨ Java ä¸­å¼€é”€ä¸å¤§ã€‚ä¾‹å¦‚ï¼Œåœ¨ Java ä¸­ä½ å¯èƒ½çœ‹åˆ°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package mytools.text;</span><br><span class="line"></span><br><span class="line">class TextComponent &#123;</span><br><span class="line">  /* ... */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªè¿™ä¸ªç±»çš„å®Œå…¨åˆæ ¼çš„å¼•ç”¨åº”è¯¥æ˜¯ <code>mytools.text.TextComponent</code>ã€‚</p>
<p>ä¸‹é¢æ˜¯ Niemeyer å’Œ Knudsen ï¼ˆå†™ï¼‰çš„ <em>Learning Java</em> ä¸­åŒ…å‘½åçš„æè¿°ï¼š</p>
<blockquote>
<p>åŒ…åæ˜¯æŒ‰å±‚çº§æ„æˆçš„ï¼Œä½¿ç”¨ç‚¹åˆ†éš”çš„å‘½åä¼ ç»Ÿã€‚åŒ…åç»„æˆæˆåˆ†ç»™ç¼–è¯‘å™¨å’Œè¿è¡Œç³»ç»Ÿæ„æˆäº†ç‹¬ä¸€æ— äºŒçš„å®šä½æ–‡ä»¶çš„è·¯å¾„ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¹¶æ²¡åœ¨åŒ…ä¹‹é—´åˆ›å»ºå…¶ä»–çš„å…³ç³»ã€‚å¹¶æ²¡æœ‰ä»€ä¹ˆã€subpackageã€çš„è¯´æ³•ï¼Œäº‹å®ä¸Šï¼ŒåŒ…å‘½åç©ºé—´æ˜¯ç›´æ¥çš„ï¼Œè€Œéå±‚çº§çš„ã€‚åœ¨åŒ…å±‚çº§å…³ç³»ç‰¹å®šéƒ¨åˆ†çš„åŒ…ä»…ä»…æ˜¯å› ä¸ºä¹ æƒ¯è€Œæœ‰å…³è”ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ç©¿ä»¶äº†å¦ä¸€ä¸ªå«åš <em>mytools.text.poetry</em> çš„åŒ…ï¼ˆå‡è®¾æ˜¯ä¸ºäº†è·Ÿè¯—æœ‰å…³çš„ä¸€äº›æ–‡å­—ç±»ï¼‰ï¼Œè¿™äº›ç±»å¹¶ä¸æ˜¯ <em>mytools.text</em> åŒ…çš„ä¸€éƒ¨åˆ†ï¼›å®ƒä»¬æ²¡æœ‰åŒ…æˆå‘˜çš„è®¿é—®æƒé™ã€‚</p>
</blockquote>
<p>åµŒå¥—å‘½åç©ºé—´çš„å¹»è§‰åœ¨ Perl ä¸­ä¹Ÿå­˜åœ¨ã€‚åœ¨ Perl ä¸­ï¼ŒåµŒå¥—åŒ…åç”±åŒå†’å·åˆ†éš”å¼€ã€‚ä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ Perl ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">package Red::Blue;</span><br><span class="line">our $var = &apos;foo&apos;;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ä¸Šè¿°å˜é‡å¼•ç”¨åº”è¯¥æ˜¯ <em>$Red::Blue::var</em>ã€‚</p>
<p>åœ¨ Perl ä¸­ï¼Œå°±åƒ Javaï¼Œå‘½åç©ºé—´å±‚çº§çš„ä¸»æ„åªæ˜¯æ–¹ä¾¿ç¨‹åºå‘˜ï¼Œè€Œä¸æ˜¯è¯­è¨€æœ¬èº«è¦æ±‚ã€‚Wallï¼ŒChristiansen å’Œ Orwant çš„ <em>Programming Perl</em> è§£é‡Šé“ï¼š</p>
<blockquote>
<p>åŒå†’å·å¯è¢«ç”¨äºé“¾æ¥åœ¨åŒ…å <em>$Red::Blue::var</em> ä¸­æ ‡è¯†ç¬¦ã€‚è¿™æ„å‘³ç€ <em>$var</em> å±äºåŒ… <em>Red::Blue</em>ã€‚åŒ… <em>Red::Blue</em> è·Ÿå¯èƒ½å­˜åœ¨çš„ <em>Red</em> åŒ…æˆ– <em>Blue</em> åŒ…ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ã€‚åªæ˜¯è¯´ï¼Œ<em>Red::Blue</em> å’Œ <em>Red</em> æˆ–è€… <em>Blue</em> ä¹‹é—´çš„å…³ç³»å¯èƒ½å¯¹äºå†™ä»£ç æˆ–è€…ä½¿ç”¨è¿™ä¸ªç¨‹åºçš„äººæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œä½†è·Ÿ Perl æ²¡å…³ç³»ã€‚ï¼ˆå¥½å§ï¼Œé™¤äº†åœ¨ç°åœ¨çš„å®ç°ä¸­ï¼Œç¬¦å·è¡¨ <em>Red::Blue</em> åˆšå¥½å­˜åœ¨ç¬¦å·è¡¨ <em>Red</em> ä¸­ã€‚ä½†æ˜¯ Perl è¯­è¨€å¹¶æ²¡æœ‰ç›´æ¥åˆ©ç”¨è¿‡å®ƒã€‚ï¼‰</p>
</blockquote>
<p>ä¸Šè¿°å¼•ç”¨ä¸­æœ€åå¤‡æ³¨æš—ç¤ºäº† Perl å¯èƒ½æœ‰å’Œåœ¨ JavaScript ä¸­ä½¿ç”¨åµŒå¥—å‘½åç©ºé—´å¯¹è±¡ä¸€æ ·çš„æ ‡è¯†ç¬¦å†²çªå¼€é”€ã€‚å¦‚æœ Perl çš„å®ç°æ”¹å˜äº†ï¼Œè¿™ä¸ªå¼€é”€å°±ä¼šæ¶ˆå¤±ã€‚åœ¨ JavaScript ä¸­ï¼Œæˆ‘è‚¯å®šåµŒå¥—å¯¹è±¡å‘½åç©ºé—´çš„å¼€é”€æ°¸è¿œä¸ä¼šæ¶ˆå¤±å› ä¸º JavaScript ä½¿ç”¨å»¶è¿Ÿç»‘å®šã€‚</p>
<p>æˆ‘å¹¶ä¸è®¤ä¸º JavaScript ä¸­çš„åµŒå¥—å¯¹è±¡å‘½åç©ºé—´æä¾›äº†ä»»ä½•å¤§å¥½å¤„ï¼Œä¸è¿‡å¦‚æœä¸ä½¿ç”¨å¯¼å…¥çš„è¯åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šå¼€é”€éå¸¸å¤§ã€‚</p>
<h2 id="ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ"><a href="#ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ" class="headerlink" title="ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ"></a>ä¸€ä¸ªæŠ˜ä¸­æ–¹æ¡ˆ</h2><p>å¦‚æœå•çº¯åœ°å‰ç¼€å‘½åç©ºé—´åœ¨æŸäº›æµè§ˆå™¨ä¸­çœŸçš„å¾ˆæ…¢ï¼Œè€ŒåµŒå¥—å‘½åç©ºé—´çš„æ¦‚å¿µå¸®åŠ©åœ¨å¼€å‘è€…è„‘ä¸­ä¿æŒå„äº‹åŠ¡çš„æœ‰åºï¼Œé‚£æˆ‘è®¤ä¸ºä¸Šè¿° Yahoo! çš„ä¾‹å­ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YAHOO.util_Event_addListener</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç”¨æ›´å¤šçš„å…¨å±€åç§°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YAHOO_util_Event.addListener</span><br></pre></td></tr></table></figure>
<h2 id="å“ªä¸ªç»´åº¦çš„å‘½åç©ºé—´ï¼Ÿ"><a href="#å“ªä¸ªç»´åº¦çš„å‘½åç©ºé—´ï¼Ÿ" class="headerlink" title="å“ªä¸ªç»´åº¦çš„å‘½åç©ºé—´ï¼Ÿ"></a>å“ªä¸ªç»´åº¦çš„å‘½åç©ºé—´ï¼Ÿ</h2><p>Perl çš„ CPAN æ¨¡å—æ˜¯åŸºäºä»–ä»¬æ‰€åšçš„äº‹æƒ…è¿›è¡Œå‘½åç©ºé—´ç®¡ç†çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘å†™äº†ä¸€ä¸ªè¿™ä¸ªå‘½åç©ºé—´é‡Œçš„æ¨¡å—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaScript::Minifier</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåˆ«äººç”¨åŒæ ·çš„åå­—å†™ä»–è‡ªå·±çš„æ¨¡å—ï¼Œå¹¶ä¸”ä»–ä¸è‡ªçŸ¥åœ°é€šè¿‡æŸäº›æ¨¡å—ä¾èµ–é€šè¿‡åŒä¸€ä¸ªåå­—ä½¿ç”¨ CPAN æ¨¡å—ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å†²çªã€‚</p>
<p>Java ç¨‹åºå‘˜é‡‡ç”¨æœ€å†—é•¿ä½†å½“ç„¶ä¹Ÿæ˜¯æœ€å®‰å…¨çš„æ–¹æ³•ã€‚ï¼ˆJava ç¨‹åºå‘˜ä¼¼ä¹éƒ½æƒ³ç€åœ¨å¤§å‹ç³»ç»Ÿä¸Šè¿è¡Œçš„ä»£ç ã€‚ï¼‰åœ¨ Java ä¸­ï¼ŒåŒ…ç»å¸¸æ˜¯åŸºäº<strong>è°å†™çš„</strong>å’Œ<strong>åšä»€ä¹ˆçš„</strong>æ¥å‘½åã€‚ï¼ˆ<em>myFunc</em>é£æ ¼çš„è§„èŒƒåŒ–ã€‚ï¼‰ã€è°å†™çš„ã€éƒ¨åˆ†ç”šè‡³ä½¿ç”¨å¼€å‘è€…è‡ªå·±çš„ç›¸å¯¹å¯ä»¥ä¿è¯å”¯ä¸€æ€§çš„åå­—ã€‚å¦‚æœæˆ‘å†™ä¸€ä¸ª Java çš„ minifierï¼Œå› ä¸ºæˆ‘æœ‰ michaux.ca çš„åŸŸåï¼Œæˆ‘å¯èƒ½ç”¨ä»¥ä¸‹å‘½åç©ºé—´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca.michaux.javascript.minifier</span><br></pre></td></tr></table></figure>
<p>åœ¨ JavaScript ä¸­ï¼Œç»è¿‡è¿™æ¬¡è®¨è®ºï¼Œå¯èƒ½è¿™æ ·å†™æ•ˆç‡æ›´é«˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca_michaux_javascript_minifier</span><br></pre></td></tr></table></figure>
<p>å› ä¸º JavaScript æ˜¯ä»¥æ–‡æœ¬çš„å½¢å¼æœåŠ¡çš„ï¼Œè¿™æ ·çš„å‘½åç©ºé—´å¯èƒ½å¼€é”€å¤ªå¤§ï¼Œå› ä¸ºå¢åŠ äº†ä¸‹è½½æ—¶é—´ã€‚Gzip å‹ç¼©ä¼šæ‰¾åˆ°å…¬å…±çš„å­—ç¬¦ä¸²å¹¶ç”¨çŸ­å­—ç¬¦ä¸²æ›¿æ¢å®ƒä»¬ã€‚å¦‚æœ gzip ä¸å¯ç”¨çš„è¯é‚£ä¹ˆå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨å¯¼å…¥äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var ca_michaux_javascript_minifier = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">(function() &#123;</span><br><span class="line">  var cmjm = ca_michaux_javascript_minifier;</span><br><span class="line">  </span><br><span class="line">  // refer to cmjm inside this module pattern</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>æˆ‘å¹¶ä¸æ˜¯è¯´è¿™äº›é•¿çš„å‘½åç©ºé—´æ˜¯ç»å¯¹å¿…é¡»çš„ï¼Œä¸è¿‡ä»–ä»¬ä¸€å®šæ˜¯é¿å…å‘½åç©ºé—´å†²çªçš„æœ€å®‰å…¨æ–¹æ³•ã€‚</p>
<h2 id="å…¶ä»–å‘½åç©ºé—´é—®é¢˜"><a href="#å…¶ä»–å‘½åç©ºé—´é—®é¢˜" class="headerlink" title="å…¶ä»–å‘½åç©ºé—´é—®é¢˜"></a>å…¶ä»–å‘½åç©ºé—´é—®é¢˜</h2><p>æ ‡è¯†ç¬¦ä¸ä»…åœ¨ JavaScript èµ„æºä¸­åˆ›å»ºã€‚ä¸€ä¸ªè¡¨å•çš„ name å±æ€§ä¹Ÿè¢«åŠ åœ¨ <em>document.forms</em> å¯¹è±¡ä¸Šã€‚åƒ <em><form name="myCompany_login"></form></em> è¿™æ ·å‘½åæ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>
<p>å‘½åç©ºé—´ç±»åå±æ€§ï¼Œæ¯”å¦‚ <em>&lt;div class=â€myCompany_storyâ€&gt;</em>ï¼Œå¯ä»¥åœ¨å‡å°‘ CSS å‘½åç©ºé—´å†²çªä»¥åŠå½“ JavaScript ä»£ç åœ¨é€šè¿‡ç±»åæœç´¢ DOM å…ƒç´ æ—¶å¾ˆæœ‰ä»·å€¼ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä¸ªäººè®¤ä¸ºï¼Œä»»ä½•åƒ <em>YAHOO.util.Event.addListener</em> è¿™æ ·æœ‰ç‚¹æˆ–è€…ä¸‹åˆ’çº¿çš„ä¸œè¥¿éƒ½æ˜¯è¢«å†²çªå“å‚»äº†çš„ã€‚å®ƒå¯ä»¥å°±æ˜¯ <em>YUI.on</em>ã€‚Dojo é€šè¿‡åŒæ ·åŠŸèƒ½çš„ dojo.connect æä¾›äº†è¶³å¤Ÿçš„ä¿æŠ¤ï¼Œå› ä¸ºå®ƒæœ‰æ•ˆåœ°æ¶µç›–äº†å‘½åç©ºé—´ã€è°ã€å’Œã€åšä»€ä¹ˆã€çš„ç»´åº¦ã€‚æ²¡æœ‰äººä¼šåœ¨ä»–ä»¬çš„å³è„‘ä¸­ä¼šè¿™æ ·æƒ³å¹¶åœ¨ dojo å‘½åç©ºé—´ä¸‹å†™ä¸€ä¸ª JavaScript åº“ã€‚Dojo çš„å¼€å‘äººå‘˜ä¹Ÿä¸ä¼šå¿˜è®°ä»–ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª connect æ–¹æ³•å¹¶å†™å¦å¤–ä¸€ä¸ªã€‚</p>
<p>å¦‚æœæˆ‘ä»¬èƒ½æœ‰ä¸€ä¸ªç½‘ç«™æ¥è®©ç¨‹åºå‘˜ä»¬ä¿å­˜ä»–ä»¬çš„ JavaScript å…¨å±€æ ‡è¯†ç¬¦å’Œä¸‹åˆ’çº¿å‰ç¼€ï¼Œå¹¶ä¸”å½“ ECMAScipt4 å‘å¸ƒäº†çš„æ—¶å€™ä¹ŸåŒ…æ‹¬ä»–ä»¬çš„åŒ…åï¼Œå°±å¥½äº†ï¼šã€JavaScript å‘½åç©ºé—´ç™»è®°å¤„ã€ã€‚</p>
<p>JavaScript æ˜¯ä¸€ä¸ªæœ€å°æ¦‚å¿µé›†çš„å¼ºå¤§è¯­è¨€ã€‚å³ä½¿ JavaScript å¹¶æ²¡æœ‰ä¸“é—¨ä¸ºé¿å…å‘½åç©ºé—´å†²çªè®¾è®¡çš„è¯­è¨€çº§æ”¯æŒï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šè§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚å¹¶æ²¡æœ‰ä¸€ä¸ªã€æ­£ç¡®ã€çš„ç­”æ¡ˆã€‚é€‰ä¸€ä¸ªä½ æœ€å–œæ¬¢çš„ã€‚</p>
<p>ä¸è¿‡ï¼Œæ— è®ºä½ åšä»€ä¹ˆï¼Œè¯·è®°ä½åˆ«å¼„ä¸€ä¸ªå¦å¤–çš„å…¨å±€ $ æ ‡è¯†ç¬¦ã€‚</p>
<h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p><a href="http://groups.google.com/group/comp.lang.javascript/browse_frm/thread/494e1757fa51fe3f" target="_blank" rel="external">comp.lang.javascript discussion on namespacing</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;http://peter.michaux.ca/articles/javascript-namespacing&quot;&gt;ã€ŠJavaScript Namespacingã€‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;JavaScript-å‘½åç©ºé—´&quot;&gt;&lt;a href=&quot;#JavaScript-å‘½åç©ºé—´&quot; class=&quot;headerlink&quot; title=&quot;JavaScript å‘½åç©ºé—´&quot;&gt;&lt;/a&gt;JavaScript å‘½åç©ºé—´&lt;/h1&gt;&lt;p&gt;JavaScript ä¸­æœ‰å¾ˆå¤šå¯ä»¥ç»™ä½ çš„å¯¹è±¡å®‰å…¨åˆ†é…å‘½åç©ºé—´çš„æ–¹æ³•ã€‚è¿™ç¯‡æ–‡ç« è®¨è®ºæˆ‘è§è¿‡çš„æ™®éçš„å®è·µã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰ç¼€å‘½åç©ºé—´&quot;&gt;&lt;a href=&quot;#å‰ç¼€å‘½åç©ºé—´&quot; class=&quot;headerlink&quot; title=&quot;å‰ç¼€å‘½åç©ºé—´&quot;&gt;&lt;/a&gt;å‰ç¼€å‘½åç©ºé—´&lt;/h2&gt;&lt;p&gt;å¦‚æœå‘½åç©ºé—´çš„ç›®çš„æ˜¯é¿å…å†²çªçš„è¯ã€‚ä¸‹é¢è¿™ä¸ªç³»ç»Ÿï¼Œåªè¦æˆ‘ä»¬çŸ¥é“å…¨å±€å˜é‡åå‰ç¼€ &lt;em&gt;myApp_&lt;/em&gt; æ˜¯å”¯ä¸€çš„ï¼Œå¯ä»¥åƒå…¶ä»–ç³»ç»Ÿä¸€æ ·é¿å…å‘½åç©ºé—´å†²çªã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// add uniquely named global properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;var myApp_sayHello = function() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  alert(&amp;apos;hello&amp;apos;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;var myApp_sayGoodbye = function() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  alert(&amp;apos;goodbye&amp;apos;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// use the namespace properties&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;myApp_sayHello();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;C è¯­è¨€ç¨‹åºç»å¸¸ä½¿ç”¨å‰ç¼€å‘½åç©ºé—´ã€‚åœ¨ JavaScript çš„ä¸–ç•Œä¸­ï¼Œä½ å¯èƒ½ä¼šç¢°è§ Macromedia çš„ MM_ æ–¹æ³•ï¼Œä¾‹å¦‚ MM_showHideLayersã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è®¤ä¸ºå‰ç¼€å‘½åç©ºé—´æ˜¯ JavaScript ä¸­æœ€æ¸…æ¥šæ˜ç™½çš„å‘½åç©ºé—´ç³»ç»Ÿã€‚ï¼ˆä¸‹é¢çš„å¯¹è±¡å‘½åç©ºé—´ç­–ç•¥åœ¨åŠ å…¥äº† &lt;code&gt;this&lt;/code&gt; å…³é”®å­—åä¼šå¯¼è‡´å›°æƒ‘ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;å‰ç¼€å‘½åç©ºé—´çš„ç¡®åˆ›å»ºäº†å¾ˆå¤šå…¨å±€å¯¹è±¡ã€‚è¿™å¯¹äºå‰ç¼€ç”¨æ¥é¿å…çš„å‘½åç©ºé—´å†²çªå¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚å‰ç¼€å‘½åç©ºé—´çš„é—®é¢˜æ˜¯ï¼Œæœ‰äº›ç½‘é¡µæµè§ˆå™¨ï¼ˆä¾‹å¦‚ IE6ï¼‰åœ¨æœ‰å¾ˆå¤šå…¨å±€å¯¹è±¡æ—¶è¡¨ç°å¾ˆç³Ÿç³•ï¼Œå°±æˆ‘æ‰€å¬è¯´ã€‚æˆ‘åšäº†ä¸€äº›æµ‹è¯•å¹¶ä¸”å‘ç°æœ‰ä¸€ä¸ª comp.lang.javascript çš„å°çº¿ç¨‹ï¼Œä¸è¿‡æˆ‘æ²¡æœ‰å°±è¿™ä¸ªè¯é¢˜ç ”ç©¶å½»åº•ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://chengkang.me/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://chengkang.me/tags/JavaScript/"/>
    
      <category term="Namespacing" scheme="http://chengkang.me/tags/Namespacing/"/>
    
      <category term="Namespace" scheme="http://chengkang.me/tags/Namespace/"/>
    
  </entry>
  
  <entry>
    <title>ã€è¯‘ã€‘JavaScript ä¸­çš„å‘½åç©ºé—´</title>
    <link href="http://chengkang.me/2016/06/21/Namespacing%20in%20JavaScript/"/>
    <id>http://chengkang.me/2016/06/21/Namespacing in JavaScript/</id>
    <published>2016-06-21T20:59:30.000Z</published>
    <updated>2016-06-28T08:08:49.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š <a href="https://javascriptweblog.wordpress.com/2010/12/07/namespacing-in-javascript/" target="_blank" rel="external">Namespacing in JavaScript</a></p>
</blockquote>
<h1 id="JavaScript-ä¸­çš„å‘½åç©ºé—´"><a href="#JavaScript-ä¸­çš„å‘½åç©ºé—´" class="headerlink" title="JavaScript ä¸­çš„å‘½åç©ºé—´"></a>JavaScript ä¸­çš„å‘½åç©ºé—´</h1><p>å…¨å±€å˜é‡åº”è¯¥ç”±æœ‰ç³»ç»ŸèŒƒå›´ç›¸å…³æ€§çš„å¯¹è±¡ä»¬ä¿ç•™ï¼Œå¹¶ä¸”å®ƒä»¬çš„å‘½ååº”è¯¥é¿å…å«ç³Šå¹¶å°½é‡å‡å°‘å‘½åå†²çªçš„é£é™©ã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥é¿å…åˆ›å»ºå…¨å±€å¯¹è±¡ï¼Œé™¤éå®ƒä»¬æ˜¯ç»å¯¹å¿…é¡»çš„ã€‚</p>
<p>ä¸è¿‡ï¼Œæ©ï¼Œè¿™äº›ä½ æ—©éƒ½çŸ¥é“äº†â€¦â€¦</p>
<p>æ‰€ä»¥ä½ å¯¹æ­¤æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä¼ ç»Ÿæ–¹æ³•å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ€å¥½çš„æ¶ˆé™¤å…¨å±€ç­–ç•¥æ˜¯åˆ›å»ºå°‘æ•°ä½œä¸ºæ½œåœ¨æ¨¡å—å’Œå­ç³»ç»Ÿçš„å®é™…å‘½åç©ºé—´çš„å…¨å±€å¯¹è±¡ã€‚æˆ‘å°†æ¢ç´¢å‡ ç§æœ‰å…³å‘½åç©ºé—´çš„æ–¹å¼ï¼Œå¹¶ä»¥æˆ‘åŸºäº <a href="http://www.brothercake.com/" target="_blank" rel="external">James Edwards</a> æœ€è¿‘çš„ä¸€ç¯‡æ–‡ç« å¾—åˆ°çš„ä¸€ä¸ªä¼˜é›…ã€å®‰å…¨å’Œçµæ´»çš„è§£å†³æ–¹æ¡ˆç»“æŸã€‚<br><a id="more"></a></p>
<h2 id="é™æ€å‘½åç©ºé—´"><a href="#é™æ€å‘½åç©ºé—´" class="headerlink" title="é™æ€å‘½åç©ºé—´"></a>é™æ€å‘½åç©ºé—´</h2><p>æˆ‘ç”¨<code>é™æ€å‘½åç©ºé—´</code>ä½œä¸ºé‚£äº›å‘½åç©ºé—´æ ‡ç­¾å®é™…ä¸Šç¡¬ç¼–ç çš„è§£å†³æ–¹æ¡ˆçš„æ¶µç›–æ€§æœ¯è¯­ã€‚æ˜¯çš„ï¼Œä½ å¯ä»¥å°†ä¸€ä¸ªå‘½åç©ºé—´é‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ªï¼Œä¸è¿‡æ–°çš„å‘½åç©ºé—´å°†ä¼šå¼•ç”¨å’Œæ—§çš„é‚£ä¸€ä¸ªåŒæ ·çš„å¯¹è±¡ã€‚</p>
<h3 id="1-é€šè¿‡ç›´æ¥åˆ†é…"><a href="#1-é€šè¿‡ç›´æ¥åˆ†é…" class="headerlink" title="1.é€šè¿‡ç›´æ¥åˆ†é…"></a>1.é€šè¿‡ç›´æ¥åˆ†é…</h3><p>æœ€åŸºç¡€çš„æ–¹æ³•ã€‚è¿™æ ·éå¸¸å†—é•¿ï¼Œå¹¶ä¸”å¦‚æœä½ è¿˜æƒ³é‡å‘½åè¿™äº›å‘½åç©ºé—´ï¼Œä½ å°±æœ‰å¾—æ´»å„¿å¹²äº†ã€‚ä¸è¿‡å®ƒæ˜¯å®‰å…¨å’Œæ¸…æ¥šæ˜ç™½çš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;</span><br><span class="line">myApp.id = 0;</span><br><span class="line">myApp.next = function() &#123;</span><br><span class="line">    return myApp.id++;  </span><br><span class="line">&#125;</span><br><span class="line">myApp.reset = function() &#123;</span><br><span class="line">    myApp.id = 0;   </span><br><span class="line">&#125;</span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.reset(),</span><br><span class="line">    myApp.next()</span><br><span class="line">); //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨<code>this</code>å¼•ç”¨å…„å¼Ÿå±æ€§æ¥ä½¿å°†æ¥çš„ç»´æŠ¤æ›´è½»æ¾ä¸€äº›ï¼Œä¸è¿‡è¿™æœ‰ä¸€ç‚¹å†’é™©å› ä¸ºæ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢ä½ çš„é‚£äº›å‘½åç©ºé—´é‡Œçš„æ–¹æ³•è¢«é‡æ–°åˆ†é…ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;</span><br><span class="line">myApp.id = 0;</span><br><span class="line">myApp.next = function() &#123;</span><br><span class="line">    return this.id++;   </span><br><span class="line">&#125;</span><br><span class="line">myApp.reset = function() &#123;</span><br><span class="line">    this.id = 0;    </span><br><span class="line">&#125;</span><br><span class="line">myApp.next(); //0</span><br><span class="line">myApp.next(); //1</span><br><span class="line">var getNextId = myApp.next;</span><br><span class="line">getNextId(); //NaN whoops!</span><br></pre></td></tr></table></figure>
<h3 id="2-ä½¿ç”¨å¯¹è±¡å­—é¢é‡"><a href="#2-ä½¿ç”¨å¯¹è±¡å­—é¢é‡" class="headerlink" title="2.ä½¿ç”¨å¯¹è±¡å­—é¢é‡"></a>2.ä½¿ç”¨å¯¹è±¡å­—é¢é‡</h3><p>ç°åœ¨æˆ‘ä»¬åªéœ€è¦å¼•ç”¨å‘½åç©ºé—´åä¸€æ¬¡ï¼Œå› æ­¤ä¹‹åæ”¹å˜åå­—æ›´ç®€å•äº†ä¸€äº›ï¼ˆå‡è®¾ä½ è¿˜æ²¡åå¤å¼•ç”¨è¿™ä¸ªå‘½åç©ºé—´ï¼‰ã€‚ä»æœ‰ä¸€ä¸ªå±é™©æ˜¯<code>this</code>çš„å€¼å¯èƒ½ä¼šæŠ›å‡ºä¸€ä¸ªã€æƒŠå–œã€ - ä¸è¿‡å‡è®¾åœ¨ä¸€ä¸ªå¯¹è±¡å­—é¢ç»“æ„é‡Œå®šä¹‰çš„å¯¹è±¡ä¸ä¼šè¢«é‡æ–°åˆ†é…ç›¸å¯¹å®‰å…¨ä¸€ç‚¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;</span><br><span class="line">    id: 0,</span><br><span class="line">    next: function() &#123;</span><br><span class="line">        return this.id++;   </span><br><span class="line">    &#125;,</span><br><span class="line">    reset: function() &#123;</span><br><span class="line">        this.id = 0;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.reset(),</span><br><span class="line">    myApp.next()</span><br><span class="line">) //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<h3 id="3-æ¨¡å—æ¨¡å¼"><a href="#3-æ¨¡å—æ¨¡å¼" class="headerlink" title="3.æ¨¡å—æ¨¡å¼"></a>3.æ¨¡å—æ¨¡å¼</h3><p>æˆ‘å‘ç°è‡ªå·±æœ€è¿‘ç”¨<code>æ¨¡å—æ¨¡å¼</code>æ›´å¤šã€‚é€»è¾‘è¢«ä¸€ä¸ªæ–¹æ³•åŒ…è£…ä»å…¨å±€åŸŸéš”ç¦»å¼€äº†ï¼ˆé€šå¸¸æ˜¯è‡ªè°ƒç”¨çš„ï¼‰ï¼Œå®ƒè¿”å›ä¸€ä¸ªä»£è¡¨è¿™ä¸ªæ¨¡å—å…¬å¼€æ¥å£çš„å¯¹è±¡ã€‚é€šè¿‡ç«‹å³è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¹¶åˆ†é…ç»“æœç»™ä¸€ä¸ªå‘½åç©ºé—´å˜é‡ï¼Œæˆ‘ä»¬å°±é”ä½äº†è¿™ä¸ªå‘½åå˜é‡ä¸­æ¨¡å—çš„ APIã€‚æ­¤å¤–ï¼Œä»»ä½•æ²¡æœ‰åŒ…æ‹¬åœ¨è¿”å›å€¼ä¸­çš„å˜é‡å°†æ°¸è¿œä¿æŒç§æœ‰ï¼Œåªå¯¹å¼•ç”¨ä»–ä»¬çš„å…¬å¼€æ–¹æ³•å¯è§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">var myApp = (function() &#123;</span><br><span class="line">    var id= 0;</span><br><span class="line">    return &#123;</span><br><span class="line">        next: function() &#123;</span><br><span class="line">            return id++;    </span><br><span class="line">        &#125;,</span><br><span class="line">        reset: function() &#123;</span><br><span class="line">            id = 0;     </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;  </span><br><span class="line">&#125;)();   </span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.reset(),</span><br><span class="line">    myApp.next()</span><br><span class="line">) //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šå¯¹è±¡å­—é¢é‡ä¾‹å­ï¼Œå‘½åç©ºé—´åå­—å¯ä»¥è½»æ˜“æ›´æ¢ï¼Œä¸è¿‡è¿˜æœ‰é¢å¤–ä¼˜åŠ¿ï¼šå¯¹è±¡å­—é¢é‡æ˜¯å››ç­çš„ - å®ƒå…¨æ˜¯å…³äºå±æ€§åˆ†é…ï¼Œæ²¡æœ‰æ”¯æŒé€»è¾‘çš„ç©ºé—´ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰å±æ€§å¿…é¡»è¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸”å±æ€§å€¼æ— æ³•è½»æ˜“è·¨å¯¹è±¡å¼•ç”¨ï¼ˆå› æ­¤ï¼Œæ¯”å¦‚ï¼Œå†…éƒ¨é—­åŒ…å°±ä¸å¯èƒ½ä½¿ç”¨äº†ï¼‰ã€‚æ¨¡å—æ¨¡å¼æ²¡æœ‰ä»»ä½•ä¸Šè¿°çº¦æŸï¼Œå¹¶ä¸”ç»™æˆ‘ä»¬é¢å¤–çš„éšç§ç¦åˆ©ã€‚</p>
<h2 id="åŠ¨æ€å‘½åç©ºé—´"><a href="#åŠ¨æ€å‘½åç©ºé—´" class="headerlink" title="åŠ¨æ€å‘½åç©ºé—´"></a>åŠ¨æ€å‘½åç©ºé—´</h2><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™ä¸€èŠ‚ç§°ä¸º<code>å‘½åç©ºé—´æ³¨å…¥</code>ã€‚å‘½åç©ºé—´ç”±ä¸€ä¸ªç›´æ¥å¼•ç”¨æ–¹æ³•åŒ…è£…<code>å†…éƒ¨</code>çš„ä»£ç†ä»£è¡¨ - è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å†éœ€è¦æ‰“åŒ…åˆ†é…ç»™å‘½åç©ºé—´çš„è¿”å›å€¼ã€‚è¿™è®©å‘½åç©ºé—´å®šä¹‰å˜å¾—æ›´çµæ´»å¹¶ä¸”è®©æ‹¥æœ‰å¤šä¸ªå­˜åœ¨äºç‹¬ç«‹å‘½åç©ºé—´ä¸­ï¼ˆæˆ–è€…ç”šè‡³åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼‰çš„æ¨¡å—çš„ç‹¬ç«‹å®ä¾‹ã€‚åŠ¨æ€å‘½åç©ºé—´æ”¯æŒæ¨¡å—æ¨¡å¼çš„å…¨éƒ¨ç‰¹å¾å¹¶é™„åŠ ç›´è§‚å’Œå¯è¯»æ€§å¼ºçš„ä¼˜åŠ¿ã€‚</p>
<h3 id="4-æä¾›å‘½åç©ºé—´å‚æ•°"><a href="#4-æä¾›å‘½åç©ºé—´å‚æ•°" class="headerlink" title="4.æä¾›å‘½åç©ºé—´å‚æ•°"></a>4.æä¾›å‘½åç©ºé—´å‚æ•°</h3><p>åœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯å°†å‘½åç©ºé—´ä½œä¸ºå‚æ•°ä¼ ç»™è‡ªè°ƒç”¨æ–¹æ³•ã€‚å˜é‡<code>id</code>æ˜¯ç§æœ‰çš„ï¼Œå› ä¸ºä»–å¹¶æ²¡æœ‰è¢«åˆ†é…ç»™<code>context</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;;</span><br><span class="line">(function(context) &#123; </span><br><span class="line">    var id = 0;</span><br><span class="line">    context.next = function() &#123;</span><br><span class="line">        return id++;    </span><br><span class="line">    &#125;;</span><br><span class="line">    context.reset = function() &#123;</span><br><span class="line">        id = 0;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(myApp);  </span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.reset(),</span><br><span class="line">    myApp.next()</span><br><span class="line">) //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç”šè‡³å¯ä»¥æŠŠ<code>context</code>è®¾ç½®ç»™å…¨å±€å¯¹è±¡ï¼ˆé€šè¿‡ä¸€ä¸ªå­—çš„æ”¹å˜ï¼ï¼‰ã€‚è¿™æ˜¯åº“ä¸»ä»¬çš„å·¨å¤§è´¢å¯Œ - ä»–ä»¬å¯ä»¥å°†ä»–ä»¬çš„ç‰¹æ€§åŒ…è£…åœ¨ä¸€ä¸ªè‡ªè°ƒç”¨å‡½æ•°ä¸­ï¼Œç„¶åè®©ç”¨æˆ·æ¥å†³å®šå®ƒä»¬æ˜¯ä¸æ˜¯å…¨å±€çš„ï¼ˆJohn Resig åœ¨ä»–å†™ JQuery æ—¶å°±æ˜¯ä¸€ä¸ªè¿™ä¸ªç†è®ºçš„æ—©æœŸé‡‡ç”¨è€…ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;;</span><br><span class="line">(function(context) &#123; </span><br><span class="line">    var id = 0;</span><br><span class="line">    context.next = function() &#123;</span><br><span class="line">        return id++;    </span><br><span class="line">    &#125;;</span><br><span class="line">    context.reset = function() &#123;</span><br><span class="line">        id = 0;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(this);   </span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    next(),</span><br><span class="line">    next(),</span><br><span class="line">    reset(),</span><br><span class="line">    next()</span><br><span class="line">) //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<h3 id="5-ç”¨thisä½œä¸ºå‘½åç©ºé—´ä»£ç†"><a href="#5-ç”¨thisä½œä¸ºå‘½åç©ºé—´ä»£ç†" class="headerlink" title="5.ç”¨thisä½œä¸ºå‘½åç©ºé—´ä»£ç†"></a>5.ç”¨<code>this</code>ä½œä¸ºå‘½åç©ºé—´ä»£ç†</h3><p><a href="http://www.brothercake.com/" target="_blank" rel="external">James Edwads</a> æœ€è¿‘å‘å¸ƒçš„ä¸€ç¯‡æ–‡ç« æ¿€èµ·äº†æˆ‘çš„å…´è¶£ã€‚<a href="http://blogs.sitepoint.com/2010/11/30/my-favorite-javascript-design-pattern/" target="_blank" rel="external">ã€ŠMy Favorite JavaScript Design Patterã€‹</a> æ˜¾ç„¶è¢«å¾ˆå¤šè¯„è®ºè€…è¯¯è§£äº†ï¼Œä»–ä»¬è®¤ä¸ºä»–å¯èƒ½ä¹Ÿæ˜¯å€ŸåŠ©äºæ¨¡å—æ¨¡å¼ã€‚è¿™ç¯‡æ–‡ç« å®£ä¼ äº†å¤šç§æŠ€æœ¯ï¼ˆå¯èƒ½å¯¼è‡´äº†è¯»è€…çš„è¿·æƒ‘ï¼‰ï¼Œä½†æ˜¯åœ¨å®ƒçš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ä¸€ç‚¹æˆ‘å·²ç»ä¿®æ”¹å¹¶å‘ˆç°ä¸ºä¸€ä¸ªå‘½åç©ºé—´å·¥å…·çš„å¾ˆå¤©æ‰çš„ä¸œè¥¿ã€‚</p>
<p>è¿™ä¸ªæ¨¡å¼çš„ç¾å°±åœ¨äºå®ƒä»…ä»…æ˜¯æŒ‰ç…§è¿™ä¸ªè¯­è¨€è¢«è®¾è®¡çš„æ–¹å¼ä½¿ç”¨ - ä¸å¤šä¸å°‘ã€ä¸æŠ•æœºä¹Ÿä¸å–å·§ã€‚æ­¤å¤–å› ä¸ºå‘½åç©ºé—´æ˜¯é€šè¿‡<code>this</code>å…³é”®å­—ï¼ˆå®ƒåœ¨ç»™å®šçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ˜¯ä¸å˜çš„ï¼‰æ³¨å…¥çš„ï¼Œå®ƒä¸å¯èƒ½è¢«æ„å¤–ä¿®æ”¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var myApp = &#123;&#125;;</span><br><span class="line">(function() &#123;</span><br><span class="line">    var id = 0;</span><br><span class="line"> </span><br><span class="line">    this.next = function() &#123;</span><br><span class="line">        return id++;    </span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    this.reset = function() &#123;</span><br><span class="line">        id = 0;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;).apply(myApp);    </span><br><span class="line"> </span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.next(),</span><br><span class="line">    myApp.reset(),</span><br><span class="line">    myApp.next()</span><br><span class="line">); //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<p>æ›´æ£’çš„æ˜¯ï¼Œ<code>apply</code>ï¼ˆä»¥åŠ<code>call</code>ï¼‰ API æä¾›äº†ä¸ä¸Šä¸‹æ–‡å’Œå‚æ•°å¤©ç„¶çš„éš”ç¦» - å› æ­¤ç»™æ¨¡å—åˆ›å»ºè€…ä¼ é€’é™„åŠ å‚æ•°éå¸¸å¹²å‡€ã€‚ä¸‹é¢çš„ä¾‹å­è¡¨æ˜äº†è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”å±•ç¤ºäº†å¦‚ä½•ç‹¬ç«‹äºå¤šä¸ªå‘½åç©ºé—´æ¥è¿è¡Œæ¨¡å—ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var subsys1 = &#123;&#125;, subsys2 = &#123;&#125;;</span><br><span class="line">var nextIdMod = function(startId) &#123;</span><br><span class="line">    var id = startId || 0;</span><br><span class="line">    this.next = function() &#123;</span><br><span class="line">        return id++;    </span><br><span class="line">    &#125;;</span><br><span class="line">    this.reset = function() &#123;</span><br><span class="line">        id = 0;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">nextIdMod.call(subsys1);    </span><br><span class="line">nextIdMod.call(subsys2,1000);   </span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    subsys1.next(),</span><br><span class="line">    subsys1.next(),</span><br><span class="line">    subsys2.next(),</span><br><span class="line">    subsys1.reset(),</span><br><span class="line">    subsys2.next(),</span><br><span class="line">    subsys1.next()</span><br><span class="line">) //0, 1, 1000, undefined, 1001, 0</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶å¦‚æœæˆ‘ä»¬å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨å±€ id ç”Ÿæˆå™¨ï¼Œéå¸¸ç®€å•â€¦â€¦</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nextIdMod();    </span><br><span class="line">window.console &amp;&amp; console.log(</span><br><span class="line">    next(),</span><br><span class="line">    next(),</span><br><span class="line">    reset(),</span><br><span class="line">    next()</span><br><span class="line">) //0, 1, undefined, 0</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæˆ‘ä»¬ä½œä¸ºä¾‹å­ä½¿ç”¨çš„ id ç”Ÿæˆå™¨å·¥å…·å¹¶æ²¡æœ‰è¡¨ç°å‡ºè¿™ä¸ªæ¨¡å¼çš„å…¨éƒ¨æ½œåŠ›ã€‚é€šè¿‡åŒ…è£¹ä¸€æ•´ä¸ªåº“å’Œä½¿ç”¨<code>this</code>å…³é”®å­—ä½œä¸ºå‘½åç©ºé—´çš„æ›¿èº«ï¼Œæˆ‘ä»¬ä½¿å¾—ç”¨æˆ·åœ¨ä»»ä½•ä»–ä»¬é€‰æ‹©çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œè¿™ä¸ªåº“å¾ˆè½»æ¾ï¼ˆåŒ…æ‹¬å…¨å±€ä¸Šä¸‹æ–‡ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//library code</span><br><span class="line">var protoQueryMooJo = function() &#123;  </span><br><span class="line">    //everything</span><br><span class="line">&#125;</span><br><span class="line">//user code</span><br><span class="line">var thirdParty = &#123;&#125;;</span><br><span class="line">protoQueryMooJo.apply(thirdParty);</span><br></pre></td></tr></table></figure>
<h2 id="å…¶ä»–çš„è€ƒè™‘"><a href="#å…¶ä»–çš„è€ƒè™‘" class="headerlink" title="å…¶ä»–çš„è€ƒè™‘"></a>å…¶ä»–çš„è€ƒè™‘</h2><p>æˆ‘å¸Œæœ›é¿å…å‘½åç©ºé—´åµŒå¥—ã€‚å®ƒä»¬å¾ˆéš¾è¿½è¸ªï¼ˆå¯¹äººå’Œç”µè„‘éƒ½æ˜¯ï¼‰å¹¶ä¸”å®ƒä»¬ä¼šè®©ä½ çš„ä»£ç å› ä¸ºä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿å˜å¾—å¾ˆå¤šã€‚å¦‚ <a href="http://michaux.ca/articles/javascript-namespacing" target="_blank" rel="external">Peter Michaux</a> æŒ‡å‡ºçš„ï¼Œæ·±åº¦åµŒå¥—çš„å‘½åç©ºé—´å¯èƒ½æ˜¯é‚£äº›è§†å›¾é‡æ–°åˆ›å»ºä»–ä»¬ç†Ÿæ‚‰å’Œçƒ­çˆ±çš„é•¿åŒ…é“¾çš„è€æ´¾ Java å¼€å‘è€…çš„é—äº§ã€‚</p>
<p>é€šè¿‡ .js æ–‡ä»¶æ¥å›ºå®šä¸€ä¸ªå•ç‹¬çš„å‘½åç©ºé—´ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆè™½ç„¶åªèƒ½é€šè¿‡å‘½åç©ºé—´æ³¨å…¥æˆ–è€…ç›´æ¥åˆ†é…æ¯ä¸€ä¸ªå˜é‡ï¼‰ï¼Œä¸è¿‡ä½ åº”è¯¥å¯¹ä¾èµ–è°¨æ…äº›ã€‚æ­¤å¤–å°†å‘½åç©ºé—´ç»‘å®šåˆ°æ–‡ä»¶ä¸Šå¯ä»¥å¸®åŠ©è¯»è€…æ›´è½»æ˜“å¼„æ¸…æ•´ä¸ªä»£ç ã€‚</p>
<p>å› ä¸º JavaScript å¹¶æ²¡æœ‰æ­£å¼çš„å‘½åç©ºé—´ç»“æ„ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šè‡ªç„¶å½¢æˆçš„æ–¹æ³•ã€‚è¿™ä¸ªè°ƒæŸ¥åªè¯¦ç»†è¯´æ˜äº†å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½æœ‰æ›´å¥½çš„æŠ€æœ¯æˆ‘æ²¡æœ‰å‘ç°ã€‚æˆ‘å¾ˆä¹æ„çŸ¥é“å®ƒä»¬ã€‚</p>
<h2 id="æ›´å¤šæ–‡ç« "><a href="#æ›´å¤šæ–‡ç« " class="headerlink" title="æ›´å¤šæ–‡ç« "></a>æ›´å¤šæ–‡ç« </h2><p>James Edwardsï¼š <a href="http://blogs.sitepoint.com/2010/11/30/my-favorite-javascript-design-pattern/" target="_blank" rel="external">My Favorite JavaScript Design Pattern</a><br>Peter Michaux: <a href="http://michaux.ca/articles/javascript-namespacing" target="_blank" rel="external">JavaScript Namespacing</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š &lt;a href=&quot;https://javascriptweblog.wordpress.com/2010/12/07/namespacing-in-javascript/&quot;&gt;Namespacing in JavaScript&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;JavaScript-ä¸­çš„å‘½åç©ºé—´&quot;&gt;&lt;a href=&quot;#JavaScript-ä¸­çš„å‘½åç©ºé—´&quot; class=&quot;headerlink&quot; title=&quot;JavaScript ä¸­çš„å‘½åç©ºé—´&quot;&gt;&lt;/a&gt;JavaScript ä¸­çš„å‘½åç©ºé—´&lt;/h1&gt;&lt;p&gt;å…¨å±€å˜é‡åº”è¯¥ç”±æœ‰ç³»ç»ŸèŒƒå›´ç›¸å…³æ€§çš„å¯¹è±¡ä»¬ä¿ç•™ï¼Œå¹¶ä¸”å®ƒä»¬çš„å‘½ååº”è¯¥é¿å…å«ç³Šå¹¶å°½é‡å‡å°‘å‘½åå†²çªçš„é£é™©ã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥é¿å…åˆ›å»ºå…¨å±€å¯¹è±¡ï¼Œé™¤éå®ƒä»¬æ˜¯ç»å¯¹å¿…é¡»çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼Œæ©ï¼Œè¿™äº›ä½ æ—©éƒ½çŸ¥é“äº†â€¦â€¦&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ä½ å¯¹æ­¤æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä¼ ç»Ÿæ–¹æ³•å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ€å¥½çš„æ¶ˆé™¤å…¨å±€ç­–ç•¥æ˜¯åˆ›å»ºå°‘æ•°ä½œä¸ºæ½œåœ¨æ¨¡å—å’Œå­ç³»ç»Ÿçš„å®é™…å‘½åç©ºé—´çš„å…¨å±€å¯¹è±¡ã€‚æˆ‘å°†æ¢ç´¢å‡ ç§æœ‰å…³å‘½åç©ºé—´çš„æ–¹å¼ï¼Œå¹¶ä»¥æˆ‘åŸºäº &lt;a href=&quot;http://www.brothercake.com/&quot;&gt;James Edwards&lt;/a&gt; æœ€è¿‘çš„ä¸€ç¯‡æ–‡ç« å¾—åˆ°çš„ä¸€ä¸ªä¼˜é›…ã€å®‰å…¨å’Œçµæ´»çš„è§£å†³æ–¹æ¡ˆç»“æŸã€‚&lt;br&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://chengkang.me/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://chengkang.me/tags/JavaScript/"/>
    
      <category term="Namespacing" scheme="http://chengkang.me/tags/Namespacing/"/>
    
      <category term="Namespace" scheme="http://chengkang.me/tags/Namespace/"/>
    
  </entry>
  
</feed>
